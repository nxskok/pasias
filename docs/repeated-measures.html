<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 33 Repeated measures | Problems and Solutions in Applied Statistics</title>
  <meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 33 Repeated measures | Problems and Solutions in Applied Statistics" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
  <meta name="github-repo" content="nxskok/pasias" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 33 Repeated measures | Problems and Solutions in Applied Statistics" />
  
  <meta name="twitter:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
  

<meta name="author" content="Ken Butler" />


<meta name="date" content="2022-12-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="multivariate-analysis-of-variance.html"/>
<link rel="next" href="discriminant-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Problems and Solutions in Applied Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#packages-used-somewhere-in-this-book"><i class="fa fa-check"></i>Packages used somewhere in this book</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html"><i class="fa fa-check"></i><b>1</b> Getting used to R and R Studio</a></li>
<li class="chapter" data-level="2" data-path="reading-in-data.html"><a href="reading-in-data.html"><i class="fa fa-check"></i><b>2</b> Reading in data</a></li>
<li class="chapter" data-level="3" data-path="drawing-graphs.html"><a href="drawing-graphs.html"><i class="fa fa-check"></i><b>3</b> Drawing graphs</a></li>
<li class="chapter" data-level="4" data-path="data-exploration.html"><a href="data-exploration.html"><i class="fa fa-check"></i><b>4</b> Data exploration</a></li>
<li class="chapter" data-level="5" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html"><i class="fa fa-check"></i><b>5</b> Working with dataframes</a></li>
<li class="chapter" data-level="6" data-path="one-sample-inference.html"><a href="one-sample-inference.html"><i class="fa fa-check"></i><b>6</b> One-sample inference</a></li>
<li class="chapter" data-level="7" data-path="two-sample-inference.html"><a href="two-sample-inference.html"><i class="fa fa-check"></i><b>7</b> Two-sample inference</a></li>
<li class="chapter" data-level="8" data-path="power-and-sample-size.html"><a href="power-and-sample-size.html"><i class="fa fa-check"></i><b>8</b> Power and sample size</a></li>
<li class="chapter" data-level="9" data-path="the-sign-test.html"><a href="the-sign-test.html"><i class="fa fa-check"></i><b>9</b> The sign test</a></li>
<li class="chapter" data-level="10" data-path="mood-median-test.html"><a href="mood-median-test.html"><i class="fa fa-check"></i><b>10</b> Mood median test</a></li>
<li class="chapter" data-level="11" data-path="matched-pairs-t-and-sign-test.html"><a href="matched-pairs-t-and-sign-test.html"><i class="fa fa-check"></i><b>11</b> Matched pairs t and sign test</a></li>
<li class="chapter" data-level="12" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html"><i class="fa fa-check"></i><b>12</b> Normal quantile plots</a>
<ul>
<li class="chapter" data-level="12.1" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers"><i class="fa fa-check"></i><b>12.1</b> Lengths of heliconia flowers</a></li>
<li class="chapter" data-level="12.2" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#ferritin-and-normality"><i class="fa fa-check"></i><b>12.2</b> Ferritin and normality</a></li>
<li class="chapter" data-level="12.3" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers-1"><i class="fa fa-check"></i><b>12.3</b> Lengths of heliconia flowers</a></li>
<li class="chapter" data-level="12.4" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#ferritin-and-normality-1"><i class="fa fa-check"></i><b>12.4</b> Ferritin and normality</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="analysis-of-variance.html"><a href="analysis-of-variance.html"><i class="fa fa-check"></i><b>13</b> Analysis of variance</a></li>
<li class="chapter" data-level="14" data-path="writing-reports.html"><a href="writing-reports.html"><i class="fa fa-check"></i><b>14</b> Writing reports</a></li>
<li class="chapter" data-level="15" data-path="learning-to-code.html"><a href="learning-to-code.html"><i class="fa fa-check"></i><b>15</b> Learning to code</a>
<ul>
<li class="chapter" data-level="15.1" data-path="learning-to-code.html"><a href="learning-to-code.html#introduction-1"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="learning-to-code.html"><a href="learning-to-code.html#data-and-pre-processing"><i class="fa fa-check"></i><b>15.2</b> Data and pre-processing</a></li>
<li class="chapter" data-level="15.3" data-path="learning-to-code.html"><a href="learning-to-code.html#analysis"><i class="fa fa-check"></i><b>15.3</b> Analysis</a></li>
<li class="chapter" data-level="15.4" data-path="learning-to-code.html"><a href="learning-to-code.html#conclusions-see-note-9"><i class="fa fa-check"></i><b>15.4</b> Conclusions (see note 9)</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="treating-dandruff.html"><a href="treating-dandruff.html"><i class="fa fa-check"></i><b>16</b> Treating dandruff</a>
<ul>
<li class="chapter" data-level="16.1" data-path="treating-dandruff.html"><a href="treating-dandruff.html#introduction-2"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="treating-dandruff.html"><a href="treating-dandruff.html#exploratory-analysis"><i class="fa fa-check"></i><b>16.2</b> Exploratory analysis</a></li>
<li class="chapter" data-level="16.3" data-path="treating-dandruff.html"><a href="treating-dandruff.html#analysis-of-variance-1"><i class="fa fa-check"></i><b>16.3</b> Analysis of Variance</a></li>
<li class="chapter" data-level="16.4" data-path="treating-dandruff.html"><a href="treating-dandruff.html#assessment-of-assumptions"><i class="fa fa-check"></i><b>16.4</b> Assessment of Assumptions</a></li>
<li class="chapter" data-level="16.5" data-path="treating-dandruff.html"><a href="treating-dandruff.html#conclusions"><i class="fa fa-check"></i><b>16.5</b> Conclusions</a></li>
<li class="chapter" data-level="16.6" data-path="treating-dandruff.html"><a href="treating-dandruff.html#end"><i class="fa fa-check"></i><b>16.6</b> End</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="tidying-data.html"><a href="tidying-data.html"><i class="fa fa-check"></i><b>17</b> Tidying data</a></li>
<li class="chapter" data-level="18" data-path="simple-regression.html"><a href="simple-regression.html"><i class="fa fa-check"></i><b>18</b> Simple regression</a></li>
<li class="chapter" data-level="19" data-path="multiple-regression.html"><a href="multiple-regression.html"><i class="fa fa-check"></i><b>19</b> Multiple regression</a></li>
<li class="chapter" data-level="20" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html"><i class="fa fa-check"></i><b>20</b> Regression with categorical variables</a>
<ul>
<li class="chapter" data-level="20.1" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#crickets-revisited"><i class="fa fa-check"></i><b>20.1</b> Crickets revisited</a></li>
<li class="chapter" data-level="20.2" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#pulse-rates-and-marching"><i class="fa fa-check"></i><b>20.2</b> Pulse rates and marching</a></li>
<li class="chapter" data-level="20.3" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#crickets-revisited-1"><i class="fa fa-check"></i><b>20.3</b> Crickets revisited</a></li>
<li class="chapter" data-level="20.4" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#pulse-rates-and-marching-1"><i class="fa fa-check"></i><b>20.4</b> Pulse rates and marching</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>21</b> Dates and times</a></li>
<li class="chapter" data-level="22" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>22</b> Functions</a></li>
<li class="chapter" data-level="23" data-path="vector-and-matrix-algebra.html"><a href="vector-and-matrix-algebra.html"><i class="fa fa-check"></i><b>23</b> Vector and matrix algebra</a>
<ul>
<li class="chapter" data-level="23.1" data-path="vector-and-matrix-algebra.html"><a href="vector-and-matrix-algebra.html#heights-and-foot-lengths-again"><i class="fa fa-check"></i><b>23.1</b> Heights and foot lengths again</a></li>
<li class="chapter" data-level="23.2" data-path="vector-and-matrix-algebra.html"><a href="vector-and-matrix-algebra.html#heights-and-foot-lengths-again-1"><i class="fa fa-check"></i><b>23.2</b> Heights and foot lengths again</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="the-bootstrap.html"><a href="the-bootstrap.html"><i class="fa fa-check"></i><b>24</b> The Bootstrap</a></li>
<li class="chapter" data-level="25" data-path="bayesian-statistics-with-stan.html"><a href="bayesian-statistics-with-stan.html"><i class="fa fa-check"></i><b>25</b> Bayesian Statistics with Stan</a></li>
<li class="chapter" data-level="26" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>26</b> Logistic regression</a></li>
<li class="chapter" data-level="27" data-path="logistic-regression-with-ordinal-response.html"><a href="logistic-regression-with-ordinal-response.html"><i class="fa fa-check"></i><b>27</b> Logistic regression with ordinal response</a></li>
<li class="chapter" data-level="28" data-path="logistic-regression-with-nominal-response.html"><a href="logistic-regression-with-nominal-response.html"><i class="fa fa-check"></i><b>28</b> Logistic regression with nominal response</a></li>
<li class="chapter" data-level="29" data-path="survival-analysis.html"><a href="survival-analysis.html"><i class="fa fa-check"></i><b>29</b> Survival analysis</a></li>
<li class="chapter" data-level="30" data-path="analysis-of-variance-revisited.html"><a href="analysis-of-variance-revisited.html"><i class="fa fa-check"></i><b>30</b> Analysis of variance revisited</a></li>
<li class="chapter" data-level="31" data-path="analysis-of-covariance.html"><a href="analysis-of-covariance.html"><i class="fa fa-check"></i><b>31</b> Analysis of covariance</a></li>
<li class="chapter" data-level="32" data-path="multivariate-analysis-of-variance.html"><a href="multivariate-analysis-of-variance.html"><i class="fa fa-check"></i><b>32</b> Multivariate analysis of variance</a></li>
<li class="chapter" data-level="33" data-path="repeated-measures.html"><a href="repeated-measures.html"><i class="fa fa-check"></i><b>33</b> Repeated measures</a>
<ul>
<li class="chapter" data-level="33.1" data-path="repeated-measures.html"><a href="repeated-measures.html#effect-of-drug-on-rat-weight"><i class="fa fa-check"></i><b>33.1</b> Effect of drug on rat weight</a></li>
<li class="chapter" data-level="33.2" data-path="repeated-measures.html"><a href="repeated-measures.html#social-interaction-among-old-people"><i class="fa fa-check"></i><b>33.2</b> Social interaction among old people</a></li>
<li class="chapter" data-level="33.3" data-path="repeated-measures.html"><a href="repeated-measures.html#childrens-stress-levels-and-airports"><i class="fa fa-check"></i><b>33.3</b> Children’s stress levels and airports</a></li>
<li class="chapter" data-level="33.4" data-path="repeated-measures.html"><a href="repeated-measures.html#body-fat-as-repeated-measures"><i class="fa fa-check"></i><b>33.4</b> Body fat as repeated measures</a></li>
<li class="chapter" data-level="33.5" data-path="repeated-measures.html"><a href="repeated-measures.html#investigating-motor-activity-in-rats"><i class="fa fa-check"></i><b>33.5</b> Investigating motor activity in rats</a></li>
<li class="chapter" data-level="33.6" data-path="repeated-measures.html"><a href="repeated-measures.html#repeated-measures-with-no-background"><i class="fa fa-check"></i><b>33.6</b> Repeated measures with no background</a></li>
<li class="chapter" data-level="33.7" data-path="repeated-measures.html"><a href="repeated-measures.html#effect-of-drug-on-rat-weight-1"><i class="fa fa-check"></i><b>33.7</b> Effect of drug on rat weight</a></li>
<li class="chapter" data-level="33.8" data-path="repeated-measures.html"><a href="repeated-measures.html#social-interaction-among-old-people-1"><i class="fa fa-check"></i><b>33.8</b> Social interaction among old people</a></li>
<li class="chapter" data-level="33.9" data-path="repeated-measures.html"><a href="repeated-measures.html#childrens-stress-levels-and-airports-1"><i class="fa fa-check"></i><b>33.9</b> Children’s stress levels and airports</a></li>
<li class="chapter" data-level="33.10" data-path="repeated-measures.html"><a href="repeated-measures.html#body-fat-as-repeated-measures-1"><i class="fa fa-check"></i><b>33.10</b> Body fat as repeated measures</a></li>
<li class="chapter" data-level="33.11" data-path="repeated-measures.html"><a href="repeated-measures.html#investigating-motor-activity-in-rats-1"><i class="fa fa-check"></i><b>33.11</b> Investigating motor activity in rats</a></li>
<li class="chapter" data-level="33.12" data-path="repeated-measures.html"><a href="repeated-measures.html#repeated-measures-with-no-background-1"><i class="fa fa-check"></i><b>33.12</b> Repeated measures with no background</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html"><i class="fa fa-check"></i><b>34</b> Discriminant analysis</a></li>
<li class="chapter" data-level="35" data-path="hierarchical-cluster-analysis.html"><a href="hierarchical-cluster-analysis.html"><i class="fa fa-check"></i><b>35</b> Hierarchical cluster analysis</a></li>
<li class="chapter" data-level="36" data-path="k-means-cluster-analysis.html"><a href="k-means-cluster-analysis.html"><i class="fa fa-check"></i><b>36</b> K-means cluster analysis</a></li>
<li class="chapter" data-level="37" data-path="drawing-maps-with-leaflet.html"><a href="drawing-maps-with-leaflet.html"><i class="fa fa-check"></i><b>37</b> Drawing maps with Leaflet</a></li>
<li class="chapter" data-level="38" data-path="multidimensional-scaling.html"><a href="multidimensional-scaling.html"><i class="fa fa-check"></i><b>38</b> Multidimensional Scaling</a></li>
<li class="chapter" data-level="39" data-path="principal-components.html"><a href="principal-components.html"><i class="fa fa-check"></i><b>39</b> Principal Components</a>
<ul>
<li class="chapter" data-level="39.1" data-path="principal-components.html"><a href="principal-components.html#the-weather-somewhere"><i class="fa fa-check"></i><b>39.1</b> The weather, somewhere</a></li>
<li class="chapter" data-level="39.2" data-path="principal-components.html"><a href="principal-components.html#the-weather-somewhere-1"><i class="fa fa-check"></i><b>39.2</b> The weather, somewhere</a></li>
</ul></li>
<li class="chapter" data-level="40" data-path="factor-analysis.html"><a href="factor-analysis.html"><i class="fa fa-check"></i><b>40</b> Factor Analysis</a></li>
<li class="chapter" data-level="41" data-path="frequency-table-analysis.html"><a href="frequency-table-analysis.html"><i class="fa fa-check"></i><b>41</b> Frequency table analysis</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Problems and Solutions in Applied Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="repeated-measures" class="section level1 hasAnchor" number="33">
<h1><span class="header-section-number">Chapter 33</span> Repeated measures<a href="repeated-measures.html#repeated-measures" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Packages for this chapter:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="repeated-measures.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb209-2"><a href="repeated-measures.html#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb209-3"><a href="repeated-measures.html#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="effect-of-drug-on-rat-weight" class="section level2 hasAnchor" number="33.1">
<h2><span class="header-section-number">33.1</span> Effect of drug on rat weight<a href="repeated-measures.html#effect-of-drug-on-rat-weight" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Box (1950) gives data on the weights of three groups of
rats. One group was given thyroxin in their drinking water, one group
thiouracil, and the third group was a control. (This description comes
from Christensen (2001).)<a href="#fn36" class="footnote-ref" id="fnref36"><sup>36</sup></a>
Weights are measured in
grams at weekly intervals (over a 4-week period, so that each rat is
measured 5 times). The data are in
<a href="http://ritsokiguess.site/datafiles/ratweight.csv">link</a> as a
<code>.csv</code> file.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read in the data and check that you have a column of
<code>drug</code> and five columns of rat weights at different times.</p></li>
<li><p>Why would it be <em>wrong</em> to use something like
<code>pivot_longer</code> to create one column of weights, and separate
columns of drug and time, and then to run a two-way ANOVA? Explain briefly.</p></li>
<li><p>Create a suitable response variable and fit a suitable
<code>lm</code> as the first step of the repeated-measures analysis.</p></li>
<li><p>Load the package <code>car</code> and run a suitable
<code>Manova</code>. To do this, you will need to set up the right thing
for <code>idata</code> and <code>idesign</code>.</p></li>
<li><p>Take a look at the output from the MANOVA. Is there a
significant interaction? What does its significance (or lack
thereof) mean?</p></li>
<li><p>We are going to draw an interaction plot in a moment. To
set that up, use <code>pivot_longer</code> as in the lecture notes to create
one column of weights and a second column of times. (You don’t
need to do the <code>separate</code> thing that I did in class, though
if you want to try it, go ahead.)</p></li>
<li><p>Obtain an interaction plot. Putting <code>time</code> as the
<code>x</code> will put time along the horizontal axis, which is the
way we’re used to seeing such things. Begin by calculating the mean
<code>weight</code> for each <code>time</code>-<code>drug</code> combination.</p></li>
<li><p>How does this plot show why the interaction was
significant? Explain briefly.</p></li>
</ol>
</div>
<div id="social-interaction-among-old-people" class="section level2 hasAnchor" number="33.2">
<h2><span class="header-section-number">33.2</span> Social interaction among old people<a href="repeated-measures.html#social-interaction-among-old-people" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A graduate student wrote a thesis comparing different
treatments for increasing social interaction among geriatric
patients. He recruited 21 patients at a state mental hospital and
randomly assigned them to treatments: Reality Orientation
(<code>ro</code>), Behavior Therapy (<code>bt</code>) or no treatment
(<code>ctrl</code>). Each subject was observed at four times, labelled
<code>t1</code> through <code>t4</code> in the data file
<a href="http://ritsokiguess.site/datafiles/geriatrics.txt">link</a>. The
response variable was the percentage of time that the subject was
“engaging in the relevant social interaction”, so that a higher
value is better.</p>
<p>The principal aim of the study was to see whether there were
differences among the treatments (one would hope that the real
treatments were better than the control one), and whether there were
any patterns over time.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read in the data and display at least some of it.</p></li>
<li><p>Create a response variable and fit a suitable <code>lm</code>
as the first stage of the repeated-measures analysis.</p></li>
<li><p>Run a suitable <code>Manova</code>. There is some setup
first. Make sure you do that.</p></li>
<li><p>Display the results of your repeated-measures
analysis. What do you conclude? Explain briefly.</p></li>
<li><p>To understand the results that you got from the repeated
measures analysis, you are going to draw a picture (or two). To do
<em>that</em>, we are going to need the data in “long” format with
one response value per line (instead of four). Use <code>pivot_longer</code>
suitably to get the data in that format, and demonstrate that you
have done so.</p></li>
<li><p>Calculate and save the mean interaction percents for each
time-treatment combination.</p></li>
<li><p>Make an interaction plot. Arrange things so that time goes
across the page. Use your data frame of means that you just calculated.</p></li>
<li><p>Describe what you see on your interaction plot, and what it
says about why your repeated-measures analysis came out as it did.</p></li>
<li><p>Draw a spaghetti plot of these data. That is, use
<code>ggplot</code> to plot the interaction percent against time for
each subject,
joining the points for the <em>same subject</em> by lines whose colour
shows what treatment they were on. Use the “long” data frame for
this (not the data frame of means).</p></li>
</ol>
</div>
<div id="childrens-stress-levels-and-airports" class="section level2 hasAnchor" number="33.3">
<h2><span class="header-section-number">33.3</span> Children’s stress levels and airports<a href="repeated-measures.html#childrens-stress-levels-and-airports" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If you did STAC32, you might remember this question, which
we can now do properly. Some of this question is a repeat from there.</p>
<p>The data in <a href="http://ritsokiguess.site/datafiles/airport.txt">link</a>
are based on a 1998 study of stress levels in children as a result of
the building of a new airport in Munich, Germany. A total of 200
children had their epinephrine levels (a stress indicator) measured at
each of four different times: before the airport was built, and 6, 18
and 36 months after it was built. The four measurements are labelled
<code>epi_1</code> through <code>epi_4</code>. Out of the children, 100
were living near the new airport (location 1 in the data set), and
could be expected to suffer stress because of the new airport. The
other 100 children lived in the same city, but outside the noise
impact zone. These children thus serve as a control group. The
children are identified with numbers 1 through 200.</p>
<ol style="list-style-type: lower-alpha">
<li><p>If we were testing for the effect of time, explain briefly
what it is about the structure of the data that would make an
analysis of variance <em>inappropriate</em>.</p></li>
<li><p>Read the data into R and demonstrate that you have the right
number of observations and variables.</p></li>
<li><p>Create and save a “longer” data frame with all the epinephrine
values collected together into one column.</p></li>
<li><p>Make a “spaghetti plot” of these data: that is, a plot of
epinephrine levels against time, with the locations identified by
colour, and the points for the same child joined by lines. To do
this: (i) from the long data frame, create a new column containing
only the numeric values of time (1 through 4), (ii) plot epinephrine
level against time with the points grouped by child and coloured by
location (which you may have to turn from a number into a factor.)</p></li>
<li><p>What do you see on your spaghetti plot? We are looking ahead
to possible effects of time, location and their interaction.</p></li>
<li><p>The spaghetti plot was hard to interpret because there are
so many children. Calculate the mean epinephrine levels for each
location-time combination, and make an interaction plot with time
on the <span class="math inline">\(x\)</span>-axis and location as the second factor.</p></li>
<li><p>What do you conclude from your interaction plot? Is your
conclusion clearer than from the spaghetti plot?</p></li>
<li><p>Run a repeated-measures analysis of variance and display the
results. Go back to your original data frame, the one you read in
from the file, for this. You’ll need to make sure your numeric
<code>location</code> gets treated as a <code>factor</code>.</p></li>
<li><p>What do you conclude from the MANOVA? Is that consistent
with your graphs? Explain briefly.</p></li>
</ol>
</div>
<div id="body-fat-as-repeated-measures" class="section level2 hasAnchor" number="33.4">
<h2><span class="header-section-number">33.4</span> Body fat as repeated measures<a href="repeated-measures.html#body-fat-as-repeated-measures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This one is also stolen from STAC32. Athletes are concerned
with measuring their body fat percentage. Two different methods are
available: one using ultrasound, and the other using X-ray
technology. We are interested in whether there is a difference in the
mean body fat percentage as measured by these two methods, and if so,
how big that difference is. Data on 16 athletes are at
<a href="http://ritsokiguess.site/datafiles/bodyfat.txt">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read in the data and check that you have a sensible number of
rows and columns.</p></li>
<li><p>Carry out a suitable (matched-pairs) <span class="math inline">\(t\)</span>-test to determine
whether the means are the same or different.</p></li>
<li><p>What do you conclude from the test?</p></li>
<li><p>Run a repeated-measures analysis of variance, treating the two
methods of measuring body fat as the repeated measures (ie., playing
the role of “time” that you have seen in most of the other repeated
measures analyses). There is no “treatment” here, so there is
nothing to go on the right side of the squiggle. Insert a <code>1</code>
there to mean “just an intercept”. Display the results.</p></li>
<li><p>Compare your repeated-measures analysis to your matched-pairs
one. Do you draw the same conclusions?</p></li>
</ol>
</div>
<div id="investigating-motor-activity-in-rats" class="section level2 hasAnchor" number="33.5">
<h2><span class="header-section-number">33.5</span> Investigating motor activity in rats<a href="repeated-measures.html#investigating-motor-activity-in-rats" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A researcher named King was investigating
the effect of the drug midazolam on motor activity in rats. Typically,
the first time the drug is injected, a rat’s motor activity decreases
substantially, but rats typically develop a “tolerance”, so that
further injections of the drug have less impact on the rat’s motor
activity.</p>
<p>The data shown in
<a href="http://ritsokiguess.site/datafiles/king.csv">link</a> were all taken
in one day, called the “experiment day” below. 24 different rats
were used. Each rat, on the experiment day, was injected with a fixed
amount of midazolam, and at each of six five-minute intervals after
being injected, the rat’s motor activity was measured (these are
labelled <code>i1</code> through <code>i6</code> in the data). The rats
differed in how they had been treated before the experiment day. The
control group of rats had previously been injected repeatedly with a
saline solution (no active ingredient), so the experiment day was the
first time this group of rats had received midazolam. The other two
groups of rats had both received midazolam repeatedly before the
experiment day: the “same” group was injected on experiment day in
the same environment that the previous injections had taken place (this
is known in psychology as a “conditioned tolerance”), but the
“different” group had the previous injections in a different
environment than on experiment day.</p>
<p>The column <code>id</code> identifies the rat from which each sequence of
values was obtained.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Explain briefly why we need to use a repeated measures
analysis for these data.</p></li>
<li><p>Read in the data and note that you have what was promised
in the question.</p></li>
<li><p>We are going to do a repeated-measures analysis using the
“profile” method shown in class. Create a suitable response
variable for this method.</p></li>
<li><p>Set up the “within-subjects” part of the analysis. That
means getting hold of the names of the columns that hold the
different times, saving them, and also making a data frame out of them:</p></li>
<li><p>Fit the repeated-measures ANOVA. This will involve fitting
an <code>lm</code> first, if you have not already done so.</p></li>
<li><p>What do you conclude from your repeated-measures ANOVA?
Explain briefly, in the context of the data.</p></li>
<li><p>To understand the results of the previous part, we are going
to make a spaghetti plot. In preparation for that, we need to save
the data in “long format” with one observation on <em>one</em> time
point in each row. Arrange that, and show by displaying (some of)
the data that you have done so.</p></li>
<li><p>Make a spaghetti plot: that is, plot motor activity against
the time points, joining the points for each <em>rat</em> by lines,
and colouring the points and lines according to the <em>context</em>.</p></li>
<li><p>Looking at your spaghetti plot, why do you think your
repeated-measures ANOVA came out as it did? Explain briefly.</p></li>
</ol>
</div>
<div id="repeated-measures-with-no-background" class="section level2 hasAnchor" number="33.6">
<h2><span class="header-section-number">33.6</span> Repeated measures with no background<a href="repeated-measures.html#repeated-measures-with-no-background" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Nine people are randomly chosen to receive one of three
treatments, labelled A, B and C. Each person has their response
<code>y</code> to the treatment measured at three times, labelled T1, T2
and T3. The main aim of the study is to properly assess the effects of
the treatments. A higher value of <code>y</code> is better.</p>
<p>The data are in <a href="http://ritsokiguess.site/datafiles/rm.txt">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li><p>There are <span class="math inline">\(9 \times 3=27\)</span> observations of <code>y</code> in
this study. Why would it be wrong to treat these as 27 independent
observations? Explain briefly.</p></li>
<li><p>Read in the data values. Are they tidy or untidy? Explain
briefly. (The data values are separated by <em>tabs</em>, like the
Australian athlete data.)</p></li>
<li><p>Make a spaghetti plot: that is, a plot of <code>y</code>
against time, with the observations for the same individual joined
by lines which are coloured according to the treatment that
individual received.</p></li>
<li><p>On your spaghetti plot, how do the values of <code>y</code> for
the treatments compare over time?</p></li>
<li><p>Explain briefly how the data are in the wrong format for a
repeated-measures ANOVA (done using MANOVA, as in class), and use
<code>pivot_wider</code> to get the data set into the right format.</p></li>
<li><p>Run a repeated-measures ANOVA the <code>Manova</code> way. What do you
conclude from it?</p></li>
<li><p>How is your conclusion from the previous part consistent
with your spaghetti plot? Explain briefly.</p></li>
</ol>
<p>My solutions follow:</p>
</div>
<div id="effect-of-drug-on-rat-weight-1" class="section level2 hasAnchor" number="33.7">
<h2><span class="header-section-number">33.7</span> Effect of drug on rat weight<a href="repeated-measures.html#effect-of-drug-on-rat-weight-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Box (1950) gives data on the weights of three groups of
rats.<a href="#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a> One group was given thyroxin in their drinking water, one group
thiouracil, and the third group was a control. (This description comes
from Christensen (2001).)<a href="#fn38" class="footnote-ref" id="fnref38"><sup>38</sup></a>
Weights are measured in
grams at weekly intervals (over a 4-week period, so that each rat is
measured 5 times). The data are in
<a href="http://ritsokiguess.site/datafiles/ratweight.csv">link</a> as a
<code>.csv</code> file.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data and check that you have a column of
<code>drug</code> and five columns of rat weights at different times.</li>
</ol>
<p>Solution</p>
<p>A <code>.csv</code> file, so <code>read_csv</code>. (I typed the data from
Christensen (2001) into a spreadsheet.)</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="repeated-measures.html#cb210-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">&quot;http://ritsokiguess.site/datafiles/ratweight.csv&quot;</span></span>
<span id="cb210-2"><a href="repeated-measures.html#cb210-2" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(my_url)</span></code></pre></div>
<pre><code>## Rows: 27 Columns: 7
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): drug
## dbl (6): rat, Time0, Time1, Time2, Time3, Time4
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="repeated-measures.html#cb212-1" aria-hidden="true" tabindex="-1"></a>weights</span></code></pre></div>
<pre><code>## # A tibble: 27 × 7
##      rat drug       Time0 Time1 Time2 Time3 Time4
##    &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1 thyroxin      59    85   121   156   191
##  2     2 thyroxin      54    71    90   110   138
##  3     3 thyroxin      56    75   108   151   189
##  4     4 thyroxin      59    85   116   148   177
##  5     5 thyroxin      57    72    97   120   144
##  6     6 thyroxin      52    73    97   116   140
##  7     7 thyroxin      52    70   105   138   171
##  8     8 thiouracil    61    86   109   120   129
##  9     9 thiouracil    59    80   101   111   122
## 10    10 thiouracil    53    79   100   106   133
## # … with 17 more rows</code></pre>
<p>There are 27 rats altogether, each measured five times (labelled time
0 through 4). The rats are also labelled <code>rat</code> (the first column), which will be useful later.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Why would it be <em>wrong</em> to use something like
<code>pivot_longer</code> to create one column of weights, and separate
columns of drug and time, and then to run a two-way ANOVA? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>Such a solution would assume that we have measurements on
<em>different</em> rats, one for each drug-time combination. But we
have sets of five measurements all on the <em>same</em> rat: that is
to say, we have repeated measures, and the proper analysis will
take that into account.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Create a suitable response variable and fit a suitable
<code>lm</code> as the first step of the repeated-measures analysis.</li>
</ol>
<p>Solution</p>
<p>The response variable is the same idea as for any MANOVA: just
glue the columns together:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="repeated-measures.html#cb214-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">with</span>(weights, <span class="fu">cbind</span>(Time0, Time1, Time2, Time3, Time4))</span>
<span id="cb214-2"><a href="repeated-measures.html#cb214-2" aria-hidden="true" tabindex="-1"></a>weights<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> drug, <span class="at">data =</span> weights)</span></code></pre></div>
<p>Now, we <em>don’t</em> look at <code>weights.1</code>, but we <em>do</em> use
it as input to <code>Manova</code> in a moment.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Load the package <code>car</code> and run a suitable
<code>Manova</code>. To do this, you will need to set up the right thing
for <code>idata</code> and <code>idesign</code>.</li>
</ol>
<p>Solution</p>
<p>Something like this:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="repeated-measures.html#cb215-1" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">colnames</span>(response)</span>
<span id="cb215-2"><a href="repeated-measures.html#cb215-2" aria-hidden="true" tabindex="-1"></a>times.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">times=</span><span class="fu">factor</span>(times))</span>
<span id="cb215-3"><a href="repeated-measures.html#cb215-3" aria-hidden="true" tabindex="-1"></a>weights<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">Manova</span>(weights<span class="fl">.1</span>, <span class="at">idata =</span> times.df, <span class="at">idesign =</span> <span class="sc">~</span>times)</span></code></pre></div>
<p>The thought process is that the columns of the response
(<code>Time.0</code> through <code>Time.4</code>) are all times. This is the
“within-subject design” part of it: within a rat, the different
response values are at different times. That’s the only part of it
that is within subjects. The different drugs are a
“between-subjects” factor: each rat only gets one of the
drugs.<a href="#fn39" class="footnote-ref" id="fnref39"><sup>39</sup></a></p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Take a look at all the output from the MANOVA. Is there a
significant interaction? What does its significance (or lack
thereof) mean?</li>
</ol>
<p>Solution</p>
<p>Look at the <code>summary</code>, which is rather long:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="repeated-measures.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weights<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests:
## 
## ------------------------------------------
##  
## Term: (Intercept) 
## 
##  Response transformation matrix:
##       (Intercept)
## Time0           1
## Time1           1
## Time2           1
## Time3           1
## Time4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)     6875579
## 
## Multivariate Tests: (Intercept)
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1   0.99257 3204.089      1     24 &lt; 2.22e-16 ***
## Wilks             1   0.00743 3204.089      1     24 &lt; 2.22e-16 ***
## Hotelling-Lawley  1 133.50372 3204.089      1     24 &lt; 2.22e-16 ***
## Roy               1 133.50372 3204.089      1     24 &lt; 2.22e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: drug 
## 
##  Response transformation matrix:
##       (Intercept)
## Time0           1
## Time1           1
## Time2           1
## Time3           1
## Time4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)    33193.27
## 
## Multivariate Tests: drug
##                  Df test stat approx F num Df den Df    Pr(&gt;F)   
## Pillai            2 0.3919186 7.734199      2     24 0.0025559 **
## Wilks             2 0.6080814 7.734199      2     24 0.0025559 **
## Hotelling-Lawley  2 0.6445166 7.734199      2     24 0.0025559 **
## Roy               2 0.6445166 7.734199      2     24 0.0025559 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: times 
## 
##  Response transformation matrix:
##       times1 times2 times3 times4
## Time0      1      0      0      0
## Time1      0      1      0      0
## Time2      0      0      1      0
## Time3      0      0      0      1
## Time4     -1     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##           times1 times2    times3   times4
## times1 235200.00 178920 116106.67 62906.67
## times2 178920.00 136107  88324.00 47854.00
## times3 116106.67  88324  57316.15 31053.93
## times4  62906.67  47854  31053.93 16825.04
## 
## Multivariate Tests: times
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1   0.98265 297.3643      4     21 &lt; 2.22e-16 ***
## Wilks             1   0.01735 297.3643      4     21 &lt; 2.22e-16 ***
## Hotelling-Lawley  1  56.64082 297.3643      4     21 &lt; 2.22e-16 ***
## Roy               1  56.64082 297.3643      4     21 &lt; 2.22e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: drug:times 
## 
##  Response transformation matrix:
##       times1 times2 times3 times4
## Time0      1      0      0      0
## Time1      0      1      0      0
## Time2      0      0      1      0
## Time3      0      0      0      1
## Time4     -1     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##          times1   times2   times3   times4
## times1 9192.071 8948.843 6864.676 3494.448
## times2 8948.843 8787.286 6740.286 3381.529
## times3 6864.676 6740.286 5170.138 2594.103
## times4 3494.448 3381.529 2594.103 1334.006
## 
## Multivariate Tests: drug:times
##                  Df test stat  approx F num Df den Df     Pr(&gt;F)    
## Pillai            2 0.8779119  4.303151      8     44 0.00069308 ***
## Wilks             2 0.2654858  4.939166      8     42 0.00023947 ***
## Hotelling-Lawley  2 2.2265461  5.566365      8     40 9.3465e-05 ***
## Roy               2 1.9494810 10.722146      4     22 5.6277e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Univariate Type II Repeated-Measures ANOVA Assuming Sphericity
## 
##              Sum Sq num Df Error SS den Df   F value    Pr(&gt;F)    
## (Intercept) 1375116      1  10300.2     24 3204.0892 &lt; 2.2e-16 ***
## drug           6639      2  10300.2     24    7.7342  0.002556 ** 
## times        146292      4   4940.7     96  710.6306 &lt; 2.2e-16 ***
## drug:times     6777      8   4940.7     96   16.4606 4.185e-15 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Mauchly Tests for Sphericity
## 
##            Test statistic   p-value
## times           0.0072565 1.781e-19
## drug:times      0.0072565 1.781e-19
## 
## 
## Greenhouse-Geisser and Huynh-Feldt Corrections
##  for Departure from Sphericity
## 
##             GG eps Pr(&gt;F[GG])    
## times      0.33165  &lt; 2.2e-16 ***
## drug:times 0.33165  2.539e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##               HF eps   Pr(&gt;F[HF])
## times      0.3436277 9.831975e-26
## drug:times 0.3436277 1.757377e-06</code></pre>
<p>Start near the bottom with Mauchly’s test. This is strongly significant (for the interaction, which is our focus here) and means that sphericity fails and the P-value for the interaction in the univariate test is not to be trusted (it is much too small). Look instead at the Huynh-Feldt adjusted P-value at the very bottom, <span class="math inline">\(1.76 \times 10^{-6}\)</span>. This is strongly significant still, but it is a <em>billion</em> times bigger than the one in the univariate table! For comparison, the test for interaction in the multivariate analysis has a P-value of 0.0007 or less, depending on which of the four tests you look at (this time, they are not all the same). As usual, the multivariate tests have bigger P-values than the appropriately adjusted univariate tests, but the P-values are all pointing in the same direction.</p>
<p>The significant interaction means that the effect of time on growth is different for
the different drugs: that is, the effect of drug is over the whole
time profile, not just something like
“a rat on Thyroxin is on average 10 grams heavier than a control rat, over all times”.</p>
<p>Since the interaction is significant, that’s where we stop, as far as
interpretation is concerned.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>We are going to draw an interaction plot in a moment. To
set that up, use <code>pivot_longer</code> as in the lecture notes to create
one column of weights and a second column of times. (You don’t
need to do the <code>separate</code> thing that I did in class, though
if you want to try it, go ahead.)</li>
</ol>
<p>Solution</p>
<p>Like this:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="repeated-measures.html#cb218-1" aria-hidden="true" tabindex="-1"></a>weights <span class="sc">%&gt;%</span> </span>
<span id="cb218-2"><a href="repeated-measures.html#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;Time&quot;</span>), <span class="at">names_to=</span><span class="st">&quot;time&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;weight&quot;</span>) <span class="ot">-&gt;</span> weights.long</span>
<span id="cb218-3"><a href="repeated-measures.html#cb218-3" aria-hidden="true" tabindex="-1"></a>weights.long</span></code></pre></div>
<pre><code>## # A tibble: 135 × 4
##      rat drug     time  weight
##    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;dbl&gt;
##  1     1 thyroxin Time0     59
##  2     1 thyroxin Time1     85
##  3     1 thyroxin Time2    121
##  4     1 thyroxin Time3    156
##  5     1 thyroxin Time4    191
##  6     2 thyroxin Time0     54
##  7     2 thyroxin Time1     71
##  8     2 thyroxin Time2     90
##  9     2 thyroxin Time3    110
## 10     2 thyroxin Time4    138
## # … with 125 more rows</code></pre>
<p>My data frame was called <code>weights</code>, so I was OK with having a
variable called <code>weight</code>. Watch out for that if you call the
data frame <code>weight</code>, though.</p>
<p>Since the piece of the time we want is the number,
<code>parse_number</code> (from <code>readr</code>, part of the
<code>tidyverse</code>) should also work:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="repeated-measures.html#cb220-1" aria-hidden="true" tabindex="-1"></a>weights <span class="sc">%&gt;%</span> </span>
<span id="cb220-2"><a href="repeated-measures.html#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;Time&quot;</span>), <span class="at">names_to=</span><span class="st">&quot;timex&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;weight&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb220-3"><a href="repeated-measures.html#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">parse_number</span>(timex)) <span class="ot">-&gt;</span> weights2.long</span>
<span id="cb220-4"><a href="repeated-measures.html#cb220-4" aria-hidden="true" tabindex="-1"></a>weights2.long <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">20</span>)</span></code></pre></div>
<pre><code>## # A tibble: 20 × 5
##      rat drug       timex weight  time
##    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1     7 thyroxin   Time4    171     4
##  2     3 thyroxin   Time2    108     2
##  3    10 thiouracil Time3    106     3
##  4    12 thiouracil Time3    123     3
##  5    13 thiouracil Time4    119     4
##  6    24 control    Time0     51     0
##  7     1 thyroxin   Time1     85     1
##  8    15 thiouracil Time2     93     2
##  9     4 thyroxin   Time1     85     1
## 10     2 thyroxin   Time3    110     3
## 11    12 thiouracil Time4    140     4
## 12    21 control    Time2    100     2
## 13    16 thiouracil Time1     61     1
## 14    15 thiouracil Time0     58     0
## 15    22 control    Time1     81     1
## 16     7 thyroxin   Time2    105     2
## 17    24 control    Time2     94     2
## 18     4 thyroxin   Time0     59     0
## 19     2 thyroxin   Time4    138     4
## 20     9 thiouracil Time4    122     4</code></pre>
<p>I decided to show you a random collection of rows, so that you can see
that <code>parse_number</code> worked for various different times.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Obtain an interaction plot. Putting <code>time</code> as the
<code>x</code> will put time along the horizontal axis, which is the
way we’re used to seeing such things. Begin by calculating the mean
<code>weight</code> for each <code>time</code>-<code>drug</code> combination.</li>
</ol>
<p>Solution</p>
<p><code>group_by</code>, <code>summarize</code> and <code>ggplot</code>, the
latter using the data frame that came out of the
<code>summarize</code>. The second factor <code>drug</code> goes as the
<code>colour</code> and <code>group</code> both, since <code>time</code> has
grabbed the <code>x</code> spot:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="repeated-measures.html#cb222-1" aria-hidden="true" tabindex="-1"></a>weights.long <span class="sc">%&gt;%</span></span>
<span id="cb222-2"><a href="repeated-measures.html#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(time, drug) <span class="sc">%&gt;%</span></span>
<span id="cb222-3"><a href="repeated-measures.html#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean.weight =</span> <span class="fu">mean</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb222-4"><a href="repeated-measures.html#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> mean.weight, <span class="at">colour =</span> drug, <span class="at">group =</span> drug)) <span class="sc">+</span></span>
<span id="cb222-5"><a href="repeated-measures.html#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;time&#39;. You can override using the
## `.groups` argument.</code></pre>
<p><img src="pasias_files/figure-html/ratweight-7-1.png" width="672" /></p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="8" style="list-style-type: lower-alpha">
<li>How does this plot show why the interaction was
significant? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>At the beginning, all the rats have the same average growth, but
from time 2 (or maybe even 1) or so, the rats on thiouracil
grew more slowly. The idea is not just that thiouracil has a
<em>constant</em> effect over all times, but that the <em>pattern</em>
of growth is different for the different drugs: whether or not
thiouracil inhibits growth, and, if so, by how much, depends on
what time point you are looking at.</p>
<p>Rats on thyroxin or the control drug grew at pretty much the same
rate over all times, so I wouldn’t concern myself with any
differences there.</p>
<p>What I thought would be interesting is to plot the growth curves for
<em>all</em> the rats individually, colour-coded by which drug the rat
was on. This is the repeated-measures version of the ANOVA interaction
plot with the data on it, a so-called spaghetti plot. (We don’t use the lines for the means, here,
instead using them for joining the measurements belonging to the same
subject.)</p>
<p>When I first used this data set, it didn’t have a column identifying which rat was which, which made this plot awkward, but now it does (the column <code>rat</code>). So we can start directly from the dataframe I created above called <code>weights.long</code>:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="repeated-measures.html#cb224-1" aria-hidden="true" tabindex="-1"></a>weights.long</span></code></pre></div>
<pre><code>## # A tibble: 135 × 4
##      rat drug     time  weight
##    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;dbl&gt;
##  1     1 thyroxin Time0     59
##  2     1 thyroxin Time1     85
##  3     1 thyroxin Time2    121
##  4     1 thyroxin Time3    156
##  5     1 thyroxin Time4    191
##  6     2 thyroxin Time0     54
##  7     2 thyroxin Time1     71
##  8     2 thyroxin Time2     90
##  9     2 thyroxin Time3    110
## 10     2 thyroxin Time4    138
## # … with 125 more rows</code></pre>
<p>Each rat is identified by <code>rat``, which repeats 5 times, once for each value of</code>time`:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="repeated-measures.html#cb226-1" aria-hidden="true" tabindex="-1"></a>weights.long <span class="sc">%&gt;%</span> <span class="fu">count</span>(rat)</span></code></pre></div>
<pre><code>## # A tibble: 27 × 2
##      rat     n
##    &lt;dbl&gt; &lt;int&gt;
##  1     1     5
##  2     2     5
##  3     3     5
##  4     4     5
##  5     5     5
##  6     6     5
##  7     7     5
##  8     8     5
##  9     9     5
## 10    10     5
## # … with 17 more rows</code></pre>
<p>In the data frame <code>weights.long</code>, we plot
<code>time</code> (<span class="math inline">\(x\)</span>) against <code>weight</code> (<span class="math inline">\(y\)</span>), grouping the points
according to <code>rat</code> and colouring them according to
<code>drug</code>.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="repeated-measures.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb228-2"><a href="repeated-measures.html#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weights.long, <span class="fu">aes</span>(time, weight, <span class="at">group =</span> rat, <span class="at">colour =</span> drug)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="pasias_files/figure-html/mantequilla-1.png" width="576" /></p>
<p>As you see, “spaghetti plot” is a rather apt name for this kind of thing.</p>
<p>I like this plot because, unlike the interaction plot, which shows
only means, this gives a sense of variability as well. The blue and
red lines (thyroxin and control) are all intermingled and they go
straight up. So there is nothing to choose between these. The green
lines, though, start off mixed up with the red and blue ones but
finish up at the bottom: the <em>pattern</em> of growth of the
thiouracil rats is different from the others, which is why we had a
significant interaction between drug and time.</p>
<p><code>drug</code> is categorical, so <code>ggplot</code>
uses a set of distinguishable colours to mark the levels. If our
colour had been a numerical variable, <code>ggplot</code> would have used
a range of colours like light blue to dark blue, with lighter being
higher, for example.</p>
<p>What, you want to see that? All right. This one is kind of silly, but
you see the point:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="repeated-measures.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weights.long, <span class="fu">aes</span>(time, weight, <span class="at">group =</span> rat, <span class="at">colour =</span> weight)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="pasias_files/figure-html/alphington-1.png" width="576" /></p>
<p>The line segments get lighter as you go up the page.</p>
<p>Since we went to the trouble of making the “long” data frame, we can also run a repeated measures analysis using the
mixed-model idea (described more fully in the problem of the children
near the new airport):</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="repeated-measures.html#cb230-1" aria-hidden="true" tabindex="-1"></a>wt<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lmer</span>(weight <span class="sc">~</span> drug <span class="sc">*</span> time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> rat), <span class="at">data =</span> weights.long)</span>
<span id="cb230-2"><a href="repeated-measures.html#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(wt<span class="fl">.1</span>, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## weight ~ drug * time + (1 | rat)
##           npar    AIC   LRT   Pr(Chi)    
## &lt;none&gt;          990.5                    
## drug:time    8 1067.8 93.27 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The drug-by-time interaction is even more strongly significant than in
the profile analysis. (The output from <code>drop1</code> reminds us that
the only thing we should be thinking about now is that interaction.)</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="social-interaction-among-old-people-1" class="section level2 hasAnchor" number="33.8">
<h2><span class="header-section-number">33.8</span> Social interaction among old people<a href="repeated-measures.html#social-interaction-among-old-people-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A graduate student wrote a thesis comparing different
treatments for increasing social interaction among geriatric
patients. He recruited 21 patients at a state mental hospital and
randomly assigned them to treatments: Reality Orientation
(<code>ro</code>), Behavior Therapy (<code>bt</code>) or no treatment
(<code>ctrl</code>). Each subject was observed at four times, labelled
<code>t1</code> through <code>t4</code> in the data file
<a href="http://ritsokiguess.site/datafiles/geriatrics.txt">link</a>. The
response variable was the percentage of time that the subject was
“engaging in the relevant social interaction”, so that a higher
value is better.</p>
<p>The principal aim of the study was to see whether there were
differences among the treatments (one would hope that the real
treatments were better than the control one), and whether there were
any patterns over time.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data and display at least some of it.</li>
</ol>
<p>Solution</p>
<p>The usual, separated by a single space:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="repeated-measures.html#cb232-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">&quot;http://ritsokiguess.site/datafiles/geriatrics.txt&quot;</span></span>
<span id="cb232-2"><a href="repeated-measures.html#cb232-2" aria-hidden="true" tabindex="-1"></a>geriatrics <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(my_url, <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 21 Columns: 6
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot; &quot;
## chr (1): treatment
## dbl (5): subject, t1, t2, t3, t4
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="repeated-measures.html#cb234-1" aria-hidden="true" tabindex="-1"></a>geriatrics</span></code></pre></div>
<pre><code>## # A tibble: 21 × 6
##    subject treatment    t1    t2    t3    t4
##      &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1       1 bt          1.5   9     5     4  
##  2       2 bt          5    14     4.5   7  
##  3       3 bt          1     8     4.5   2.5
##  4       4 bt          5    14     8     5  
##  5       5 bt          3     8     4     4  
##  6       6 bt          0.5   3.5   1.3   1  
##  7       7 bt          0.5   3     1     0  
##  8       8 ro          2     5     5     1.5
##  9       9 ro          1.5   1.9   1.5   1  
## 10      10 ro          3.5   7     8     4  
## # … with 11 more rows</code></pre>
<p>Correctly 21 observations measured at 4 different times. We also have
subject numbers, which might be useful later.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Create a response variable and fit a suitable <code>lm</code>
as the first stage of the repeated-measures analysis.</li>
</ol>
<p>Solution</p>
<p>This:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="repeated-measures.html#cb236-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">with</span>(geriatrics, <span class="fu">cbind</span>(t1, t2, t3, t4))</span>
<span id="cb236-2"><a href="repeated-measures.html#cb236-2" aria-hidden="true" tabindex="-1"></a>geriatrics<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> treatment, <span class="at">data =</span> geriatrics)</span></code></pre></div>
<p>There is no need to look at this, since we are going to feed it into
<code>Manova</code> in a moment, but in case you’re curious, you see (in <code>summary</code>) a
regression of each of the four columns in <code>response</code> on
<code>treatment</code>, one by one.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Run a suitable <code>Manova</code>. There is some setup
first. Make sure you do that.</li>
</ol>
<p>Solution</p>
<p>Make sure <code>car</code> is loaded, and do the <code>idata</code> and
<code>idesign</code> thing:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="repeated-measures.html#cb237-1" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">colnames</span>(response)</span>
<span id="cb237-2"><a href="repeated-measures.html#cb237-2" aria-hidden="true" tabindex="-1"></a>times.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">times=</span><span class="fu">factor</span>(times))</span>
<span id="cb237-3"><a href="repeated-measures.html#cb237-3" aria-hidden="true" tabindex="-1"></a>geriatrics<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">Manova</span>(geriatrics<span class="fl">.1</span>, <span class="at">idata =</span> times.df, <span class="at">idesign =</span> <span class="sc">~</span>times)</span></code></pre></div>
<p>In case you’re curious, <code>response</code> is an R <code>matrix</code>:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="repeated-measures.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(response)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<p>and
not a data frame (because it was created by <code>cbind</code> which makes
a matrix out of vectors). So, to pull the names off the top, we really
do need <code>colnames</code> (applied to a matrix) rather than just
<code>names</code> (which applies to a data frame).</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Display the results of your repeated-measures
analysis. What do you conclude? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>Its <code>summary</code> will get you what you want:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="repeated-measures.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(geriatrics<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## Warning in summary.Anova.mlm(geriatrics.2): HF eps &gt; 1 treated as 1</code></pre>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests:
## 
## ------------------------------------------
##  
## Term: (Intercept) 
## 
##  Response transformation matrix:
##    (Intercept)
## t1           1
## t2           1
## t3           1
## t4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)    3286.252
## 
## Multivariate Tests: (Intercept)
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1 0.7458921 52.83606      1     18 9.3318e-07 ***
## Wilks             1 0.2541079 52.83606      1     18 9.3318e-07 ***
## Hotelling-Lawley  1 2.9353366 52.83606      1     18 9.3318e-07 ***
## Roy               1 2.9353366 52.83606      1     18 9.3318e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: treatment 
## 
##  Response transformation matrix:
##    (Intercept)
## t1           1
## t2           1
## t3           1
## t4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)    360.6695
## 
## Multivariate Tests: treatment
##                  Df test stat approx F num Df den Df   Pr(&gt;F)  
## Pillai            2 0.2436597 2.899406      2     18 0.080994 .
## Wilks             2 0.7563403 2.899406      2     18 0.080994 .
## Hotelling-Lawley  2 0.3221562 2.899406      2     18 0.080994 .
## Roy               2 0.3221562 2.899406      2     18 0.080994 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: times 
## 
##  Response transformation matrix:
##    times1 times2 times3
## t1      1      0      0
## t2      0      1      0
## t3      0      0      1
## t4     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##            times1     times2    times3
## times1  0.5833333  -8.366667 -1.666667
## times2 -8.3666667 120.001905 23.904762
## times3 -1.6666667  23.904762  4.761905
## 
## Multivariate Tests: times
##                  Df test stat approx F num Df den Df   Pr(&gt;F)    
## Pillai            1 0.7214276  13.8119      3     16 0.000105 ***
## Wilks             1 0.2785724  13.8119      3     16 0.000105 ***
## Hotelling-Lawley  1 2.5897315  13.8119      3     16 0.000105 ***
## Roy               1 2.5897315  13.8119      3     16 0.000105 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: treatment:times 
## 
##  Response transformation matrix:
##    times1 times2 times3
## t1      1      0      0
## t2      0      1      0
## t3      0      0      1
## t4     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##            times1    times2    times3
## times1   8.166667 -27.33333 -4.933333
## times2 -27.333333  91.61524 17.569524
## times3  -4.933333  17.56952 11.443810
## 
## Multivariate Tests: treatment:times
##                  Df test stat  approx F num Df den Df     Pr(&gt;F)    
## Pillai            2 0.9258067  4.883886      6     34 0.00107288 ** 
## Wilks             2 0.2190296  6.062534      6     32 0.00025426 ***
## Hotelling-Lawley  2 2.9043306  7.260827      6     30 7.4555e-05 ***
## Roy               2 2.6552949 15.046671      3     17 4.8948e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Univariate Type II Repeated-Measures ANOVA Assuming Sphericity
## 
##                 Sum Sq num Df Error SS den Df F value    Pr(&gt;F)    
## (Intercept)     821.56      1   279.89     18 52.8361 9.332e-07 ***
## treatment        90.17      2   279.89     18  2.8994   0.08099 .  
## times            87.07      3    72.25     54 21.6933 2.378e-09 ***
## treatment:times  90.77      6    72.25     54 11.3067 3.827e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Mauchly Tests for Sphericity
## 
##                 Test statistic p-value
## times                  0.85209 0.75008
## treatment:times        0.85209 0.75008
## 
## 
## Greenhouse-Geisser and Huynh-Feldt Corrections
##  for Departure from Sphericity
## 
##                  GG eps Pr(&gt;F[GG])    
## times           0.90848  1.108e-08 ***
## treatment:times 0.90848  1.434e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                   HF eps   Pr(&gt;F[HF])
## times           1.086414 2.377839e-09
## treatment:times 1.086414 3.826914e-08</code></pre>
<p>As is the way, start at the bottom and go up to Mauchly’s test for sphericity. No problem here, so you can use the P-value for interaction on the univariate test as is ($3.8 ^{-8}). By way of comparison, the Huynh-Feldt adjusted P-value is exactly the same (not actually adjusted at all), which makes sense because there was no lack of sphericity. The multivariate tests for the interaction have P-values that vary, but they are all (i) a bit bigger than the univariate one, and (ii) still significant.</p>
<p>Thus, the interaction is significant, so the effects of the treatments are
different at different times. (It makes most sense to say it this way
around, since treatment is something that was controlled and time was not.)</p>
<p>You, I hope, know better than to look at the main effects when there
is a significant interaction!</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>To understand the results that you got from the repeated
measures analysis, you are going to draw a picture (or two). To do
<em>that</em>, we are going to need the data in “long” format with
one response value per line (instead of four). Use <code>pivot_longer</code>
suitably to get the data in that format, and demonstrate that you
have done so.</li>
</ol>
<p>Solution</p>
<p>The usual layout:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="repeated-measures.html#cb243-1" aria-hidden="true" tabindex="-1"></a>geriatrics <span class="sc">%&gt;%</span> </span>
<span id="cb243-2"><a href="repeated-measures.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(t1<span class="sc">:</span>t4, <span class="at">names_to=</span><span class="st">&quot;time&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;intpct&quot;</span>) <span class="ot">-&gt;</span> geriatrics.long</span>
<span id="cb243-3"><a href="repeated-measures.html#cb243-3" aria-hidden="true" tabindex="-1"></a>geriatrics.long</span></code></pre></div>
<pre><code>## # A tibble: 84 × 4
##    subject treatment time  intpct
##      &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;
##  1       1 bt        t1       1.5
##  2       1 bt        t2       9  
##  3       1 bt        t3       5  
##  4       1 bt        t4       4  
##  5       2 bt        t1       5  
##  6       2 bt        t2      14  
##  7       2 bt        t3       4.5
##  8       2 bt        t4       7  
##  9       3 bt        t1       1  
## 10       3 bt        t2       8  
## # … with 74 more rows</code></pre>
<p>I have <em>one</em> column of interaction percents, and
<em>one</em> column of times. If you check the whole thing, you’ll see
that <code>pivot_longer</code> gives all the measurements for subject 1, then subject 2, and so on.</p>
<p>The long data frame is, well, long.</p>
<p>It’s not necessary to pull out the numeric time values, though you
could if you wanted to, by using
<code>parse_number</code>.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Calculate and save the mean interaction percents for each
time-treatment combination.</li>
</ol>
<p>Solution</p>
<p><code>group_by</code> followed by <code>summarize</code>, as ever:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="repeated-measures.html#cb245-1" aria-hidden="true" tabindex="-1"></a>geriatrics.long <span class="sc">%&gt;%</span></span>
<span id="cb245-2"><a href="repeated-measures.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment, time) <span class="sc">%&gt;%</span></span>
<span id="cb245-3"><a href="repeated-measures.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(intpct)) <span class="ot">-&gt;</span> means</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;treatment&#39;. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="repeated-measures.html#cb247-1" aria-hidden="true" tabindex="-1"></a>means</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
## # Groups:   treatment [3]
##    treatment time   mean
##    &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt;
##  1 bt        t1     2.36
##  2 bt        t2     8.5 
##  3 bt        t3     4.04
##  4 bt        t4     3.36
##  5 ctrl      t1     2.64
##  6 ctrl      t2     2.23
##  7 ctrl      t3     1.63
##  8 ctrl      t4     2.14
##  9 ro        t1     1.86
## 10 ro        t2     3.8 
## 11 ro        t3     3.11
## 12 ro        t4     1.86</code></pre>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Make an interaction plot. Arrange things so that time goes
across the page. Use your data frame of means that you just calculated.</li>
</ol>
<p>Solution</p>
<p>Once you have the means, this is not too bad:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="repeated-measures.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(means, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> mean, <span class="at">group =</span> treatment, <span class="at">colour =</span> treatment)) <span class="sc">+</span></span>
<span id="cb249-2"><a href="repeated-measures.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="pasias_files/figure-html/ger_int-1.png" width="672" /></p>
<p>The “second factor” <code>treatment</code> appears as both
<code>group</code> and <code>colour</code>.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Describe what you see on your interaction plot, and what it
says about why your repeated-measures analysis came out as it did.</li>
</ol>
<p>Solution</p>
<p>The two “real” treatments <code>bt</code> and <code>ro</code> both go up
sharply between time 1 and time 2, and then come back down so that
by time 4 they are about where they started. The control group
basically didn’t change at all, and if anything went <em>down</em>
between times 1 and 2, a completely different pattern to the others.
The two treatments <code>bt</code> and <code>ro</code> are not exactly
parallel, but they do at least have qualitatively the same
pattern.<a href="#fn40" class="footnote-ref" id="fnref40"><sup>40</sup></a> It
is, I think, the fact that the control group has a
<em>completely</em> different pattern over time that makes the
interaction come out significant.<a href="#fn41" class="footnote-ref" id="fnref41"><sup>41</sup></a>
I’m going to explore that some more later, but first I want to get
you to draw a spaghetti plot.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol style="list-style-type: lower-roman">
<li>Draw a spaghetti plot of these data. That is, use
<code>ggplot</code> to plot the interaction percent against time for
each subject,
joining the points for the <em>same subject</em> by lines whose colour
shows what treatment they were on. Use the “long” data frame for
this (not the data frame of means).</li>
</ol>
<p>Solution</p>
<p>This is almost easier to do than it is to ask you to do:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="repeated-measures.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(geriatrics.long, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> intpct, <span class="at">colour =</span> treatment, <span class="at">group =</span> subject)) <span class="sc">+</span></span>
<span id="cb250-2"><a href="repeated-measures.html#cb250-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="pasias_files/figure-html/ger_spag-1.png" width="672" /></p>
<p>The basic difficulty here is to get all the parts. We need both a
<code>colour</code> and a <code>group</code>; the latter controls the joining
of points by lines (if you have both). Fortunately we already had
subject numbers in the original data; if we had not had them, we would
have had to create them. <code>dplyr</code> has a function
<code>row_number</code> that we could have used for that; we’d apply the row
numbers to the original wide data frame, before we made it long, so
that the correct subject numbers would get carried along.</p>
<p>Whether you add a <code>geom_point()</code> to plot the data points, or not,
is up to you. Logically, it makes sense to include the actual data,
but aesthetically, it looks more like spaghetti if you leave the
points out. Either way is good, as far as I’m concerned.</p>
<p>I didn’t ask you to comment on the spaghetti plot, because the story
is much the same as the interaction plot. There is a lot of
variability, but the story within each group is basically what we
already said: the red lines go sharply up and almost as sharply back
down again, the blue lines do something similar, only not as sharply
up and down, and the green lines do basically nothing.</p>
<p>I said that the control subjects’ time pattern was noticeably
different from the others. Which made me think: what if we remove the
control subjects? Would there still be an interaction?<a href="#fn42" class="footnote-ref" id="fnref42"><sup>42</sup></a></p>
<p>All right, we need to start with the original wide data frame, and
from <em>that</em> select everything but <code>ctrl</code>:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="repeated-measures.html#cb251-1" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> geriatrics <span class="sc">%&gt;%</span> <span class="fu">filter</span>(treatment <span class="sc">!=</span> <span class="st">&quot;ctrl&quot;</span>)</span>
<span id="cb251-2"><a href="repeated-measures.html#cb251-2" aria-hidden="true" tabindex="-1"></a>gg</span></code></pre></div>
<pre><code>## # A tibble: 14 × 6
##    subject treatment    t1    t2    t3    t4
##      &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1       1 bt          1.5   9     5     4  
##  2       2 bt          5    14     4.5   7  
##  3       3 bt          1     8     4.5   2.5
##  4       4 bt          5    14     8     5  
##  5       5 bt          3     8     4     4  
##  6       6 bt          0.5   3.5   1.3   1  
##  7       7 bt          0.5   3     1     0  
##  8       8 ro          2     5     5     1.5
##  9       9 ro          1.5   1.9   1.5   1  
## 10      10 ro          3.5   7     8     4  
## 11      11 ro          1.5   4.2   2     1.5
## 12      12 ro          1.5   3.6   2     1  
## 13      13 ro          1.5   2.5   2.8   4  
## 14      14 ro          1.5   2.4   0.5   0</code></pre>
<p>So now there are two treatments left, seven people on
each:<a href="#fn43" class="footnote-ref" id="fnref43"><sup>43</sup></a></p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="repeated-measures.html#cb253-1" aria-hidden="true" tabindex="-1"></a>gg <span class="sc">%&gt;%</span> <span class="fu">count</span>(treatment)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   treatment     n
##   &lt;chr&gt;     &lt;int&gt;
## 1 bt            7
## 2 ro            7</code></pre>
<p>Then we do
the same stuff over again: construct the response, run the
<code>lm</code>, create the stuff for <code>idata</code> and <code>idesign</code>,
and run the <code>Manova</code>. There’s really nothing new here:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="repeated-measures.html#cb255-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">with</span>(gg, <span class="fu">cbind</span>(t1, t2, t3, t4))</span>
<span id="cb255-2"><a href="repeated-measures.html#cb255-2" aria-hidden="true" tabindex="-1"></a>gg<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> treatment, <span class="at">data =</span> gg)</span>
<span id="cb255-3"><a href="repeated-measures.html#cb255-3" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">colnames</span>(response)</span>
<span id="cb255-4"><a href="repeated-measures.html#cb255-4" aria-hidden="true" tabindex="-1"></a>times.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">times=</span><span class="fu">factor</span>(times))</span>
<span id="cb255-5"><a href="repeated-measures.html#cb255-5" aria-hidden="true" tabindex="-1"></a>gg<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">Manova</span>(gg<span class="fl">.1</span>, <span class="at">idata =</span> times.df, <span class="at">idesign =</span> <span class="sc">~</span>times)</span>
<span id="cb255-6"><a href="repeated-measures.html#cb255-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gg<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## Warning in summary.Anova.mlm(gg.2): HF eps &gt; 1 treated as 1</code></pre>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests:
## 
## ------------------------------------------
##  
## Term: (Intercept) 
## 
##  Response transformation matrix:
##    (Intercept)
## t1           1
## t2           1
## t3           1
## t4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)    2920.346
## 
## Multivariate Tests: (Intercept)
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1  0.765026 39.06941      1     12 4.2509e-05 ***
## Wilks             1  0.234974 39.06941      1     12 4.2509e-05 ***
## Hotelling-Lawley  1  3.255785 39.06941      1     12 4.2509e-05 ***
## Roy               1  3.255785 39.06941      1     12 4.2509e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: treatment 
## 
##  Response transformation matrix:
##    (Intercept)
## t1           1
## t2           1
## t3           1
## t4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)    203.6829
## 
## Multivariate Tests: treatment
##                  Df test stat approx F num Df den Df Pr(&gt;F)
## Pillai            1 0.1850562 2.724941      1     12 0.1247
## Wilks             1 0.8149438 2.724941      1     12 0.1247
## Hotelling-Lawley  1 0.2270784 2.724941      1     12 0.1247
## Roy               1 0.2270784 2.724941      1     12 0.1247
## 
## ------------------------------------------
##  
## Term: times 
## 
##  Response transformation matrix:
##    times1 times2 times3
## t1      1      0      0
## t2      0      1      0
## t3      0      0      1
## t4     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##        times1    times2   times3
## times1    3.5 -24.80000 -6.80000
## times2  -24.8 175.72571 48.18286
## times3   -6.8  48.18286 13.21143
## 
## Multivariate Tests: times
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1  0.817303 14.91185      3     10 0.00050726 ***
## Wilks             1  0.182697 14.91185      3     10 0.00050726 ***
## Hotelling-Lawley  1  4.473555 14.91185      3     10 0.00050726 ***
## Roy               1  4.473555 14.91185      3     10 0.00050726 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: treatment:times 
## 
##  Response transformation matrix:
##    times1 times2 times3
## t1      1      0      0
## t2      0      1      0
## t3      0      0      1
## t4     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##        times1 times2    times3
## times1    3.5 -11.20  2.000000
## times2  -11.2  35.84 -6.400000
## times3    2.0  -6.40  1.142857
## 
## Multivariate Tests: treatment:times
##                  Df test stat approx F num Df den Df   Pr(&gt;F)  
## Pillai            1 0.5816827 4.635099      3     10 0.027959 *
## Wilks             1 0.4183173 4.635099      3     10 0.027959 *
## Hotelling-Lawley  1 1.3905298 4.635099      3     10 0.027959 *
## Roy               1 1.3905298 4.635099      3     10 0.027959 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Univariate Type II Repeated-Measures ANOVA Assuming Sphericity
## 
##                 Sum Sq num Df Error SS den Df F value    Pr(&gt;F)    
## (Intercept)     730.09      1  224.243     12 39.0694 4.251e-05 ***
## treatment        50.92      1  224.243     12  2.7249 0.1247005    
## times           136.04      3   60.551     36 26.9595 2.560e-09 ***
## treatment:times  38.16      3   60.551     36  7.5629 0.0004777 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Mauchly Tests for Sphericity
## 
##                 Test statistic p-value
## times                  0.66019 0.48791
## treatment:times        0.66019 0.48791
## 
## 
## Greenhouse-Geisser and Huynh-Feldt Corrections
##  for Departure from Sphericity
## 
##                  GG eps Pr(&gt;F[GG])    
## times           0.82418  5.012e-08 ***
## treatment:times 0.82418   0.001217 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                 HF eps   Pr(&gt;F[HF])
## times           1.0546 2.560037e-09
## treatment:times 1.0546 4.777491e-04</code></pre>
<p>The procedure, as before: Mauchly’s test is not significant, so you can look at the univariate
test for interaction. For comparison, the P-values for interaction in the multivariate test (all the same) are quite a bit bigger but still significant.</p>
<p>There is still an interaction, but it’s not as significant as it was
before. I think it is still significant because the shape of the two
time trends is not the same: the red <code>bt</code> group goes up further
and down further. I was musing that the higher values are also more
variable, which would suggest a transformation, but I haven’t explored that.
If the interaction had turned out to be nonsignificant this way? You
might think about trying to remove it from the model, except that in
this kind of model, <code>treatment</code> is a “between-subjects factor”
and <code>times</code> is a “within-subjects factor”, so they
are different kinds of things. What you do in that case is to ignore
the non-significant interaction and interpret the main effects: there
is no way to “gain df for error” like we did in two-way
ANOVA. Supposing, in this case, that we were using <span class="math inline">\(\alpha=0.01\)</span>, we
would say that the interaction is not significant. Then we look at the
main effects: there is no effect of treatment, but there is an effect
of time. Or, to put it another way, once you allow for an effect of
time, there is no difference between the two remaining
treatments.<a href="#fn44" class="footnote-ref" id="fnref44"><sup>44</sup></a></p>
<p>Thinking back to our spaghetti plot, we are now comparing the red and
blue treatments. They both go up at time 2 and down afterwards, which
is the time effect, but even once you allow for this time trend, there is
too much scatter to be able to infer a difference between the treatments.</p>
<p>Extra (maybe I could branch off into another question sometime?) I was thinking that this is not terribly clear, so I thought I would
fake up some data where there is a treatment effect and a time effect
(but no interaction), and draw a spaghetti plot, so you can see the
difference, idealized somewhat of course. Let’s try to come up with
something with the same kind of time effect, up at time 2 and then
down afterwards, that is the same for two drugs A and B. Here’s what I
came up with:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="repeated-measures.html#cb258-1" aria-hidden="true" tabindex="-1"></a>fake <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;fake.csv&quot;</span>, <span class="at">header =</span> T)</span>
<span id="cb258-2"><a href="repeated-measures.html#cb258-2" aria-hidden="true" tabindex="-1"></a>fake</span></code></pre></div>
<pre><code>##    subject drug t1 t2 t3 t4
## 1        1    a 10 15 13 11
## 2        2    a 11 14 12  9
## 3        3    a 12 16 13 11
## 4        4    a 10 14 11 11
## 5        5    a 11 13 10  9
## 6        6    b  7 10  8  6
## 7        7    b  8 12 11  9
## 8        8    b  5  9  7  5
## 9        9    b  7  8  6  5
## 10      10    b  8 12 11  9</code></pre>
<p>You can kind of get the idea that the pattern over time is up and then
down, so that it finishes about where it starts, but the numbers for
drug A are usually bigger than the ones for drug B, consistently over
time. So there ought not to be an interaction, but there ought to be
both a time effect and a drug effect.</p>
<p>Let’s see whether we can demonstrate that. First, a spaghetti plot,
which involves getting the data in long format first. I’m saving the
long format to use again later.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="repeated-measures.html#cb260-1" aria-hidden="true" tabindex="-1"></a>fake <span class="sc">%&gt;%</span> </span>
<span id="cb260-2"><a href="repeated-measures.html#cb260-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(t1<span class="sc">:</span>t4, <span class="at">names_to=</span><span class="st">&quot;times&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;score&quot;</span>) <span class="ot">-&gt;</span> fake.long</span>
<span id="cb260-3"><a href="repeated-measures.html#cb260-3" aria-hidden="true" tabindex="-1"></a>fake.long <span class="sc">%&gt;%</span></span>
<span id="cb260-4"><a href="repeated-measures.html#cb260-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> times, <span class="at">y =</span> score, <span class="at">colour =</span> drug, <span class="at">group =</span> subject)) <span class="sc">+</span></span>
<span id="cb260-5"><a href="repeated-measures.html#cb260-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="pasias_files/figure-html/geriatrics-12-1.png" width="672" /></p>
<p>The reds are consistently higher than the blues (drug effect), the
pattern over time goes up and then down (time effect), but the time
effect is basically the same for both drugs (no interaction).</p>
<p>I got the plot wrong the first time, because I forgot whether I was
doing an interaction plot (where <code>group=</code> and <code>colour=</code>
are the same) or a spaghetti plot (where <code>group</code> has to be
<code>subject</code> and the colour represents the treatment, usually).</p>
<p>Let’s do the repeated-measures ANOVA and see whether my guess above is right:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="repeated-measures.html#cb261-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">with</span>(fake, <span class="fu">cbind</span>(t1, t2, t3, t4))</span>
<span id="cb261-2"><a href="repeated-measures.html#cb261-2" aria-hidden="true" tabindex="-1"></a>fake<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> drug, <span class="at">data =</span> fake)</span>
<span id="cb261-3"><a href="repeated-measures.html#cb261-3" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">colnames</span>(response)</span>
<span id="cb261-4"><a href="repeated-measures.html#cb261-4" aria-hidden="true" tabindex="-1"></a>times.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">times=</span><span class="fu">factor</span>(times))</span>
<span id="cb261-5"><a href="repeated-measures.html#cb261-5" aria-hidden="true" tabindex="-1"></a>fake<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">Manova</span>(fake<span class="fl">.1</span>, <span class="at">idata =</span> times.df, <span class="at">idesign =</span> <span class="sc">~</span>times)</span></code></pre></div>
<p>After typing this kind of stuff out a few too many times, I hope
you’re getting the idea “function”. Also, the construction of the
response is kind of annoying, where you have to list all the time
columns. The trouble is, <code>response</code> has to be a <code>matrix</code>,
which it is:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="repeated-measures.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(response)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<p>but if you do the obvious thing of selecting the columns of the data
frame that you want:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="repeated-measures.html#cb264-1" aria-hidden="true" tabindex="-1"></a>fake <span class="sc">%&gt;%</span> <span class="fu">select</span>(t1<span class="sc">:</span>t4) <span class="ot">-&gt;</span> r</span>
<span id="cb264-2"><a href="repeated-measures.html#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(r)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>you get a data frame instead. I think this would work:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="repeated-measures.html#cb266-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> fake <span class="sc">%&gt;%</span> <span class="fu">select</span>(t1<span class="sc">:</span>t4) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb266-2"><a href="repeated-measures.html#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(r)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<p>The idea is that you select the columns you want as a data frame first
(with <code>select</code>), and then turn it into a <code>matrix</code> at the
end.</p>
<p>This is the kind of thing you’d have to do in a function, I think,
since you’d have to have some way of telling the function which are
the “time” columns. Anyway, hope you haven’t forgotten what we were
doing:<a href="#fn45" class="footnote-ref" id="fnref45"><sup>45</sup></a></p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="repeated-measures.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fake<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests:
## 
## ------------------------------------------
##  
## Term: (Intercept) 
## 
##  Response transformation matrix:
##    (Intercept)
## t1           1
## t2           1
## t3           1
## t4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)     15920.1
## 
## Multivariate Tests: (Intercept)
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1   0.98478 517.7268      1      8 1.4752e-08 ***
## Wilks             1   0.01522 517.7268      1      8 1.4752e-08 ***
## Hotelling-Lawley  1  64.71585 517.7268      1      8 1.4752e-08 ***
## Roy               1  64.71585 517.7268      1      8 1.4752e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: drug 
## 
##  Response transformation matrix:
##    (Intercept)
## t1           1
## t2           1
## t3           1
## t4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)       532.9
## 
## Multivariate Tests: drug
##                  Df test stat approx F num Df den Df    Pr(&gt;F)   
## Pillai            1   0.68417 17.33008      1      8 0.0031525 **
## Wilks             1   0.31583 17.33008      1      8 0.0031525 **
## Hotelling-Lawley  1   2.16626 17.33008      1      8 0.0031525 **
## Roy               1   2.16626 17.33008      1      8 0.0031525 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: times 
## 
##  Response transformation matrix:
##    times1 times2 times3
## t1      1      0      0
## t2      0      1      0
## t3      0      0      1
## t4     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##        times1 times2 times3
## times1    1.6   15.2    6.8
## times2   15.2  144.4   64.6
## times3    6.8   64.6   28.9
## 
## Multivariate Tests: times
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1   0.98778 161.7086      3      6 3.9703e-06 ***
## Wilks             1   0.01222 161.7086      3      6 3.9703e-06 ***
## Hotelling-Lawley  1  80.85428 161.7086      3      6 3.9703e-06 ***
## Roy               1  80.85428 161.7086      3      6 3.9703e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: drug:times 
## 
##  Response transformation matrix:
##    times1 times2 times3
## t1      1      0      0
## t2      0      1      0
## t3      0      0      1
## t4     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##        times1 times2 times3
## times1    0.4    0.8   -0.2
## times2    0.8    1.6   -0.4
## times3   -0.2   -0.4    0.1
## 
## Multivariate Tests: drug:times
##                  Df test stat approx F num Df den Df   Pr(&gt;F)  
## Pillai            1 0.6490046  3.69808      3      6 0.081108 .
## Wilks             1 0.3509954  3.69808      3      6 0.081108 .
## Hotelling-Lawley  1 1.8490401  3.69808      3      6 0.081108 .
## Roy               1 1.8490401  3.69808      3      6 0.081108 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Univariate Type II Repeated-Measures ANOVA Assuming Sphericity
## 
##             Sum Sq num Df Error SS den Df  F value    Pr(&gt;F)    
## (Intercept) 3980.0      1     61.5      8 517.7268 1.475e-08 ***
## drug         133.2      1     61.5      8  17.3301  0.003152 ** 
## times         87.9      3     14.9     24  47.1812 3.233e-10 ***
## drug:times     1.5      3     14.9     24   0.7919  0.510323    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Mauchly Tests for Sphericity
## 
##            Test statistic p-value
## times             0.18708 0.04852
## drug:times        0.18708 0.04852
## 
## 
## Greenhouse-Geisser and Huynh-Feldt Corrections
##  for Departure from Sphericity
## 
##             GG eps Pr(&gt;F[GG])    
## times      0.54943  1.886e-06 ***
## drug:times 0.54943     0.4505    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##               HF eps   Pr(&gt;F[HF])
## times      0.6735592 1.708486e-07
## drug:times 0.6735592 4.709652e-01</code></pre>
<p>The usual procedure: check for sphericity first. Here, that is <em>just</em> rejected, but since the P-value on the sphericity test is only just less than 0.05, you would expect the P-values on the univariate test for interaction and the Huynh-Feldt adjustment to be similar, and they are (0.510 and 0.471 respectively). Scrolling up a bit further, the multivariate test for interaction only just fails to be significant, with a P-value of 0.081. It is a mild concern that this one differs so much from the others; normally the multivariate test(s) would tell a similar story to the others.</p>
<p>The drug-by-time interaction is not significant, so we go ahead and
interpret the main effects: there is a time effect (the increase at
time 2 that I put in on purpose), and, allowing for the time effect,
there is also a difference between the drugs (because the drug A
scores are a bit higher than the drug B scores). The procedure is to look at the Huynh-Feldt adjusted P-value for time (<span class="math inline">\(1.71 \times 10^{-7}\)</span>), expecting it to be a bit bigger than the one in the univariate table (it is) and comparable to the one for time in the appropriate multivariate analysis (<span class="math inline">\(3.97 \times 10^{-6}\)</span>; it is, but remember to scroll back enough). In this kind of analysis, the effect of drug is averaged over time,<a href="#fn46" class="footnote-ref" id="fnref46"><sup>46</sup></a> so the test for the drug main effect is unaffected by sphericity. Its P-value, 0.0032, is identical in the univariate and multivariate tables, and you see that the drug main effect is not part of the sphericity testing.</p>
<p>What if we ignored the time effect? You’d think we could do something
like this, treating the measurements at different times as replicates:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="repeated-measures.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fake.long)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   subject drug  times score
##     &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
## 1       1 a     t1       10
## 2       1 a     t2       15
## 3       1 a     t3       13
## 4       1 a     t4       11
## 5       2 a     t1       11
## 6       2 a     t2       14</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="repeated-measures.html#cb272-1" aria-hidden="true" tabindex="-1"></a>fake<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">aov</span>(score <span class="sc">~</span> drug, <span class="at">data =</span> fake.long)</span>
<span id="cb272-2"><a href="repeated-measures.html#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fake<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## drug         1  133.2  133.23   30.54 2.54e-06 ***
## Residuals   38  165.8    4.36                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>but this would be <em>wrong</em>, because we are acting as if we have 40
independent observations, which we don’t (this is the point of doing
repeated measures in the first place). It looks as if we have achieved
something by getting a lower P-value for <code>drug</code>, but we
haven’t really, because we have done so by cheating.</p>
<p>What we could do instead is to average the scores for each subject
over all the times,<a href="#fn47" class="footnote-ref" id="fnref47"><sup>47</sup></a> for
which we go back to the original data frame:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="repeated-measures.html#cb274-1" aria-hidden="true" tabindex="-1"></a>fake</span></code></pre></div>
<pre><code>##    subject drug t1 t2 t3 t4
## 1        1    a 10 15 13 11
## 2        2    a 11 14 12  9
## 3        3    a 12 16 13 11
## 4        4    a 10 14 11 11
## 5        5    a 11 13 10  9
## 6        6    b  7 10  8  6
## 7        7    b  8 12 11  9
## 8        8    b  5  9  7  5
## 9        9    b  7  8  6  5
## 10      10    b  8 12 11  9</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="repeated-measures.html#cb276-1" aria-hidden="true" tabindex="-1"></a>fake <span class="sc">%&gt;%</span></span>
<span id="cb276-2"><a href="repeated-measures.html#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">avg.score =</span> (t1 <span class="sc">+</span> t2 <span class="sc">+</span> t3 <span class="sc">+</span> t4) <span class="sc">/</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb276-3"><a href="repeated-measures.html#cb276-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aov</span>(avg.score <span class="sc">~</span> drug, <span class="at">data =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb276-4"><a href="repeated-measures.html#cb276-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value  Pr(&gt;F)   
## drug         1  33.31   33.31   17.33 0.00315 **
## Residuals    8  15.37    1.92                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Ah, now, this is very interesting. I was hoping that by throwing away
the time information (which is useful), we would have diminished
the significance of the drug effect. By failing to include the
time-dependence in our model, we ought to have introduced some extra
variability, which ought to weaken our test. But this test gives
<em>exactly the same</em> P-value as the ones in the MANOVA, and it looks
like exactly the same test (the <span class="math inline">\(F\)</span>-value is the same too). So it
looks as if this is what the MANOVA is doing, to assess the
<code>drug</code> effect: it’s averaging over the times. Since the same
four (here) time points are being used to compute the average for each
subject, we are comparing like with like at least, and even if there
is a large time effect, I suppose it’s going to have the same effect
on each average. For example, if as here the scores at time 2 are
typically highest, all the averages are going to be composed of one
high score and three lower ones. So maybe I have to go back and dilute
my conclusions about the significance of treatments earlier: it’s actually
saying that there is a difference between the two remaining treatments
<em>averaged over time</em> rather than <em>allowing for time</em> as I
said earlier.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="childrens-stress-levels-and-airports-1" class="section level2 hasAnchor" number="33.9">
<h2><span class="header-section-number">33.9</span> Children’s stress levels and airports<a href="repeated-measures.html#childrens-stress-levels-and-airports-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If you did STAC32, you might remember this question, which
we can now do properly. Some of this question is a repeat from there.</p>
<p>The data in <a href="http://ritsokiguess.site/datafiles/airport.txt">link</a>
are based on a 1998 study of stress levels in children as a result of
the building of a new airport in Munich, Germany. A total of 200
children had their epinephrine levels (a stress indicator) measured at
each of four different times: before the airport was built, and 6, 18
and 36 months after it was built. The four measurements are labelled
<code>epi_1</code> through <code>epi_4</code>. Out of the children, 100
were living near the new airport (location 1 in the data set), and
could be expected to suffer stress because of the new airport. The
other 100 children lived in the same city, but outside the noise
impact zone. These children thus serve as a control group. The
children are identified with numbers 1 through 200.</p>
<ol style="list-style-type: lower-alpha">
<li>If we were testing for the effect of time, explain briefly
what it is about the structure of the data that would make an
analysis of variance <em>inappropriate</em>.</li>
</ol>
<p>Solution</p>
<p>It is the fact that each child was measured four times, rather
than each measurement being on a <em>different</em> child (with
thus <span class="math inline">\(4\times 200=800\)</span> observations altogether). It’s
the same distinction as between matched pairs and a two-sample
<span class="math inline">\(t\)</span> test.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Read the data into R and demonstrate that you have the right
number of observations and variables.</li>
</ol>
<p>Solution</p>
<p>The usual, data values separated by one space:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="repeated-measures.html#cb278-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">&quot;http://ritsokiguess.site/datafiles/airport.txt&quot;</span></span>
<span id="cb278-2"><a href="repeated-measures.html#cb278-2" aria-hidden="true" tabindex="-1"></a>airport <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(my_url, <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 200 Columns: 6
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot; &quot;
## dbl (6): epi_1, epi_2, epi_3, epi_4, location, child
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="repeated-measures.html#cb280-1" aria-hidden="true" tabindex="-1"></a>airport</span></code></pre></div>
<pre><code>## # A tibble: 200 × 6
##     epi_1  epi_2 epi_3 epi_4 location child
##     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  89.6  253.   214.   209.        1     1
##  2 -55.5   -1.45  26.0  259.        1     2
##  3 201.   280.   265.   174.        1     3
##  4 448.   349.   386.   225.        1     4
##  5  -4.60 315.   331.   333.        1     5
##  6 231.   237.   488.   319.        1     6
##  7 227.   469.   382.   359.        1     7
##  8 336.   280.   362.   472.        1     8
##  9  16.8  190.    90.9  145.        1     9
## 10  54.5  359.   454.   199.        1    10
## # … with 190 more rows</code></pre>
<p>There are 200 rows (children), with four <code>epi</code> measurements, a
location and a child identifier, so that looks good.</p>
<p>(I am mildly concerned about the negative <code>epi</code> measurements,
but I don’t know what the scale is, so presumably they are all
right. Possibly epinephrine is measured on a log scale, so that a
negative value here is less than 1 on the original scale that we don’t
see.)</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Create and save a “longer” data frame with all the epinephrine
values collected together into one column.</li>
</ol>
<p>Solution</p>
<p><code>pivot_longer</code>:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="repeated-measures.html#cb282-1" aria-hidden="true" tabindex="-1"></a>airport <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;epi&quot;</span>), <span class="at">names_to=</span><span class="st">&quot;when&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;epinephrine&quot;</span>) <span class="ot">-&gt;</span> airport.long</span>
<span id="cb282-2"><a href="repeated-measures.html#cb282-2" aria-hidden="true" tabindex="-1"></a>airport.long</span></code></pre></div>
<pre><code>## # A tibble: 800 × 4
##    location child when  epinephrine
##       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;
##  1        1     1 epi_1       89.6 
##  2        1     1 epi_2      253.  
##  3        1     1 epi_3      214.  
##  4        1     1 epi_4      209.  
##  5        1     2 epi_1      -55.5 
##  6        1     2 epi_2       -1.45
##  7        1     2 epi_3       26.0 
##  8        1     2 epi_4      259.  
##  9        1     3 epi_1      201.  
## 10        1     3 epi_2      280.  
## # … with 790 more rows</code></pre>
<p>Success. I’m saving the name <code>time</code> for later, so I’ve called
the time points <code>when</code> for now. There were 4 measurements on
each of 200 children, so the long data frame should (and does) have
<span class="math inline">\(200\times 4 = 800\)</span> rows.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Make a “spaghetti plot” of these data: that is, a plot of
epinephrine levels against time, with the locations identified by
colour, and the points for the same child joined by lines. To do
this: (i) from the long data frame, create a new column containing
only the numeric values of time (1 through 4), (ii) plot epinephrine
level against time with the points grouped by child and coloured by
location (which you may have to turn from a number into a factor.)</li>
</ol>
<p>Solution</p>
<p>Note the use of the different things for <code>colour</code> and <code>group</code>, as usual for a spaghetti plot. Also, note that the locations are identified by number, but the number is only a label, and we want to use different colours for the different locations, so we need to turn <code>location</code> into a factor for this.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="repeated-measures.html#cb284-1" aria-hidden="true" tabindex="-1"></a>airport.long <span class="sc">%&gt;%</span></span>
<span id="cb284-2"><a href="repeated-measures.html#cb284-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">parse_number</span>(when)) <span class="sc">%&gt;%</span></span>
<span id="cb284-3"><a href="repeated-measures.html#cb284-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> epinephrine, <span class="at">colour =</span> <span class="fu">factor</span>(location), <span class="at">group =</span> child)) <span class="sc">+</span></span>
<span id="cb284-4"><a href="repeated-measures.html#cb284-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="pasias_files/figure-html/toofat-1.png" width="672" /></p>
<p>This<a href="#fn48" class="footnote-ref" id="fnref48"><sup>48</sup></a> is different from the plot we had in C32, where I had you use a
different colour for each <em>child</em>, and we ended up with a huge
legend of all the children (which we then removed).</p>
<p>If you forget to turn <code>location</code> into a factor, <code>ggplot</code>
will assume that you want <code>location</code> to be on a continuous
scale, and you’ll get two shades of blue.</p>
<p>Another problem with this plot is that there are so many children, you
can’t see the ones underneath because the ones on top are overwriting
them. The solution to that is to make the lines (partly) transparent,
which is controlled by a parameter <code>alpha</code>:<a href="#fn49" class="footnote-ref" id="fnref49"><sup>49</sup></a></p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="repeated-measures.html#cb285-1" aria-hidden="true" tabindex="-1"></a>airport.long <span class="sc">%&gt;%</span></span>
<span id="cb285-2"><a href="repeated-measures.html#cb285-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">parse_number</span>(when)) <span class="sc">%&gt;%</span></span>
<span id="cb285-3"><a href="repeated-measures.html#cb285-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> epinephrine, <span class="at">colour =</span> <span class="fu">factor</span>(location), <span class="at">group =</span> child)) <span class="sc">+</span></span>
<span id="cb285-4"><a href="repeated-measures.html#cb285-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="pasias_files/figure-html/skinnier-1.png" width="672" /></p>
<p>It seems to make the lines skinnier, so they look more like
threads. Even given the lesser thickness, they seem to be a little bit
see-through as well. You can experiment with adding transparency to
the points in addition.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>What do you see on your spaghetti plot? We are looking ahead
to possible effects of time, location and their interaction.</li>
</ol>
<p>Solution</p>
<p>This is not clear, so it’s very much your call.
I see the red spaghetti strands as going up further
(especially) and maybe down further than the blue ones. The
epinephrine levels of the children near the new airport are
definitely more spread out, and maybe have a higher mean, than
those of the control group of children not near the airport.
The red spaghetti strands show something of an increase over
time, at least up to time 3, after which they seem to drop
again. The blue strands, however, don’t show any kind of trend
over time. Since the time trend is different for the two
locations, I would expect to see a significant interaction.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>The spaghetti plot was hard to interpret because there are
so many children. Calculate the mean epinephrine levels for each
location-time combination, and make an interaction plot with time
on the <span class="math inline">\(x\)</span>-axis and location as the second factor.</li>
</ol>
<p>Solution</p>
<p>We’ve done this before:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="repeated-measures.html#cb286-1" aria-hidden="true" tabindex="-1"></a>airport.long <span class="sc">%&gt;%</span></span>
<span id="cb286-2"><a href="repeated-measures.html#cb286-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">parse_number</span>(when)) <span class="sc">%&gt;%</span></span>
<span id="cb286-3"><a href="repeated-measures.html#cb286-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">floc =</span> <span class="fu">factor</span>(location)) <span class="sc">%&gt;%</span></span>
<span id="cb286-4"><a href="repeated-measures.html#cb286-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(floc, time) <span class="sc">%&gt;%</span></span>
<span id="cb286-5"><a href="repeated-measures.html#cb286-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean.epi =</span> <span class="fu">mean</span>(epinephrine)) <span class="sc">%&gt;%</span></span>
<span id="cb286-6"><a href="repeated-measures.html#cb286-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> mean.epi, <span class="at">group =</span> floc, <span class="at">colour =</span> floc)) <span class="sc">+</span></span>
<span id="cb286-7"><a href="repeated-measures.html#cb286-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;floc&#39;. You can override using the
## `.groups` argument.</code></pre>
<p><img src="pasias_files/figure-html/airport-3-1.png" width="672" /></p>
<p>I wanted the actual numerical times, so I made them again. Also, it
seemed to be easier to create a factor version of the numeric location
up front, and then use it several times later. I’m actually not sure
that you need it here, since <code>group_by</code> works with the
distinct values of a variable, whatever they are, and <code>group</code>
in a boxplot may or may not insist on something other than a number. I
should try it:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="repeated-measures.html#cb288-1" aria-hidden="true" tabindex="-1"></a>airport.long <span class="sc">%&gt;%</span></span>
<span id="cb288-2"><a href="repeated-measures.html#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">parse_number</span>(when)) <span class="sc">%&gt;%</span></span>
<span id="cb288-3"><a href="repeated-measures.html#cb288-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location, time) <span class="sc">%&gt;%</span></span>
<span id="cb288-4"><a href="repeated-measures.html#cb288-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean.epi =</span> <span class="fu">mean</span>(epinephrine)) <span class="sc">%&gt;%</span></span>
<span id="cb288-5"><a href="repeated-measures.html#cb288-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> mean.epi, <span class="at">group =</span> location, <span class="at">colour =</span> location)) <span class="sc">+</span></span>
<span id="cb288-6"><a href="repeated-measures.html#cb288-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;location&#39;. You can override using the
## `.groups` argument.</code></pre>
<p><img src="pasias_files/figure-html/airport-4-1.png" width="672" /></p>
<p>It seems that <code>colour</code> requires a non-number:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="repeated-measures.html#cb290-1" aria-hidden="true" tabindex="-1"></a>airport.long <span class="sc">%&gt;%</span></span>
<span id="cb290-2"><a href="repeated-measures.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">parse_number</span>(when)) <span class="sc">%&gt;%</span></span>
<span id="cb290-3"><a href="repeated-measures.html#cb290-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location, time) <span class="sc">%&gt;%</span></span>
<span id="cb290-4"><a href="repeated-measures.html#cb290-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean.epi =</span> <span class="fu">mean</span>(epinephrine)) <span class="sc">%&gt;%</span></span>
<span id="cb290-5"><a href="repeated-measures.html#cb290-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> mean.epi, <span class="at">group =</span> location, <span class="at">colour =</span> <span class="fu">factor</span>(location))) <span class="sc">+</span></span>
<span id="cb290-6"><a href="repeated-measures.html#cb290-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;location&#39;. You can override using the
## `.groups` argument.</code></pre>
<p><img src="pasias_files/figure-html/airport-5-1.png" width="672" /></p>
<p>With a long pipeline like this, none of us get it right the first time (I
certainly didn’t), so be prepared to debug it one line at a time. The
way I like to do this is to take the pipe symbol and move it down to
the next line (moving the cursor to just before it and hitting
Enter). This ends the pipe at the end of <em>this</em> line and displays
what it produces so far. When you are happy with that, go to the start
of the next line (that currently has a pipe symbol by itself) and hit
Backspace to move the pipe symbol back where it was. Then go to the
end of the next line (where the next pipe symbol is), move <em>that</em>
to a line by itself, and so on. Keep going until each line produces
what you want, and when you are finished, the whole pipeline will do
what you want.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" style="list-style-type: lower-alpha">
<li>What do you conclude from your interaction plot? Is your
conclusion clearer than from the spaghetti plot?</li>
</ol>
<p>Solution</p>
<p>The two “traces” are not parallel, so I would expect to see
an interaction between location and time. The big difference
seems to be between times 1 and 2; the traces are the same at
time 1, and more or less parallel after time 2. Between times
1 and 2, the mean epinephrine level of the children near the
new airport increases sharply, whereas for the children in the
control group it increases much less.
This, to my mind, is very much easier to interpret than the
spaghetti plot, even the second version with the thinner
strands, because there is a lot of variability there that
obscures the overall pattern. The interaction plot is plain as
day, but it might be an oversimplification because it doesn’t
show variability.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Run a repeated-measures analysis of variance and display the
results. Go back to your original data frame, the one you read in
from the file, for this. You’ll need to make sure your numeric
<code>location</code> gets treated as a <code>factor</code>.</li>
</ol>
<p>Solution</p>
<p>The usual process. I’ll try the other way I used of making the
<code>response</code>:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="repeated-measures.html#cb292-1" aria-hidden="true" tabindex="-1"></a>airport <span class="sc">%&gt;%</span></span>
<span id="cb292-2"><a href="repeated-measures.html#cb292-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(epi_1<span class="sc">:</span>epi_4) <span class="sc">%&gt;%</span></span>
<span id="cb292-3"><a href="repeated-measures.html#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="ot">-&gt;</span> response</span>
<span id="cb292-4"><a href="repeated-measures.html#cb292-4" aria-hidden="true" tabindex="-1"></a>airport<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> <span class="fu">factor</span>(location), <span class="at">data =</span> airport)</span>
<span id="cb292-5"><a href="repeated-measures.html#cb292-5" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">colnames</span>(response)</span>
<span id="cb292-6"><a href="repeated-measures.html#cb292-6" aria-hidden="true" tabindex="-1"></a>times.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">times=</span><span class="fu">factor</span>(times))</span>
<span id="cb292-7"><a href="repeated-measures.html#cb292-7" aria-hidden="true" tabindex="-1"></a>airport<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">Manova</span>(airport<span class="fl">.1</span>, <span class="at">idata =</span> times.df, <span class="at">idesign =</span> <span class="sc">~</span>times)</span>
<span id="cb292-8"><a href="repeated-measures.html#cb292-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airport<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests:
## 
## ------------------------------------------
##  
## Term: (Intercept) 
## 
##  Response transformation matrix:
##       (Intercept)
## epi_1           1
## epi_2           1
## epi_3           1
## epi_4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)   268516272
## 
## Multivariate Tests: (Intercept)
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1  0.920129     2281      1    198 &lt; 2.22e-16 ***
## Wilks             1  0.079871     2281      1    198 &lt; 2.22e-16 ***
## Hotelling-Lawley  1 11.520204     2281      1    198 &lt; 2.22e-16 ***
## Roy               1 11.520204     2281      1    198 &lt; 2.22e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: factor(location) 
## 
##  Response transformation matrix:
##       (Intercept)
## epi_1           1
## epi_2           1
## epi_3           1
## epi_4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)     3519790
## 
## Multivariate Tests: factor(location)
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1 0.1311980 29.90002      1    198 1.3611e-07 ***
## Wilks             1 0.8688020 29.90002      1    198 1.3611e-07 ***
## Hotelling-Lawley  1 0.1510102 29.90002      1    198 1.3611e-07 ***
## Roy               1 0.1510102 29.90002      1    198 1.3611e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: times 
## 
##  Response transformation matrix:
##       times1 times2 times3
## epi_1      1      0      0
## epi_2      0      1      0
## epi_3      0      0      1
## epi_4     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##            times1     times2     times3
## times1  497500.84 -113360.08 -56261.667
## times2 -113360.08   25830.12  12819.731
## times3  -56261.67   12819.73   6362.552
## 
## Multivariate Tests: times
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1 0.3274131 31.80405      3    196 &lt; 2.22e-16 ***
## Wilks             1 0.6725869 31.80405      3    196 &lt; 2.22e-16 ***
## Hotelling-Lawley  1 0.4867966 31.80405      3    196 &lt; 2.22e-16 ***
## Roy               1 0.4867966 31.80405      3    196 &lt; 2.22e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: factor(location):times 
## 
##  Response transformation matrix:
##       times1 times2 times3
## epi_1      1      0      0
## epi_2      0      1      0
## epi_3      0      0      1
## epi_4     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##           times1    times2      times3
## times1 533081.68 206841.01 -14089.6126
## times2 206841.01  80256.38  -5466.9104
## times3 -14089.61  -5466.91    372.3954
## 
## Multivariate Tests: factor(location):times
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1 0.2373704 20.33516      3    196 1.6258e-11 ***
## Wilks             1 0.7626296 20.33516      3    196 1.6258e-11 ***
## Hotelling-Lawley  1 0.3112525 20.33516      3    196 1.6258e-11 ***
## Roy               1 0.3112525 20.33516      3    196 1.6258e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Univariate Type II Repeated-Measures ANOVA Assuming Sphericity
## 
##                          Sum Sq num Df Error SS den Df  F value    Pr(&gt;F)    
## (Intercept)            67129068      1  5827073    198 2281.000 &lt; 2.2e-16 ***
## factor(location)         879947      1  5827073    198   29.900 1.361e-07 ***
## times                    475671      3  3341041    594   28.190 &lt; 2.2e-16 ***
## factor(location):times   366641      3  3341041    594   21.728 2.306e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Mauchly Tests for Sphericity
## 
##                        Test statistic  p-value
## times                          0.9488 0.066194
## factor(location):times         0.9488 0.066194
## 
## 
## Greenhouse-Geisser and Huynh-Feldt Corrections
##  for Departure from Sphericity
## 
##                         GG eps Pr(&gt;F[GG])    
## times                  0.96685  &lt; 2.2e-16 ***
## factor(location):times 0.96685   5.35e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                           HF eps   Pr(&gt;F[HF])
## times                  0.9827628 8.418534e-17
## factor(location):times 0.9827628 3.571900e-13</code></pre>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol style="list-style-type: lower-roman">
<li>What do you conclude from the MANOVA? Is that consistent
with your graphs? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>Start with Mauchly’s test near the bottom. This is not quite significant (for the interaction), so we are entitled to look at the univariate test for interaction, which is <span class="math inline">\(2.3 \times 10^{-13}\)</span>, extremely significant. If you want a comparison, look at the Huynh-Feldt adjustment for the interaction, which is almost exactly the same (<span class="math inline">\(3.57 \times 10^{-13}\)</span>), or the multivariate tests for the interaction (almost the same again).</p>
<p>So, we start and end with the significant interaction: there is an
effect of location, but the nature of that effect depends on
time. This is the same as we saw in the interaction plot:
from time 2 on, the mean epinephrine levels for the children near
the new airport were clearly higher.
If you stare at the spaghetti plot, you <em>might</em> come to
the same conclusion. Or you might not! I suppose those red
dots at time 2 are mostly at the top, and generally so
afterwards, whereas at time 1 they are all mixed up with the
blue ones.
Interactions of this sort in this kind of analysis are very
common. There is an “intervention” or “treatment”, and the
time points are chosen so that the first one is before the
treatment happens, and the other time points are after. Then,
the results are very similar for the first time point, and
very different after that, rather than being (say) always
higher for the treatment group by about the same amount for
all times (in which case there would be no interaction).
So, you have some choices in practice as to how you might
go. You might do the MANOVA, get a significant interaction,
and draw an interaction plot to see why. You might stop there,
or you might do something like what we did in class: having
seen that the first time point is different from the others
for reasons that you can explain, do the analysis again, but
omitting the first time point. For the MANOVA, that means
tweaking your definition of your <code>response</code> to omit the
first time point. The rest of it stays the same, though you
might want to change your model numbers rather than re-using
the old ones as I did:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="repeated-measures.html#cb294-1" aria-hidden="true" tabindex="-1"></a>airport <span class="sc">%&gt;%</span></span>
<span id="cb294-2"><a href="repeated-measures.html#cb294-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(epi_2<span class="sc">:</span>epi_4) <span class="sc">%&gt;%</span></span>
<span id="cb294-3"><a href="repeated-measures.html#cb294-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="ot">-&gt;</span> response</span>
<span id="cb294-4"><a href="repeated-measures.html#cb294-4" aria-hidden="true" tabindex="-1"></a>airport<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> <span class="fu">factor</span>(location), <span class="at">data =</span> airport)</span>
<span id="cb294-5"><a href="repeated-measures.html#cb294-5" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">colnames</span>(response)</span>
<span id="cb294-6"><a href="repeated-measures.html#cb294-6" aria-hidden="true" tabindex="-1"></a>times.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">times=</span><span class="fu">factor</span>(times))</span>
<span id="cb294-7"><a href="repeated-measures.html#cb294-7" aria-hidden="true" tabindex="-1"></a>airport<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">Manova</span>(airport<span class="fl">.1</span>, <span class="at">idata =</span> times.df, <span class="at">idesign =</span> <span class="sc">~</span>times)</span>
<span id="cb294-8"><a href="repeated-measures.html#cb294-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airport<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## Warning in summary.Anova.mlm(airport.2): HF eps &gt; 1 treated as 1</code></pre>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests:
## 
## ------------------------------------------
##  
## Term: (Intercept) 
## 
##  Response transformation matrix:
##       (Intercept)
## epi_2           1
## epi_3           1
## epi_4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)   165867956
## 
## Multivariate Tests: (Intercept)
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1  0.918531 2232.383      1    198 &lt; 2.22e-16 ***
## Wilks             1  0.081469 2232.383      1    198 &lt; 2.22e-16 ***
## Hotelling-Lawley  1 11.274662 2232.383      1    198 &lt; 2.22e-16 ***
## Roy               1 11.274662 2232.383      1    198 &lt; 2.22e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: factor(location) 
## 
##  Response transformation matrix:
##       (Intercept)
## epi_2           1
## epi_3           1
## epi_4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)     3567099
## 
## Multivariate Tests: factor(location)
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1 0.1951509 48.00886      1    198 5.8219e-11 ***
## Wilks             1 0.8048491 48.00886      1    198 5.8219e-11 ***
## Hotelling-Lawley  1 0.2424690 48.00886      1    198 5.8219e-11 ***
## Roy               1 0.2424690 48.00886      1    198 5.8219e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: times 
## 
##  Response transformation matrix:
##       times1 times2
## epi_2      1      0
## epi_3      0      1
## epi_4     -1     -1
## 
## Sum of squares and products for the hypothesis:
##          times1    times2
## times1 25830.12 12819.731
## times2 12819.73  6362.552
## 
## Multivariate Tests: times
##                  Df test stat approx F num Df den Df  Pr(&gt;F)
## Pillai            1 0.0123563 1.232325      2    197 0.29385
## Wilks             1 0.9876437 1.232325      2    197 0.29385
## Hotelling-Lawley  1 0.0125109 1.232325      2    197 0.29385
## Roy               1 0.0125109 1.232325      2    197 0.29385
## 
## ------------------------------------------
##  
## Term: factor(location):times 
## 
##  Response transformation matrix:
##       times1 times2
## epi_2      1      0
## epi_3      0      1
## epi_4     -1     -1
## 
## Sum of squares and products for the hypothesis:
##          times1     times2
## times1 80256.38 -5466.9104
## times2 -5466.91   372.3954
## 
## Multivariate Tests: factor(location):times
##                  Df test stat approx F num Df den Df    Pr(&gt;F)   
## Pillai            1 0.0508561 5.277736      2    197 0.0058507 **
## Wilks             1 0.9491439 5.277736      2    197 0.0058507 **
## Hotelling-Lawley  1 0.0535811 5.277736      2    197 0.0058507 **
## Roy               1 0.0535811 5.277736      2    197 0.0058507 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Univariate Type II Repeated-Measures ANOVA Assuming Sphericity
## 
##                          Sum Sq num Df Error SS den Df   F value    Pr(&gt;F)    
## (Intercept)            55289319      1  4903856    198 2232.3830 &lt; 2.2e-16 ***
## factor(location)        1189033      1  4903856    198   48.0089 5.822e-11 ***
## times                     12915      2  2281728    396    1.1207  0.327070    
## factor(location):times    57397      2  2281728    396    4.9807  0.007306 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Mauchly Tests for Sphericity
## 
##                        Test statistic p-value
## times                         0.99068 0.39746
## factor(location):times        0.99068 0.39746
## 
## 
## Greenhouse-Geisser and Huynh-Feldt Corrections
##  for Departure from Sphericity
## 
##                         GG eps Pr(&gt;F[GG])   
## times                  0.99076   0.326702   
## factor(location):times 0.99076   0.007483 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                          HF eps  Pr(&gt;F[HF])
## times                  1.000731 0.327069634
## factor(location):times 1.000731 0.007305714</code></pre>
<p>The interaction is still significant. The sphericity test is not significant, so you can use the 0.0073 in the univariate tests as your P-value (note that the Huynh-Feldt adjustment is actually not adjusted at all).</p>
<p>So there is still not a
consistent effect of being near the new airport on epinephrine levels:
that is to say, the effect of the new airport <em>still</em> varies over
time. That might be because (looking at the interaction plot) for the
children near the new airport, the mean epinephrine level went up
again between times 2 and 3, whereas for the control children it (for
some reason) went dramatically down over the same time period.</p>
<p>We have lots of data here (200 children), so the significant
interaction effect also might not be very big.</p>
<p>Experimental designs like this are kind of awkward, because you expect
there to be some kind of pattern over time for the treatment group,
that will vary over time, whereas for the control group, you expect
there to be no pattern over time. So a significant difference shows up
as an <em>interaction</em>, which is messier to interpret than you would
like.</p>
<p>Extra: the other way to analyze repeated measures data <a href="#fn50" class="footnote-ref" id="fnref50"><sup>50</sup></a> is to treat them as “mixed models”, which
requires a different kind of analysis using the <code>lme4</code>
package. I always forget how these go, and I have to look them up when
I need them, but the idea is this: the treatments you observe, and the
time points at which you observe them, are
typically the only ones you care about (a so-called “fixed effect”),
but the individuals (children, here)
which you happen to observe are
something like a random sample of all the children you might have
observed (a so-called “random effect”). Models with random effects
in them are called “mixed models” (or, I suppose, models with both
fixed and random effects). This matters because you have repeated
observations on the <em>same</em> child. Some people like to think of
this in terms of “sources of variability”: the epinephrine levels
vary because of the location and time at which they were observed, but
also because of the particular child they happen to have been observed
for: each child has a “random effect” that they carry with them
through all the time points at which they are observed.</p>
<p>Let’s see if we can make it fly for this example. We need the data in
“long” format, the way we arranged it for graphing: the data frame
<code>airport.long</code>. I’d like to convert things to factors first:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="repeated-measures.html#cb297-1" aria-hidden="true" tabindex="-1"></a>airport.long <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb297-2"><a href="repeated-measures.html#cb297-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fchild =</span> <span class="fu">factor</span>(child),</span>
<span id="cb297-3"><a href="repeated-measures.html#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">flocation =</span> <span class="fu">factor</span>(location)</span>
<span id="cb297-4"><a href="repeated-measures.html#cb297-4" aria-hidden="true" tabindex="-1"></a>) <span class="ot">-&gt;</span> fairport</span>
<span id="cb297-5"><a href="repeated-measures.html#cb297-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-6"><a href="repeated-measures.html#cb297-6" aria-hidden="true" tabindex="-1"></a>airport<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">lmer</span>(epinephrine <span class="sc">~</span> flocation <span class="sc">*</span> when <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> fchild), <span class="at">data =</span> fairport)</span>
<span id="cb297-7"><a href="repeated-measures.html#cb297-7" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(airport<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
##                npar Sum Sq Mean Sq F value
## flocation         1 168177  168177  29.900
## when              3 475671  158557  28.190
## flocation:when    3 366641  122214  21.728</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="repeated-measures.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(airport<span class="fl">.3</span>, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## epinephrine ~ flocation * when + (1 | fchild)
##                npar    AIC    LRT   Pr(Chi)    
## &lt;none&gt;              9521.2                     
## flocation:when    3 9577.6 62.475 1.739e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The <code>anova</code> doesn’t actually give us any tests, but what you
see in the ANOVA table are the fixed effects. These are testable. The
easiest way to see what you can get rid of is <code>drop1</code>; the
chi-squared test appears to be the right one (more on that
below). This says that the interaction is strongly significant, and we
should not consider removing it, the same conclusion as our
“profile analysis” before.
The other choice for
testing is to fit a model without what you
are testing and use <code>anova</code> to compare the two models:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="repeated-measures.html#cb301-1" aria-hidden="true" tabindex="-1"></a>airport<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(airport<span class="fl">.3</span>, . <span class="sc">~</span> . <span class="sc">-</span> flocation<span class="sc">:</span>when)</span>
<span id="cb301-2"><a href="repeated-measures.html#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(airport<span class="fl">.4</span>, airport<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>## refitting model(s) with ML (instead of REML)</code></pre>
<pre><code>## Data: fairport
## Models:
## airport.4: epinephrine ~ flocation + when + (1 | fchild)
## airport.3: epinephrine ~ flocation * when + (1 | fchild)
##           npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    
## airport.4    7 9577.6 9610.4 -4781.8   9563.6                         
## airport.3   10 9521.2 9568.0 -4750.6   9501.2 62.475  3  1.739e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>There are technical considerations involved in comparing the fit of
two models (which is the reason for the
“refitting models with…”): there is one method for estimating and a different
method for testing. The test is based on “likelihood ratio”, which
means that the right test for the <code>drop1</code> above is
<code>Chisq</code>.</p>
<p>If you omit the test in <code>drop1</code>, it just gives
you AIC values, which you can use for an informal assessment. In this
case, <code>&lt;none&gt;</code> has a much smaller AIC than the interaction
(smaller by over 50), so there’s no way we should entertain taking out
the interaction. However, if it had not been significant, we would
just take it out by fitting a model like <code>airport4</code>: there is
no distinction here between “within-subject” and
“between-subject”
factors that prevented us from taking the interaction out in profile
analysis.</p>
<p>As ever when an interaction is significant, we might think about
simple effects: that is, look at the two locations separately. That
makes sense here because of the kind of experimental design it is: we
<em>expect</em> a different kind of relationship with time for the
“treatment” children (the ones living near the new airport) as
compared to the control children, the ones who live farther away. That
approach would work with either the profile-analysis way using
<code>Manova</code> or the mixed-modelling way using <code>lmer</code>. In
either case, we’d expect to see a time effect at location 1 but not at
location 2. (Having separated out locations, only the time effect
would be left for testing.) I guess I have to show you that, but I
have to get ready for class first.</p>
<p>Later</p>
<p>The nice thing about Wednesday evenings is that I am so tired from
class that I have energy for almost nothing except playing with these
things. So let’s have a crack at it.</p>
<p>Let’s start with location 1, at which we expect there to be
something happening. This is really a simple effect of time at
location 1, but in repeated measures guise. The awkwardness is that
the profile analysis needs the wide-format data, while the mixed-model
analysis needs long format, so we’ll have to repeat our process, once
for each format of data set:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="repeated-measures.html#cb304-1" aria-hidden="true" tabindex="-1"></a>loc1 <span class="ot">&lt;-</span> airport <span class="sc">%&gt;%</span> <span class="fu">filter</span>(location <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb304-2"><a href="repeated-measures.html#cb304-2" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> loc1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(epi_1<span class="sc">:</span>epi_4) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb304-3"><a href="repeated-measures.html#cb304-3" aria-hidden="true" tabindex="-1"></a>loc1<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> loc1)</span>
<span id="cb304-4"><a href="repeated-measures.html#cb304-4" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">colnames</span>(response)</span>
<span id="cb304-5"><a href="repeated-measures.html#cb304-5" aria-hidden="true" tabindex="-1"></a>times.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">times=</span><span class="fu">factor</span>(times))</span>
<span id="cb304-6"><a href="repeated-measures.html#cb304-6" aria-hidden="true" tabindex="-1"></a>loc1<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">Manova</span>(loc1<span class="fl">.1</span>, <span class="at">idata =</span> times.df, <span class="at">idesign =</span> <span class="sc">~</span>times)</span></code></pre></div>
<pre><code>## Note: model has only an intercept; equivalent type-III tests substituted.</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="repeated-measures.html#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(loc1<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## Warning in summary.Anova.mlm(loc1.2): HF eps &gt; 1 treated as 1</code></pre>
<pre><code>## 
## Type III Repeated Measures MANOVA Tests:
## 
## ------------------------------------------
##  
## Term: (Intercept) 
## 
##  Response transformation matrix:
##       (Intercept)
## epi_1           1
## epi_2           1
## epi_3           1
## epi_4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)   166760848
## 
## Multivariate Tests: (Intercept)
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1  0.897288 864.8584      1     99 &lt; 2.22e-16 ***
## Wilks             1  0.102712 864.8584      1     99 &lt; 2.22e-16 ***
## Hotelling-Lawley  1  8.735944 864.8584      1     99 &lt; 2.22e-16 ***
## Roy               1  8.735944 864.8584      1     99 &lt; 2.22e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: times 
## 
##  Response transformation matrix:
##       times1 times2 times3
## epi_1      1      0      0
## epi_2      0      1      0
## epi_3      0      0      1
## epi_4     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##            times1    times2     times3
## times1 1030275.32 87978.051 -71100.691
## times2   87978.05  7512.688  -6071.484
## times3  -71100.69 -6071.484   4906.755
## 
## Multivariate Tests: times
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1 0.4542272 26.90988      3     97 9.4963e-13 ***
## Wilks             1 0.5457728 26.90988      3     97 9.4963e-13 ***
## Hotelling-Lawley  1 0.8322643 26.90988      3     97 9.4963e-13 ***
## Roy               1 0.8322643 26.90988      3     97 9.4963e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Univariate Type III Repeated-Measures ANOVA Assuming Sphericity
## 
##               Sum Sq num Df Error SS den Df F value    Pr(&gt;F)    
## (Intercept) 41690212      1  4772262     99 864.858 &lt; 2.2e-16 ***
## times         776618      3  2774062    297  27.716 7.869e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Mauchly Tests for Sphericity
## 
##       Test statistic p-value
## times        0.95865 0.53129
## 
## 
## Greenhouse-Geisser and Huynh-Feldt Corrections
##  for Departure from Sphericity
## 
##        GG eps Pr(&gt;F[GG])    
## times 0.97423  1.748e-15 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##         HF eps   Pr(&gt;F[HF])
## times 1.007064 7.869406e-16</code></pre>
<p>This is one of those times where a pipe doesn’t quite do it. We need
to grab the data for location 1, but then we need to do two things
with it: one, create a response variable, and two, feed the response
variable <em>and</em> the location 1 data into <code>lm</code>. Pipes are
for linear sequences of things to do, and this one diverges. So, save
what you need to save, and then do it without a pipe.</p>
<p>This is one of those explanatory-variable-less repeated measures where
you <em>only</em> have things varying over time. Here, the treatment was
location, and we’re only looking at one of those locations. We still
have a within-subject design (the four times), but there is no
between-subject design left.</p>
<p>The conclusion is that there is very strong evidence of a time effect
for location 1, as we would have guessed.</p>
<p>Now, let’s see whether the mixed-model analysis comes to the same
conclusion. This time, we have to start from the <em>long</em> data set
(the one I’m using is the one called <code>fairport</code> with things as
factors) and pull out the rows for location 1. The only remaining
fixed effect is time:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="repeated-measures.html#cb309-1" aria-hidden="true" tabindex="-1"></a>fairport <span class="sc">%&gt;%</span></span>
<span id="cb309-2"><a href="repeated-measures.html#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb309-3"><a href="repeated-measures.html#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(epinephrine <span class="sc">~</span> when <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> fchild), <span class="at">data =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb309-4"><a href="repeated-measures.html#cb309-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop1</span>(<span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## epinephrine ~ when + (1 | fchild)
##        npar    AIC    LRT   Pr(Chi)    
## &lt;none&gt;      4964.1                     
## when      3 5032.1 74.048 5.796e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The effect of time is, once again, substantial. The P-value is not the
same, because the test is not the same, but it is very similar and
points to exactly the same conclusion.</p>
<p>I should perhaps point out that you don’t <em>have</em> to do these
models in a pipe. I just did because it was easier for me. But there’s
nothing wrong with doing it like this:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="repeated-measures.html#cb311-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> fairport <span class="sc">%&gt;%</span> <span class="fu">filter</span>(location <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb311-2"><a href="repeated-measures.html#cb311-2" aria-hidden="true" tabindex="-1"></a>tmp<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lmer</span>(epinephrine <span class="sc">~</span> when <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> child), <span class="at">data =</span> tmp)</span>
<span id="cb311-3"><a href="repeated-measures.html#cb311-3" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(tmp<span class="fl">.1</span>, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## epinephrine ~ when + (1 | child)
##        npar    AIC    LRT   Pr(Chi)    
## &lt;none&gt;      4964.1                     
## when      3 5032.1 74.048 5.796e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>and it gives exactly the same result.</p>
<p>This last model (in either of its versions) is a so-called random
intercepts model. What it says is that epinephrine level for a child
depends on time, but the effect of being one child rather than another
is to shunt the mean epinephrine level up or down by a fixed amount
for all times. It seems to me that this is a very reasonable way to
model the child-to-child variation in this case, but in other cases,
things might be different. <code>lmer</code> allows more sophisticated
things, like for example the random child effect depending linearly on
time. To do that, you’d rewrite the above like this:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="repeated-measures.html#cb313-1" aria-hidden="true" tabindex="-1"></a>fairport <span class="sc">%&gt;%</span></span>
<span id="cb313-2"><a href="repeated-measures.html#cb313-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb313-3"><a href="repeated-measures.html#cb313-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(epinephrine <span class="sc">~</span> when <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> when <span class="sc">|</span> fchild), <span class="at">data =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb313-4"><a href="repeated-measures.html#cb313-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop1</span>(<span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<p>The change is on the <code>lmer</code> line: the bit in brackets has a
linear model in <code>when</code> for each child. I didn’t run that, so
I’m not certain it works,<a href="#fn51" class="footnote-ref" id="fnref51"><sup>51</sup></a> but that’s the idea.</p>
<p>All right, let’s get on to location 2. This was the control location,
so we expect to see <em>no</em> dependence of epinephrine level on time,
either in the profile analysis or in the mixed-model analysis. There
is a large amount of copying and pasting coming up:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="repeated-measures.html#cb314-1" aria-hidden="true" tabindex="-1"></a>airport <span class="sc">%&gt;%</span> <span class="fu">filter</span>(location <span class="sc">==</span> <span class="dv">2</span>) <span class="ot">-&gt;</span> loc2</span>
<span id="cb314-2"><a href="repeated-measures.html#cb314-2" aria-hidden="true" tabindex="-1"></a>loc2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(epi_1<span class="sc">:</span>epi_4) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>() <span class="ot">-&gt;</span> response</span>
<span id="cb314-3"><a href="repeated-measures.html#cb314-3" aria-hidden="true" tabindex="-1"></a>loc2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> loc1)</span>
<span id="cb314-4"><a href="repeated-measures.html#cb314-4" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">colnames</span>(response)</span>
<span id="cb314-5"><a href="repeated-measures.html#cb314-5" aria-hidden="true" tabindex="-1"></a>times.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">times=</span><span class="fu">factor</span>(times))</span>
<span id="cb314-6"><a href="repeated-measures.html#cb314-6" aria-hidden="true" tabindex="-1"></a>loc2<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">Manova</span>(loc2<span class="fl">.1</span>, <span class="at">idata =</span> times.df, <span class="at">idesign =</span> <span class="sc">~</span>times)</span></code></pre></div>
<pre><code>## Note: model has only an intercept; equivalent type-III tests substituted.</code></pre>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="repeated-measures.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(loc2<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
## Type III Repeated Measures MANOVA Tests:
## 
## ------------------------------------------
##  
## Term: (Intercept) 
## 
##  Response transformation matrix:
##       (Intercept)
## epi_1           1
## epi_2           1
## epi_3           1
## epi_4           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)   105275213
## 
## Multivariate Tests: (Intercept)
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1  0.961466 2470.169      1     99 &lt; 2.22e-16 ***
## Wilks             1  0.038534 2470.169      1     99 &lt; 2.22e-16 ***
## Hotelling-Lawley  1 24.951203 2470.169      1     99 &lt; 2.22e-16 ***
## Roy               1 24.951203 2470.169      1     99 &lt; 2.22e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: times 
## 
##  Response transformation matrix:
##       times1 times2 times3
## epi_1      1      0      0
## epi_2      0      1      0
## epi_3      0      0      1
## epi_4     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##           times1    times2     times3
## times1  307.1984  5502.882   749.4117
## times2 5502.8823 98573.811 13424.3048
## times3  749.4117 13424.305  1828.1931
## 
## Multivariate Tests: times
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1 0.3023560 14.01313      3     97 1.1613e-07 ***
## Wilks             1 0.6976440 14.01313      3     97 1.1613e-07 ***
## Hotelling-Lawley  1 0.4333957 14.01313      3     97 1.1613e-07 ***
## Roy               1 0.4333957 14.01313      3     97 1.1613e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Univariate Type III Repeated-Measures ANOVA Assuming Sphericity
## 
##               Sum Sq num Df Error SS den Df  F value    Pr(&gt;F)    
## (Intercept) 26318803      1  1054811     99 2470.169 &lt; 2.2e-16 ***
## times          65694      3   566979    297   11.471 3.884e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Mauchly Tests for Sphericity
## 
##       Test statistic    p-value
## times        0.77081 0.00011477
## 
## 
## Greenhouse-Geisser and Huynh-Feldt Corrections
##  for Departure from Sphericity
## 
##        GG eps Pr(&gt;F[GG])    
## times 0.84304  2.433e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##          HF eps   Pr(&gt;F[HF])
## times 0.8669702 1.838348e-06</code></pre>
<p>I think I changed everything I needed to.</p>
<p>There actually <em>is</em> still an effect of time. This is true even though sphericity fails and so the Huynh-Feldt adjustment to the P-value is fairly substantial; even so, it is still clearly significant.</p>
<p>What kind of effect?
We can look at that by finding epinephrine means at each time. That
would be easier if we had long format, but I think we can still do
it. The magic word is <code>across</code>:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="repeated-measures.html#cb318-1" aria-hidden="true" tabindex="-1"></a>airport <span class="sc">%&gt;%</span></span>
<span id="cb318-2"><a href="repeated-measures.html#cb318-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb318-3"><a href="repeated-measures.html#cb318-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;epi&quot;</span>), \(epi) <span class="fu">mean</span>(epi)))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##   epi_1 epi_2 epi_3 epi_4
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  249.  279.  251.  247.</code></pre>
<p>(in words, “for each column that starts with <code>epi</code>, find the mean of it.”)</p>
<p>The message here is that the mean epinephrine levels at time 2 were
higher than the others, so that’s what seems to be driving the time
effect. And remember, these were the control children, so they had no
new airport nearby.</p>
<p>I want to try this:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="repeated-measures.html#cb320-1" aria-hidden="true" tabindex="-1"></a>airport <span class="sc">%&gt;%</span> <span class="fu">nest_by</span>(location)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
## # Rowwise:  location
##   location               data
##      &lt;dbl&gt; &lt;list&lt;tibble[,5]&gt;&gt;
## 1        1          [100 × 5]
## 2        2          [100 × 5]</code></pre>
<p>This is like the idea in the Spilich problem: I want to write a
function that calculates the means of the <code>epi_1</code> through
<code>epi_4</code> columns of a data frame like <code>airport</code>, and
then apply it to each of those “nested” data frames.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="repeated-measures.html#cb322-1" aria-hidden="true" tabindex="-1"></a>epi.means <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb322-2"><a href="repeated-measures.html#cb322-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;epi&quot;</span>), \(epi) <span class="fu">mean</span>(epi)))</span>
<span id="cb322-3"><a href="repeated-measures.html#cb322-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb322-4"><a href="repeated-measures.html#cb322-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-5"><a href="repeated-measures.html#cb322-5" aria-hidden="true" tabindex="-1"></a><span class="fu">epi.means</span>(airport)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##   epi_1 epi_2 epi_3 epi_4
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  248.  309.  304.  298.</code></pre>
<p>OK, and then:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="repeated-measures.html#cb324-1" aria-hidden="true" tabindex="-1"></a>airport <span class="sc">%&gt;%</span></span>
<span id="cb324-2"><a href="repeated-measures.html#cb324-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest_by</span>(location) <span class="sc">%&gt;%</span></span>
<span id="cb324-3"><a href="repeated-measures.html#cb324-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb324-4"><a href="repeated-measures.html#cb324-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">means =</span> <span class="fu">list</span>(<span class="fu">epi.means</span>(data))) <span class="sc">%&gt;%</span></span>
<span id="cb324-5"><a href="repeated-measures.html#cb324-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(means)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
##   location               data epi_1 epi_2 epi_3 epi_4
##      &lt;dbl&gt; &lt;list&lt;tibble[,5]&gt;&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1        1          [100 × 5]  247.  340.  356.  349.
## 2        2          [100 × 5]  249.  279.  251.  247.</code></pre>
<p>Ooh, nice. There are the means for the four time points at both of the
two locations. At location 1, epinephrine starts out low, jumps high
after the airport is built, and stays there, while at location 2, the
mean is mysteriously higher at time 2 and then epinephrine levels go
back down again.</p>
<p>Enough of that. Back to the mixed model analysis, with more copying
and pasting. Here is the “simple time effect” at location 2:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="repeated-measures.html#cb326-1" aria-hidden="true" tabindex="-1"></a>fairport <span class="sc">%&gt;%</span></span>
<span id="cb326-2"><a href="repeated-measures.html#cb326-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb326-3"><a href="repeated-measures.html#cb326-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(epinephrine <span class="sc">~</span> when <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> fchild), <span class="at">data =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb326-4"><a href="repeated-measures.html#cb326-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop1</span>(<span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## epinephrine ~ when + (1 | fchild)
##        npar    AIC    LRT   Pr(Chi)    
## &lt;none&gt;      4336.8                     
## when      3 4363.7 32.889 3.399e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>This also finds a time effect at location 2, with a very similar P-value.</p>
<p>So which method is preferred? They are, I think, two different ways of
approaching the same problem, and so there is no good reason to prefer
one way over the other. The profile-analysis way is easier to follow
if you are coming from a MANOVA direction: set it up the same way as
you would a MANOVA, with your repeated measures as your multivariate
response, and distinguish between the within-subject design (times,
for us) and the between-subject design (treatments, stuff like
that). As for mixed models: when you get your head around that crazy
way of specifying the random effects, which are typically “subjects”
in this kind of analysis, the actual model statement is brief:
response depends on fixed effects plus random effects with the
brackets and vertical bar. I always find the <code>lmer</code> models look
very simple once you have figured them out (like <code>ggplot</code> in
that regard). I also like the fact that <code>lmer</code> uses “tidy data”,
so that you can make graphs and do this flavour of analysis
with the same data frame. Having gotten my head around getting my data
tidy, it seems odd to me that profile analysis requires the data to be
untidy, although it does so for a good reason: if you were genuinely
doing a MANOVA, you would <em>want</em> your multiple response
variables each in their own column. Doing repeated measures this way
is thinking of your responses at different times like different
variables.</p>
<p>The approach I’ve taken in this course is for historical reasons. That
is to say, <em>my</em> history, not because the historical perspective
is necessarily the best one. It began with doing repeated measures in
SAS (this was like nine years ago), and the only way I could get my
head around that was the profile-analysis way. I’m not even sure there
was software for doing mixed models in those days, certainly not in
SAS. Besides, random effects scared me back then. Anyway, when I
moved things over to R (this must have been about six years ago), I
realized I was using basically the same idea in R: make it into a
MANOVA and tweak things as needed. So I developed things by showing
you MANOVA first as ANOVA when you have lots of <span class="math inline">\(y\)</span>-variables instead
of just one, and then using it for repeated measures by thinking of
the repeated measures as “different-but-related” <span class="math inline">\(y\)</span>-variables. To
my mind, this is a reasonable way of doing it in a course like this:
you get to see MANOVA, which is worth knowing about anyway, and then
you get to apply it to a very common situation.</p>
<p>Mixed models are actually quite recent, as a way of doing this kind of
modelling. Back when I was learning this stuff, you learned to
distinguish between “fixed effects”, whose levels were the only ones
you cared about (like the two locations here), and “random effects”,
where the ones you observed were only a sample of the ones you might
have seen (like “children” or in general “subjects”). Then you
would test the fixed effects by hypothesizing that their mean effect
was zero and seeing whether you could reject that (in the same way
that you do in regression or regular ANOVA: in the latter case, you
test that the effects of all the different groups are zero, which
comes down to saying that all the groups have the same mean). The way
you handled random effects was to estimate their <em>variance</em>, and
then you would test whether a random effect exists or not by testing
whether the variance of that random effect is zero (does not exist) or
is greater than zero. Zero is the smallest a variance (or SD) can be,
which means that testing for it has always been kind of flakey and the
standard theory doesn’t work for it (the technical term is
“on the boundary of the parameter space”, and the theory applies when the
null-hypothesis value is strictly <em>inside</em> the set of possible
values the parameter can take). Back when we did this stuff by
hand,<a href="#fn52" class="footnote-ref" id="fnref52"><sup>52</sup></a> we had to figure out whether we were testing
a fixed or a random effect, and there were rules, involving things
called “expected mean squares”, that told you how to get the tests
right. Anyway, that is all considered rather old-fashioned now, and
mixed models are where it is at. In these, you typically <em>only</em>
test the fixed effects, while estimating the size of the random
effects, taking it for granted that they exist. This is an active area
of research; the things that <code>lmer</code> fits are called
“linear mixed models”, and there are also now
“generalized linear mixed models”, things like logistic regression with random effects.</p>
<p>We haven’t had to worry about this up to now because in most of the
experimental designs we have used, each subject only contributes
<em>one</em> measurement. In that case, you cannot separate out a
subject-specific “random effect” from random error, and so we lump
it all into random error. The one experimental design where a subject
gives us more than one measurement is matched pairs, and the way we
have handled that so far is to turn the two measurements into one by
taking the difference between them; even in that case, each subject
contributes only one <em>difference</em> to the analysis. Repeated
measures, though, is genuinely different: you can’t wish away multiple
measurements on the same subject by taking differences any more, so
you have to face up to the issue at last. Either we think of it as
several different measurements that might be correlated (the
profile-analysis MANOVA way), or we face up to the idea that different
subjects bring their own random effect to the table that shows up in
every measurement that the subject provides (mixed models).</p>
<p>I did analysis of covariance as a separate mini-section, thinking of
it as a regression, but if the numerical covariate is the same thing
as the response but measured at a different time (eg., before rather than
after), that would also respond to a repeated-measures approach, or to
the taking of differences as matched pairs does. There is almost
always more than one way to look at these things.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="body-fat-as-repeated-measures-1" class="section level2 hasAnchor" number="33.10">
<h2><span class="header-section-number">33.10</span> Body fat as repeated measures<a href="repeated-measures.html#body-fat-as-repeated-measures-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This one is also stolen from STAC32. Athletes are concerned
with measuring their body fat percentage. Two different methods are
available: one using ultrasound, and the other using X-ray
technology. We are interested in whether there is a difference in the
mean body fat percentage as measured by these two methods, and if so,
how big that difference is. Data on 16 athletes are at
<a href="http://ritsokiguess.site/datafiles/bodyfat.txt">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data and check that you have a sensible number of
rows and columns.</li>
</ol>
<p>Solution</p>
<p>This kind of thing:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="repeated-measures.html#cb328-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">&quot;http://ritsokiguess.site/datafiles/bodyfat.txt&quot;</span></span>
<span id="cb328-2"><a href="repeated-measures.html#cb328-2" aria-hidden="true" tabindex="-1"></a>bodyfat <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(my_url, <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 16 Columns: 3
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot; &quot;
## dbl (3): athlete, xray, ultrasound
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="repeated-measures.html#cb330-1" aria-hidden="true" tabindex="-1"></a>bodyfat</span></code></pre></div>
<pre><code>## # A tibble: 16 × 3
##    athlete  xray ultrasound
##      &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1       1  5          4.75
##  2       2  7          3.75
##  3       3  9.25       9   
##  4       4 12         11.8 
##  5       5 17.2       17   
##  6       6 29.5       27.5 
##  7       7  5.5        6.5 
##  8       8  6          6.75
##  9       9  8          8.75
## 10      10  8.5        9.5 
## 11      11  9.25       9.5 
## 12      12 11         12   
## 13      13 12         12.2 
## 14      14 14         15.5 
## 15      15 17         18   
## 16      16 18         18.2</code></pre>
<p>16 rows (athletes) and 3 columns, one for each measurement
method and one labelling the athletes. All good.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Carry out a suitable (matched-pairs) <span class="math inline">\(t\)</span>-test to determine
whether the means are the same or different.</li>
</ol>
<p>Solution</p>
<p>Feed the two columns into <code>t.test</code> along with
<code>paired=T</code>. Remember that this is (in effect) a one-sample
<span class="math inline">\(t\)</span>-test, so that you can’t use a <code>data=</code>. You therefore have
to wrap everything in a <code>with</code>:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="repeated-measures.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(bodyfat, <span class="fu">t.test</span>(xray, ultrasound, <span class="at">paired =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  xray and ultrasound
## t = -0.30801, df = 15, p-value = 0.7623
## alternative hypothesis: true mean difference is not equal to 0
## 95 percent confidence interval:
##  -0.7425068  0.5550068
## sample estimates:
## mean difference 
##        -0.09375</code></pre>
<p>The test we want is two-sided, so we didn’t have to take any special
steps to get that.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>What do you conclude from the test?</li>
</ol>
<p>Solution</p>
<p>The P-value of 0.7623 is not at all small, so there is no way we can
reject the null hypothesis.<a href="#fn53" class="footnote-ref" id="fnref53"><sup>53</sup></a> There
is no evidence of a difference in means; we can act as if the two
methods produce the same mean body fat percentage.
That is to say, on this evidence we can use either method, whichever
one is cheaper or more convenient.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Run a repeated-measures analysis of variance, treating the two
methods of measuring body fat as the repeated measures (ie., playing
the role of “time” that you have seen in most of the other repeated
measures analyses). There is no “treatment” here, so there is
nothing to go on the right side of the squiggle. Insert a <code>1</code>
there to mean “just an intercept”. Display the results.</li>
</ol>
<p>Solution</p>
<p>Construct the response variable, run <code>lm</code>, construct the
within-subjects part of the design, run <code>Manova</code>:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="repeated-measures.html#cb334-1" aria-hidden="true" tabindex="-1"></a>bodyfat <span class="sc">%&gt;%</span></span>
<span id="cb334-2"><a href="repeated-measures.html#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(xray<span class="sc">:</span>ultrasound) <span class="sc">%&gt;%</span></span>
<span id="cb334-3"><a href="repeated-measures.html#cb334-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="ot">-&gt;</span> response</span>
<span id="cb334-4"><a href="repeated-measures.html#cb334-4" aria-hidden="true" tabindex="-1"></a>bodyfat<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb334-5"><a href="repeated-measures.html#cb334-5" aria-hidden="true" tabindex="-1"></a>methods <span class="ot">&lt;-</span> <span class="fu">colnames</span>(response)</span>
<span id="cb334-6"><a href="repeated-measures.html#cb334-6" aria-hidden="true" tabindex="-1"></a>methods.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">methods=</span><span class="fu">factor</span>(methods))</span>
<span id="cb334-7"><a href="repeated-measures.html#cb334-7" aria-hidden="true" tabindex="-1"></a>bodyfat<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">Manova</span>(bodyfat<span class="fl">.1</span>, <span class="at">idata =</span> methods.df, <span class="at">idesign =</span> <span class="sc">~</span>methods)</span></code></pre></div>
<pre><code>## Note: model has only an intercept; equivalent type-III tests substituted.</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="repeated-measures.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bodyfat<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
## Type III Repeated Measures MANOVA Tests:
## 
## ------------------------------------------
##  
## Term: (Intercept) 
## 
##  Response transformation matrix:
##            (Intercept)
## xray                 1
## ultrasound           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)        9025
## 
## Multivariate Tests: (Intercept)
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1  0.797341 59.01586      1     15 1.4135e-06 ***
## Wilks             1  0.202659 59.01586      1     15 1.4135e-06 ***
## Hotelling-Lawley  1  3.934390 59.01586      1     15 1.4135e-06 ***
## Roy               1  3.934390 59.01586      1     15 1.4135e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: methods 
## 
##  Response transformation matrix:
##            methods1
## xray             -1
## ultrasound        1
## 
## Sum of squares and products for the hypothesis:
##          methods1
## methods1 0.140625
## 
## Multivariate Tests: methods
##                  Df test stat   approx F num Df den Df  Pr(&gt;F)
## Pillai            1 0.0062849 0.09486999      1     15 0.76231
## Wilks             1 0.9937151 0.09486999      1     15 0.76231
## Hotelling-Lawley  1 0.0063247 0.09486999      1     15 0.76231
## Roy               1 0.0063247 0.09486999      1     15 0.76231
## 
## Univariate Type III Repeated-Measures ANOVA Assuming Sphericity
## 
##             Sum Sq num Df Error SS den Df F value    Pr(&gt;F)    
## (Intercept) 4512.5      1  1146.94     15 59.0159 1.413e-06 ***
## methods        0.1      1    11.12     15  0.0949    0.7623    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>This is an unusual one in that the repeated measures variable is not time but method, and there is no actual
treatment. The consequence (with there being only two methods) is that sphericity is automatically good, and the univariate test for methods (at the bottom) has exactly the same P-value as all the multivariate tests, so that the conclusion is the same either way. (Also, see below about the matched pairs.)</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Compare your repeated-measures analysis to your matched-pairs
one. Do you draw the same conclusions?</li>
</ol>
<p>Solution</p>
<p>The P-value for <code>methods</code>, which is testing the same thing
as the matched pairs, is 0.7623, which is actually
<em>identical</em> to the matched pairs <span class="math inline">\(t\)</span>-test, and so the
conclusion is identical also. That is, there is no difference
between the two methods for measuring body fat.
This goes to show that repeated measures gives the same answer as
a matched-pairs <span class="math inline">\(t\)</span>-test in the situation where they both
apply. But repeated measures is, as we have seen, a lot more general.</p>
<p>Since this really is repeated measures, we ought to be able to use
a mixed model here too. We need “long” or “tidy” format, which
we don’t have yet. One pipe to save them all, to paraphrase Lord
of the Rings<a href="#fn54" class="footnote-ref" id="fnref54"><sup>54</sup></a> — put all the fat measurements in one column with a
label saying which <code>method</code> they were obtained with; create
a column which is the athlete number as a factor; fit the linear
mixed model; see what we can drop from it:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="repeated-measures.html#cb338-1" aria-hidden="true" tabindex="-1"></a>bodyfat</span></code></pre></div>
<pre><code>## # A tibble: 16 × 3
##    athlete  xray ultrasound
##      &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1       1  5          4.75
##  2       2  7          3.75
##  3       3  9.25       9   
##  4       4 12         11.8 
##  5       5 17.2       17   
##  6       6 29.5       27.5 
##  7       7  5.5        6.5 
##  8       8  6          6.75
##  9       9  8          8.75
## 10      10  8.5        9.5 
## 11      11  9.25       9.5 
## 12      12 11         12   
## 13      13 12         12.2 
## 14      14 14         15.5 
## 15      15 17         18   
## 16      16 18         18.2</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="repeated-measures.html#cb340-1" aria-hidden="true" tabindex="-1"></a>bodyfat <span class="sc">%&gt;%</span></span>
<span id="cb340-2"><a href="repeated-measures.html#cb340-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>athlete, <span class="at">names_to=</span><span class="st">&quot;method&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;fat&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb340-3"><a href="repeated-measures.html#cb340-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fathlete =</span> <span class="fu">factor</span>(athlete)) <span class="sc">%&gt;%</span></span>
<span id="cb340-4"><a href="repeated-measures.html#cb340-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(fat <span class="sc">~</span> method <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> fathlete), <span class="at">data =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb340-5"><a href="repeated-measures.html#cb340-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop1</span>(<span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## fat ~ method + (1 | fathlete)
##        npar    AIC     LRT Pr(Chi)
## &lt;none&gt;      161.34                
## method    1 159.44 0.10088  0.7508</code></pre>
<p>Once again, there is no difference between methods, and though the
P-value is different from the matched pairs or profile analysis, it is
very close to those.</p>
<p>If you’re not clear about the tidy data frame used for input to
<code>lmer</code>, pull the top two lines off the pipeline and see what they produce:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="repeated-measures.html#cb342-1" aria-hidden="true" tabindex="-1"></a>bodyfat <span class="sc">%&gt;%</span></span>
<span id="cb342-2"><a href="repeated-measures.html#cb342-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>athlete, <span class="at">names_to=</span><span class="st">&quot;method&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;fat&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb342-3"><a href="repeated-measures.html#cb342-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fathlete =</span> <span class="fu">factor</span>(athlete))</span></code></pre></div>
<pre><code>## # A tibble: 32 × 4
##    athlete method       fat fathlete
##      &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;fct&gt;   
##  1       1 xray        5    1       
##  2       1 ultrasound  4.75 1       
##  3       2 xray        7    2       
##  4       2 ultrasound  3.75 2       
##  5       3 xray        9.25 3       
##  6       3 ultrasound  9    3       
##  7       4 xray       12    4       
##  8       4 ultrasound 11.8  4       
##  9       5 xray       17.2  5       
## 10       5 ultrasound 17    5       
## # … with 22 more rows</code></pre>
<p>Each athlete now appears twice: once with their <code>fat</code> measured
by <code>xray</code>, and again with it measured by
<code>ultrasound</code>. The column <code>fathlete</code> is a factor.</p>
<p>The mixed model took me two goes to get right: I forgot that I needed the
<code>data=.</code> in <code>lmer</code>, because it works like <code>lm</code>
with the model formula first, not the input data. If the pipeline is
going too fast for you, create the tidy data frame and save it, then
use the saved data frame as input to <code>lmer</code>.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="investigating-motor-activity-in-rats-1" class="section level2 hasAnchor" number="33.11">
<h2><span class="header-section-number">33.11</span> Investigating motor activity in rats<a href="repeated-measures.html#investigating-motor-activity-in-rats-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A researcher named King was investigating
the effect of the drug midazolam on motor activity in rats. Typically,
the first time the drug is injected, a rat’s motor activity decreases
substantially, but rats typically develop a “tolerance”, so that
further injections of the drug have less impact on the rat’s motor
activity.</p>
<p>The data shown in
<a href="http://ritsokiguess.site/datafiles/king.csv">link</a> were all taken
in one day, called the “experiment day” below. 24 different rats
were used. Each rat, on the experiment day, was injected with a fixed
amount of midazolam, and at each of six five-minute intervals after
being injected, the rat’s motor activity was measured (these are
labelled <code>i1</code> through <code>i6</code> in the data). The rats
differed in how they had been treated before the experiment day. The
control group of rats had previously been injected repeatedly with a
saline solution (no active ingredient), so the experiment day was the
first time this group of rats had received midazolam. The other two
groups of rats had both received midazolam repeatedly before the
experiment day: the “same” group was injected on experiment day in
the same environment that the previous injections had taken place (this
is known in psychology as a “conditioned tolerance”), but the
“different” group had the previous injections in a different
environment than on experiment day.</p>
<p>The column <code>id</code> identifies the rat from which each sequence of
values was obtained.</p>
<ol style="list-style-type: lower-alpha">
<li>Explain briefly why we need to use a repeated measures
analysis for these data.</li>
</ol>
<p>Solution</p>
<p>Each rat is measured at six different times (<code>i1</code> through
<code>i6</code>): that is to say, each row of the data set consists of
repeated measurements on the <em>same</em> rat. (If each row had
used six <em>different</em> rats to obtain the six measurements, we
would have been back in familiar territory and could have used a
regular analysis of variance.)</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Read in the data and note that you have what was promised
in the question.</li>
</ol>
<p>Solution</p>
<p>The usual:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="repeated-measures.html#cb344-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">&quot;http://ritsokiguess.site/datafiles/king.csv&quot;</span></span>
<span id="cb344-2"><a href="repeated-measures.html#cb344-2" aria-hidden="true" tabindex="-1"></a>king <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(my_url)</span></code></pre></div>
<pre><code>## Rows: 24 Columns: 8
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): context
## dbl (7): id, i1, i2, i3, i4, i5, i6
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="repeated-measures.html#cb346-1" aria-hidden="true" tabindex="-1"></a>king</span></code></pre></div>
<pre><code>## # A tibble: 24 × 8
##       id context    i1    i2    i3    i4    i5    i6
##    &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1   101 control   150    44    71    59   132    74
##  2   102 control   335   270   156   160   118   230
##  3   103 control   149    52    91   115    43   154
##  4   104 control   159    31   127   212    71   224
##  5   105 control   292   125   184   246   225   170
##  6   106 control   297   187    66    96   209    74
##  7   107 control   170    37    42    66   114    81
##  8   108 control   159     0    35    75    71    34
##  9   109 same      346   175   177   192   239   140
## 10   110 same      426   329   236    76   102   232
## # … with 14 more rows</code></pre>
<p>There are 24 rats (rows). The columns label the rat (<code>id</code>) and
the times at which motor activity was measured (<code>i1</code> through
<code>i6</code>). The remaining column, <code>context</code>, describes how
the rats were treated before experiment day, with the levels being the
same ones given in the question.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>We are going to do a repeated-measures analysis using the
“profile” method shown in class. Create a suitable response
variable for this method.</li>
</ol>
<p>Solution</p>
<p><code>cbind</code> the appropriate columns together, to make a matrix:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="repeated-measures.html#cb348-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">with</span>(king, <span class="fu">cbind</span>(i1, i2, i3, i4, i5, i6))</span></code></pre></div>
<p>This is the “simple” but tedious way, and produces a matrix because
the <code>i1</code> through <code>i6</code> are vectors (single columns):</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="repeated-measures.html#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(response)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<p><code>i1:i6</code> does not work here, because we are outside of the
<code>tidyverse</code>, and in that world, <code>:</code> only means
“through” (as in “this through that”) when the things on either
side of it are or represent numbers.</p>
<p>The clever way to get the response is to <code>select</code> the columns
and then turn them into a matrix. This <em>does</em> permit the colon
because we are now in the <code>tidyverse</code>:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="repeated-measures.html#cb351-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> king <span class="sc">%&gt;%</span></span>
<span id="cb351-2"><a href="repeated-measures.html#cb351-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(i1<span class="sc">:</span>i6) <span class="sc">%&gt;%</span></span>
<span id="cb351-3"><a href="repeated-measures.html#cb351-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb351-4"><a href="repeated-measures.html#cb351-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(response)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<p>It is indeed a matrix.</p>
<p>I tried to be extra-clever and use <code>starts_with</code>, but I have
another column <code>id</code> that starts with <code>i</code> that I do
<em>not</em> want to be part of the response. So I had to abandon that
idea, but not before trying this:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="repeated-measures.html#cb353-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> king <span class="sc">%&gt;%</span></span>
<span id="cb353-2"><a href="repeated-measures.html#cb353-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&quot;i[0-9]&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb353-3"><a href="repeated-measures.html#cb353-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb353-4"><a href="repeated-measures.html#cb353-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(response)</span></code></pre></div>
<pre><code>##       i1  i2  i3  i4  i5  i6
## [1,] 150  44  71  59 132  74
## [2,] 335 270 156 160 118 230
## [3,] 149  52  91 115  43 154
## [4,] 159  31 127 212  71 224
## [5,] 292 125 184 246 225 170
## [6,] 297 187  66  96 209  74</code></pre>
<p><code>head</code> displays the first six lines (of anything). We don’t
normally need it because we are typically dealing with
<code>tibble</code>-like data frames that display only ten rows of
themselves by default. But this worked. The <code>matches</code> part
takes a so-called “regular expression” which is a very flexible way
of matching anything: in this case, a column whose name starts with
<code>i</code> followed by exactly one digit (something between 0 and 9
inclusive).</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Set up the “within-subjects” part of the analysis. That
means getting hold of the names of the columns that hold the
different times, saving them, and also making a data frame out of them:</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="repeated-measures.html#cb355-1" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">colnames</span>(response)</span>
<span id="cb355-2"><a href="repeated-measures.html#cb355-2" aria-hidden="true" tabindex="-1"></a>times.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">times=</span><span class="fu">factor</span>(times))</span></code></pre></div>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Fit the repeated-measures ANOVA. This will involve fitting
an <code>lm</code> first, if you have not already done so.</li>
</ol>
<p>Solution</p>
<p>Fit the <code>lm</code> first, and then pass that into <code>Manova</code>
from <code>car</code>:</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="repeated-measures.html#cb356-1" aria-hidden="true" tabindex="-1"></a>king<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> context, <span class="at">data =</span> king)</span>
<span id="cb356-2"><a href="repeated-measures.html#cb356-2" aria-hidden="true" tabindex="-1"></a>king<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">Manova</span>(king<span class="fl">.1</span>, <span class="at">idata =</span> times.df, <span class="at">idesign =</span> <span class="sc">~</span>times)</span>
<span id="cb356-3"><a href="repeated-measures.html#cb356-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(king<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests:
## 
## ------------------------------------------
##  
## Term: (Intercept) 
## 
##  Response transformation matrix:
##    (Intercept)
## i1           1
## i2           1
## i3           1
## i4           1
## i5           1
## i6           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)    24399650
## 
## Multivariate Tests: (Intercept)
##                  Df test stat approx F num Df den Df    Pr(&gt;F)    
## Pillai            1  0.913261 221.1069      1     21 1.273e-12 ***
## Wilks             1  0.086739 221.1069      1     21 1.273e-12 ***
## Hotelling-Lawley  1 10.528902 221.1069      1     21 1.273e-12 ***
## Roy               1 10.528902 221.1069      1     21 1.273e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: context 
## 
##  Response transformation matrix:
##    (Intercept)
## i1           1
## i2           1
## i3           1
## i4           1
## i5           1
## i6           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)     1611524
## 
## Multivariate Tests: context
##                  Df test stat approx F num Df den Df    Pr(&gt;F)   
## Pillai            2 0.4101695 7.301725      2     21 0.0039141 **
## Wilks             2 0.5898305 7.301725      2     21 0.0039141 **
## Hotelling-Lawley  2 0.6954024 7.301725      2     21 0.0039141 **
## Roy               2 0.6954024 7.301725      2     21 0.0039141 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: times 
## 
##  Response transformation matrix:
##    times1 times2 times3 times4 times5
## i1      1      0      0      0      0
## i2      0      1      0      0      0
## i3      0      0      1      0      0
## i4      0      0      0      1      0
## i5      0      0      0      0      1
## i6     -1     -1     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##             times1      times2       times3      times4      times5
## times1 463982.0417 18075.41667 -17241.16667 -47691.2917  973.291667
## times2  18075.4167   704.16667   -671.66667  -1857.9167   37.916667
## times3 -17241.1667  -671.66667    640.66667   1772.1667  -36.166667
## times4 -47691.2917 -1857.91667   1772.16667   4902.0417 -100.041667
## times5    973.2917    37.91667    -36.16667   -100.0417    2.041667
## 
## Multivariate Tests: times
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1  0.856997 20.37569      5     17 1.2326e-06 ***
## Wilks             1  0.143003 20.37569      5     17 1.2326e-06 ***
## Hotelling-Lawley  1  5.992849 20.37569      5     17 1.2326e-06 ***
## Roy               1  5.992849 20.37569      5     17 1.2326e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: context:times 
## 
##  Response transformation matrix:
##    times1 times2 times3 times4 times5
## i1      1      0      0      0      0
## i2      0      1      0      0      0
## i3      0      0      1      0      0
## i4      0      0      0      1      0
## i5      0      0      0      0      1
## i6     -1     -1     -1     -1     -1
## 
## Sum of squares and products for the hypothesis:
##           times1    times2    times3    times4    times5
## times1 40376.583 44326.333 28404.667 -6315.458  9666.458
## times2 44326.333 93153.083 56412.417  3080.292 24377.208
## times3 28404.667 56412.417 34289.083  1235.458 14606.042
## times4 -6315.458  3080.292  1235.458  3241.583  1586.167
## times5  9666.458 24377.208 14606.042  1586.167  6573.083
## 
## Multivariate Tests: context:times
##                  Df test stat approx F num Df den Df    Pr(&gt;F)   
## Pillai            2 0.8033948 2.417022     10     36 0.0256284 * 
## Wilks             2 0.3347058 2.476886     10     34 0.0237616 * 
## Hotelling-Lawley  2 1.5750953 2.520152     10     32 0.0230293 * 
## Roy               2 1.2432100 4.475556      5     18 0.0079604 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Univariate Type II Repeated-Measures ANOVA Assuming Sphericity
## 
##                Sum Sq num Df Error SS den Df  F value    Pr(&gt;F)    
## (Intercept)   4066608      1   386233     21 221.1069 1.273e-12 ***
## context        268587      2   386233     21   7.3017 0.0039141 ** 
## times          407439      5   273592    105  31.2736 &lt; 2.2e-16 ***
## context:times   88901     10   273592    105   3.4119 0.0006746 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Mauchly Tests for Sphericity
## 
##               Test statistic  p-value
## times                0.24793 0.022324
## context:times        0.24793 0.022324
## 
## 
## Greenhouse-Geisser and Huynh-Feldt Corrections
##  for Departure from Sphericity
## 
##                GG eps Pr(&gt;F[GG])    
## times         0.70016  3.152e-14 ***
## context:times 0.70016   0.003269 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                  HF eps   Pr(&gt;F[HF])
## times         0.8573896 6.269000e-17
## context:times 0.8573896 1.422381e-03</code></pre>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>What do you conclude from your repeated-measures ANOVA?
Explain briefly, in the context of the data.</li>
</ol>
<p>Solution</p>
<p>The interaction term is significant, with a P-value less than
0.05. This is where we start and stop looking.</p>
<p>To be precise, the sphericity test fails (P-value 0.022), so that the P-value in the univariate test for interaction is too small, and we should trust the Huynh-Feldt one of 0.0014 below it. This is still significant, but not as significant as you might have thought. For comparison, the multivariate test P-values vary between 0.008 and 0.026, a bit bigger but still significant.</p>
<p>This means that the effect of time on motor activity (that is, the
way the motor activity depends on time) is different for each
<code>context</code>. That’s all we can say now.
Grading note: as long as the setup and MANOVA are done somewhere,
I don’t mind which part they are labelled with. But you need to do
the setup, initial <code>lm</code> and <code>Manova</code>
<em>somewhere</em> so that everything comes out right in the end.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" style="list-style-type: lower-alpha">
<li>To understand the results of the previous part, we are going
to make a spaghetti plot. In preparation for that, we need to save
the data in “long format” with one observation on <em>one</em> time
point in each row. Arrange that, and show by displaying (some of)
the data that you have done so.</li>
</ol>
<p>Solution</p>
<p>This is <code>pivot_longer</code> yet again: gather up columns <code>i1</code>
through <code>i6</code> and call them something like <code>activity</code>:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="repeated-measures.html#cb358-1" aria-hidden="true" tabindex="-1"></a>king <span class="sc">%&gt;%</span> </span>
<span id="cb358-2"><a href="repeated-measures.html#cb358-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(i1<span class="sc">:</span>i6, <span class="at">names_to=</span><span class="st">&quot;time&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;activity&quot;</span>) <span class="ot">-&gt;</span> king.long</span>
<span id="cb358-3"><a href="repeated-measures.html#cb358-3" aria-hidden="true" tabindex="-1"></a>king.long</span></code></pre></div>
<pre><code>## # A tibble: 144 × 4
##       id context time  activity
##    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
##  1   101 control i1         150
##  2   101 control i2          44
##  3   101 control i3          71
##  4   101 control i4          59
##  5   101 control i5         132
##  6   101 control i6          74
##  7   102 control i1         335
##  8   102 control i2         270
##  9   102 control i3         156
## 10   102 control i4         160
## # … with 134 more rows</code></pre>
<p>Displaying the top 10 rows of the resulting data frame is a good way to display “some of” it.
You can always look at more if you like. There are more rows
and fewer columns than there were before, which is
encouraging. <code>pivot_longer</code> collects up all the time and activity values for the first rat, then the second, and so on.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Make a spaghetti plot: that is, plot motor activity against
the time points, joining the points for each <em>rat</em> by lines,
and colouring the points and lines according to the <em>context</em>.</li>
</ol>
<p>Solution</p>
<p>That means this, using <code>group</code> to indicate which points to
join by lines, since it’s different from the <code>colour</code>:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="repeated-measures.html#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(king.long, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> activity, <span class="at">colour =</span> context, <span class="at">group =</span> id)) <span class="sc">+</span></span>
<span id="cb360-2"><a href="repeated-measures.html#cb360-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="pasias_files/figure-html/king-9-1.png" width="672" /></p>
<p>I’d say the <code>geom_point</code> is optional, so that this is also
good, perhaps better even:</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="repeated-measures.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(king.long, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> activity, <span class="at">colour =</span> context, <span class="at">group =</span> id)) <span class="sc">+</span></span>
<span id="cb361-2"><a href="repeated-measures.html#cb361-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="pasias_files/figure-html/king-10-1.png" width="672" /></p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol style="list-style-type: lower-roman">
<li>Looking at your spaghetti plot, why do you think your
repeated-measures ANOVA came out as it did? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>What you’re after is an explanation of how the <em>patterns</em> over
time are different for the three <code>context</code>s. If you can find
something that says that, I’m good. For example, even though all of
the rats experienced a decrease in motor activity between times 1
and 2, the rats in the <code>same</code> group didn’t decrease as
much. Or, the rats in the <code>same</code> group continued to decrease
beyond time 2, whereas the rats in the <code>control</code> and
<code>different</code> groups tended to level off after time 2, not
decreasing so much after that.
If you like, you can draw an interaction plot by working out the
means for each <code>context</code>-<code>time</code> group first:</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="repeated-measures.html#cb362-1" aria-hidden="true" tabindex="-1"></a>king.long <span class="sc">%&gt;%</span></span>
<span id="cb362-2"><a href="repeated-measures.html#cb362-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(context, time) <span class="sc">%&gt;%</span></span>
<span id="cb362-3"><a href="repeated-measures.html#cb362-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">m =</span> <span class="fu">mean</span>(activity)) <span class="sc">%&gt;%</span></span>
<span id="cb362-4"><a href="repeated-measures.html#cb362-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> m, <span class="at">colour =</span> context, <span class="at">group =</span> context)) <span class="sc">+</span></span>
<span id="cb362-5"><a href="repeated-measures.html#cb362-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;context&#39;. You can override using the
## `.groups` argument.</code></pre>
<p><img src="pasias_files/figure-html/king-11-1.png" width="672" /></p>
<p>This seems to illustrate the same things as I found on the spaghetti
plot. It gains in clarity by only looking at means, but loses by not
considering the variability. Your call.</p>
<p>This kind of thing also runs with <code>lmer</code> from package
<code>lme4</code>. It uses the long data frame, thus, treating <code>id</code>
(identifying the rats) as a random effect:</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="repeated-measures.html#cb364-1" aria-hidden="true" tabindex="-1"></a>king<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">lmer</span>(activity <span class="sc">~</span> context <span class="sc">*</span> time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> id), <span class="at">data =</span> king.long)</span></code></pre></div>
<p>What can we drop? The only thing under consideration is the interaction:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="repeated-measures.html#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(king<span class="fl">.3</span>, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## activity ~ context * time + (1 | id)
##              npar    AIC    LRT   Pr(Chi)    
## &lt;none&gt;            1609.0                     
## context:time   10 1622.7 33.764 0.0002025 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>and we get the same conclusion as before, but with a much smaller P-value.</p>
<p>With this kind of modelling, there is no distinction between
“within” and “between”, so that even though <code>time</code> is a
within-subjects factor and <code>context</code> is between subjects, if
the interaction had not been significant, we could have dropped it
from the model, and then we would have had an effect of <code>time</code>
and an effect of <code>context</code>, independent of each other. I was
actually looking for an example with a non-significant interaction,
but I couldn’t find one.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="repeated-measures-with-no-background-1" class="section level2 hasAnchor" number="33.12">
<h2><span class="header-section-number">33.12</span> Repeated measures with no background<a href="repeated-measures.html#repeated-measures-with-no-background-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Nine people are randomly chosen to receive one of three
treatments, labelled A, B and C. Each person has their response
<code>y</code> to the treatment measured at three times, labelled T1, T2
and T3. The main aim of the study is to properly assess the effects of
the treatments. A higher value of <code>y</code> is better.</p>
<p>The data are in <a href="http://ritsokiguess.site/datafiles/rm.txt">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>There are <span class="math inline">\(9 \times 3=27\)</span> observations of <code>y</code> in
this study. Why would it be wrong to treat these as 27 independent
observations? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>There are only 9 people with 3 observations on each person. The
three observations on the same person are likely to be correlated
with each other, and so treating them as independent would be a
mistake.
This is repeated-measures data. If you say that, that’s useful,
but you also need to demonstrate that you know what repeated
measures <em>means</em> and why it needs to be handled differently
from one-observation-per-individual data. Another way to look at
it is that individuals will differ from each other, and so there
ought to be an “individual” effect included in the model, in the
same way that you would include a block effect in a randomized
block design: not because you care about differences among
individuals, but because you are pretty sure they’ll be there and
you want to account for them.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Read in the data values. Are they tidy or untidy? Explain
briefly. (The data values are separated by <em>tabs</em>, like the
Australian athlete data.)</li>
</ol>
<p>Solution</p>
<p>We therefore need <code>read_tsv</code>. I’m not quite sure what to
call this one:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="repeated-measures.html#cb367-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">&quot;http://ritsokiguess.site/datafiles/rm.txt&quot;</span></span>
<span id="cb367-2"><a href="repeated-measures.html#cb367-2" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(my_url)</span></code></pre></div>
<pre><code>## Rows: 27 Columns: 4
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;\t&quot;
## chr (2): trt, time
## dbl (2): subject, y
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="repeated-measures.html#cb369-1" aria-hidden="true" tabindex="-1"></a>treatments</span></code></pre></div>
<pre><code>## # A tibble: 27 × 4
##    trt   time  subject     y
##    &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1 A     T1          1    10
##  2 A     T1          2    12
##  3 A     T1          3    13
##  4 A     T2          1    16
##  5 A     T2          2    19
##  6 A     T2          3    20
##  7 A     T3          1    25
##  8 A     T3          2    27
##  9 A     T3          3    28
## 10 B     T1          4    12
## # … with 17 more rows</code></pre>
<p>Find a way to display what you have, so you can decide whether it is
tidy or not.
Each observation of <code>y</code> is in a row by itself, so this is
tidy, or long format. You might even call this extra-tidy, because
each person is spread over three rows, one for each time point.
Looking ahead, this is ideal for making a graph, or for doing the
advanced version of the analysis with <code>lme4</code>, but it is not
so good for our MANOVA way of doing a repeated measures
analysis. That we will have to prepare for.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Make a spaghetti plot: that is, a plot of <code>y</code>
against time, with the observations for the same individual joined
by lines which are coloured according to the treatment that
individual received.</li>
</ol>
<p>Solution</p>
<p>The individuals are labelled in <code>subject</code> and the
treatments are in <code>trt</code>, which means we need to do this:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="repeated-measures.html#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(treatments, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> y, <span class="at">colour =</span> trt, <span class="at">group =</span> subject)) <span class="sc">+</span></span>
<span id="cb371-2"><a href="repeated-measures.html#cb371-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="pasias_files/figure-html/bock-1.png" width="672" /></p>
<p>I’m going to be all smug and tell you that I got this right first
time. (I’m telling you this because it doesn’t happen often.) If it didn’t come out that way for you, no stress: figure out what went wrong, fix it, and no one is any the wiser. On a spaghetti plot, you want to join together the points that belong to the same <em>subject</em>, and you want to colour them by <em>treatment</em>, so <code>colour</code> needs to be <code>trt</code> and <code>group</code> needs to be <code>subject</code>, since otherwise <em>all</em> the observations on the same treatment will get connected by lines, which is not what you want. You can use <code>group</code> in other contexts too, but for us we would normally distinguish groups by colour, and here we have two grouping variables (subject and treatment), which we want to distinguish in different ways.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>On your spaghetti plot, how do the values of <code>y</code> for
the treatments compare over time?</li>
</ol>
<p>Solution</p>
<p>The most obvious thing is that the values of <code>y</code> <em>all</em>
go up over time, regardless of which treatment they were from.
At the initial time T1, the treatments are all about the same, but
at the second and third time points, <code>y</code> is bigger for
treatment C than for the other two treatments (which are about the
same as each other). If you like, say that the gap between
treatment C and the others is increasing over time, or that the
lines for treatment C are steeper than for the other
treatments. Any of those ways of saying it comes to the same
conclusion.
Extra: if you look at the lines of the same colour (treatment),
they don’t seem to cross over very much. That suggests that an
individual who starts with a larger value of <code>y</code>
(relatively, compared to the other individuals on the same
treatment) tends to stay larger than the other individuals on the
same treatment all the way through. This would be another thing
you’d see if the measurements for the individuals are correlated,
or if there is an “individual effect” to go along with a
treatment effect (and a time effect).
If you think of this like an individual-level version of an
interaction plot (which would be obtained by plotting the
<em>means</em> for each treatment at each time), there is a
suggestion here of an interaction between treatment and time, as
well as a treatment effect (the latter because treatment C appears
better than the rest).</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Explain briefly how the data are in the wrong format for a
repeated-measures ANOVA (done using MANOVA, as in class), and use
<code>pivot_wider</code> to get the data set into the right format.</li>
</ol>
<p>Solution</p>
<p>For MANOVA, we want the three responses (here, the values of
<code>y</code> at the three different times) in three separate
columns, with <em>all</em> the measurements for one subject in one
row (rather than on three separate rows, as here).
<code>pivot_wider</code> is the flip-side of <code>pivot_longer</code>: instead of
making different columns that all measure the same thing into one
column, we split one column that contains things that are (slightly)
different from each other (here, <code>y</code> at different
times). It needs two inputs: <code>names_from</code>, the current single column that
contains the column names you are going to make, and <code>values_from</code>, the values to
carry along with them:</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="repeated-measures.html#cb372-1" aria-hidden="true" tabindex="-1"></a>treatments <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time, <span class="at">values_from =</span> y) <span class="ot">-&gt;</span> tr2</span>
<span id="cb372-2"><a href="repeated-measures.html#cb372-2" aria-hidden="true" tabindex="-1"></a>tr2</span></code></pre></div>
<pre><code>## # A tibble: 9 × 5
##   trt   subject    T1    T2    T3
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A           1    10    16    25
## 2 A           2    12    19    27
## 3 A           3    13    20    28
## 4 B           4    12    18    25
## 5 B           5    11    20    26
## 6 B           6    10    22    27
## 7 C           7    10    22    31
## 8 C           8    12    23    34
## 9 C           9    13    22    33</code></pre>
<p>(I got this right the first time too. I must be having a good day!)</p>
<p>Technical detail: in <code>pivot_longer</code>, the column names are in quotes because they don’t exist yet, but in <code>pivot_wider</code>, they are <em>not</em> in quotes because they are columns that already exist.</p>
<p>Note that the <code>time</code> and <code>y</code> columns have
<em>disappeared</em>: the columns labelled with the time points are
where those values of <code>y</code> have gone. The nine subjects make up
the nine rows of the new “wide” data set, which is in the format we
want.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Run a repeated-measures ANOVA the <code>Manova</code> way. What do you
conclude from it?</li>
</ol>
<p>Solution</p>
<p>Create the response variable first, and use it in an <code>lm</code>:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="repeated-measures.html#cb374-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">with</span>(tr2, <span class="fu">cbind</span>(T1, T2, T3))</span>
<span id="cb374-2"><a href="repeated-measures.html#cb374-2" aria-hidden="true" tabindex="-1"></a>treatment<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> trt, <span class="at">data =</span> tr2)</span></code></pre></div>
<p>Now we have to construct the within-subject stuff, for which we need
to get the different times we have. You can type them in again (fine
here), or get them from the <code>response</code> you just made:</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="repeated-measures.html#cb375-1" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">colnames</span>(response)</span>
<span id="cb375-2"><a href="repeated-measures.html#cb375-2" aria-hidden="true" tabindex="-1"></a>times.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">times=</span><span class="fu">factor</span>(times))</span></code></pre></div>
<p>This is where the possible time effect is accounted for. Because time
is within-subjects (each subject is measured at several different
times) but treatment is between subjects (each subject only gets one
treatment), the two things have to be treated separately, in this
approach at least.</p>
<p>Then, uppercase-M <code>Manova</code>:</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="repeated-measures.html#cb376-1" aria-hidden="true" tabindex="-1"></a>treatment<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">Manova</span>(treatment<span class="fl">.1</span>, <span class="at">idata =</span> times.df, <span class="at">idesign =</span> <span class="sc">~</span>times)</span>
<span id="cb376-2"><a href="repeated-measures.html#cb376-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(treatment<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests:
## 
## ------------------------------------------
##  
## Term: (Intercept) 
## 
##  Response transformation matrix:
##    (Intercept)
## T1           1
## T2           1
## T3           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)    32520.11
## 
## Multivariate Tests: (Intercept)
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1    0.9975 2399.025      1      6 4.8568e-09 ***
## Wilks             1    0.0025 2399.025      1      6 4.8568e-09 ***
## Hotelling-Lawley  1  399.8374 2399.025      1      6 4.8568e-09 ***
## Roy               1  399.8374 2399.025      1      6 4.8568e-09 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: trt 
## 
##  Response transformation matrix:
##    (Intercept)
## T1           1
## T2           1
## T3           1
## 
## Sum of squares and products for the hypothesis:
##             (Intercept)
## (Intercept)    193.5556
## 
## Multivariate Tests: trt
##                  Df test stat approx F num Df den Df   Pr(&gt;F)  
## Pillai            2 0.7041229 7.139344      2      6 0.025902 *
## Wilks             2 0.2958771 7.139344      2      6 0.025902 *
## Hotelling-Lawley  2 2.3797814 7.139344      2      6 0.025902 *
## Roy               2 2.3797814 7.139344      2      6 0.025902 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: times 
## 
##  Response transformation matrix:
##    times1 times2
## T1      1      0
## T2      0      1
## T3     -1     -1
## 
## Sum of squares and products for the hypothesis:
##        times1    times2
## times1   2601 1258.0000
## times2   1258  608.4444
## 
## Multivariate Tests: times
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            1    0.9988 2010.298      2      5 5.4369e-08 ***
## Wilks             1    0.0012 2010.298      2      5 5.4369e-08 ***
## Hotelling-Lawley  1  804.1190 2010.298      2      5 5.4369e-08 ***
## Roy               1  804.1190 2010.298      2      5 5.4369e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------
##  
## Term: trt:times 
## 
##  Response transformation matrix:
##    times1 times2
## T1      1      0
## T2      0      1
## T3     -1     -1
## 
## Sum of squares and products for the hypothesis:
##        times1   times2
## times1     72 38.00000
## times2     38 28.22222
## 
## Multivariate Tests: trt:times
##                  Df test stat approx F num Df den Df     Pr(&gt;F)    
## Pillai            2  1.345125  6.16206      4     12 0.00620585 ** 
## Wilks             2  0.023398 13.84359      4     10 0.00043842 ***
## Hotelling-Lawley  2 25.988095 25.98810      4      8 0.00012292 ***
## Roy               2 25.367215 76.10165      2      6 5.4552e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Univariate Type II Repeated-Measures ANOVA Assuming Sphericity
## 
##              Sum Sq num Df Error SS den Df   F value    Pr(&gt;F)    
## (Intercept) 10840.0      1   27.111      6 2399.0246 4.857e-09 ***
## trt            64.5      2   27.111      6    7.1393 0.0259021 *  
## times        1301.0      2   12.889     12  605.6207 8.913e-13 ***
## trt:times      41.5      4   12.889     12    9.6552 0.0009899 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Mauchly Tests for Sphericity
## 
##           Test statistic  p-value
## times            0.29964 0.049149
## trt:times        0.29964 0.049149
## 
## 
## Greenhouse-Geisser and Huynh-Feldt Corrections
##  for Departure from Sphericity
## 
##            GG eps Pr(&gt;F[GG])    
## times     0.58811  3.114e-08 ***
## trt:times 0.58811   0.008332 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##              HF eps   Pr(&gt;F[HF])
## times     0.6461293 7.092455e-09
## trt:times 0.6461293 6.137921e-03</code></pre>
<p>(Since I call things by the same names every time, my code for one of
these looks a lot like my code for any of the others.)</p>
<p>Start near the bottom with the Mauchly tests for sphericity. These are <em>just</em> significant, so that instead of looking at the univariate tests, look at the bottom for the Huynh-Feldt adjusted P-values, the one for the interaction being 0.0061. This is a bit bigger than the one for the interaction in the univariate tests (0.0010), the latter being deceptively small because sphericity is actually no good.</p>
<p>Compare this, if you like, with the multivariate tests for the interaction. In this case, these are actually not all the same; the largest P-value is the Pillai one, which at 0.0062 is very close to the properly adjusted univariate test.</p>
<p>Finally, interpretation. We look <em>only</em> at the interaction. This
is significant, so the effect of treatment is different at the
different times. And we <strong>stop there</strong>.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" style="list-style-type: lower-alpha">
<li>How is your conclusion from the previous part consistent
with your spaghetti plot? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>The thing that the interaction means is that the effect of
treatment is different over different times. That shows up in the
spaghetti plot by treatment C being the same as the others at the
beginning, but clearly better than the others at the later
times. That is to say, you can’t talk about “an” effect of
treatment, because whether or not treatment C is better than the
others depends on which time you’re looking at.</p>
<p>Extra: we used the MANOVA way of doing the repeated-measures
analysis. There is another way, “mixed models”, which is in some
ways less familiar and in some ways more.</p>
<p>In any analysis of variance, there are two kinds of effects of
things you may care about: fixed effects and random effects. Fixed
effects are things like the treatment and time here, where the
ones you look at are the only ones you are interested in (in this
study at least). If you had wanted to assess another treatment,
you would have designed it into the study; if you cared about
other times, you would have measured <code>y</code> at those times
too. The subjects, though, are different: they are a random sample
of all possible people, and you want your results to generalize to
the population of all people of whom your subjects are a
sample.<a href="#fn55" class="footnote-ref" id="fnref55"><sup>55</sup></a>
So subjects are a different kind of thing and they have what are
called random effects. When each subject only gives one
measurement, as in all the things we’ve seen so
far,<a href="#fn56" class="footnote-ref" id="fnref56"><sup>56</sup></a> it
doesn’t matter how you treat (statistically) the subjects, but
when each subject gives <em>more</em> than one measurement, it does
matter. Which is why we have to do the <code>idesign</code> stuff in
the MANOVA, or what you will see below.</p>
<p>A model with both fixed and random effects is called a mixed model.</p>
<p>We’re going to make the assumption that the effect of being one
subject rather than another is to move the value of <code>y</code> up
or down by a fixed amount regardless of treatment or time, on
average (each subject is different, but <em>within</em> a subject
the random effect is the same size). That seems reasonable, given
the spaghetti plot, where some subjects seemed to give
consistently larger or smaller values of <code>y</code> than
others. This is a so-called “random-intercepts” model. In the
package <code>lme4</code>, there is a function <code>lmer</code> that
looks like <code>lm</code>, except for the way in which you specify
the random effects. It looks like this, noting that
<em>it works with the tidy data frame</em> that we read in from the file and made
the spaghetti plot out of:</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="repeated-measures.html#cb378-1" aria-hidden="true" tabindex="-1"></a>treatment<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">lmer</span>(y <span class="sc">~</span> trt <span class="sc">*</span> time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> subject), <span class="at">data =</span> treatments)</span>
<span id="cb378-2"><a href="repeated-measures.html#cb378-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(treatment<span class="fl">.4</span>, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## y ~ trt * time + (1 | subject)
##          npar    AIC   LRT   Pr(Chi)    
## &lt;none&gt;        102.53                    
## trt:time    4 120.44 25.91 3.299e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The way to read that model is “<code>y</code> depends on the combination of treatment and time and also on a random intercept for each subject”.
This is the way in which the model captures the idea that
each subject is different.</p>
<p>You don’t get a test for the random effects; you are <em>assuming</em> that the
subjects will be different from each other and you want to <em>adjust</em> for
that, rather than testing for it.<a href="#fn57" class="footnote-ref" id="fnref57"><sup>57</sup></a>
All you get is tests for the fixed effects that are currently up for
grabs, in this case the interaction, which is strongly significant.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="36">
<li id="fn36"><p>References: Box, George EP, Problems in the analysis of growth and wear curves, Biometrics vol. 6, 362-369, 1950; Christensen R, Advanced Linear Modeling, 2nd edition, Springer, 2001. Yes, that’s the Box-Cox Box.<a href="repeated-measures.html#fnref36" class="footnote-back">↩︎</a></p></li>
<li id="fn37"><p>This is the same Box as Box-Cox and the M test.<a href="repeated-measures.html#fnref37" class="footnote-back">↩︎</a></p></li>
<li id="fn38"><p>References: Box, George EP, Problems in the analysis of growth and wear curves, Biometrics vol. 6, 362-369, 1950; Christensen R, Advanced Linear Modeling, 2nd edition, Springer, 2001. Yes, that’s the Box-Cox Box.<a href="repeated-measures.html#fnref38" class="footnote-back">↩︎</a></p></li>
<li id="fn39"><p>Things would be a lot more complicated if each rat got a different drug at a different time! But the rats each got one drug <em>once</em>, at the beginning, and the issue was the effect of that drug on all the growth that followed.<a href="repeated-measures.html#fnref39" class="footnote-back">↩︎</a></p></li>
<li id="fn40"><p>That is to say, it’s the same kind of shape.<a href="repeated-measures.html#fnref40" class="footnote-back">↩︎</a></p></li>
<li id="fn41"><p>I am kind of wrong about that, as we see.<a href="repeated-measures.html#fnref41" class="footnote-back">↩︎</a></p></li>
<li id="fn42"><p>This is rather like removing time zero in the example in lecture.<a href="repeated-measures.html#fnref42" class="footnote-back">↩︎</a></p></li>
<li id="fn43"><p>The factor <code>treatment</code> still has three levels, but only two of them have any remaining data.<a href="repeated-measures.html#fnref43" class="footnote-back">↩︎</a></p></li>
<li id="fn44"><p>There is often an effect of time, which is why you would be taking multiple time measurements, but the issue is when you take that into account, you are giving yourself an improved chance, in general, to find a treatment effect. This is exactly the same idea as using a matched pairs design to give yourself an improved chance of finding a treatment effect, even though the subjects might be quite different from each other. In fact, repeated measures <em>is</em> matched pairs with more than two measurements on each person. Which makes me think, I should have you do a matched pairs as repeated measures.<a href="repeated-measures.html#fnref44" class="footnote-back">↩︎</a></p></li>
<li id="fn45"><p>I got sidetracked, surprise surprise.<a href="repeated-measures.html#fnref45" class="footnote-back">↩︎</a></p></li>
<li id="fn46"><p>See below.<a href="repeated-measures.html#fnref46" class="footnote-back">↩︎</a></p></li>
<li id="fn47"><p>This would be allowable, since we are averaging <em>over</em> the time-dependence; we are creating 10 independent averages, from the 10 subjects. People do this kind of thing, instead of having to deal with the repeated measures.<a href="repeated-measures.html#fnref47" class="footnote-back">↩︎</a></p></li>
<li id="fn48"><p>The term “accidental aRt” is sometimes used for graphs that cross the boundary between being informative and looking like a piece of art, particularly if it was not done on purpose. This one is a bit like that.<a href="repeated-measures.html#fnref48" class="footnote-back">↩︎</a></p></li>
<li id="fn49"><p>This is different from the 0.05 <span class="math inline">\(\alpha\)</span>.<a href="repeated-measures.html#fnref49" class="footnote-back">↩︎</a></p></li>
<li id="fn50"><p>This is something <em>I</em> want to understand, so I will share my findings with you. You can read them or not, as you choose.<a href="repeated-measures.html#fnref50" class="footnote-back">↩︎</a></p></li>
<li id="fn51"><p>I’m suspicious about <em>when</em> needing to be the numerical time inside. Not sure.<a href="repeated-measures.html#fnref51" class="footnote-back">↩︎</a></p></li>
<li id="fn52"><p>I understand psychology students <em>still</em> do this kind of stuff by hand.<a href="repeated-measures.html#fnref52" class="footnote-back">↩︎</a></p></li>
<li id="fn53"><p>My hat stays on my head.<a href="repeated-measures.html#fnref53" class="footnote-back">↩︎</a></p></li>
<li id="fn54"><p>The movies of Lord of the Rings were filmed in New Zealand, which is also the country in which R was first designed.<a href="repeated-measures.html#fnref54" class="footnote-back">↩︎</a></p></li>
<li id="fn55"><p>In practice, things are usually fuzzier than this, because the subjects in your study are typically the ones you could get, rather than being a physical random sample of all possible people, but we usually act as if our subjects are a random sample of all possible subjects.<a href="repeated-measures.html#fnref55" class="footnote-back">↩︎</a></p></li>
<li id="fn56"><p>Including matched pairs, because what we do there is to take the difference between the two measurements for each person and throw away the actual measurements themselves, so that each subject still only gives us one measurement.<a href="repeated-measures.html#fnref56" class="footnote-back">↩︎</a></p></li>
<li id="fn57"><p>This is rather like the test for blocks in a randomized block design: you want to <em>allow</em> for differences among blocks, but you don’t especially care to test that there <em>are</em> any. In fact, blocks are a lot like subjects, in that they are typically things like different experimental plots in which plants are grown, or different days on which the experiment is conducted, and you want to generalize from the blocks you observed, which are certainly <em>not</em> all possible blocks, to the population of all possible blocks.<a href="repeated-measures.html#fnref57" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="multivariate-analysis-of-variance.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="discriminant-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["pasias.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
