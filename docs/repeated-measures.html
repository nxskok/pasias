<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Problems and Solutions in Applied Statistics" />
<meta property="og:type" content="book" />
<meta property="og:url" content="<a href="http://ritsokiguess.site/pasias" class="uri">http://ritsokiguess.site/pasias</a>" />

<meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
<meta name="github-repo" content="nxskok/pasias" />

<meta name="author" content="Ken Butler" />

<meta name="date" content="2019-01-07" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics">

<title>Problems and Solutions in Applied Statistics</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li class="has-sub"><a href="getting-used-to-r-and-r-studio.html#getting-used-to-r-and-r-studio"><span class="toc-section-number">2</span> Getting used to R and R Studio</a><ul>
<li><a href="getting-used-to-r-and-r-studio.html#getting-an-r-studio-cloud-account"><span class="toc-section-number">2.1</span> Getting an R Studio Cloud account</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#getting-started"><span class="toc-section-number">2.2</span> Getting started</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#reading-data-from-a-file"><span class="toc-section-number">2.3</span> Reading data from a file</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#reading-files-different-ways"><span class="toc-section-number">2.4</span> Reading files different ways</a></li>
</ul></li>
<li class="has-sub"><a href="reading-in-data-and-drawing-some-graphs.html#reading-in-data-and-drawing-some-graphs"><span class="toc-section-number">3</span> Reading in data and drawing some graphs</a><ul>
<li><a href="reading-in-data-and-drawing-some-graphs.html#orange-juice"><span class="toc-section-number">3.1</span> Orange juice</a></li>
<li><a href="reading-in-data-and-drawing-some-graphs.html#making-soap"><span class="toc-section-number">3.2</span> Making soap</a></li>
<li><a href="reading-in-data-and-drawing-some-graphs.html#handling-shipments"><span class="toc-section-number">3.3</span> Handling shipments</a></li>
</ul></li>
<li class="has-sub"><a href="data-exploration.html#data-exploration"><span class="toc-section-number">4</span> Data exploration</a><ul>
<li><a href="data-exploration.html#north-carolina-births"><span class="toc-section-number">4.1</span> North Carolina births</a></li>
<li><a href="data-exploration.html#more-about-the-nc-births"><span class="toc-section-number">4.2</span> More about the NC births</a></li>
<li><a href="data-exploration.html#nenana-alaska"><span class="toc-section-number">4.3</span> Nenana, Alaska</a></li>
<li><a href="data-exploration.html#computerized-accounting"><span class="toc-section-number">4.4</span> Computerized accounting</a></li>
<li><a href="data-exploration.html#test-scores-in-two-classes"><span class="toc-section-number">4.5</span> Test scores in two classes</a></li>
</ul></li>
<li class="has-sub"><a href="one-sample-inference.html#one-sample-inference"><span class="toc-section-number">5</span> One-sample inference</a><ul>
<li><a href="one-sample-inference.html#hunter-gatherers-in-australia"><span class="toc-section-number">5.1</span> Hunter-gatherers in Australia</a></li>
<li><a href="one-sample-inference.html#buses-to-boulder"><span class="toc-section-number">5.2</span> Buses to Boulder</a></li>
<li><a href="one-sample-inference.html#length-of-gestation-in-north-carolina"><span class="toc-section-number">5.3</span> Length of gestation in North Carolina</a></li>
<li><a href="one-sample-inference.html#inferring-ice-break-up-in-nenana"><span class="toc-section-number">5.4</span> Inferring ice break-up in Nenana</a></li>
</ul></li>
<li class="has-sub"><a href="two-sample-inference.html#two-sample-inference"><span class="toc-section-number">6</span> Two-sample inference</a><ul>
<li><a href="two-sample-inference.html#children-and-electronic-devices"><span class="toc-section-number">6.1</span> Children and electronic devices</a></li>
<li><a href="two-sample-inference.html#parking-close-to-the-curb"><span class="toc-section-number">6.2</span> Parking close to the curb</a></li>
<li><a href="two-sample-inference.html#bell-peppers-and-too-much-water"><span class="toc-section-number">6.3</span> Bell peppers and too much water</a></li>
<li><a href="two-sample-inference.html#exercise-and-anxiety-and-bullying-mice"><span class="toc-section-number">6.4</span> Exercise and anxiety and bullying mice</a></li>
<li><a href="two-sample-inference.html#diet-and-growth-in-boys"><span class="toc-section-number">6.5</span> Diet and growth in boys</a></li>
</ul></li>
<li class="has-sub"><a href="power-and-sample-size.html#power-and-sample-size"><span class="toc-section-number">7</span> Power and sample size</a><ul>
<li><a href="power-and-sample-size.html#simulating-power"><span class="toc-section-number">7.1</span> Simulating power</a></li>
<li><a href="power-and-sample-size.html#calculating-power-and-sample-size-for-estimating-mean"><span class="toc-section-number">7.2</span> Calculating power and sample size for estimating mean</a></li>
<li><a href="power-and-sample-size.html#simulating-power-for-proportions"><span class="toc-section-number">7.3</span> Simulating power for proportions</a></li>
</ul></li>
<li class="has-sub"><a href="the-sign-test-and-moods-median-test.html#the-sign-test-and-moods-median-test"><span class="toc-section-number">8</span> The sign test and Mood’s median test</a><ul>
<li><a href="the-sign-test-and-moods-median-test.html#running-a-maze"><span class="toc-section-number">8.1</span> Running a maze</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#chocolate-chips"><span class="toc-section-number">8.2</span> Chocolate chips</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#the-power-of-the-sign-test"><span class="toc-section-number">8.3</span> The power of the sign test</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#sugar-in-breakfast-cereals"><span class="toc-section-number">8.4</span> Sugar in breakfast cereals</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#fear-of-math"><span class="toc-section-number">8.5</span> Fear of math</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#medical-instructions"><span class="toc-section-number">8.6</span> Medical instructions</a></li>
</ul></li>
<li class="has-sub"><a href="matched-pairs-t-and-sign-test.html#matched-pairs-t-and-sign-test"><span class="toc-section-number">9</span> Matched pairs t and sign test</a><ul>
<li><a href="matched-pairs-t-and-sign-test.html#measuring-body-fat"><span class="toc-section-number">9.1</span> Measuring body fat</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#throwing-baseballs-and-softballs"><span class="toc-section-number">9.2</span> Throwing baseballs and softballs</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#throwing-baseballs-and-softballs-again"><span class="toc-section-number">9.3</span> Throwing baseballs and softballs, again</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#changes-in-salary"><span class="toc-section-number">9.4</span> Changes in salary</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#body-fat-revisited"><span class="toc-section-number">9.5</span> Body fat revisited</a></li>
</ul></li>
<li class="has-sub"><a href="normal-quantile-plots.html#normal-quantile-plots"><span class="toc-section-number">10</span> Normal quantile plots</a><ul>
<li><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers"><span class="toc-section-number">10.1</span> Lengths of heliconia flowers</a></li>
<li><a href="normal-quantile-plots.html#ferritin-and-normality"><span class="toc-section-number">10.2</span> Ferritin and normality</a></li>
</ul></li>
<li class="has-sub"><a href="analysis-of-variance.html#analysis-of-variance"><span class="toc-section-number">11</span> Analysis of variance</a><ul>
<li><a href="analysis-of-variance.html#movie-ratings-and-lengths"><span class="toc-section-number">11.1</span> Movie ratings and lengths</a></li>
<li><a href="analysis-of-variance.html#deer-and-how-much-they-eat"><span class="toc-section-number">11.2</span> Deer and how much they eat</a></li>
<li><a href="analysis-of-variance.html#movie-ratings-again"><span class="toc-section-number">11.3</span> Movie ratings again</a></li>
<li><a href="analysis-of-variance.html#atomic-weight-of-carbon"><span class="toc-section-number">11.4</span> Atomic weight of carbon</a></li>
<li><a href="analysis-of-variance.html#can-caffeine-improve-your-performance-on-a-test"><span class="toc-section-number">11.5</span> Can caffeine improve your performance on a test?</a></li>
</ul></li>
<li class="has-sub"><a href="tidying-and-selecting-data.html#tidying-and-selecting-data"><span class="toc-section-number">12</span> Tidying and selecting data</a><ul>
<li><a href="tidying-and-selecting-data.html#tidying-the-jays-data"><span class="toc-section-number">12.1</span> Tidying the Jays data</a></li>
<li><a href="tidying-and-selecting-data.html#baseball-and-softball-spaghetti"><span class="toc-section-number">12.2</span> Baseball and softball spaghetti</a></li>
<li><a href="tidying-and-selecting-data.html#ethanol-and-sleep-time-in-rats"><span class="toc-section-number">12.3</span> Ethanol and sleep time in rats</a></li>
<li><a href="tidying-and-selecting-data.html#growth-of-tomatoes"><span class="toc-section-number">12.4</span> Growth of tomatoes</a></li>
<li><a href="tidying-and-selecting-data.html#pain-relief-in-migraine-headaches-again"><span class="toc-section-number">12.5</span> Pain relief in migraine headaches (again)</a></li>
<li><a href="tidying-and-selecting-data.html#location-species-and-disease-in-plants"><span class="toc-section-number">12.6</span> Location, species and disease in plants</a></li>
<li><a href="tidying-and-selecting-data.html#mating-songs-in-crickets"><span class="toc-section-number">12.7</span> Mating songs in crickets</a></li>
<li><a href="tidying-and-selecting-data.html#cars"><span class="toc-section-number">12.8</span> Cars</a></li>
<li><a href="tidying-and-selecting-data.html#number-1-songs"><span class="toc-section-number">12.9</span> Number 1 songs</a></li>
<li><a href="tidying-and-selecting-data.html#bikes-on-college"><span class="toc-section-number">12.10</span> Bikes on College</a></li>
<li><a href="tidying-and-selecting-data.html#feeling-the-heat"><span class="toc-section-number">12.11</span> Feeling the heat</a></li>
</ul></li>
<li class="has-sub"><a href="regression.html#regression"><span class="toc-section-number">13</span> Regression</a><ul>
<li><a href="regression.html#rainfall-in-california"><span class="toc-section-number">13.1</span> Rainfall in California</a></li>
<li><a href="regression.html#carbon-monoxide-in-cigarettes"><span class="toc-section-number">13.2</span> Carbon monoxide in cigarettes</a></li>
<li><a href="regression.html#maximal-oxygen-uptake-in-young-boys"><span class="toc-section-number">13.3</span> Maximal oxygen uptake in young boys</a></li>
<li><a href="regression.html#facebook-friends-and-grey-matter"><span class="toc-section-number">13.4</span> Facebook friends and grey matter</a></li>
<li><a href="regression.html#endogenous-nitrogen-excretion-in-carp"><span class="toc-section-number">13.5</span> Endogenous nitrogen excretion in carp</a></li>
<li><a href="regression.html#sparrowhawks"><span class="toc-section-number">13.6</span> Sparrowhawks</a></li>
<li><a href="regression.html#salaries-of-social-workers"><span class="toc-section-number">13.7</span> Salaries of social workers</a></li>
<li><a href="regression.html#predicting-volume-of-wood-in-pine-trees"><span class="toc-section-number">13.8</span> Predicting volume of wood in pine trees</a></li>
<li><a href="regression.html#tortoise-shells-and-eggs"><span class="toc-section-number">13.9</span> Tortoise shells and eggs</a></li>
<li><a href="regression.html#crickets-revisited"><span class="toc-section-number">13.10</span> Crickets revisited</a></li>
<li><a href="regression.html#roller-coasters"><span class="toc-section-number">13.11</span> Roller coasters</a></li>
<li><a href="regression.html#running-and-blood-sugar"><span class="toc-section-number">13.12</span> Running and blood sugar</a></li>
<li><a href="regression.html#calories-and-fat-in-pizza"><span class="toc-section-number">13.13</span> Calories and fat in pizza</a></li>
<li><a href="regression.html#where-should-the-fire-stations-be"><span class="toc-section-number">13.14</span> Where should the fire stations be?</a></li>
<li><a href="regression.html#being-satisfied-with-hospital"><span class="toc-section-number">13.15</span> Being satisfied with hospital</a></li>
<li><a href="regression.html#handling-shipments-of-chemicals"><span class="toc-section-number">13.16</span> Handling shipments of chemicals</a></li>
<li><a href="regression.html#salaries-of-mathematicians"><span class="toc-section-number">13.17</span> Salaries of mathematicians</a></li>
<li><a href="regression.html#predicting-gpa-of-computer-science-students"><span class="toc-section-number">13.18</span> Predicting GPA of computer science students</a></li>
</ul></li>
<li class="has-sub"><a href="dates-and-times.html#dates-and-times"><span class="toc-section-number">14</span> Dates and times</a><ul>
<li><a href="dates-and-times.html#dealing-with-dates-in-the-worcester-heart-attack-study"><span class="toc-section-number">14.1</span> Dealing with dates in the Worcester Heart Attack study</a></li>
<li><a href="dates-and-times.html#growth-of-mizuna-lettuce-seeds"><span class="toc-section-number">14.2</span> Growth of Mizuna lettuce seeds</a></li>
<li><a href="dates-and-times.html#types-of-childbirth"><span class="toc-section-number">14.3</span> Types of childbirth</a></li>
<li><a href="dates-and-times.html#wolves-and-caribou"><span class="toc-section-number">14.4</span> Wolves and caribou</a></li>
</ul></li>
<li class="has-sub"><a href="functions.html#functions"><span class="toc-section-number">15</span> Functions</a><ul>
<li><a href="functions.html#making-some-r-functions"><span class="toc-section-number">15.1</span> Making some R functions</a></li>
<li><a href="functions.html#the-collatz-sequence"><span class="toc-section-number">15.2</span> The Collatz sequence</a></li>
</ul></li>
<li class="has-sub"><a href="logistic-regression.html#logistic-regression"><span class="toc-section-number">16</span> Logistic regression</a><ul>
<li><a href="logistic-regression.html#finding-wolf-spiders-on-the-beach"><span class="toc-section-number">16.1</span> Finding wolf spiders on the beach</a></li>
<li><a href="logistic-regression.html#killing-aphids"><span class="toc-section-number">16.2</span> Killing aphids</a></li>
<li><a href="logistic-regression.html#the-effects-of-substance-a"><span class="toc-section-number">16.3</span> The effects of Substance A</a></li>
<li><a href="logistic-regression.html#what-makes-an-animal-get-infected"><span class="toc-section-number">16.4</span> What makes an animal get infected?</a></li>
<li><a href="logistic-regression.html#the-brain-of-a-cat"><span class="toc-section-number">16.5</span> The brain of a cat</a></li>
<li><a href="logistic-regression.html#how-not-to-get-heart-disease"><span class="toc-section-number">16.6</span> How not to get heart disease</a></li>
<li><a href="logistic-regression.html#successful-breastfeeding"><span class="toc-section-number">16.7</span> Successful breastfeeding</a></li>
<li><a href="logistic-regression.html#making-it-over-the-mountains"><span class="toc-section-number">16.8</span> Making it over the mountains</a></li>
<li><a href="logistic-regression.html#who-needs-the-most-intensive-care"><span class="toc-section-number">16.9</span> Who needs the most intensive care?</a></li>
<li><a href="logistic-regression.html#go-away-and-dont-come-back"><span class="toc-section-number">16.10</span> Go away and don’t come back!</a></li>
</ul></li>
<li class="has-sub"><a href="logistic-regression-with-ordinal-or-nominal-response.html#logistic-regression-with-ordinal-or-nominal-response"><span class="toc-section-number">17</span> Logistic regression with ordinal or nominal response</a><ul>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#do-you-like-your-mobile-phone"><span class="toc-section-number">17.1</span> Do you like your mobile phone?</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#attitudes-towards-abortion"><span class="toc-section-number">17.2</span> Attitudes towards abortion</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#finding-non-missing-values"><span class="toc-section-number">17.3</span> Finding non-missing values</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#european-social-survey-and-voting"><span class="toc-section-number">17.4</span> European Social Survey and voting</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#alligator-food"><span class="toc-section-number">17.5</span> Alligator food</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#how-do-you-like-your-steak-the-data"><span class="toc-section-number">17.6</span> How do you like your steak – the data</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#crimes-in-san-francisco-the-data"><span class="toc-section-number">17.7</span> Crimes in San Francisco – the data</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#how-do-you-like-your-steak"><span class="toc-section-number">17.8</span> How do you like your steak?</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#crimes-in-san-francisco"><span class="toc-section-number">17.9</span> Crimes in San Francisco</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#high-school-and-beyond"><span class="toc-section-number">17.10</span> High School and Beyond</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#what-sports-do-these-athletes-play"><span class="toc-section-number">17.11</span> What sports do these athletes play?</a></li>
</ul></li>
<li class="has-sub"><a href="survival-analysis.html#survival-analysis"><span class="toc-section-number">18</span> Survival analysis</a><ul>
<li><a href="survival-analysis.html#the-worcester-survey"><span class="toc-section-number">18.1</span> The Worcester survey</a></li>
<li><a href="survival-analysis.html#drug-treatment-programs"><span class="toc-section-number">18.2</span> Drug treatment programs</a></li>
<li><a href="survival-analysis.html#multiple-myeloma"><span class="toc-section-number">18.3</span> Multiple myeloma</a></li>
<li><a href="survival-analysis.html#ovarian-cancer"><span class="toc-section-number">18.4</span> Ovarian cancer</a></li>
</ul></li>
<li class="has-sub"><a href="analysis-of-variance-revisited.html#analysis-of-variance-revisited"><span class="toc-section-number">19</span> Analysis of Variance revisited</a><ul>
<li><a href="analysis-of-variance-revisited.html#focused-comparisons-of-the-effect-of-caffeine"><span class="toc-section-number">19.1</span> Focused comparisons of the effect of caffeine</a></li>
<li><a href="analysis-of-variance-revisited.html#who-studies-the-most-outside-class"><span class="toc-section-number">19.2</span> Who studies the most outside class?</a></li>
<li><a href="analysis-of-variance-revisited.html#mental-context"><span class="toc-section-number">19.3</span> Mental context</a></li>
<li><a href="analysis-of-variance-revisited.html#trying-on-shirts"><span class="toc-section-number">19.4</span> Trying on shirts</a></li>
<li><a href="analysis-of-variance-revisited.html#productivity-and-research-and-development"><span class="toc-section-number">19.5</span> Productivity and research-and-development</a></li>
<li><a href="analysis-of-variance-revisited.html#treating-leprosy"><span class="toc-section-number">19.6</span> Treating leprosy</a></li>
<li><a href="analysis-of-variance-revisited.html#do-characteristics-of-urine-depend-on-obesity"><span class="toc-section-number">19.7</span> Do characteristics of urine depend on obesity?</a></li>
</ul></li>
<li class="has-sub"><a href="multivariate-analysis-of-variance.html#multivariate-analysis-of-variance"><span class="toc-section-number">20</span> Multivariate analysis of variance</a><ul>
<li><a href="multivariate-analysis-of-variance.html#fabricated-data"><span class="toc-section-number">20.1</span> Fabricated data</a></li>
<li><a href="multivariate-analysis-of-variance.html#do-characteristics-of-urine-depend-on-obesity-1"><span class="toc-section-number">20.2</span> Do characteristics of urine depend on obesity?</a></li>
<li><a href="multivariate-analysis-of-variance.html#how-do-height-and-weight-depend-on-sport-played-by-elite-athletes"><span class="toc-section-number">20.3</span> How do height and weight depend on sport played by elite athletes?</a></li>
</ul></li>
<li class="has-sub"><a href="repeated-measures.html#repeated-measures"><span class="toc-section-number">21</span> Repeated measures</a><ul>
<li><a href="repeated-measures.html#effect-of-drug-on-rat-weight"><span class="toc-section-number">21.1</span> Effect of drug on rat weight</a></li>
<li><a href="repeated-measures.html#social-interaction-among-old-people"><span class="toc-section-number">21.2</span> Social interaction among old people</a></li>
<li><a href="repeated-measures.html#childrens-stress-levels-and-airports"><span class="toc-section-number">21.3</span> Children’s stress levels and airports</a></li>
<li><a href="repeated-measures.html#investigating-motor-activity-in-rats"><span class="toc-section-number">21.4</span> Investigating motor activity in rats</a></li>
<li><a href="repeated-measures.html#repeated-measures-with-no-background"><span class="toc-section-number">21.5</span> Repeated measures with no background</a></li>
</ul></li>
<li class="has-sub"><a href="discriminant-analysis.html#discriminant-analysis"><span class="toc-section-number">22</span> Discriminant analysis</a><ul>
<li><a href="discriminant-analysis.html#telling-whether-a-banknote-is-real-or-counterfeit"><span class="toc-section-number">22.1</span> Telling whether a banknote is real or counterfeit</a></li>
<li><a href="discriminant-analysis.html#urine-and-obesity-what-makes-a-difference"><span class="toc-section-number">22.2</span> Urine and obesity: what makes a difference?</a></li>
<li><a href="discriminant-analysis.html#understanding-a-manova"><span class="toc-section-number">22.3</span> Understanding a MANOVA</a></li>
<li><a href="discriminant-analysis.html#what-distinguishes-people-who-do-different-jobs"><span class="toc-section-number">22.4</span> What distinguishes people who do different jobs?</a></li>
<li><a href="discriminant-analysis.html#observing-children-with-adhd"><span class="toc-section-number">22.5</span> Observing children with ADHD</a></li>
<li><a href="discriminant-analysis.html#growing-corn"><span class="toc-section-number">22.6</span> Growing corn</a></li>
<li><a href="discriminant-analysis.html#understanding-athletes-height-weight-sport-and-gender"><span class="toc-section-number">22.7</span> Understanding athletes’ height, weight, sport and gender</a></li>
</ul></li>
<li class="has-sub"><a href="cluster-analysis.html#cluster-analysis"><span class="toc-section-number">23</span> Cluster analysis</a><ul>
<li><a href="cluster-analysis.html#dissimilarities-between-fruits"><span class="toc-section-number">23.1</span> Dissimilarities between fruits</a></li>
<li><a href="cluster-analysis.html#similarity-of-species"><span class="toc-section-number">23.2</span> Similarity of species</a></li>
<li><a href="cluster-analysis.html#rating-beer"><span class="toc-section-number">23.3</span> Rating beer</a></li>
<li><a href="cluster-analysis.html#sites-on-the-sea-bed"><span class="toc-section-number">23.4</span> Sites on the sea bed</a></li>
<li><a href="cluster-analysis.html#clustering-the-swiss-bills"><span class="toc-section-number">23.5</span> Clustering the Swiss bills</a></li>
<li><a href="cluster-analysis.html#grouping-similar-cars"><span class="toc-section-number">23.6</span> Grouping similar cars</a></li>
<li><a href="cluster-analysis.html#running-jumping-and-throwing"><span class="toc-section-number">23.7</span> Running, jumping, and throwing</a></li>
<li><a href="cluster-analysis.html#bridges-in-pittsburgh"><span class="toc-section-number">23.8</span> Bridges in Pittsburgh</a></li>
</ul></li>
<li class="has-sub"><a href="multidimensional-scaling.html#multidimensional-scaling"><span class="toc-section-number">24</span> Multidimensional Scaling</a><ul>
<li><a href="multidimensional-scaling.html#making-a-map-of-wisconsin"><span class="toc-section-number">24.1</span> Making a map of Wisconsin</a></li>
<li><a href="multidimensional-scaling.html#things-that-feel-similar-to-each-other"><span class="toc-section-number">24.2</span> Things that feel similar to each other</a></li>
<li><a href="multidimensional-scaling.html#confusing-letters"><span class="toc-section-number">24.3</span> Confusing letters</a></li>
<li><a href="multidimensional-scaling.html#more-beer-please"><span class="toc-section-number">24.4</span> More beer please</a></li>
<li><a href="multidimensional-scaling.html#feeling-similar-again"><span class="toc-section-number">24.5</span> Feeling similar, again</a></li>
</ul></li>
<li class="has-sub"><a href="principal-components-and-factor-analysis.html#principal-components-and-factor-analysis"><span class="toc-section-number">25</span> Principal Components and Factor Analysis</a><ul>
<li><a href="principal-components-and-factor-analysis.html#the-weather-somewhere"><span class="toc-section-number">25.1</span> The weather, somewhere</a></li>
<li><a href="principal-components-and-factor-analysis.html#air-pollution"><span class="toc-section-number">25.2</span> Air pollution</a></li>
<li><a href="principal-components-and-factor-analysis.html#a-correlation-matrix"><span class="toc-section-number">25.3</span> A correlation matrix</a></li>
<li><a href="principal-components-and-factor-analysis.html#the-interpersonal-circumplex"><span class="toc-section-number">25.4</span> The Interpersonal Circumplex</a></li>
</ul></li>
<li class="has-sub"><a href="frequency-table-analysis.html#frequency-table-analysis"><span class="toc-section-number">26</span> Frequency table analysis</a><ul>
<li><a href="frequency-table-analysis.html#college-plans"><span class="toc-section-number">26.1</span> College plans</a></li>
<li><a href="frequency-table-analysis.html#predicting-voting"><span class="toc-section-number">26.2</span> Predicting voting</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="repeated-measures" class="section level1">
<h1><span class="header-section-number">Chapter 21</span> Repeated measures</h1>
<p>Packages for this chapter:</p>
<div class="sourceCode" id="cb3083"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3083-1" data-line-number="1"><span class="kw">library</span>(car)</a></code></pre></div>
<pre><code>## Loading required package: carData</code></pre>
<div class="sourceCode" id="cb3085"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3085-1" data-line-number="1"><span class="kw">library</span>(lme4)</a></code></pre></div>
<pre><code>## Loading required package: Matrix</code></pre>
<div class="sourceCode" id="cb3087"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3087-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<pre><code>## ── Attaching packages ────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.1.0     ✔ purrr   0.2.5
## ✔ tibble  1.4.2     ✔ dplyr   0.7.8
## ✔ tidyr   0.8.2     ✔ stringr 1.3.1
## ✔ readr   1.3.1     ✔ forcats 0.3.0</code></pre>
<pre><code>## ── Conflicts ───────────────────────────────────── tidyverse_conflicts() ──
## ✖ tidyr::expand() masks Matrix::expand()
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
## ✖ dplyr::recode() masks car::recode()
## ✖ purrr::some()   masks car::some()</code></pre>
<div id="effect-of-drug-on-rat-weight" class="section level2">
<h2><span class="header-section-number">21.1</span> Effect of drug on rat weight</h2>
<p>Box (1950) gives data on the weights of three groups of
rats. One group was given thyroxin in their drinking water, one group
thiouracil, and the third group was a control. (This description comes
from Christensen (2001).)
Weights are measured in
grams at weekly intervals (over a 4-week period, so that each rat is
measured 5 times). The data are in
<a href="http://www.utsc.utoronto.ca/~butler/d29/ratweight.csv">link</a> as a
<code>.csv</code> file.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data and check that you have a column of
<code>drug</code> and five columns of rat weights at different times.</li>
</ol>
<p>Solution</p>
<p>A <code>.csv</code> file, so <code>read_csv</code>. (I typed the data from
 into a spreadsheet.)</p>
<div class="sourceCode" id="cb3091"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3091-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/d29/ratweight.csv&quot;</span></a>
<a class="sourceLine" id="cb3091-2" data-line-number="2">weights=<span class="kw">read_csv</span>(my_url)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   drug = col_character(),
##   Time0 = col_double(),
##   Time1 = col_double(),
##   Time2 = col_double(),
##   Time3 = col_double(),
##   Time4 = col_double()
## )</code></pre>
<div class="sourceCode" id="cb3093"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3093-1" data-line-number="1">weights</a></code></pre></div>
<pre><code>## # A tibble: 27 x 6
##    drug       Time0 Time1 Time2 Time3 Time4
##    &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 thyroxin      59    85   121   156   191
##  2 thyroxin      54    71    90   110   138
##  3 thyroxin      56    75   108   151   189
##  4 thyroxin      59    85   116   148   177
##  5 thyroxin      57    72    97   120   144
##  6 thyroxin      52    73    97   116   140
##  7 thyroxin      52    70   105   138   171
##  8 thiouracil    61    86   109   120   129
##  9 thiouracil    59    80   101   111   122
## 10 thiouracil    53    79   100   106   133
## # ... with 17 more rows</code></pre>
<p>There are 27 rats altogether, each measured five times (labelled time
0 through 4).</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Why would it be <em>wrong</em> to use something like
<code>gather</code> to create one column of weights, and separate
columns of drug and time, and then to run a two-way ANOVA? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>Such a solution would assume that we have measurements on
<em>different</em> rats, one for each drug-time combination. But we
have sets of five measurements all on the <em>same</em> rat: that is
to say, we have repeated measures, and the proper analysis will
take that into account.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Create a suitable response variable and fit a suitable
<code>lm</code> as the first step of the repeated-measures analysis.</li>
</ol>
<p>Solution</p>
<p>The response variable is the same idea as for any MANOVA: just
glue the columns together:</p>
<div class="sourceCode" id="cb3095"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3095-1" data-line-number="1">response=<span class="kw">with</span>(weights,<span class="kw">cbind</span>(Time0,Time1,Time2,Time3,Time4))</a>
<a class="sourceLine" id="cb3095-2" data-line-number="2">weights<span class="fl">.1</span>=<span class="kw">lm</span>(response<span class="op">~</span>drug,<span class="dt">data=</span>weights)</a></code></pre></div>
<p>Now, we <em>don’t</em> look at <code>weights.1</code>, but we <em>do</em> use
it as input to <code>Manova</code> in a moment.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Load the package <code>car</code> and run a suitable
<code>Manova</code>. To do this, you will need to set up the right thing
for <code>idata</code> and <code>idesign</code>.</li>
</ol>
<p>Solution</p>
<p>Something like this:</p>
<div class="sourceCode" id="cb3096"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3096-1" data-line-number="1">times=<span class="kw">colnames</span>(response)</a>
<a class="sourceLine" id="cb3096-2" data-line-number="2">times.df=<span class="kw">data.frame</span>(times)</a>
<a class="sourceLine" id="cb3096-3" data-line-number="3">weights<span class="fl">.2</span>=<span class="kw">Manova</span>(weights<span class="fl">.1</span>,<span class="dt">idata=</span>times.df,<span class="dt">idesign=</span><span class="op">~</span>times)</a></code></pre></div>
<p>The thought process is that the columns of the response
(<code>Time.0</code> through <code>Time.4</code>) are all times. This is the
“within-subject design” part of it: within a rat, the different
response values are at different times. That’s the only part of it
that is within subjects. The different drugs are a
“between-subjects” factor: each rat only gets one of the
drugs. (Things would be a lot more complicated if each rat got a
different drug at a different time! But the rats each got one drug
<em>once</em>, at the beginning, and the issue was the effect of that
drug on all the growth that followed.)</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Take a look at the output from the MANOVA. Is there a
significant interaction? What does its significance (or lack
thereof) mean?</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb3097"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3097-1" data-line-number="1">weights<span class="fl">.2</span></a></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests: Pillai test statistic
##             Df test stat approx F num Df den Df    Pr(&gt;F)    
## (Intercept)  1   0.99257   3204.1      1     24 &lt; 2.2e-16 ***
## drug         2   0.39192      7.7      2     24 0.0025559 ** 
## times        1   0.98265    297.4      4     21 &lt; 2.2e-16 ***
## drug:times   2   0.87791      4.3      8     44 0.0006931 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The interaction is definitely significant, with a P-value of
0.00069. This means that the effect of time on growth is different for
the different drugs: that is, the effect of drug is over the whole
time profile, not just something like
“a rat on Thyroxin is on average 10 grams heavier than a control rat, over all times”.</p>
<p>Since the interaction is significant, that’s where we stop, as far as
interpretation is concerned.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>We are going to draw an interaction plot in a moment. To
set that up, use <code>gather</code> as in the lecture notes to create
one column of weights and and second column of times. (You don’t
need to do the <code>separate</code> thing that I did in class, though
if you want to try it, go ahead.)</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb3099"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3099-1" data-line-number="1">weights.long =<span class="st"> </span>weights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3099-2" data-line-number="2"><span class="kw">gather</span>(time,weight,Time0<span class="op">:</span>Time4) </a>
<a class="sourceLine" id="cb3099-3" data-line-number="3">weights.long</a></code></pre></div>
<pre><code>## # A tibble: 135 x 3
##    drug       time  weight
##    &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;
##  1 thyroxin   Time0     59
##  2 thyroxin   Time0     54
##  3 thyroxin   Time0     56
##  4 thyroxin   Time0     59
##  5 thyroxin   Time0     57
##  6 thyroxin   Time0     52
##  7 thyroxin   Time0     52
##  8 thiouracil Time0     61
##  9 thiouracil Time0     59
## 10 thiouracil Time0     53
## # ... with 125 more rows</code></pre>
<p>My data frame was called <code>weights</code>, so I was OK with having a
variable called <code>weight</code>. Watch out for that if you call the
data frame <code>weight</code>, though.</p>
<p>If you want to try the <code>separate</code> thing, that goes something
like this:</p>
<div class="sourceCode" id="cb3101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3101-1" data-line-number="1">weights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(timex,weight,Time0<span class="op">:</span>Time4) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3101-2" data-line-number="2"><span class="kw">separate</span>(timex,<span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;junk&quot;</span>,<span class="st">&quot;time&quot;</span>),<span class="dt">sep=</span><span class="dv">4</span>) -&gt;<span class="st"> </span>weights2.long</a>
<a class="sourceLine" id="cb3101-3" data-line-number="3">weights2.long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">20</span>)</a></code></pre></div>
<pre><code>## # A tibble: 20 x 4
##    drug       junk  time  weight
##    &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1 thyroxin   Time  1         72
##  2 control    Time  4        140
##  3 thiouracil Time  4        129
##  4 thiouracil Time  0         51
##  5 thyroxin   Time  2        121
##  6 control    Time  4        169
##  7 control    Time  1         77
##  8 thiouracil Time  1         69
##  9 control    Time  0         57
## 10 thiouracil Time  3        114
## 11 thiouracil Time  0         56
## 12 control    Time  0         60
## 13 control    Time  2        102
## 14 thyroxin   Time  3        148
## 15 thyroxin   Time  2         90
## 16 thyroxin   Time  3        120
## 17 thiouracil Time  3        100
## 18 control    Time  1         81
## 19 thiouracil Time  1         80
## 20 thyroxin   Time  4        189</code></pre>
<p>Separate after the fourth character (<code>sep=4</code>), which will put
<code>Time</code> into <code>junk</code> and the actual time into
<code>time</code>. I could also have organized the data file so that the
word <code>Time</code> and the number were separated by some character,
like an underscore, and you could have separated at that.
Since the piece of the time we want is the number,
<code>parse_number</code> (from <code>readr</code>, part of the
<code>tidyverse</code>) should also work:</p>
<div class="sourceCode" id="cb3103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3103-1" data-line-number="1">weights2.long =<span class="st"> </span>weights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3103-2" data-line-number="2"><span class="kw">gather</span>(timex,weight,Time0<span class="op">:</span>Time4) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3103-3" data-line-number="3"><span class="kw">mutate</span>(<span class="dt">time=</span><span class="kw">parse_number</span>(timex))</a>
<a class="sourceLine" id="cb3103-4" data-line-number="4">weights2.long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">20</span>)</a></code></pre></div>
<pre><code>## # A tibble: 20 x 4
##    drug       timex weight  time
##    &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 thyroxin   Time3    138     3
##  2 thiouracil Time4    122     4
##  3 thyroxin   Time4    177     4
##  4 thiouracil Time0     46     0
##  5 control    Time3    139     3
##  6 thiouracil Time0     51     0
##  7 thyroxin   Time3    151     3
##  8 thiouracil Time0     51     0
##  9 thyroxin   Time2    121     2
## 10 control    Time2    110     2
## 11 thyroxin   Time4    138     4
## 12 control    Time4    177     4
## 13 thyroxin   Time1     71     1
## 14 thiouracil Time0     58     0
## 15 thyroxin   Time3    156     3
## 16 control    Time2    123     2
## 17 thyroxin   Time3    120     3
## 18 control    Time1     70     1
## 19 thyroxin   Time2     97     2
## 20 thyroxin   Time1     85     1</code></pre>
<p>I decided to show you a random collection of rows, so that you can see
that <code>parse_number</code> worked for various different times.</p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Obtain an interaction plot. Putting <code>time</code> as the
<code>x</code> will put time along the horizontal axis, which is the
way we’re used to seeing such things. Begin by calculating the mean
<code>weight</code> for each <code>time</code>-<code>drug</code> combination.</li>
</ol>
<p>Solution</p>
<p><code>group_by</code>, <code>summarize</code> and <code>ggplot</code>, the
latter using the data frame that came out of the
<code>summarize</code>. The second factor <code>drug</code> goes as the
<code>colour</code> and <code>group</code> both, since <code>time</code> has
grabbed the <code>x</code> spot:</p>
<div class="sourceCode" id="cb3105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3105-1" data-line-number="1">weights.long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(time,drug) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3105-2" data-line-number="2"><span class="kw">summarize</span>(<span class="dt">mean.weight=</span><span class="kw">mean</span>(weight)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3105-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>time,<span class="dt">y=</span>mean.weight,<span class="dt">colour=</span>drug,<span class="dt">group=</span>drug))<span class="op">+</span></a>
<a class="sourceLine" id="cb3105-4" data-line-number="4"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-9-1.png" width="672"  /></p>
<ol start="8" style="list-style-type: lower-alpha">
<li>How does this plot show why the interaction was
significant? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>At the beginning, all the rats have the same average growth, but
from time 2 (or maybe even 1) or so, the rats on thiouracil
grew more slowly. The idea is not just that thiouracil has a
<em>constant</em> effect over all times, but that the <em>pattern</em>
of growth is different for the different drugs: whether or not
thiouracil inhibits growth, and, if so, by how much, depends on
what time point you are looking at.
Rats on thyroxin or the control drug grew at pretty much the same
rate over all times, so I wouldn’t concern myself with any
differences there.
What I thought would be interesting is to plot the growth curves
for <em>all</em> the rats individually, colour-coded by which drug
the rat was on. In other words, a “spaghetti plot”.
This goes rather nicely with <code>ggplot2</code>.
Unfortunately, there’s a bit of data awkwardness, because we need
to know which rat is which when we plot them. To do that, we need
to go all the way back to <code>weights</code> and introduce a
subject-number variable. This suggests a chain of
things. There are 27 rats altogether. First we take the original
data frame <code>weights</code> with each row being one rat, and we
add a variable <code>subject</code> which is 1 through 27. Then we
gather together the columns <code>Time0</code> through
<code>Time4</code> that are different <code>time</code>s but all
<code>weight</code>s, like we did before. Optionally, we can also
<code>separate</code> <code>Time.x</code> into the <code>Time</code> part and
the <code>x</code> part (<code>x</code> being 0, 1, 2, 3, 4), but I won’t
do that here. Then we save the result into a new data frame
<code>wt</code>, and take a look at the first few lines:</p>
<div class="sourceCode" id="cb3106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3106-1" data-line-number="1">wt =<span class="st"> </span>weights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">subject=</span><span class="dv">1</span><span class="op">:</span><span class="dv">27</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3106-2" data-line-number="2"><span class="kw">gather</span>(time,weight,Time0<span class="op">:</span>Time4)  </a>
<a class="sourceLine" id="cb3106-3" data-line-number="3">wt</a></code></pre></div>
<pre><code>## # A tibble: 135 x 4
##    drug       subject time  weight
##    &lt;chr&gt;        &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1 thyroxin         1 Time0     59
##  2 thyroxin         2 Time0     54
##  3 thyroxin         3 Time0     56
##  4 thyroxin         4 Time0     59
##  5 thyroxin         5 Time0     57
##  6 thyroxin         6 Time0     52
##  7 thyroxin         7 Time0     52
##  8 thiouracil       8 Time0     61
##  9 thiouracil       9 Time0     59
## 10 thiouracil      10 Time0     53
## # ... with 125 more rows</code></pre>
<p>Each rat is identified by <code>subject</code>, which repeats 5 times,
once for each value of <code>time</code>.</p>
<p>After going through that, the logic of the actual plotting part is
pretty straightforward. In the data frame <code>wt</code>, we plot
<code>time</code> (<span class="math inline">\(x\)</span>) against <code>weight</code> (<span class="math inline">\(y\)</span>), grouping the points
according to subject and colouring them according to
<code>drug</code>.</p>
<div class="sourceCode" id="cb3108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3108-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb3108-2" data-line-number="2"><span class="kw">ggplot</span>(wt,<span class="kw">aes</span>(time,weight,<span class="dt">group=</span>subject,<span class="dt">colour=</span>drug))<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/mantequilla-1.png" width="576"  /></p>
<p>This is often called, rather aptly, a “spaghetti plot”.</p>
<p>I like this plot because, unlike the interaction plot, which shows
only means, this gives a sense of variability as well. The blue and
red lines (thyroxin and control) are all intermingled and they go
straight up. So there is nothing to choose between these. The green
lines, though, start off mixed up with the red and blue ones but
finish up at the bottom: the <em>pattern</em> of growth of the
thiouracil rats is different from the others, which is why we had a
significant interaction between drug and time.</p>
<p><code>drug</code> is categorical, so <code>ggplot</code>
uses a set of distinguishable colours to mark the levels. If our
colour had been a numerical variable, <code>ggplot</code> would have used
a range of colours like light blue to dark blue, with lighter being
higher, for example.</p>
<p>What, you want to see that? All right. This one is kind of silly, but
you see the point:</p>
<div class="sourceCode" id="cb3109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3109-1" data-line-number="1"><span class="kw">ggplot</span>(wt,<span class="kw">aes</span>(time,weight,<span class="dt">group=</span>subject,<span class="dt">colour=</span>weight))<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/alphington-1.png" width="576"  /></p>
<p>The line segments get lighter as you go up the page.</p>
<p>Since we went to the trouble of making the “long” data frame
<code>wt</code>, we can also run a repeated measures analysis using the
mixed-model idea (described elsewhere in this assignment):</p>
<div class="sourceCode" id="cb3110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3110-1" data-line-number="1">wt<span class="fl">.1</span>=<span class="kw">lmer</span>(weight<span class="op">~</span>drug<span class="op">*</span>time<span class="op">+</span>(<span class="dv">1</span><span class="op">|</span>subject),<span class="dt">data=</span>wt)</a>
<a class="sourceLine" id="cb3110-2" data-line-number="2"><span class="kw">drop1</span>(wt<span class="fl">.1</span>,<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## weight ~ drug * time + (1 | subject)
##           Df    AIC   LRT   Pr(Chi)    
## &lt;none&gt;        990.5                    
## drug:time  8 1067.8 93.27 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The drug-by-time interaction is even more strongly significant than in
the profile analysis. (The output from <code>drop1</code> reminds us that
the only thing we should be thinking about now is that interaction.)</p>
</div>
<div id="social-interaction-among-old-people" class="section level2">
<h2><span class="header-section-number">21.2</span> Social interaction among old people</h2>
<p>A graduate student wrote a thesis comparing different
treatments for increasing social interaction among geriatric
patients. He recruited 21 patients at a state mental hospital and
randomly assigned them to treatments: Reality Orientation
(<code>ro</code>), Behavior Therapy (<code>bt</code>) or no treatment
(<code>ctrl</code>). Each subject was observed at four times, labelled
<code>t1</code> through <code>t4</code> in the data file
<a href="http://www.utsc.utoronto.ca/~butler/d29/geriatrics.txt">link</a>. The
response variable was the percentage of time that the subject was
“engaging in the relevant social interaction”, so that a higher
value is better.</p>
<p>The principal aim of the study was to see whether there were
differences among the treatments (one would hope that the real
treatments were better than the control one), and whether there were
any patterns over time.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data and display at least some of it.</li>
</ol>
<p>Solution</p>
<p>The usual, separated by a single space:</p>
<div class="sourceCode" id="cb3112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3112-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/d29/geriatrics.txt&quot;</span></a>
<a class="sourceLine" id="cb3112-2" data-line-number="2">geriatrics=<span class="kw">read_delim</span>(my_url,<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   subject = col_double(),
##   treatment = col_character(),
##   t1 = col_double(),
##   t2 = col_double(),
##   t3 = col_double(),
##   t4 = col_double()
## )</code></pre>
<div class="sourceCode" id="cb3114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3114-1" data-line-number="1">geriatrics</a></code></pre></div>
<pre><code>## # A tibble: 21 x 6
##    subject treatment    t1    t2    t3    t4
##      &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1       1 bt          1.5   9     5     4  
##  2       2 bt          5    14     4.5   7  
##  3       3 bt          1     8     4.5   2.5
##  4       4 bt          5    14     8     5  
##  5       5 bt          3     8     4     4  
##  6       6 bt          0.5   3.5   1.3   1  
##  7       7 bt          0.5   3     1     0  
##  8       8 ro          2     5     5     1.5
##  9       9 ro          1.5   1.9   1.5   1  
## 10      10 ro          3.5   7     8     4  
## # ... with 11 more rows</code></pre>
<p>Correctly 21 observations measured at 4 different times. We also have
subject numbers, which might be useful later.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Create a response variable and fit a suitable <code>lm</code>
as the first stage of the repeated-measures analysis.</li>
</ol>
<p>Solution</p>
<p>This:</p>
<div class="sourceCode" id="cb3116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3116-1" data-line-number="1">response=<span class="kw">with</span>(geriatrics,<span class="kw">cbind</span>(t1,t2,t3,t4))</a>
<a class="sourceLine" id="cb3116-2" data-line-number="2">geriatrics<span class="fl">.1</span>=<span class="kw">lm</span>(response<span class="op">~</span>treatment,<span class="dt">data=</span>geriatrics)</a></code></pre></div>
<p>There is no need to look at this, since we are going to feed it into
<code>Manova</code> in a moment, but in case you’re curious, you see (in <code>summary</code>) a
regression of each of the four columns in <code>response</code> on
<code>treatment</code>, one by one.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Run a suitable <code>Manova</code>. There is some setup
first. Make sure you do that.</li>
</ol>
<p>Solution</p>
<p>Make sure <code>car</code> is loaded, and do the <code>idata</code> and
<code>idesign</code> thing:</p>
<div class="sourceCode" id="cb3117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3117-1" data-line-number="1">times=<span class="kw">colnames</span>(response)</a>
<a class="sourceLine" id="cb3117-2" data-line-number="2">times.df=<span class="kw">data.frame</span>(times)</a>
<a class="sourceLine" id="cb3117-3" data-line-number="3">geriatrics<span class="fl">.2</span>=<span class="kw">Manova</span>(geriatrics<span class="fl">.1</span>,<span class="dt">idata=</span>times.df,<span class="dt">idesign=</span><span class="op">~</span>times)</a></code></pre></div>
<p>In case you’re curious, <code>response</code> is an R <code>matrix</code>:</p>
<div class="sourceCode" id="cb3118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3118-1" data-line-number="1"><span class="kw">class</span>(response)</a></code></pre></div>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
<p>and
not a data frame (because it was created by <code>cbind</code> which makes
a matrix out of vectors). So, to pull the names off the top, we really
do need <code>colnames</code> (applied to a matrix) rather than just
<code>names</code> (which applies to a data frame).</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Display the results of your repeated-measures
analysis. What do you conclude? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>Just “printing” it will get you what you want:</p>
<div class="sourceCode" id="cb3120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3120-1" data-line-number="1">geriatrics<span class="fl">.2</span></a></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests: Pillai test statistic
##                 Df test stat approx F num Df den Df    Pr(&gt;F)    
## (Intercept)      1   0.74589   52.836      1     18 9.332e-07 ***
## treatment        2   0.24366    2.899      2     18  0.080994 .  
## times            1   0.72143   13.812      3     16  0.000105 ***
## treatment:times  2   0.92581    4.884      6     34  0.001073 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The interaction is significant, so the effects of the treatments are
different at different times. (It makes most sense to say it this way
around, since treatment is something that was controlled and time was not.)</p>
<p>You, I hope, know better than to look at the main effects when there
is a significant interaction!</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>To understand the results that you got from the repeated
measures analysis, you are going to draw a picture (or two). To do
<em>that</em>, we are going to need the data in “long” format with
one response value per line (instead of four). Use <code>gather</code>
suitably to get the data in that format, and demonstrate that you
have done so.</li>
</ol>
<p>Solution</p>
<p>The usual layout for <code>gather</code>:</p>
<div class="sourceCode" id="cb3122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3122-1" data-line-number="1">geriatrics.long =<span class="st"> </span>geriatrics <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3122-2" data-line-number="2"><span class="kw">gather</span>(time,intpct,t1<span class="op">:</span>t4) </a>
<a class="sourceLine" id="cb3122-3" data-line-number="3">geriatrics.long</a></code></pre></div>
<pre><code>## # A tibble: 84 x 4
##    subject treatment time  intpct
##      &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;
##  1       1 bt        t1       1.5
##  2       2 bt        t1       5  
##  3       3 bt        t1       1  
##  4       4 bt        t1       5  
##  5       5 bt        t1       3  
##  6       6 bt        t1       0.5
##  7       7 bt        t1       0.5
##  8       8 ro        t1       2  
##  9       9 ro        t1       1.5
## 10      10 ro        t1       3.5
## # ... with 74 more rows</code></pre>
<p>I had to think a bit about “what makes the gathered columns the same”.
They are all percentages of interactions of a specific type,
so you could as well (or better) call them “percent”.</p>
<p>Anyway, I have <em>one</em> column of interaction percents, and
<em>one</em> column of times. If you check the whole thing, you’ll see
that you get all the time-1 measurements first, then all the time-2
measurements, and so on, so that the subject number loops through the
21 subjects four times.</p>
<p>The long data frame is, well, long.</p>
<p>It’s not necessary to pull out the numeric time values, though you
could if you wanted to, via <code>separate</code> or by using
<code>parse_number</code>.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Calculate and save the mean interaction percents for each
time-treatment combination.</li>
</ol>
<p>Solution</p>
<p><code>group_by</code> followed by <code>summarize</code>, as ever:</p>
<div class="sourceCode" id="cb3124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3124-1" data-line-number="1">geriatrics.long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(treatment,time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3124-2" data-line-number="2"><span class="kw">summarize</span>(<span class="dt">mean=</span><span class="kw">mean</span>(intpct)) -&gt;<span class="st"> </span>means</a>
<a class="sourceLine" id="cb3124-3" data-line-number="3">means</a></code></pre></div>
<pre><code>## # A tibble: 12 x 3
## # Groups:   treatment [?]
##    treatment time   mean
##    &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt;
##  1 bt        t1     2.36
##  2 bt        t2     8.5 
##  3 bt        t3     4.04
##  4 bt        t4     3.36
##  5 ctrl      t1     2.64
##  6 ctrl      t2     2.23
##  7 ctrl      t3     1.63
##  8 ctrl      t4     2.14
##  9 ro        t1     1.86
## 10 ro        t2     3.8 
## 11 ro        t3     3.11
## 12 ro        t4     1.86</code></pre>
<ol start="7" style="list-style-type: lower-alpha">
<li>Make an interaction plot. Arrange things so that time goes
across the page. Use your data frame of means that you just calculated.</li>
</ol>
<p>Solution</p>
<p>Once you have the means, this is not too bad:</p>
<div class="sourceCode" id="cb3126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3126-1" data-line-number="1"><span class="kw">ggplot</span>(means,<span class="kw">aes</span>(<span class="dt">x=</span>time,<span class="dt">y=</span>mean,<span class="dt">group=</span>treatment,<span class="dt">colour=</span>treatment))<span class="op">+</span></a>
<a class="sourceLine" id="cb3126-2" data-line-number="2"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-19-1.png" width="672"  /></p>
<p>The “second factor” <code>treatment</code> appears as both
<code>group</code> and <code>colour</code>.</p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Describe what you see on your interaction plot, and what it
says about why your repeated-measures analysis came out as it did.</li>
</ol>
<p>Solution</p>
<p>The two “real” treatments <code>bt</code> and <code>ro</code> both go up
sharply between time 1 and time 2, and then come back down so that
by time 4 they are about where they started. The control group
basically didn’t change at all, and if anything went <em>down</em>
between times 1 and 2, a completely different pattern to the others.
The two treatments <code>bt</code> and <code>ro</code> are not exactly
parallel, but they do at least have qualitatively the same
pattern.
<label for="tufte-mn-193" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-193" class="margin-toggle"><span class="marginnote">That is to say, it’s the same kind of shape.</span> It
is, I think, the fact that the control group has a
<em>completely</em> different pattern over time that makes the
interaction come out significant.
<label for="tufte-mn-194" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-194" class="margin-toggle"><span class="marginnote">I am kind of wrong about that, as we see.</span>
I’m going to explore that some more later, but first I want to get
you to draw a spaghetti plot.</p>
<ol style="list-style-type: lower-roman">
<li>Draw a spaghetti plot of these data. That is, use
<code>ggplot</code> to plot the interaction percent against time for
each subject,
joining the points for the <em>same subject</em> by lines whose colour
shows what treatment they were on. Use the “long” data frame for
this (not the data frame of means).</li>
</ol>
<p>Solution</p>
<p>This is almost easier to do than it is to ask you to do:</p>
<div class="sourceCode" id="cb3127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3127-1" data-line-number="1"><span class="kw">ggplot</span>(geriatrics.long,<span class="kw">aes</span>(<span class="dt">x=</span>time,<span class="dt">y=</span>intpct,<span class="dt">colour=</span>treatment,<span class="dt">group=</span>subject))<span class="op">+</span></a>
<a class="sourceLine" id="cb3127-2" data-line-number="2"><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-20-1.png" width="672"  /></p>
<p>The basic difficulty here is to get all the parts. We need both a
<code>colour</code> and a <code>group</code>; the latter controls the joining
of points by lines (if you have both). Fortunately we already had
subject numbers in the original data; if we had not had them, we would
have had to create them. <code>dplyr</code> has a function
<code>row_number</code> that we could have used for that; we’d apply the row
numbers to the original wide data frame, before we made it long, so
that the correct subject numbers would get carried along.</p>
<p>Whether you add a <code>geom_point()</code> to plot the data points, or not,
is up to you. Logically, it makes sense to include the actual data,
but aesthetically, it looks more like spaghetti if you leave the
points out. Either way is good, as far as I’m concerned.</p>
<p>I didn’t ask you to comment on the spaghetti plot, because the story
is much the same as the interaction plot. There is a lot of
variability, but the story within each group is basically what we
already said: the red lines go sharply up and almost as sharply back
down again, the blue lines do something similar, only not as sharply
up and down, and the green lines do basically nothing.</p>
<p>I said that the control subjects’ time pattern was noticeably
different from the others. Which made me think: what if we remove the
control subjects? Would there still be an interaction?
<label for="tufte-mn-195" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-195" class="margin-toggle"><span class="marginnote">This is rather like removing time zero in the example in class.</span></p>
<p>All right, we need to start with the original wide data frame, and
from <em>that</em> select everything but <code>ctrl</code>:</p>
<div class="sourceCode" id="cb3128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3128-1" data-line-number="1">gg =<span class="st"> </span>geriatrics <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(treatment<span class="op">!=</span><span class="st">&quot;ctrl&quot;</span>) </a>
<a class="sourceLine" id="cb3128-2" data-line-number="2">gg</a></code></pre></div>
<pre><code>## # A tibble: 14 x 6
##    subject treatment    t1    t2    t3    t4
##      &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1       1 bt          1.5   9     5     4  
##  2       2 bt          5    14     4.5   7  
##  3       3 bt          1     8     4.5   2.5
##  4       4 bt          5    14     8     5  
##  5       5 bt          3     8     4     4  
##  6       6 bt          0.5   3.5   1.3   1  
##  7       7 bt          0.5   3     1     0  
##  8       8 ro          2     5     5     1.5
##  9       9 ro          1.5   1.9   1.5   1  
## 10      10 ro          3.5   7     8     4  
## 11      11 ro          1.5   4.2   2     1.5
## 12      12 ro          1.5   3.6   2     1  
## 13      13 ro          1.5   2.5   2.8   4  
## 14      14 ro          1.5   2.4   0.5   0</code></pre>
<p>So now there are two treatments left, seven people on
each:
<label for="tufte-mn-196" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-196" class="margin-toggle"><span class="marginnote">The factor <em>treatment</em> still has three levels, but only two of them have any remaining data.</span></p>
<div class="sourceCode" id="cb3130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3130-1" data-line-number="1">gg <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(treatment)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   treatment     n
##   &lt;chr&gt;     &lt;int&gt;
## 1 bt            7
## 2 ro            7</code></pre>
<p>Then we do
the same stuff over again: construct the response, run the
<code>lm</code>, create the stuff for <code>idata</code> and <code>idesign</code>,
and run the <code>Manova</code>. There’s really nothing new here:</p>
<div class="sourceCode" id="cb3132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3132-1" data-line-number="1"><span class="kw">attach</span>(gg)</a>
<a class="sourceLine" id="cb3132-2" data-line-number="2">response=<span class="kw">cbind</span>(t1,t2,t3,t4)</a>
<a class="sourceLine" id="cb3132-3" data-line-number="3">gg<span class="fl">.1</span>=<span class="kw">lm</span>(response<span class="op">~</span>treatment)</a>
<a class="sourceLine" id="cb3132-4" data-line-number="4">times=<span class="kw">colnames</span>(response)</a>
<a class="sourceLine" id="cb3132-5" data-line-number="5">times.df=<span class="kw">data.frame</span>(times)</a>
<a class="sourceLine" id="cb3132-6" data-line-number="6">gg<span class="fl">.2</span>=<span class="kw">Manova</span>(gg<span class="fl">.1</span>,<span class="dt">idata=</span>times.df,<span class="dt">idesign=</span><span class="op">~</span>times)</a>
<a class="sourceLine" id="cb3132-7" data-line-number="7">gg<span class="fl">.2</span></a></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests: Pillai test statistic
##                 Df test stat approx F num Df den Df    Pr(&gt;F)    
## (Intercept)      1   0.76503   39.069      1     12 4.251e-05 ***
## treatment        1   0.18506    2.725      1     12 0.1247005    
## times            1   0.81730   14.912      3     10 0.0005073 ***
## treatment:times  1   0.58168    4.635      3     10 0.0279590 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb3134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3134-1" data-line-number="1"><span class="kw">detach</span>(gg)</a></code></pre></div>
<p>There is still an interaction, but it’s not as significant as it was
before. I think it is still significant because the shape of the two
time trends is not the same: the red <code>bt</code> group goes up further
and down further. I was musing that the higher values are also more
variable, which would suggest a transformation, but I haven’t explored that.</p>
<p>If the interaction had turned out to be nonsignificant this way? You
might think about trying to remove it from the model, except that in
this kind of model, <code>treatment</code> is a `<code>between-subjects factor'' and</code>times` is a “within-subjects factor”, so they
are different kinds of things. What you do in that case is to ignore
the non-significant interaction and interpret the main effects: there
is no way to “gain df for error” like we did in two-way
ANOVA. Supposing, in this case, that we were using <span class="math inline">\(\alpha=0.01\)</span>, we
would say that the interaction is not significant. Then we look at the
main effects: there is no effect of treatment, but there is an effect
of time. Or, to put it another way, once you allow for an effect of
time, there is no difference between the two remaining
treatments.
<label for="tufte-mn-197" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-197" class="margin-toggle"><span class="marginnote">There is often an effect of time, which is why you would be taking multiple time measurements, but the issue is when you take that into account, you are giving yourself an improved chance, in general, to find a treatment effect. This is exactly the same idea as using a matched pairs design to give yourself an improved chance of finding a treatment effect, even though the subjects might be quite different from each other. In fact, repeated measures <em>is</em> matched pairs with more than two measurements on each person. Which makes me think, I should have you do a matched pairs as repeated measures.</span></p>
<p>Thinking back to our spaghetti plot, we are now comparing the red and
blue treatments. They both go up at time 2 and down afterwards, which
is the time effect, but even once you allow for this time trend, there is
too much scatter to be able to infer a difference between the treatments.</p>
<p>Extra (maybe branch off into another question?) I was thinking that this is not terribly clear, so I thought I would
fake up some data where there is a treatment effect and a time effect
(but no interaction), and draw a spaghetti plot, so you can see the
difference, idealized somewhat of course. Let’s try to come up with
something with the same kind of time effect, up at time 2 and then
down afterwards, that is the same for two drugs A and B. Here’s what I
came up with:</p>
<div class="sourceCode" id="cb3135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3135-1" data-line-number="1">fake=<span class="kw">read.csv</span>(<span class="st">&quot;fake.csv&quot;</span>,<span class="dt">header=</span>T)</a>
<a class="sourceLine" id="cb3135-2" data-line-number="2">fake</a></code></pre></div>
<pre><code>##    subject drug t1 t2 t3 t4
## 1        1    a 10 15 13 11
## 2        2    a 11 14 12  9
## 3        3    a 12 16 13 11
## 4        4    a 10 14 11 11
## 5        5    a 11 13 10  9
## 6        6    b  7 10  8  6
## 7        7    b  8 12 11  9
## 8        8    b  5  9  7  5
## 9        9    b  7  8  6  5
## 10      10    b  8 12 11  9</code></pre>
<p>You can kind of get the idea that the pattern over time is up and then
down, so that it finishes about where it starts, but the numbers for
drug A are usually bigger than the ones for drug B, consistently over
time. So there ought not to be an interaction, but there ought to be
both a time effect and a drug effect.</p>
<p>Let’s see whether we can demonstrate that. First, a spaghetti plot,
which involves getting the data in long format first. I’m saving the
long format to use again later.</p>
<div class="sourceCode" id="cb3137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3137-1" data-line-number="1">fake <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(times,score,t1<span class="op">:</span>t4) -&gt;<span class="st"> </span>fake.long</a>
<a class="sourceLine" id="cb3137-2" data-line-number="2">fake.long <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3137-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>times,<span class="dt">y=</span>score,<span class="dt">colour=</span>drug,<span class="dt">group=</span>subject))<span class="op">+</span></a>
<a class="sourceLine" id="cb3137-4" data-line-number="4"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-25-1.png" width="672"  /></p>
<p>The reds are consistently higher than the blues (drug effect), the
pattern over time goes up and then down (time effect), but the time
effect is basically the same for both drugs (no interaction).</p>
<p>I got the plot wrong the first time, because I forgot whether I was
doing an interaction plot (where <code>group=</code> and <code>colour=</code>
are the same) or a spaghetti plot (where <code>group</code> has to be
<code>subject</code> and the colour represents the treatment, usually).</p>
<p>Let’s do the repeated-measures ANOVA and see whether my guess above is right:</p>
<div class="sourceCode" id="cb3138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3138-1" data-line-number="1">response=<span class="kw">with</span>(fake,<span class="kw">cbind</span>(t1,t2,t3,t4))</a>
<a class="sourceLine" id="cb3138-2" data-line-number="2">fake<span class="fl">.1</span>=<span class="kw">lm</span>(response<span class="op">~</span>drug,<span class="dt">data=</span>fake)</a>
<a class="sourceLine" id="cb3138-3" data-line-number="3">times=<span class="kw">colnames</span>(response)</a>
<a class="sourceLine" id="cb3138-4" data-line-number="4">times.df=<span class="kw">data.frame</span>(times)</a>
<a class="sourceLine" id="cb3138-5" data-line-number="5">fake<span class="fl">.2</span>=<span class="kw">Manova</span>(fake<span class="fl">.1</span>,<span class="dt">idata=</span>times.df,<span class="dt">idesign=</span><span class="op">~</span>times)</a></code></pre></div>
<p>After typing this kind of stuff out a few too many times, I hope
you’re getting the idea “function”. Also, the construction of the
response is kind of annoying, where you have to list all the time
columns. The trouble is, <code>response</code> has to be a <code>matrix</code>,
which it is:</p>
<div class="sourceCode" id="cb3139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3139-1" data-line-number="1"><span class="kw">class</span>(response)</a></code></pre></div>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
<p>but if you do the obvious thing of selecting the columns of the data
frame that you want:</p>
<div class="sourceCode" id="cb3141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3141-1" data-line-number="1">fake <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(t1<span class="op">:</span>t4) -&gt;<span class="st"> </span>r</a>
<a class="sourceLine" id="cb3141-2" data-line-number="2"><span class="kw">class</span>(r)</a></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>you get a data frame instead. I think this would work:</p>
<div class="sourceCode" id="cb3143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3143-1" data-line-number="1">r =<span class="st"> </span>fake <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(t1<span class="op">:</span>t4) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.matrix</span>()</a>
<a class="sourceLine" id="cb3143-2" data-line-number="2"><span class="kw">class</span>(r)</a></code></pre></div>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
<p>The idea is that you select the columns you want as a data frame first
(with <code>select</code>), and then turn it into a <code>matrix</code> at the
end.</p>
<p>This is the kind of thing you’d have to do in a function, I think,
since you’d have to have some way of telling the function which are
the “time” columns. Anyway, hope you haven’t forgotten what we were
doing:
<label for="tufte-mn-198" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-198" class="margin-toggle"><span class="marginnote">I got sidetracked, surprise surprise.</span></p>
<div class="sourceCode" id="cb3145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3145-1" data-line-number="1">fake<span class="fl">.2</span></a></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests: Pillai test statistic
##             Df test stat approx F num Df den Df    Pr(&gt;F)    
## (Intercept)  1   0.98478   517.73      1      8 1.475e-08 ***
## drug         1   0.68417    17.33      1      8  0.003152 ** 
## times        1   0.98778   161.71      3      6 3.970e-06 ***
## drug:times   1   0.64900     3.70      3      6  0.081108 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The drug-by-time interaction is not (quite) significant, so working at
<span class="math inline">\(\alpha=0.05\)</span> (since that will help me make my point), we go ahead and
interpret the main effects: there is a time effect (the increase at
time 2 that I put in on purpose), and, allowing for the time effect,
there is also a difference between the drugs (because the drug A
scores are a bit higher than the drug B scores).</p>
<p>What if we ignored the time effect? You’d think we could do something
like this, treating the measurements at different times as replicates:</p>
<div class="sourceCode" id="cb3147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3147-1" data-line-number="1"><span class="kw">head</span>(fake.long)</a></code></pre></div>
<pre><code>##   subject drug times score
## 1       1    a    t1    10
## 2       2    a    t1    11
## 3       3    a    t1    12
## 4       4    a    t1    10
## 5       5    a    t1    11
## 6       6    b    t1     7</code></pre>
<div class="sourceCode" id="cb3149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3149-1" data-line-number="1">fake<span class="fl">.3</span>=<span class="kw">aov</span>(score<span class="op">~</span>drug,<span class="dt">data=</span>fake.long)</a>
<a class="sourceLine" id="cb3149-2" data-line-number="2"><span class="kw">summary</span>(fake<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## drug         1  133.2  133.23   30.54 2.54e-06 ***
## Residuals   38  165.8    4.36                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>but this would be <em>wrong</em>, because we are acting as if we have 40
independent observations, which we don’t (this is the point of doing
repeated measures in the first place). It looks as if we have achieved
something by getting a lower P-value for <code>drug</code>, but we
haven’t really, because we have done so by cheating.</p>
<p>What we could do instead is to average the scores for each subject
over all the times,
<label for="tufte-mn-199" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-199" class="margin-toggle"><span class="marginnote">This would be allowable, since we are averaging <em>over</em> the time-dependence; we are creating 10 independent averages, from the 10 subjects. People do this kind of thing, instead of having to deal with the repeated measures.</span> for
which we go back to the original data frame:</p>
<div class="sourceCode" id="cb3151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3151-1" data-line-number="1">fake</a></code></pre></div>
<pre><code>##    subject drug t1 t2 t3 t4
## 1        1    a 10 15 13 11
## 2        2    a 11 14 12  9
## 3        3    a 12 16 13 11
## 4        4    a 10 14 11 11
## 5        5    a 11 13 10  9
## 6        6    b  7 10  8  6
## 7        7    b  8 12 11  9
## 8        8    b  5  9  7  5
## 9        9    b  7  8  6  5
## 10      10    b  8 12 11  9</code></pre>
<div class="sourceCode" id="cb3153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3153-1" data-line-number="1">fake <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">avg.score=</span>(t1<span class="op">+</span>t2<span class="op">+</span>t3<span class="op">+</span>t4)<span class="op">/</span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3153-2" data-line-number="2"><span class="kw">aov</span>(avg.score<span class="op">~</span>drug,<span class="dt">data=</span>.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>()</a></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value  Pr(&gt;F)   
## drug         1  33.31   33.31   17.33 0.00315 **
## Residuals    8  15.37    1.92                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Ah, now, this is very interesting. I was hoping that by throwing away
the time information (which is useful), we would have diminished
the significance of the drug effect. By failing to include the
time-dependence in our model, we ought to have introduced some extra
variability, which ought to weaken our test. But this test gives
<em>exactly the same</em> P-value as the one in the MANOVA, and it looks
like exactly the same test (the <span class="math inline">\(F\)</span>-value is the same too). So it
looks as if this is what the MANOVA is doing, to assess the
<code>drug</code> effect: it’s averaging over the times. Since the same
four (here) time points are being used to compute the average for each
subject, we are comparing like with like at least, and even if there
is a large time effect, I suppose it’s going to have the same effect
on each average. For example, if as here the scores at time 2 are
typically highest, all the averages are going to be composed of one
high score and three lower ones. So maybe I have to go back and dilute
my conclusions about the significance of treatments earlier: it’s actually
saying that there is a difference between the two remaining treatments
<em>averaged over time</em> rather than <em>allowing for time</em> as I
said earlier.</p>
</div>
<div id="childrens-stress-levels-and-airports" class="section level2">
<h2><span class="header-section-number">21.3</span> Children’s stress levels and airports</h2>
<p>If you did STAC32, you might remember this question, which
we can now do properly. Some of this question is a repeat from there.</p>
<p>The data in <a href="http://www.utsc.utoronto.ca/~butler/c32/airport.txt">link</a>
are based on a 1998 study of stress levels in children as a result of
the building of a new airport in Munich, Germany. A total of 200
children had their epinephrine levels (a stress indicator) measured at
each of four different times: before the airport was built, and 6, 18
and 36 months after it was built. The four measurements are labelled
<code>epi_1</code> through <code>epi_4</code>. Out of the children, 100
were living near the new airport (location 1 in the data set), and
could be expected to suffer stress because of the new airport. The
other 100 children lived in the same city, but outside the noise
impact zone. These children thus serve as a control group. The
children are identified with numbers 1 through 200.</p>
<ol style="list-style-type: lower-alpha">
<li>If we were testing for the effect of time, explain briefly
what it is about the structure of the data that would make an
analysis of variance <em>inappropriate</em>.</li>
</ol>
<p>Solution</p>
<p>It is the fact that each child was measured four times, rather
than each measurement being on a <em>different</em> child (with
thus <span class="math inline">\(4\times 200=800\)</span> observations altogether). It’s
the same distinction as between matched pairs and a two-sample
<span class="math inline">\(t\)</span> test.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Read the data into R and demonstrate that you have the right
number of observations and variables.</li>
</ol>
<p>Solution</p>
<p>The usual, data values separated by one space:</p>
<div class="sourceCode" id="cb3155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3155-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/airport.txt&quot;</span></a>
<a class="sourceLine" id="cb3155-2" data-line-number="2">airport=<span class="kw">read_delim</span>(my_url,<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   epi_1 = col_double(),
##   epi_2 = col_double(),
##   epi_3 = col_double(),
##   epi_4 = col_double(),
##   location = col_double(),
##   child = col_double()
## )</code></pre>
<div class="sourceCode" id="cb3157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3157-1" data-line-number="1">airport</a></code></pre></div>
<pre><code>## # A tibble: 200 x 6
##      epi_1   epi_2 epi_3 epi_4 location child
##      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1   89.6   253.   214.   209.        1     1
##  2  -55.5    -1.45  26.0  259.        1     2
##  3  201.    280.   265.   174.        1     3
##  4  448.    349.   386.   225.        1     4
##  5   -4.60  315.   331.   333.        1     5
##  6  231.    237.   488.   319.        1     6
##  7  227.    469.   382.   359.        1     7
##  8  336.    280.   362.   472.        1     8
##  9   16.8   190.    90.9  145.        1     9
## 10   54.5   359.   454.   199.        1    10
## # ... with 190 more rows</code></pre>
<p>There are 200 rows (children), with four <code>epi</code> measurements, a
location and a child identifier, so that looks good.</p>
<p>(I am mildly concerned about the negative <code>epi</code> measurements,
but I don’t know what the scale is, so presumably they are all
right. Possibly epinephrine is measured on a log scale, so that a
negative value here is less than 1 on the original scale that we don’t
see.)</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Create and save a “long” data frame with all the epinephrine
values gathered together into one column.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb3159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3159-1" data-line-number="1">airport.long =<span class="st"> </span>airport <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(when, epinephrine, epi_<span class="dv">1</span><span class="op">:</span>epi_<span class="dv">4</span>) </a>
<a class="sourceLine" id="cb3159-2" data-line-number="2">airport.long</a></code></pre></div>
<pre><code>## # A tibble: 800 x 4
##    location child when  epinephrine
##       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;
##  1        1     1 epi_1       89.6 
##  2        1     2 epi_1      -55.5 
##  3        1     3 epi_1      201.  
##  4        1     4 epi_1      448.  
##  5        1     5 epi_1       -4.60
##  6        1     6 epi_1      231.  
##  7        1     7 epi_1      227.  
##  8        1     8 epi_1      336.  
##  9        1     9 epi_1       16.8 
## 10        1    10 epi_1       54.5 
## # ... with 790 more rows</code></pre>
<p>Success. I’m saving the name <code>time</code> for later, so I’ve called
the time points <code>when</code> for now. There were 4 measurements on
each of 200 children, so the long data frame should (and does) have
<span class="math inline">\(200\times 4 = 800\)</span> rows.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Make a “spaghetti plot” of these data: that is, a plot of
epinephrine levels against time, with the locations identified by
colour, and the points for the same child joined by lines. To do
this: (i) from the long data frame, create a new column containing
only the numeric values of time (1 through 4), (ii) plot epinephrine
level against time with the points grouped by child and coloured by
location (which you may have to turn from a number into a factor.)</li>
</ol>
<p>Solution</p>
<p>I hope you are thinking “pipeline”:</p>
<div class="sourceCode" id="cb3161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3161-1" data-line-number="1">airport.long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">time=</span><span class="kw">parse_number</span>(when)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3161-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>time,<span class="dt">y=</span>epinephrine,<span class="dt">colour=</span><span class="kw">factor</span>(location),<span class="dt">group=</span>child))<span class="op">+</span></a>
<a class="sourceLine" id="cb3161-3" data-line-number="3"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-35-1.png" width="672"  /></p>
<p>This is different from the plot we had in C32, where I had you use a
different colour for each <em>child</em>, and we ended up with a huge
legend of all the children (which we then removed).</p>
<p>If you forget to turn <code>location</code> into a factor, <code>ggplot</code>
will assume that you want <code>location</code> to be on a continuous
scale, and you’ll get two shades of blue.</p>
<p>Another problem with this plot is that there are so many children, you
can’t see the ones underneath because the ones on top are overwriting
them. The solution to that is to make the lines (partly) transparent,
which is controlled by a parameter <code>alpha</code>:
<label for="tufte-mn-200" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-200" class="margin-toggle"><span class="marginnote">This is different from the 0.05 <em>alpha</em>.</span></p>
<div class="sourceCode" id="cb3162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3162-1" data-line-number="1">airport.long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">time=</span><span class="kw">parse_number</span>(when)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3162-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>time,<span class="dt">y=</span>epinephrine,<span class="dt">colour=</span><span class="kw">factor</span>(location),<span class="dt">group=</span>child))<span class="op">+</span></a>
<a class="sourceLine" id="cb3162-3" data-line-number="3"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>(<span class="dt">alpha=</span><span class="fl">0.2</span>)</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-36-1.png" width="672"  /></p>
<p>It seems to make the lines skinnier, so they look more like
threads. Even given the lesser thickness, they seem to be a little bit
see-through as well. You can experiment with adding transparency to
the points in addition.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>What do you see on your spaghetti plot? We are looking ahead
to possible effects of time, location and their interaction.</li>
</ol>
<p>Solution</p>
<p>This is not clear, so it’s very much your call.
I see the red spaghetti strands as going up further
(especially) and maybe down further than the blue ones. The
epinephrine levels of the children near the new airport are
definitely more spread out, and maybe have a higher mean, than
those of the control group of children not near the airport.
The red spaghetti strands show something of an increase over
time, at least up to time 3, after which they seem to drop
again. The blue strands, however, don’t show any kind of trend
over time. Since the time trend is different for the two
locations, I would expect to see a significant interaction.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>The spaghetti plot was hard to interpret because there are
so many children. Calculate the mean epinephrine levels for each
location-time combination, and make an interaction plot with time
on the <span class="math inline">\(x\)</span>-axis and location as the second factor.</li>
</ol>
<p>Solution</p>
<p>We’ve done this before:</p>
<div class="sourceCode" id="cb3163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3163-1" data-line-number="1">airport.long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">time=</span><span class="kw">parse_number</span>(when)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3163-2" data-line-number="2"><span class="kw">mutate</span>(<span class="dt">floc=</span><span class="kw">factor</span>(location)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3163-3" data-line-number="3"><span class="kw">group_by</span>(floc,time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3163-4" data-line-number="4"><span class="kw">summarize</span>(<span class="dt">mean.epi=</span><span class="kw">mean</span>(epinephrine)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3163-5" data-line-number="5"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>time,<span class="dt">y=</span>mean.epi,<span class="dt">group=</span>floc,<span class="dt">colour=</span>floc))<span class="op">+</span></a>
<a class="sourceLine" id="cb3163-6" data-line-number="6"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-37-1.png" width="672"  /></p>
<p>I wanted the actual numerical times, so I made them again. Also, it
seemed to be easier to create a factor version of the numeric location
up front, and then use it several times later. I’m actually not sure
that you need it here, since <code>group_by</code> works with the
distinct values of a variable, whatever they are, and <code>group</code>
in a boxplot may or may not insist on something other than a number. I
should try it:</p>
<div class="sourceCode" id="cb3164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3164-1" data-line-number="1">airport.long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">time=</span><span class="kw">parse_number</span>(when)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3164-2" data-line-number="2"><span class="kw">group_by</span>(location,time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3164-3" data-line-number="3"><span class="kw">summarize</span>(<span class="dt">mean.epi=</span><span class="kw">mean</span>(epinephrine)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3164-4" data-line-number="4"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>time,<span class="dt">y=</span>mean.epi,<span class="dt">group=</span>location,<span class="dt">colour=</span>location))<span class="op">+</span></a>
<a class="sourceLine" id="cb3164-5" data-line-number="5"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-38-1.png" width="672"  /></p>
<p>It seems that <code>colour</code> requires a non-number:</p>
<div class="sourceCode" id="cb3165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3165-1" data-line-number="1">airport.long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">time=</span><span class="kw">parse_number</span>(when)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3165-2" data-line-number="2"><span class="kw">group_by</span>(location,time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3165-3" data-line-number="3"><span class="kw">summarize</span>(<span class="dt">mean.epi=</span><span class="kw">mean</span>(epinephrine)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3165-4" data-line-number="4"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>time,<span class="dt">y=</span>mean.epi,<span class="dt">group=</span>location,<span class="dt">colour=</span><span class="kw">factor</span>(location)))<span class="op">+</span></a>
<a class="sourceLine" id="cb3165-5" data-line-number="5"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-39-1.png" width="672"  /></p>
<p>With a long pipeline like this, none of us get it right the first time (I
certainly didn’t), so be prepared to debug it one line at a time. The
way I like to do this is to take the pipe symbol and move it down to
the next line (moving the cursor to just before it and hitting
Enter). This ends the pipe at the end of <em>this</em> line and displays
what it produces so far. When you are happy with that, go to the start
of the next line (that currently has a pipe symbol by itself) and hit
Backspace to move the pipe symbol back where it was. Then go to the
end of the next line (where the next pipe symbol is), move <em>that</em>
to a line by itself, and so on. Keep going until each line produces
what you want, and when you are finished, the whole pipeline will do
what you want.</p>
<ol start="7" style="list-style-type: lower-alpha">
<li>What do you conclude from your interaction plot? Is your
conclusion clearer than from the spaghetti plot?</li>
</ol>
<p>Solution</p>
<p>The two “traces” are not parallel, so I would expect to see
an interaction between location and time. The big difference
seems to be between times 1 and 2; the traces are the same at
time 1, and more or less parallel after time 2. Between times
1 and 2, the mean epinephrine level of the children near the
new airport increases sharply, whereas for the children in the
control group it increases much less.
This, to my mind, is very much easier to interpret than the
spaghetti plot, even the second version with the thinner
strands, because there is a lot of variability there that
obscures the overall pattern. The interaction plot is plain as
day, but it might be an oversimplification because it doesn’t
show variability.</p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Run a repeated-measures analysis of variance and display the
results. Go back to your original data frame, the one you read in
from the file, for this. You’ll need to make sure your numeric
<code>location</code> gets treated as a <code>factor</code>.</li>
</ol>
<p>Solution</p>
<p>The usual process. I’ll try the other way I used of making the
<code>response</code>:</p>
<div class="sourceCode" id="cb3166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3166-1" data-line-number="1">airport <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(epi_<span class="dv">1</span><span class="op">:</span>epi_<span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3166-2" data-line-number="2"><span class="kw">as.matrix</span>() -&gt;<span class="st"> </span>response</a>
<a class="sourceLine" id="cb3166-3" data-line-number="3">airport<span class="fl">.1</span>=<span class="kw">lm</span>(response<span class="op">~</span><span class="kw">factor</span>(location),<span class="dt">data=</span>airport)</a>
<a class="sourceLine" id="cb3166-4" data-line-number="4">times=<span class="kw">colnames</span>(response)</a>
<a class="sourceLine" id="cb3166-5" data-line-number="5">times.df=<span class="kw">data.frame</span>(times)</a>
<a class="sourceLine" id="cb3166-6" data-line-number="6">airport<span class="fl">.2</span>=<span class="kw">Manova</span>(airport<span class="fl">.1</span>,<span class="dt">idata=</span>times.df,<span class="dt">idesign=</span><span class="op">~</span>times)</a>
<a class="sourceLine" id="cb3166-7" data-line-number="7">airport<span class="fl">.2</span></a></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests: Pillai test statistic
##                        Df test stat approx F num Df den Df    Pr(&gt;F)    
## (Intercept)             1   0.92013  2281.00      1    198 &lt; 2.2e-16 ***
## factor(location)        1   0.13120    29.90      1    198 1.361e-07 ***
## times                   1   0.32741    31.80      3    196 &lt; 2.2e-16 ***
## factor(location):times  1   0.23737    20.34      3    196 1.626e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<ol style="list-style-type: lower-roman">
<li>What do you conclude from the MANOVA? Is that consistent
with your graphs? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>We start and end with the significant interaction: there is an
effect of location, but the nature of that effect depends on
time. This is the same as we saw in the interaction plot:
from time 2 on, the mean epinephrine levels for the children near
the new airport were clearly higher.
If you stare at the spaghetti plot, you <em>might</em> come to
the same conclusion. Or you might not! I suppose those red
dots at time 2 are mostly at the top, and generally so
afterwards, whereas at time 1 they are all mixed up with the
blue ones.
Interactions of this sort in this kind of analysis are very
common. There is an “intervention” or “treatment”, and the
time points are chosen so that the first one is before the
treatment happens, and the other time points are after. Then,
the results are very similar for the first time point, and
very different after that, rather than being (say) always
higher for the treatment group by about the same amount for
all times (in which case there would be no interaction).
So, you have some choices in practice as to how you might
go. You might do the MANOVA, get a significant interaction,
and draw an interaction plot to see why. You might stop there,
or you might do something like what we did in class: having
seen that the first time point is different from the others
for reasons that you can explain, do the analysis again, but
omitting the first time point. For the MANOVA, that means
tweaking your definition of your <code>response</code> to omit the
first time point. The rest of it stays the same, though you
might want to change your model numbers rather than re-using
the old ones as I did:</p>
<div class="sourceCode" id="cb3168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3168-1" data-line-number="1">airport <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(epi_<span class="dv">2</span><span class="op">:</span>epi_<span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3168-2" data-line-number="2"><span class="kw">as.matrix</span>() -&gt;<span class="st"> </span>response</a>
<a class="sourceLine" id="cb3168-3" data-line-number="3">airport<span class="fl">.1</span>=<span class="kw">lm</span>(response<span class="op">~</span><span class="kw">factor</span>(location),<span class="dt">data=</span>airport)</a>
<a class="sourceLine" id="cb3168-4" data-line-number="4">times=<span class="kw">colnames</span>(response)</a>
<a class="sourceLine" id="cb3168-5" data-line-number="5">times.df=<span class="kw">data.frame</span>(times)</a>
<a class="sourceLine" id="cb3168-6" data-line-number="6">airport<span class="fl">.2</span>=<span class="kw">Manova</span>(airport<span class="fl">.1</span>,<span class="dt">idata=</span>times.df,<span class="dt">idesign=</span><span class="op">~</span>times)</a>
<a class="sourceLine" id="cb3168-7" data-line-number="7">airport<span class="fl">.2</span></a></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests: Pillai test statistic
##                        Df test stat approx F num Df den Df    Pr(&gt;F)    
## (Intercept)             1   0.91853  2232.38      1    198 &lt; 2.2e-16 ***
## factor(location)        1   0.19515    48.01      1    198 5.822e-11 ***
## times                   1   0.01236     1.23      2    197  0.293852    
## factor(location):times  1   0.05086     5.28      2    197  0.005851 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The interaction is still significant, so there is still not a
consistent effect of being near the new airport on epinephrine levels:
that is to say, the effect of the new airport <em>still</em> varies over
time. That might be because (looking at the interaction plot) for the
children near the new airport, the mean epinephrine level went up
again between times 2 and 3, whereas for the control children it (for
some reason) went dramatically down over the same time period.</p>
<p>We have lots of data here (200 children), so the significant
interaction effect also might not be very big.</p>
<p>Experimental designs like this are kind of awkward, because you expect
there to be some kind of pattern over time for the treatment group,
that will vary over time, whereas for the control group, you expect
there to be no pattern over time. So a significant difference shows up
as an <em>interaction</em>, which is messier to interpret than you would
like.</p>
<p>Extra: the other way to analyze repeated measures data (that we, well, you, do not look
at in this course)
<label for="tufte-mn-201" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-201" class="margin-toggle"><span class="marginnote">This is something <em>I</em> want to understand, so I will share my findings with you. You can read them or not, as you choose.</span> is to treat them as “mixed models”, which
requires a different kind of analysis using the <code>lme4</code>
package. I always forget how these go, and I have to look them up when
I need them, but the idea is this: the treatments you observe, and the
time points at which you observe them, are
typically the only ones you care about (a so-called “fixed effect”),
but the individuals (children, here)
which you happen to observe are
something like a random sample of all the children you might have
observed (a so-called “random effect”). Models with random effects
in them are called “mixed models” (or, I suppose, models with both
fixed and random effects). This matters because you have repeated
observations on the <em>same</em> child. Some people like to think of
this in terms of “sources of variability”: the epinephrine levels
vary because of the location and time at which they were observed, but
also because of the particular child they happen to have been observed
for: each child has a “random effect” that they carry with them
through all the time points at which they are observed.</p>
<p>Let’s see if we can make it fly for this example. We need the data in
“long” format, the way we arranged it for graphing: the data frame
<code>airport.long</code>. I’d like to convert things to factors first:</p>
<div class="sourceCode" id="cb3170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3170-1" data-line-number="1">airport.long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">fchild=</span><span class="kw">factor</span>(child),</a>
<a class="sourceLine" id="cb3170-2" data-line-number="2"><span class="dt">flocation=</span><span class="kw">factor</span>(location)</a>
<a class="sourceLine" id="cb3170-3" data-line-number="3">) -&gt;<span class="st"> </span>fairport</a>
<a class="sourceLine" id="cb3170-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3170-5" data-line-number="5">airport<span class="fl">.3</span>=<span class="kw">lmer</span>(epinephrine<span class="op">~</span>flocation<span class="op">*</span>when<span class="op">+</span>(<span class="dv">1</span><span class="op">|</span>fchild), <span class="dt">data=</span>fairport)</a>
<a class="sourceLine" id="cb3170-6" data-line-number="6"><span class="kw">anova</span>(airport<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>## Analysis of Variance Table
##                Df Sum Sq Mean Sq F value
## flocation       1 168177  168177  29.900
## when            3 475671  158557  28.190
## flocation:when  3 366641  122214  21.728</code></pre>
<div class="sourceCode" id="cb3172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3172-1" data-line-number="1"><span class="kw">drop1</span>(airport<span class="fl">.3</span>,<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## epinephrine ~ flocation * when + (1 | fchild)
##                Df    AIC    LRT   Pr(Chi)    
## &lt;none&gt;            9521.2                     
## flocation:when  3 9577.6 62.475 1.739e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The <code>anova</code> doesn’t actually give us any tests, but what you
see in the ANOVA table are the fixed effects. These are testable. The
easiest way to see what you can get rid of is <code>drop1</code>; the
chi-squared test appears to be the right one (more on that
below). This says that the interaction is strongly significant, and we
should not consider removing it, the same conclusion as our
“profile analysis” before.
The other choice for
testing is to fit a model without what you
are testing and use <code>anova</code> to compare the two models:</p>
<div class="sourceCode" id="cb3174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3174-1" data-line-number="1">airport<span class="fl">.4</span>=<span class="kw">update</span>(airport<span class="fl">.3</span>,.<span class="op">~</span>.<span class="op">-</span>flocation<span class="op">:</span>when)</a>
<a class="sourceLine" id="cb3174-2" data-line-number="2"><span class="kw">anova</span>(airport<span class="fl">.4</span>,airport<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>## refitting model(s) with ML (instead of REML)</code></pre>
<pre><code>## Data: fairport
## Models:
## airport.4: epinephrine ~ flocation + when + (1 | fchild)
## airport.3: epinephrine ~ flocation * when + (1 | fchild)
##           Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)    
## airport.4  7 9577.6 9610.4 -4781.8   9563.6                             
## airport.3 10 9521.2 9568.0 -4750.6   9501.2 62.475      3  1.739e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>There are technical considerations involved in comparing the fit of
two models (which is the reason for the
“refitting models with…”): there is one method for estimating and a different
method for testing. The test is based on “likelihood ratio”, which
means that the right test for the <code>drop1</code> above is
<code>Chisq</code>.</p>
<p>If you omit the test in <code>drop1</code>, it just gives
you AIC values, which you can use for an informal assessment. In this
case, <code>&lt;none&gt;</code> has a much smaller AIC than the interaction
(smaller by over 50), so there’s no way we should entertain taking out
the interaction. However, if it had not been significant, we would
just take it out by fitting a model like <code>airport4</code>: there is
no distinction here between “within-subject” and
“between-subject”
factors that prevented us from taking the interaction out in profile
analysis.</p>
<p>As ever when an interaction is significant, we might think about
simple effects: that is, look at the two locations separately. That
makes sense here because of the kind of experimental design it is: we
<em>expect</em> a different kind of relationship with time for the
“treatment” children (the ones living near the new airport) as
compared to the control children, the ones who live farther away. That
approach would work with either the profile-analysis way using
<code>Manova</code> or the mixed-modelling way using <code>lmer</code>. In
either case, we’d expect to see a time effect at location 1 but not at
location 2. (Having separated out locations, only the time effect
would be left for testing.) I guess I have to show you that, but I
have to get ready for class first.</p>
<p>Later</p>
<p>The nice thing about Wednesday evenings is that I am so tired from
class that I have energy for almost nothing except playing with these
things. So let’s have a crack at it.</p>
<p>Let’s start with location 1, at which we expect there to be
something happening. This is really a simple effect of time at
location 1, but in repeated measures guise. The awkwardness is that
the profile analysis needs the wide-format data, while the mixed-model
analysis needs long format, so we’ll have to repeat our process, once
for each format of data set:</p>
<div class="sourceCode" id="cb3177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3177-1" data-line-number="1">loc1 =<span class="st"> </span>airport <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(location<span class="op">==</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3177-2" data-line-number="2">response =<span class="st"> </span>loc1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(epi_<span class="dv">1</span><span class="op">:</span>epi_<span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.matrix</span>() </a>
<a class="sourceLine" id="cb3177-3" data-line-number="3">loc1<span class="fl">.1</span>=<span class="kw">lm</span>(response<span class="op">~</span><span class="dv">1</span>,<span class="dt">data=</span>loc1)</a>
<a class="sourceLine" id="cb3177-4" data-line-number="4">times=<span class="kw">colnames</span>(response)</a>
<a class="sourceLine" id="cb3177-5" data-line-number="5">times.df=<span class="kw">data.frame</span>(times)</a>
<a class="sourceLine" id="cb3177-6" data-line-number="6">loc1<span class="fl">.2</span>=<span class="kw">Manova</span>(loc1<span class="fl">.1</span>,<span class="dt">idata=</span>times.df,<span class="dt">idesign=</span><span class="op">~</span>times)</a></code></pre></div>
<pre><code>## Note: model has only an intercept; equivalent type-III tests substituted.</code></pre>
<div class="sourceCode" id="cb3179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3179-1" data-line-number="1">loc1<span class="fl">.2</span></a></code></pre></div>
<pre><code>## 
## Type III Repeated Measures MANOVA Tests: Pillai test statistic
##             Df test stat approx F num Df den Df    Pr(&gt;F)    
## (Intercept)  1   0.89729   864.86      1     99 &lt; 2.2e-16 ***
## times        1   0.45423    26.91      3     97 9.496e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>This is one of those times where a pipe doesn’t quite do it. We need
to grab the data for location 1, but then we need to do two things
with it: one, create a response variable, and two, feed the response
variable <em>and</em> the location 1 data into <code>lm</code>. Pipes are
for linear sequences of things to do, and this one diverges. So, save
what you need to save, and then do it without a pipe.</p>
<p>This is one of those explanatory-variable-less repeated measures where
you <em>only</em> have things varying over time. Here, the treatment was
location, and we’re only looking at one of those locations. We still
have a within-subject design (the four times), but there is no
between-subject design left.</p>
<p>The conclusion is that there is very strong evidence of a time effect
for location 1, as we would have guessed.</p>
<p>Now, let’s see whether the mixed-model analysis comes to the same
conclusion. This time, we have to start from the <em>long</em> data set
(the one I’m using is the one called <code>fairport</code> with things as
factors) and pull out the rows for location 1. The only remaining
fixed effect is time:</p>
<div class="sourceCode" id="cb3181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3181-1" data-line-number="1">fairport <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(location<span class="op">==</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3181-2" data-line-number="2"><span class="kw">lmer</span>(epinephrine<span class="op">~</span>when<span class="op">+</span>(<span class="dv">1</span><span class="op">|</span>fchild),<span class="dt">data=</span>.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3181-3" data-line-number="3"><span class="kw">drop1</span>(<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## epinephrine ~ when + (1 | fchild)
##        Df    AIC    LRT   Pr(Chi)    
## &lt;none&gt;    4964.1                     
## when    3 5032.1 74.048 5.796e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The effect of time is, once again, substantial. The P-value is not the
same, because the test is not the same, but it is very similar and
points to exactly the same conclusion.</p>
<p>I should perhaps point out that you don’t <em>have</em> to do these
models in a pipe. I just did because it was easier for me. But there’s
nothing wrong with doing it like this:</p>
<div class="sourceCode" id="cb3183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3183-1" data-line-number="1">tmp=fairport <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(location<span class="op">==</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3183-2" data-line-number="2">tmp<span class="fl">.1</span>=<span class="kw">lmer</span>(epinephrine<span class="op">~</span>when<span class="op">+</span>(<span class="dv">1</span><span class="op">|</span>child),<span class="dt">data=</span>tmp)</a>
<a class="sourceLine" id="cb3183-3" data-line-number="3"><span class="kw">drop1</span>(tmp<span class="fl">.1</span>,<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## epinephrine ~ when + (1 | child)
##        Df    AIC    LRT   Pr(Chi)    
## &lt;none&gt;    4964.1                     
## when    3 5032.1 74.048 5.796e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>and it gives exactly the same result.</p>
<p>This last model (in either of its versions) is a so-called random
intercepts model. What it says is that epinephrine level for a child
depends on time, but the effect of being one child rather than another
is to shunt the mean epinephrine level up or down by a fixed amount
for all times. It seems to me that this is a very reasonable way to
model the child-to-child variation in this case, but in other cases,
things might be different. <code>lmer</code> allows more sophisticated
things, like for example the random child effect depending linearly on
time. To do that, you’d rewrite the above like this:</p>
<div class="sourceCode" id="cb3185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3185-1" data-line-number="1">fairport <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(location<span class="op">==</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3185-2" data-line-number="2"><span class="kw">lmer</span>(epinephrine<span class="op">~</span>when<span class="op">+</span>(<span class="dv">1</span><span class="op">+</span>when<span class="op">|</span>fchild),<span class="dt">data=</span>.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3185-3" data-line-number="3"><span class="kw">drop1</span>(<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</a></code></pre></div>
<p>The change is on the <code>lmer</code> line: the bit in brackets has a
linear model in <code>when</code> for each child. I didn’t run that, so
I’m not certain it works,
<label for="tufte-mn-202" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-202" class="margin-toggle"><span class="marginnote">I’m suspicious about <em>when</em> needing to be the numerical time inside. Not sure.</span> but that’s the idea.</p>
<p>All right, let’s get on to location 2. This was the control location,
so we expect to see <em>no</em> dependence of epinephrine level on time,
either in the profile analysis or in the mixed-model analysis. There
is a large amount of copying and pasting coming up:</p>
<div class="sourceCode" id="cb3186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3186-1" data-line-number="1">airport <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(location<span class="op">==</span><span class="dv">2</span>) -&gt;<span class="st"> </span>loc2</a>
<a class="sourceLine" id="cb3186-2" data-line-number="2">loc2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(epi_<span class="dv">1</span><span class="op">:</span>epi_<span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.matrix</span>() -&gt;<span class="st"> </span>response</a>
<a class="sourceLine" id="cb3186-3" data-line-number="3">loc2<span class="fl">.1</span>=<span class="kw">lm</span>(response<span class="op">~</span><span class="dv">1</span>,<span class="dt">data=</span>loc1)</a>
<a class="sourceLine" id="cb3186-4" data-line-number="4">times=<span class="kw">colnames</span>(response)</a>
<a class="sourceLine" id="cb3186-5" data-line-number="5">times.df=<span class="kw">data.frame</span>(times)</a>
<a class="sourceLine" id="cb3186-6" data-line-number="6">loc2<span class="fl">.2</span>=<span class="kw">Manova</span>(loc2<span class="fl">.1</span>,<span class="dt">idata=</span>times.df,<span class="dt">idesign=</span><span class="op">~</span>times)</a></code></pre></div>
<pre><code>## Note: model has only an intercept; equivalent type-III tests substituted.</code></pre>
<div class="sourceCode" id="cb3188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3188-1" data-line-number="1">loc2<span class="fl">.2</span></a></code></pre></div>
<pre><code>## 
## Type III Repeated Measures MANOVA Tests: Pillai test statistic
##             Df test stat approx F num Df den Df    Pr(&gt;F)    
## (Intercept)  1   0.96147  2470.17      1     99 &lt; 2.2e-16 ***
## times        1   0.30236    14.01      3     97 1.161e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>I think I changed everything I needed to.</p>
<p>There actually <em>is</em> still an effect of time. What kind of effect?
We can look at that by finding epinephrine means at each time. That
would be easier if we had long format, but I think we can still do
it. The magic word is <code>summarize_at</code> (well, the magic two
words):</p>
<div class="sourceCode" id="cb3190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3190-1" data-line-number="1">airport <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(location<span class="op">==</span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3190-2" data-line-number="2"><span class="kw">summarize_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">&quot;epi&quot;</span>)),<span class="kw">funs</span>(mean))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   epi_1 epi_2 epi_3 epi_4
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  249.  279.  251.  247.</code></pre>
<p>The message here is that the mean epinephrine levels at time 2 were
higher than the others, so that’s what seems to be driving the time
effect. And remember, these were the control children, so they had no
new airport nearby.</p>
<p>I want to try this:</p>
<div class="sourceCode" id="cb3192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3192-1" data-line-number="1">airport <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(location) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nest</span>()</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   location data              
##      &lt;dbl&gt; &lt;list&gt;            
## 1        1 &lt;tibble [100 × 5]&gt;
## 2        2 &lt;tibble [100 × 5]&gt;</code></pre>
<p>This is like the idea in the Spilich problem: I want to write a
function that calculates the means of the <code>epi_1</code> through
<code>epi_4</code> columns of a data frame like <code>airport</code>, and
then apply it to each of those “nested” data frames.</p>
<div class="sourceCode" id="cb3194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3194-1" data-line-number="1">epi.means=<span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb3194-2" data-line-number="2">x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">&quot;epi&quot;</span>)),<span class="kw">funs</span>(mean))</a>
<a class="sourceLine" id="cb3194-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb3194-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3194-5" data-line-number="5"><span class="kw">epi.means</span>(airport)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   epi_1 epi_2 epi_3 epi_4
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  248.  309.  304.  298.</code></pre>
<p>OK, and then:</p>
<div class="sourceCode" id="cb3196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3196-1" data-line-number="1">airport <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(location) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3196-2" data-line-number="2"><span class="kw">mutate</span>(<span class="dt">means=</span><span class="kw">map</span>(data,epi.means)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3196-3" data-line-number="3"><span class="kw">unnest</span>(means)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   location data               epi_1 epi_2 epi_3 epi_4
##      &lt;dbl&gt; &lt;list&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1        1 &lt;tibble [100 × 5]&gt;  247.  340.  356.  349.
## 2        2 &lt;tibble [100 × 5]&gt;  249.  279.  251.  247.</code></pre>
<p>Ooh, nice. There are the means for the four time points at both of the
two locations. At location 1, epinephrine starts out low, jumps high
after the airport is built, and stays there, while at location 2, the
mean is mysteriously higher at time 2 and then epinephrine levels go
back down again.</p>
<p>Enough of that. Back to the mixed model analysis, with more copying
and pasting. Here is the “simple time effect” at location 2:</p>
<div class="sourceCode" id="cb3198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3198-1" data-line-number="1">fairport <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(location<span class="op">==</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3198-2" data-line-number="2"><span class="kw">lmer</span>(epinephrine<span class="op">~</span>when<span class="op">+</span>(<span class="dv">1</span><span class="op">|</span>fchild),<span class="dt">data=</span>.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3198-3" data-line-number="3"><span class="kw">drop1</span>(<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## epinephrine ~ when + (1 | fchild)
##        Df    AIC    LRT   Pr(Chi)    
## &lt;none&gt;    4336.8                     
## when    3 4363.7 32.889 3.399e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>This also finds a time effect at location 2, with a very similar P-value.</p>
<p>So which method is preferred? They are, I think, two different ways of
approaching the same problem, and so there is no good reason to prefer
one way over the other. The profile-analysis way is easier to follow
if you are coming from a MANOVA direction: set it up the same way as
you would a MANOVA, with your repeated measures as your multivariate
response, and distinguish between the within-subject design (times,
for us) and the between-subject design (treatments, stuff like
that). As for mixed models: when you get your head around that crazy
way of specifying the random effects, which are typically “subjects”
in this kind of analysis, the actual model statement is brief:
response depends on fixed effects plus random effects with the
brackets and vertical bar. I always find the <code>lmer</code> models look
very simple once you have figured them out (like <code>ggplot</code> in
that regard). I also like the fact that <code>lmer</code> uses “tidy data”,
so that you can make graphs and do this flavour of analysis
with the same data frame. Having gotten my head around getting my data
tidy, it seems odd to me that profile analysis requires the data to be
untidy, although it does so for a good reason: if you were genuinely
doing a MANOVA, you would <em>want</em> your multiple response
variables each in their own column. Doing repeated measures this way
is thinking of your responses at different times like different
variables.</p>
<p>The approach I’ve taken in this course is for historical reasons. That
is to say, <em>my</em> history, not because the historical perspective
is necessarily the best one. It began with doing repeated measures in
SAS (this was like nine years ago), and the only way I could get my
head around that was the profile-analysis way. I’m not even sure there
was software for doing mixed models in those days, certainly not in
SAS. Besides, random effects scared me back then. Anyway, when I
moved things over to R (this must have been about six years ago), I
realized I was using basically the same idea in R: make it into a
MANOVA and tweak things as needed. So I developed things by showing
you MANOVA first as ANOVA when you have lots of <span class="math inline">\(y\)</span>-variables instead
of just one, and then using it for repeated measures by thinking of
the repeated measures as “different-but-related” <span class="math inline">\(y\)</span>-variables. To
my mind, this is a reasonable way of doing it in a course like this:
you get to see MANOVA, which is worth knowing about anyway, and then
you get to apply it to a very common situation.</p>
<p>Mixed models are actually quite recent, as a way of doing this kind of
modelling. Back when I was learning this stuff, you learned to
distinguish between “fixed effects”, whose levels were the only ones
you cared about (like the two locations here), and “random effects”,
where the ones you observed were only a sample of the ones you might
have seen (like “children” or in general “subjects”). Then you
would test the fixed effects by hypothesizing that their mean effect
was zero and seeing whether you could reject that (in the same way
that you do in regression or regular ANOVA: in the latter case, you
test that the effects of all the different groups are zero, which
comes down to saying that all the groups have the same mean). The way
you handled random effects was to estimate their <em>variance</em>, and
then you would test whether a random effect exists or not by testing
whether the variance of that random effect is zero (does not exist) or
is greater than zero. Zero is the smallest a variance (or SD) can be,
which means that testing for it has always been kind of flakey and the
standard theory doesn’t work for it (the technical term is
“on the boundary of the parameter space”, and the theory applies when the
null-hypothesis value is strictly <em>inside</em> the set of possible
values the parameter can take). Back when we did this stuff by
hand,
<label for="tufte-mn-203" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-203" class="margin-toggle"><span class="marginnote">I understand psychology students <em>still</em> do this kind of stuff by hand.</span> we had to figure out whether we were testing
a fixed or a random effect, and there were rules, involving things
called “expected mean squares”, that told you how to get the tests
right. Anyway, that is all considered rather old-fashioned now, and
mixed models are where it is at. In these, you typically <em>only</em>
test the fixed effects, while estimating the size of the random
effects, taking it for granted that they exist. This is an active area
of research; the things that <code>lmer</code> fits are called
“linear mixed models”, and there are also now
“generalized linear mixed models”, things like logistic regression with random effects.</p>
<p>We haven’t had to worry about this up to now because in most of the
experimental designs we have used, each subject only contributes
<em>one</em> measurement. In that case, you cannot separate out a
subject-specific “random effect” from random error, and so we lump
it all into random error. The one experimental design where a subject
gives us more than one measurement is matched pairs, and the way we
have handled that so far is to turn the two measurements into one by
taking the difference between them; even in that case, each subject
contributes only one <em>difference</em> to the analysis. Repeated
measures, though, is genuinely different: you can’t wish away multiple
measurements on the same subject by taking differences any more, so
you have to face up to the issue at last. Either we think of it as
several different measurements that might be correlated (the
profile-analysis MANOVA way), or we face up to the idea that different
subjects bring their own random effect to the table that shows up in
every measurement that the subject provides (mixed models).</p>
<p>I did analysis of covariance as a separate mini-section, thinking of
it as a regression, but if the numerical covariate is the same thing
as the response but measured at a different time (eg., before rather than
after), that would also respond to a repeated-measures approach, or to
the taking of differences as matched pairs does. There is almost
always more than one way to look at these things.</p>
<p>This one is also stolen from STAC32. Athletes are concerned
with measuring their body fat percentage. Two different methods are
available: one using ultrasound, and the other using X-ray
technology. We are interested in whether there is a difference in the
mean body fat percentage as measured by these two methods, and if so,
how big that difference is. Data on 16 athletes are at
<a href="http://www.utsc.utoronto.ca/~butler/c32/bodyfat.txt">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data and check that you have a sensible number of
rows and columns.</li>
</ol>
<p>Solution</p>
<p>This kind of thing:</p>
<div class="sourceCode" id="cb3200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3200-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/bodyfat.txt&quot;</span></a>
<a class="sourceLine" id="cb3200-2" data-line-number="2">bodyfat=<span class="kw">read_delim</span>(my_url,<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   athlete = col_double(),
##   xray = col_double(),
##   ultrasound = col_double()
## )</code></pre>
<div class="sourceCode" id="cb3202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3202-1" data-line-number="1">bodyfat</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##    athlete  xray ultrasound
##      &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1       1  5          4.75
##  2       2  7          3.75
##  3       3  9.25       9   
##  4       4 12         11.8 
##  5       5 17.2       17   
##  6       6 29.5       27.5 
##  7       7  5.5        6.5 
##  8       8  6          6.75
##  9       9  8          8.75
## 10      10  8.5        9.5 
## 11      11  9.25       9.5 
## 12      12 11         12   
## 13      13 12         12.2 
## 14      14 14         15.5 
## 15      15 17         18   
## 16      16 18         18.2</code></pre>
<p>16 rows (athletes) and 3 columns, one for each measurement
method and one labelling the athletes. All good.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Carry out a suitable (matched-pairs) <span class="math inline">\(t\)</span>-test to determine
whether the means are the same or different.</li>
</ol>
<p>Solution</p>
<p>Feed the two columns into <code>t.test</code> along with
<code>paired=T</code>. Remember that this is (in effect) a one-sample
<span class="math inline">\(t\)</span>-test, so that you can’t use a <code>data=</code>. You therefore have
to wrap everything in a <code>with</code>:</p>
<div class="sourceCode" id="cb3204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3204-1" data-line-number="1"><span class="kw">with</span>(bodyfat,<span class="kw">t.test</span>(xray,ultrasound,<span class="dt">paired=</span>T))</a></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  xray and ultrasound
## t = -0.30801, df = 15, p-value = 0.7623
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.7425068  0.5550068
## sample estimates:
## mean of the differences 
##                -0.09375</code></pre>
<p>The test we want is two-sided, so we didn’t have to take any special
steps to get that.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>What do you conclude from the test?</li>
</ol>
<p>Solution</p>
<p>The P-value of 0.7623 is not at all small, so there is no way we can
reject the null hypothesis.
<label for="tufte-mn-204" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-204" class="margin-toggle"><span class="marginnote">My hat stays on my head.</span> There
is no evidence of a difference in means; we can act as if the two
methods produce the same mean body fat percentage.
That is to say, on this evidence we can use either method, whichever
one is cheaper or more convenient.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Run a repeated-measures analysis of variance, treating the two
methods of measuring body fat as the repeated measures (ie., playing
the role of “time” that you have seen in most of the other repeated
measures analyses). There is no “treatment” here, so there is
nothing to go on the right side of the squiggle. Insert a <code>1</code>
there to mean “just an intercept”. Display the results.</li>
</ol>
<p>Solution</p>
<p>Construct the response variable, run <code>lm</code>, construct the
within-subjects part of the design, run <code>Manova</code>:</p>
<div class="sourceCode" id="cb3206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3206-1" data-line-number="1">bodyfat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(xray<span class="op">:</span>ultrasound) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3206-2" data-line-number="2"><span class="kw">as.matrix</span>() -&gt;<span class="st"> </span>response</a>
<a class="sourceLine" id="cb3206-3" data-line-number="3">bodyfat<span class="fl">.1</span>=<span class="kw">lm</span>(response<span class="op">~</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3206-4" data-line-number="4">methods=<span class="kw">colnames</span>(response)</a>
<a class="sourceLine" id="cb3206-5" data-line-number="5">methods.df=<span class="kw">data.frame</span>(methods)</a>
<a class="sourceLine" id="cb3206-6" data-line-number="6">bodyfat<span class="fl">.2</span>=<span class="kw">Manova</span>(bodyfat<span class="fl">.1</span>,<span class="dt">idata=</span>methods.df,<span class="dt">idesign=</span><span class="op">~</span>methods)</a></code></pre></div>
<pre><code>## Note: model has only an intercept; equivalent type-III tests substituted.</code></pre>
<div class="sourceCode" id="cb3208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3208-1" data-line-number="1">bodyfat<span class="fl">.2</span></a></code></pre></div>
<pre><code>## 
## Type III Repeated Measures MANOVA Tests: Pillai test statistic
##             Df test stat approx F num Df den Df    Pr(&gt;F)    
## (Intercept)  1   0.79734   59.016      1     15 1.413e-06 ***
## methods      1   0.00628    0.095      1     15    0.7623    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<ol start="5" style="list-style-type: lower-alpha">
<li>Compare your repeated-measures analysis to your matched-pairs
one. Do you draw the same conclusions?</li>
</ol>
<p>Solution</p>
<p>The P-value for <code>methods</code>, which is testing the same thing
as the matched pairs, is 0.7623, which is actually
<em>identical</em> to the matched pairs <span class="math inline">\(t\)</span>-test, and so the
conclusion is identical also. That is, there is no difference
between the two methods for measuring body fat.
This goes to show that repeated measures gives the same answer as
a matched-pairs <span class="math inline">\(t\)</span>-test in the situation where they both
apply. But repeated measures is, as we have seen, a lot more general.
Since this really is repeated measures, we ought to be able to use
a mixed model here too. We need “long” or “tidy” format, which
we don’t have yet. One pipe to save them all, to paraphrase Lord
of the Rings
<label for="tufte-mn-205" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-205" class="margin-toggle"><span class="marginnote">The movies of Lord of the Rings were filmed in New Zealand, which is also the country in which R was first designed.</span> — put all the fat measurements in one column with a
label saying which <code>method</code> they were obtained with; create
a column which is the athlete number as a factor; fit the linear
mixed model; see what we can drop from it:</p>
<div class="sourceCode" id="cb3210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3210-1" data-line-number="1">bodyfat</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##    athlete  xray ultrasound
##      &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1       1  5          4.75
##  2       2  7          3.75
##  3       3  9.25       9   
##  4       4 12         11.8 
##  5       5 17.2       17   
##  6       6 29.5       27.5 
##  7       7  5.5        6.5 
##  8       8  6          6.75
##  9       9  8          8.75
## 10      10  8.5        9.5 
## 11      11  9.25       9.5 
## 12      12 11         12   
## 13      13 12         12.2 
## 14      14 14         15.5 
## 15      15 17         18   
## 16      16 18         18.2</code></pre>
<div class="sourceCode" id="cb3212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3212-1" data-line-number="1">bodyfat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(method,fat,xray<span class="op">:</span>ultrasound) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3212-2" data-line-number="2"><span class="kw">mutate</span>(<span class="dt">fathlete=</span><span class="kw">factor</span>(athlete)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3212-3" data-line-number="3"><span class="kw">lmer</span>(fat<span class="op">~</span>method<span class="op">+</span>(<span class="dv">1</span><span class="op">|</span>fathlete),<span class="dt">data=</span>.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3212-4" data-line-number="4"><span class="kw">drop1</span>(<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## fat ~ method + (1 | fathlete)
##        Df    AIC     LRT Pr(Chi)
## &lt;none&gt;    161.34                
## method  1 159.44 0.10088  0.7508</code></pre>
<p>Once again, there is no difference between methods, and though the
P-value is different from the matched pairs or profile analysis, it is
very close to those.</p>
<p>If you’re not clear about the tidy data frame used for input to
<code>lmer</code>, pull the top two lines off the chain and see what they produce:</p>
<div class="sourceCode" id="cb3214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3214-1" data-line-number="1">bodyfat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(method,fat,xray<span class="op">:</span>ultrasound) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3214-2" data-line-number="2"><span class="kw">mutate</span>(<span class="dt">fathlete=</span><span class="kw">factor</span>(athlete)) </a></code></pre></div>
<pre><code>## # A tibble: 32 x 4
##    athlete method   fat fathlete
##      &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;fct&gt;   
##  1       1 xray    5    1       
##  2       2 xray    7    2       
##  3       3 xray    9.25 3       
##  4       4 xray   12    4       
##  5       5 xray   17.2  5       
##  6       6 xray   29.5  6       
##  7       7 xray    5.5  7       
##  8       8 xray    6    8       
##  9       9 xray    8    9       
## 10      10 xray    8.5  10      
## # ... with 22 more rows</code></pre>
<p>Each athlete now appears twice: once with their <code>fat</code> measured
by <code>xray</code>, and again with it measured by
<code>ultrasound</code>. The column <code>fathlete</code> is a factor.</p>
<p>The mixed model took me two goes to get right: I forgot that I needed the
<code>data=.</code> in <code>lmer</code>, because it works like <code>lm</code>
with the model formula first, not the input data. If the chain is
going too fast for you, create the tidy data frame and save it, then
use the saved data frame as input to <code>lmer</code>.</p>
</div>
<div id="investigating-motor-activity-in-rats" class="section level2">
<h2><span class="header-section-number">21.4</span> Investigating motor activity in rats</h2>
<p>A researcher named King was investigating
the effect of the drug midazolam on motor activity in rats. Typically,
the first time the drug is injected, a rat’s motor activity decreases
substantially, but rats typically develop a “tolerance”, so that
further injections of the drug have less impact on the rat’s motor
activity.</p>
<p>The data shown in
<a href="http://www.utsc.utoronto.ca/~butler/d29/king.csv">link</a> were all taken
in one day, called the “experiment day” below. 24 different rats
were used. Each rat, on the experiment day, was injected with a fixed
amount of midazolam, and at each of six five-minute intervals after
being injected, the rat’s motor activity was measured (these are
labelled <code>i1</code> through <code>i6</code> in the data). The rats
differed in how they had been treated before the experiment day. The
control group of rats had previously been injected repeatedly with a
saline solution (no active ingredient), so the experiment day was the
first time this group of rats had received midazolam. The other two
groups of rats had both received midazolam repeatedly before the
experiment day: the “same” group was injected on experiment day in
the same environment that the previous injections had taken place (this
is known in psychology as a “conditioned tolerance”), but the
“different” group had the previous injections in a different
environment than on experiment day.</p>
<p>The column <code>id</code> identifies the rat from which each sequence of
values was obtained.</p>
<ol style="list-style-type: lower-alpha">
<li>Explain briefly why we need to use a repeated measures
analysis for these data.</li>
</ol>
<p>Solution</p>
<p>Each rat is measured at six different times (<code>i1</code> through
<code>i6</code>): that is to say, each row of the data set consists of
repeated measurements on the <em>same</em> rat. (If each row had
used six <em>different</em> rats to obtain the six measurements, we
would have been back in familiar territory and could have used a
regular analysis of variance.)</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Read in the data and note that you have what was promised
in the question.</li>
</ol>
<p>Solution</p>
<p>The usual:</p>
<div class="sourceCode" id="cb3216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3216-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/d29/king.csv&quot;</span></a>
<a class="sourceLine" id="cb3216-2" data-line-number="2">king=<span class="kw">read_csv</span>(my_url)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   id = col_double(),
##   context = col_character(),
##   i1 = col_double(),
##   i2 = col_double(),
##   i3 = col_double(),
##   i4 = col_double(),
##   i5 = col_double(),
##   i6 = col_double()
## )</code></pre>
<div class="sourceCode" id="cb3218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3218-1" data-line-number="1">king</a></code></pre></div>
<pre><code>## # A tibble: 24 x 8
##       id context    i1    i2    i3    i4    i5    i6
##    &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1   101 control   150    44    71    59   132    74
##  2   102 control   335   270   156   160   118   230
##  3   103 control   149    52    91   115    43   154
##  4   104 control   159    31   127   212    71   224
##  5   105 control   292   125   184   246   225   170
##  6   106 control   297   187    66    96   209    74
##  7   107 control   170    37    42    66   114    81
##  8   108 control   159     0    35    75    71    34
##  9   109 same      346   175   177   192   239   140
## 10   110 same      426   329   236    76   102   232
## # ... with 14 more rows</code></pre>
<p>There are 24 rats (rows). The columns label the rat (<code>id</code>) and
the times at which motor activity was measured (<code>i1</code> through
<code>i6</code>). The remaining column, <code>context</code>, describes how
the rats were treated before experiment day, with the levels being the
same ones given in the question.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>We are going to do a repeated-measures analysis using the
“profile” method shown in class. Create a suitable response
variable for this method.</li>
</ol>
<p>Solution</p>
<p><code>cbind</code> the appropriate columns together, to make a matrix:</p>
<div class="sourceCode" id="cb3220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3220-1" data-line-number="1">response=<span class="kw">with</span>(king,<span class="kw">cbind</span>(i1,i2,i3,i4,i5,i6))</a></code></pre></div>
<p>This is the “simple” but tedious way, and produces a matrix because
the <code>i1</code> through <code>i6</code> are vectors (single columns):</p>
<div class="sourceCode" id="cb3221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3221-1" data-line-number="1"><span class="kw">class</span>(response)</a></code></pre></div>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
<p><code>i1:i6</code> does not work here, because we are outside of the
<code>tidyverse</code>, and in that world, <code>:</code> only means
“through” (as in “this through that”) when the things on either
side of it are or represent numbers.</p>
<p>The clever way to get the response is to <code>select</code> the columns
and then turn them into a matrix. This <em>does</em> permit the colon
because we are now in the <code>tidyverse</code>:</p>
<div class="sourceCode" id="cb3223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3223-1" data-line-number="1">response =<span class="st"> </span>king <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3223-2" data-line-number="2"><span class="kw">select</span>(i1<span class="op">:</span>i6) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3223-3" data-line-number="3"><span class="kw">as.matrix</span>() </a>
<a class="sourceLine" id="cb3223-4" data-line-number="4"><span class="kw">class</span>(response)  </a></code></pre></div>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
<p>It is indeed a matrix.</p>
<p>I tried to be extra-clever and use <code>starts_with</code>, but I have
another column <code>id</code> that starts with <code>i</code> that I do
<em>not</em> want to be part of the response. So I had to abandon that
idea, but not before trying this:</p>
<div class="sourceCode" id="cb3225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3225-1" data-line-number="1">response =<span class="st"> </span>king <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3225-2" data-line-number="2"><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;i[0-9]&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3225-3" data-line-number="3"><span class="kw">as.matrix</span>()</a>
<a class="sourceLine" id="cb3225-4" data-line-number="4"><span class="kw">head</span>(response)</a></code></pre></div>
<pre><code>##       i1  i2  i3  i4  i5  i6
## [1,] 150  44  71  59 132  74
## [2,] 335 270 156 160 118 230
## [3,] 149  52  91 115  43 154
## [4,] 159  31 127 212  71 224
## [5,] 292 125 184 246 225 170
## [6,] 297 187  66  96 209  74</code></pre>
<p><code>head</code> displays the first six lines (of anything). We don’t
normally need it because we are typically dealing with
<code>tibble</code>-like data frames that display only ten rows of
themselves by default. But this worked. The <code>matches</code> part
takes a so-called “regular expression” which is a very flexible way
of matching anything: in this case, a column whose name starts with
<code>i</code> followed by exactly one digit (something between 0 and 9
inclusive).</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Set up the “within-subjects” part of the analysis. That
means getting hold of the names of the columns that hold the
different times, saving them, and also making a data frame out of them:</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb3227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3227-1" data-line-number="1">times=<span class="kw">colnames</span>(response)</a>
<a class="sourceLine" id="cb3227-2" data-line-number="2">times.df=<span class="kw">data.frame</span>(times)</a></code></pre></div>
<ol start="5" style="list-style-type: lower-alpha">
<li>Fit the repeated-measures ANOVA. This will involve fitting
an <code>lm</code> first, if you have not already done so.</li>
</ol>
<p>Solution</p>
<p>Fit the <code>lm</code> first, and then pass that into <code>Manova</code>
from <code>car</code>:</p>
<div class="sourceCode" id="cb3228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3228-1" data-line-number="1">king<span class="fl">.1</span>=<span class="kw">lm</span>(response<span class="op">~</span>context,<span class="dt">data=</span>king)</a>
<a class="sourceLine" id="cb3228-2" data-line-number="2">king<span class="fl">.2</span>=<span class="kw">Manova</span>(king<span class="fl">.1</span>,<span class="dt">idata=</span>times.df,<span class="dt">idesign=</span><span class="op">~</span>times)</a>
<a class="sourceLine" id="cb3228-3" data-line-number="3">king<span class="fl">.2</span></a></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests: Pillai test statistic
##               Df test stat approx F num Df den Df    Pr(&gt;F)    
## (Intercept)    1   0.91326  221.107      1     21 1.273e-12 ***
## context        2   0.41017    7.302      2     21  0.003914 ** 
## times          1   0.85700   20.376      5     17 1.233e-06 ***
## context:times  2   0.80339    2.417     10     36  0.025628 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<ol start="6" style="list-style-type: lower-alpha">
<li>What do you conclude from your repeated-measures ANOVA?
Explain briefly, in the context of the data.</li>
</ol>
<p>Solution</p>
<p>The interaction term is significant, with a P-value less than
0.05. This is where we start and stop looking.
This means that the effect of time on motor activity (that is, the
way the motor activity depends on time) is different for each
<code>context</code>. That’s all we can say now.
Grading note: as long as the setup and MANOVA are done somewhere,
I don’t mind which part they are labelled with. But you need to do
the setup, initial <code>lm</code> and <code>Manova</code>
<em>somewhere</em> so that everything comes out right in the end.</p>
<ol start="7" style="list-style-type: lower-alpha">
<li>To understand the results of the previous part, we are going
to make a spaghetti plot. In preparation for that, we need to save
the data in “long format” with one observation on <em>one</em> time
point in each row. Arrange that, and show by displaying (some of)
the data that you have done so.</li>
</ol>
<p>Solution</p>
<p>This is <code>gather</code> yet again: gather up columns <code>i1</code>
through <code>i6</code> and call them something like <code>activity</code>:</p>
<div class="sourceCode" id="cb3230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3230-1" data-line-number="1">king.long =<span class="st"> </span>king <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(time,activity,i1<span class="op">:</span>i6)</a>
<a class="sourceLine" id="cb3230-2" data-line-number="2">king.long</a></code></pre></div>
<pre><code>## # A tibble: 144 x 4
##       id context time  activity
##    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
##  1   101 control i1         150
##  2   102 control i1         335
##  3   103 control i1         149
##  4   104 control i1         159
##  5   105 control i1         292
##  6   106 control i1         297
##  7   107 control i1         170
##  8   108 control i1         159
##  9   109 same    i1         346
## 10   110 same    i1         426
## # ... with 134 more rows</code></pre>
<p>Displaying the resulting data frame is a good way to display `<code>some of'' it. You can always look at more if you like. There are more rows and fewer columns than there were before, which is encouraging.</code>gather<code>works columnwise: it gathers up all the values in the first time column</code>i1<code>first, then</code>i2`,
and so on.</p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Make a spaghetti plot: that is, plot motor activity against
the time points, joining the points for each <em>rat</em> by lines,
and colouring the points and lines according to the <em>context</em>.</li>
</ol>
<p>Solution</p>
<p>That means this, using <code>group</code> to indicate which points to
join by lines, since it’s different from the <code>colour</code>:</p>
<div class="sourceCode" id="cb3232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3232-1" data-line-number="1"><span class="kw">ggplot</span>(king.long,<span class="kw">aes</span>(<span class="dt">x=</span>time,<span class="dt">y=</span>activity,<span class="dt">colour=</span>context,<span class="dt">group=</span>id))<span class="op">+</span></a>
<a class="sourceLine" id="cb3232-2" data-line-number="2"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-67-1.png" width="672"  /></p>
<p>I’d say the <code>geom_point</code> is optional, so that this is also
good, perhaps better even:</p>
<div class="sourceCode" id="cb3233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3233-1" data-line-number="1"><span class="kw">ggplot</span>(king.long,<span class="kw">aes</span>(<span class="dt">x=</span>time,<span class="dt">y=</span>activity,<span class="dt">colour=</span>context,<span class="dt">group=</span>id))<span class="op">+</span></a>
<a class="sourceLine" id="cb3233-2" data-line-number="2"><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-68-1.png" width="672"  /></p>
<ol style="list-style-type: lower-roman">
<li>Looking at your spaghetti plot, why do you think your
repeated-measures ANOVA came out as it did? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>What you’re after is an explanation of how the <em>patterns</em> over
time are different for the three <code>context</code>s. If you can find
something that says that, I’m good. For example, even though all of
the rats experienced a decrease in motor activity between times 1
and 2, the rats in the <code>same</code> group didn’t decrease as
much. Or, the rats in the <code>same</code> group continued to decrease
beyond time 2, whereas the rats in the <code>control</code> and
<code>different</code> groups tended to level off after time 2, not
decreasing so much after that.
If you like, you can draw an interaction plot by working out the
means for each <code>context</code>-<code>time</code> group first:</p>
<div class="sourceCode" id="cb3234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3234-1" data-line-number="1">king.long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(context,time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3234-2" data-line-number="2"><span class="kw">summarize</span>(<span class="dt">m=</span><span class="kw">mean</span>(activity)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3234-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>time,<span class="dt">y=</span>m,<span class="dt">colour=</span>context,<span class="dt">group=</span>context))<span class="op">+</span></a>
<a class="sourceLine" id="cb3234-4" data-line-number="4"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-69-1.png" width="672"  /></p>
<p>This seems to illustrate the same things as I found on the spaghetti
plot. It gains in clarity by only looking at means, but loses by not
considering the variability. Your call.</p>
<p>This kind of thing also runs with <code>lmer</code> from package
<code>lme4</code>. It uses the long data frame, thus, treating <code>id</code>
(identifying the rats) as a random effect:</p>
<div class="sourceCode" id="cb3235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3235-1" data-line-number="1">king<span class="fl">.3</span>=<span class="kw">lmer</span>(activity<span class="op">~</span>context<span class="op">*</span>time<span class="op">+</span>(<span class="dv">1</span><span class="op">|</span>id),<span class="dt">data=</span>king.long)</a></code></pre></div>
<p>What can we drop? The only thing under consideration is the interaction:</p>
<div class="sourceCode" id="cb3236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3236-1" data-line-number="1"><span class="kw">drop1</span>(king<span class="fl">.3</span>,<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## activity ~ context * time + (1 | id)
##              Df    AIC    LRT   Pr(Chi)    
## &lt;none&gt;          1609.0                     
## context:time 10 1622.7 33.764 0.0002025 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>and we get the same conclusion as before, but with a much smaller P-value.</p>
<p>With this kind of modelling, there is no distinction between
“within” and “between”, so that even though <code>time</code> is a
within-subjects factor and <code>context</code> is between subjects, if
the interaction had not been significant, we could have dropped it
from the model, and then we would have had an effect of <code>time</code>
and an effect of <code>context</code>, independent of each other. I was
actually looking for an example with a non-significant interaction,
but I couldn’t find one.</p>
</div>
<div id="repeated-measures-with-no-background" class="section level2">
<h2><span class="header-section-number">21.5</span> Repeated measures with no background</h2>
<p>Nine people are randomly chosen to receive one of three
treatments, labelled A, B and C. Each person has their response
<code>y</code> to the treatment measured at three times, labelled T1, T2
and T3. The main aim of the study is to properly assess the effects of
the treatments. A higher value of <code>y</code> is better.</p>
<p>The data are in <a href="http://www.utsc.utoronto.ca/~butler/d29/rm.txt">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>There are <span class="math inline">\(9 \times 3=27\)</span> observations of <code>y</code> in
this study. Why would it be wrong to treat these as 27 independent
observations? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>There are only 9 people with 3 observations on each person. The
three observations on the same person are likely to be correlated
with each other, and so treating them as independent would be a
mistake.
This is repeated-measures data. If you say that, that’s useful,
but you also need to demonstrate that you know what repeated
measures <em>means</em> and why it needs to be handled differently
from one-observation-per-individual data. Another way to look at
it is that individuals will differ from each other, and so there
ought to be an “individual” effect included in the model, in the
same way that you would include a block effect in a randomized
block design: not because you care about differences among
individuals, but because you are pretty sure they’ll be there and
you want to account for them.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Read in the data values. Are they tidy or untidy? Explain
briefly. (The data values are separated by <em>tabs</em>, like the
Australian athlete data.)</li>
</ol>
<p>Solution</p>
<p>We therefore need <code>read_tsv</code>. I’m not quite sure what to
call this one:</p>
<div class="sourceCode" id="cb3238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3238-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/d29/rm.txt&quot;</span></a>
<a class="sourceLine" id="cb3238-2" data-line-number="2">treatments=<span class="kw">read_tsv</span>(my_url)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   trt = col_character(),
##   time = col_character(),
##   subject = col_double(),
##   y = col_double()
## )</code></pre>
<div class="sourceCode" id="cb3240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3240-1" data-line-number="1">treatments</a></code></pre></div>
<pre><code>## # A tibble: 27 x 4
##    trt   time  subject     y
##    &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1 A     T1          1    10
##  2 A     T1          2    12
##  3 A     T1          3    13
##  4 A     T2          1    16
##  5 A     T2          2    19
##  6 A     T2          3    20
##  7 A     T3          1    25
##  8 A     T3          2    27
##  9 A     T3          3    28
## 10 B     T1          4    12
## # ... with 17 more rows</code></pre>
<p>Find a way to display what you have, so you can decide whether it is
tidy or not.
Each observation of <code>y</code> is in a row by itself, so this is
tidy, or long format. You might even call this extra-tidy, because
each person is spread over three rows, one for each time point.
Looking ahead, this is ideal for making a graph, or for doing the
advanced version of the analysis with <code>lme4</code>, but it is not
so good for our MANOVA way of doing a repeated measures
analysis. That we will have to prepare for.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Make a spaghetti plot: that is, a plot of <code>y</code>
against time, with the observations for the same individual joined
by lines which are coloured according to the treatment that
individual received.</li>
</ol>
<p>Solution</p>
<p>The individuals are labelled in <code>subject</code> and the
treatments are in <code>trt</code>, which means we need to do this:</p>
<div class="sourceCode" id="cb3242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3242-1" data-line-number="1"><span class="kw">ggplot</span>(treatments,<span class="kw">aes</span>(<span class="dt">x=</span>time,<span class="dt">y=</span>y,<span class="dt">colour=</span>trt,<span class="dt">group=</span>subject))<span class="op">+</span></a>
<a class="sourceLine" id="cb3242-2" data-line-number="2"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="20-repeated-measures_files/figure-html/unnamed-chunk-73-1.png" width="672"  /></p>
<p>I’m going to be all smug and tell you that I got this right first
time. (I’m telling you this because it doesn’t happen often.)</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>On your spaghetti plot, how do the values of <code>y</code> for
the treatments compare over time?</li>
</ol>
<p>Solution</p>
<p>The most obvious thing is that the values of <code>y</code> <em>all</em>
go up over time, regardless of which treatment they were from.
At the initial time T1, the treatments are all about the same, but
at the second and third time points, <code>y</code> is bigger for
treatment C than for the other two treatments (which are about the
same as each other). If you like, say that the gap between
treatment C and the others is increasing over time, or that the
lines for treatment C are steeper than for the other
treatments. Any of those ways of saying it comes to the same
conclusion.
Extra: if you look at the lines of the same colour (treatment),
they don’t seem to cross over very much. That suggests that an
individual who starts with a larger value of <code>y</code>
(relatively, compared to the other individuals on the same
treatment) tends to stay larger than the other individuals on the
same treatment all the way through. This would be another thing
you’d see if the measurements for the individuals are correlated,
or if there is an “individual effect” to go along with a
treatment effect (and a time effect).
If you think of this like an individual-level version of an
interaction plot (which would be obtained by plotting the
<em>means</em> for each treatment at each time), there is a
suggestion here of an interaction between treatment and time, as
well as a treatment effect (the latter because treatment C appears
better than the rest).</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Explain briefly how the data are in the wrong format for a
repeated-measures ANOVA (done using MANOVA, as in class), and use
<code>spread</code> to get the data set into the right format. (Hint:
there is an example of <code>spread</code> in assignment 2.)</li>
</ol>
<p>Solution</p>
<p>For MANOVA, we want the three responses (here, the values of
<code>y</code> at the three different times) in three separate
columns, with <em>all</em> the measurements for one subject in one
row (rather than on three separate rows, as here).
<code>spread</code> is the flip-side of <code>gather</code>: instead of
making different columns that all measure the same thing into one
column, we split one column that contains things that are slightly
different from each other (here, <code>y</code> at different
times). It needs two inputs: the current single column that
contains the column names you are going to make, and the values to
carry along with them, in that order:</p>
<div class="sourceCode" id="cb3243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3243-1" data-line-number="1">tr2 =<span class="st"> </span>treatments <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">spread</span>(time,y)</a>
<a class="sourceLine" id="cb3243-2" data-line-number="2">tr2</a></code></pre></div>
<pre><code>## # A tibble: 9 x 5
##   trt   subject    T1    T2    T3
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A           1    10    16    25
## 2 A           2    12    19    27
## 3 A           3    13    20    28
## 4 B           4    12    18    25
## 5 B           5    11    20    26
## 6 B           6    10    22    27
## 7 C           7    10    22    31
## 8 C           8    12    23    34
## 9 C           9    13    22    33</code></pre>
<p>(I got this right the first time too. I must be having a good day!)</p>
<p>Note that the <code>time</code> and <code>y</code> columns have
<em>disappeared</em>: the columns labelled with the time points are
where those values of <code>y</code> have gone. The nine subjects make up
the nine rows of the new “wide” data set, which is in the format we
want.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Run a repeated-measures ANOVA the <code>Manova</code> way. What do you
conclude from it?</li>
</ol>
<p>Solution</p>
<p>Create the response variable first, and use it in an <code>lm</code>:</p>
<div class="sourceCode" id="cb3245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3245-1" data-line-number="1">response=<span class="kw">with</span>(tr2,<span class="kw">cbind</span>(T1,T2,T3))</a>
<a class="sourceLine" id="cb3245-2" data-line-number="2">treatment<span class="fl">.1</span>=<span class="kw">lm</span>(response<span class="op">~</span>trt,<span class="dt">data=</span>tr2)</a></code></pre></div>
<p>Now we have to construct the within-subject stuff, for which we need
to get the different times we have. You can type them in again (fine
here), or get them from the <code>response</code> you just made:</p>
<div class="sourceCode" id="cb3246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3246-1" data-line-number="1">times=<span class="kw">colnames</span>(response)</a>
<a class="sourceLine" id="cb3246-2" data-line-number="2">times.df=<span class="kw">data.frame</span>(times)</a></code></pre></div>
<p>This is where the possible time effect is accounted for. Because time
is within-subjects (each subject is measured at several different
times) but treatment is between subjects (each subject only gets one
treatment), the two things have to be treated separately, in this
approach at least.</p>
<p>Then, uppercase-M <code>Manova</code>:</p>
<div class="sourceCode" id="cb3247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3247-1" data-line-number="1">treatment<span class="fl">.2</span>=<span class="kw">Manova</span>(treatment<span class="fl">.1</span>,<span class="dt">idata=</span>times.df,<span class="dt">idesign=</span><span class="op">~</span>times)</a>
<a class="sourceLine" id="cb3247-2" data-line-number="2">treatment<span class="fl">.2</span></a></code></pre></div>
<pre><code>## 
## Type II Repeated Measures MANOVA Tests: Pillai test statistic
##             Df test stat approx F num Df den Df    Pr(&gt;F)    
## (Intercept)  1   0.99751  2399.02      1      6 4.857e-09 ***
## trt          2   0.70412     7.14      2      6  0.025902 *  
## times        1   0.99876  2010.30      2      5 5.437e-08 ***
## trt:times    2   1.34513     6.16      4     12  0.006206 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>(Since I call things by the same names every time, my code for one of
these looks a lot like my code for any of the others.)</p>
<p>Finally, interpretation. We look <em>only</em> at the interaction. This
is significant, so the effect of treatment is different at the
different times. And we <strong>stop there</strong>.</p>
<p>Extra: <code>car</code> also includes a thing called <code>Anova</code> with a
capital A. That looks a bit different but gives us some extra information:</p>
<div class="sourceCode" id="cb3249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3249-1" data-line-number="1">treatment<span class="fl">.3</span>=<span class="kw">Anova</span>(treatment<span class="fl">.1</span>,<span class="dt">idata=</span>times.df,<span class="dt">idesign=</span><span class="op">~</span>times,<span class="dt">type=</span><span class="st">&quot;III&quot;</span>)</a></code></pre></div>
<p>The “type” on the end is a Roman numeral 3, for the type of test to
do. III is good:</p>
<div class="sourceCode" id="cb3250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3250-1" data-line-number="1"><span class="kw">summary</span>(treatment<span class="fl">.3</span>,<span class="dt">multivariate=</span>F)</a></code></pre></div>
<pre><code>## 
## Univariate Type III Repeated-Measures ANOVA Assuming Sphericity
## 
##             Sum Sq num Df Error SS den Df  F value    Pr(&gt;F)    
## (Intercept) 3211.1      1   27.111      6 710.6557 1.840e-07 ***
## trt           64.5      2   27.111      6   7.1393 0.0259021 *  
## times        338.9      2   12.889     12 157.7586 2.419e-09 ***
## trt:times     41.5      4   12.889     12   9.6552 0.0009899 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Mauchly Tests for Sphericity
## 
##           Test statistic  p-value
## times            0.29964 0.049149
## trt:times        0.29964 0.049149
## 
## 
## Greenhouse-Geisser and Huynh-Feldt Corrections
##  for Departure from Sphericity
## 
##            GG eps Pr(&gt;F[GG])    
## times     0.58811  3.285e-06 ***
## trt:times 0.58811   0.008332 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##              HF eps   Pr(&gt;F[HF])
## times     0.6461293 1.182316e-06
## trt:times 0.6461293 6.137921e-03</code></pre>
<p>What is all that about? Start in the middle, with Mauchly’s test, the
one with a P-value of 0.049. One of the assumptions of a
repeated-measures ANOVA is of a special kind of equal spreads: that
all comparisons of pairs of treatments have the same variance. This is
called sphericity. Sphericity is a hard thing to judge unless we have
a test to do it with, such as Mauchly’s test. This one is on the
borderline: do we reject sphericity or not? If you reject sphericity,
you can’t trust the results of the MANOVA. So let’s assume that we
<em>do</em> reject sphericity. What we do next is to look down the
bottom at the two “corrections for departure from sphericity”. One
is due to Greenhouse and Geisser, the other to Huynh and Feldt. I
don’t have any suggestions for choosing between them, so the thing to
do is to see whether they agree with each other. The two P-values for
testing the interaction are 0.008 and 0.006, which are a bit bigger
than before, but still definitely significant. So, whether we believe
sphericity or not, there is an interaction between treatment and
time. If this is your analysis, you make impressive-sounding
pronouncements like
“the significance of the interaction is robust to sphericity”.</p>
<ol start="7" style="list-style-type: lower-alpha">
<li>How is your conclusion from the previous part consistent
with your spaghetti plot? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>The thing that the interaction means is that the effect of
treatment is different over different times. That shows up in the
spaghetti plot by treatment C being the same as the others at the
beginning, but clearly better than the others at the later
times. That is to say, you can’t talk about “an” effect of
treatment, because whether or not treatment C is better than the
others depends on which time you’re looking at.</p>
<p>Extra: we used the MANOVA way of doing the repeated-measures
analysis. There is another way, “mixed models”, which is in some
ways less familiar and in some ways more.</p>
<p>In any analysis of variance, there are two kinds of effects of
things you may care about: fixed effects and random effects. Fixed
effects are things like the treatment and time here, where the
ones you look at are the only ones you are interested in (in this
study at least). If you had wanted to assess another treatment,
you would have designed it into the study; if you cared about
other times, you would have measured <code>y</code> at those times
too. The subjects, though, are different: they are a random sample
of all possible people, and you want your results to generalize to
the population of all people of whom your subjects are a
sample.
<label for="tufte-mn-206" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-206" class="margin-toggle"><span class="marginnote">In practice, things are usually fuzzier than this, because the subjects in your study are typically the ones you could get, rather than being a physical random sample of all possible people, but we usually act as if our subjects are a random sample of all possible subjects.</span>
So subjects are a different kind of thing and they have what are
called random effects. When each subject only gives one
measurement, as in all the things we’ve seen so
far,
<label for="tufte-mn-207" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-207" class="margin-toggle"><span class="marginnote">Including matched pairs, because what we do there is to take the difference between the two measurements for each person and throw away the actual measurements themselves, so that each subject still only gives us one measurement.</span> it
doesn’t matter how you treat (statistically) the subjects, but
when each subject gives <em>more</em> than one measurement, it does
matter. Which is why we have to do the <code>idesign</code> stuff in
the MANOVA, or what you will see below.</p>
<p>A model with both fixed and random effects is called a mixed model.</p>
<p>We’re going to make the assumption that the effect of being one
subject rather than another is to move the value of <code>y</code> up
or down by a fixed amount regardless of treatment or time, on
average (each subject is different, but <em>within</em> a subject
the random effect is the same size). That seems reasonable, given
the spaghetti plot, where some subjects seemed to give
consistently larger or smaller values of <code>y</code> than
others. This is a so-called “random-intercepts” model. In the
package <code>lme4</code>, there is a function <code>lmer</code> that
looks like <code>lm</code>, except for the way in which you specify
the random effects. It looks like this, noting that  that we read in from the file and made
the spaghetti plot out of:</p>
<div class="sourceCode" id="cb3252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3252-1" data-line-number="1">treatment<span class="fl">.4</span>=<span class="kw">lmer</span>(y<span class="op">~</span>trt<span class="op">*</span>time<span class="op">+</span>(<span class="dv">1</span><span class="op">|</span>subject),<span class="dt">data=</span>treatments)</a>
<a class="sourceLine" id="cb3252-2" data-line-number="2"><span class="kw">drop1</span>(treatment<span class="fl">.4</span>,<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## y ~ trt * time + (1 | subject)
##          Df    AIC   LRT   Pr(Chi)    
## &lt;none&gt;      102.53                    
## trt:time  4 120.44 25.91 3.299e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The way to read that model is ``<code>y</code> depends on the combination
of treatment and time and also on a random intercept for each
subject’’. This is the way in which the model captures the idea that
each subject is different.</p>
<p>You don’t get a test for the random effects; you are assuming that the
subjects will be different from each other and you want to adjust for
that.
<label for="tufte-mn-208" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-208" class="margin-toggle"><span class="marginnote">This is rather like the test for blocks in a randomized block design: you want to <em>allow</em> for differences among blocks, but you don’t especially care to test that there <em>are</em> any. In fact, blocks are a lot like subjects, in that they are typically things like different experimental plots in which plants are grown, or different days on which the experiment is conducted, and you want to generalize from the blocks you observed, which are certainly <em>not</em> all possible blocks, to the population of all possible blocks.</span>
All you get is tests for the fixed effects that are currently up for
grabs, in this case the interaction, which is strongly significant.</p>

</div>
</div>
<p style="text-align: center;">
<a href="multivariate-analysis-of-variance.html"><button class="btn btn-default">Previous</button></a>
<a href="discriminant-analysis.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
