<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Chapter 29 Analysis of covariance | Problems and Solutions in Applied Statistics" />
<meta property="og:type" content="book" />
<meta property="og:url" content="http://ritsokiguess.site/pasias" />

<meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
<meta name="github-repo" content="nxskok/pasias" />

<meta name="author" content="Ken Butler" />

<meta name="date" content="2021-04-26" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="/usr/share/javascript/mathjax/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics">

<title>Chapter 29 Analysis of covariance | Problems and Solutions in Applied Statistics</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#introduction">Introduction</a><ul>
<li><a href="index.html#packages-used-somewhere-in-this-book">Packages used somewhere in this book</a></li>
</ul></li>
<li><a href="getting-used-to-r-and-r-studio.html#getting-used-to-r-and-r-studio"><span class="toc-section-number">1</span> Getting used to R and R Studio</a></li>
<li><a href="reading-in-data.html#reading-in-data"><span class="toc-section-number">2</span> Reading in data</a></li>
<li><a href="drawing-graphs.html#drawing-graphs"><span class="toc-section-number">3</span> Drawing graphs</a></li>
<li><a href="data-exploration.html#data-exploration"><span class="toc-section-number">4</span> Data exploration</a></li>
<li class="has-sub"><a href="working-with-dataframes.html#working-with-dataframes"><span class="toc-section-number">5</span> Working with dataframes</a><ul>
<li><a href="working-with-dataframes.html#tidying-the-jays-data"><span class="toc-section-number">5.1</span> Tidying the Jays data</a></li>
<li><a href="working-with-dataframes.html#cars"><span class="toc-section-number">5.2</span> Cars</a></li>
<li><a href="working-with-dataframes.html#tidying-the-jays-data-1"><span class="toc-section-number">5.3</span> Tidying the Jays data</a></li>
<li><a href="working-with-dataframes.html#cars-1"><span class="toc-section-number">5.4</span> Cars</a></li>
</ul></li>
<li><a href="one-sample-inference.html#one-sample-inference"><span class="toc-section-number">6</span> One-sample inference</a></li>
<li><a href="two-sample-inference.html#two-sample-inference"><span class="toc-section-number">7</span> Two-sample inference</a></li>
<li><a href="power-and-sample-size.html#power-and-sample-size"><span class="toc-section-number">8</span> Power and sample size</a></li>
<li><a href="the-sign-test.html#the-sign-test"><span class="toc-section-number">9</span> The sign test</a></li>
<li><a href="mood-median-test.html#mood-median-test"><span class="toc-section-number">10</span> Mood median test</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#matched-pairs-t-and-sign-test"><span class="toc-section-number">11</span> Matched pairs t and sign test</a></li>
<li class="has-sub"><a href="normal-quantile-plots.html#normal-quantile-plots"><span class="toc-section-number">12</span> Normal quantile plots</a><ul>
<li><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers"><span class="toc-section-number">12.1</span> Lengths of heliconia flowers</a></li>
<li><a href="normal-quantile-plots.html#ferritin-and-normality"><span class="toc-section-number">12.2</span> Ferritin and normality</a></li>
<li><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers-1"><span class="toc-section-number">12.3</span> Lengths of heliconia flowers</a></li>
<li><a href="normal-quantile-plots.html#ferritin-and-normality-1"><span class="toc-section-number">12.4</span> Ferritin and normality</a></li>
</ul></li>
<li><a href="analysis-of-variance.html#analysis-of-variance"><span class="toc-section-number">13</span> Analysis of variance</a></li>
<li><a href="writing-reports.html#writing-reports"><span class="toc-section-number">14</span> Writing reports</a></li>
<li><a href="tidying-data.html#tidying-data"><span class="toc-section-number">15</span> Tidying data</a></li>
<li><a href="simple-regression.html#simple-regression"><span class="toc-section-number">16</span> Simple regression</a></li>
<li><a href="multiple-regression.html#multiple-regression"><span class="toc-section-number">17</span> Multiple regression</a></li>
<li class="has-sub"><a href="regression-with-categorical-variables.html#regression-with-categorical-variables"><span class="toc-section-number">18</span> Regression with categorical variables</a><ul>
<li><a href="regression-with-categorical-variables.html#crickets-revisited"><span class="toc-section-number">18.1</span> Crickets revisited</a></li>
<li><a href="regression-with-categorical-variables.html#pulse-rates-and-marching"><span class="toc-section-number">18.2</span> Pulse rates and marching</a></li>
<li><a href="regression-with-categorical-variables.html#crickets-revisited-1"><span class="toc-section-number">18.3</span> Crickets revisited</a></li>
<li><a href="regression-with-categorical-variables.html#pulse-rates-and-marching-1"><span class="toc-section-number">18.4</span> Pulse rates and marching</a></li>
</ul></li>
<li><a href="dates-and-times.html#dates-and-times"><span class="toc-section-number">19</span> Dates and times</a></li>
<li><a href="functions.html#functions"><span class="toc-section-number">20</span> Functions</a></li>
<li class="has-sub"><a href="vector-and-matrix-algebra.html#vector-and-matrix-algebra"><span class="toc-section-number">21</span> Vector and matrix algebra</a><ul>
<li><a href="vector-and-matrix-algebra.html#heights-and-foot-lengths-again"><span class="toc-section-number">21.1</span> Heights and foot lengths again</a></li>
<li><a href="vector-and-matrix-algebra.html#heights-and-foot-lengths-again-1"><span class="toc-section-number">21.2</span> Heights and foot lengths again</a></li>
</ul></li>
<li><a href="the-bootstrap.html#the-bootstrap"><span class="toc-section-number">22</span> The Bootstrap</a></li>
<li><a href="bayesian-statistics-with-stan.html#bayesian-statistics-with-stan"><span class="toc-section-number">23</span> Bayesian Statistics with Stan</a></li>
<li><a href="logistic-regression.html#logistic-regression"><span class="toc-section-number">24</span> Logistic regression</a></li>
<li><a href="logistic-regression-with-ordinal-response.html#logistic-regression-with-ordinal-response"><span class="toc-section-number">25</span> Logistic regression with ordinal response</a></li>
<li><a href="logistic-regression-with-nominal-response.html#logistic-regression-with-nominal-response"><span class="toc-section-number">26</span> Logistic regression with nominal response</a></li>
<li><a href="survival-analysis.html#survival-analysis"><span class="toc-section-number">27</span> Survival analysis</a></li>
<li><a href="analysis-of-variance-revisited.html#analysis-of-variance-revisited"><span class="toc-section-number">28</span> Analysis of variance revisited</a></li>
<li class="has-sub"><a href="analysis-of-covariance.html#analysis-of-covariance"><span class="toc-section-number">29</span> Analysis of covariance</a><ul>
<li><a href="analysis-of-covariance.html#productivity-and-research-and-development"><span class="toc-section-number">29.1</span> Productivity and research-and-development</a></li>
<li><a href="analysis-of-covariance.html#treating-leprosy"><span class="toc-section-number">29.2</span> Treating leprosy</a></li>
<li><a href="analysis-of-covariance.html#productivity-and-research-and-development-1"><span class="toc-section-number">29.3</span> Productivity and research-and-development</a></li>
<li><a href="analysis-of-covariance.html#treating-leprosy-1"><span class="toc-section-number">29.4</span> Treating leprosy</a></li>
</ul></li>
<li><a href="multivariate-analysis-of-variance.html#multivariate-analysis-of-variance"><span class="toc-section-number">30</span> Multivariate analysis of variance</a></li>
<li><a href="repeated-measures.html#repeated-measures"><span class="toc-section-number">31</span> Repeated measures</a></li>
<li><a href="discriminant-analysis.html#discriminant-analysis"><span class="toc-section-number">32</span> Discriminant analysis</a></li>
<li><a href="hierarchical-cluster-analysis.html#hierarchical-cluster-analysis"><span class="toc-section-number">33</span> Hierarchical cluster analysis</a></li>
<li><a href="k-means-cluster-analysis.html#k-means-cluster-analysis"><span class="toc-section-number">34</span> K-means cluster analysis</a></li>
<li><a href="drawing-maps-with-leaflet.html#drawing-maps-with-leaflet"><span class="toc-section-number">35</span> Drawing maps with Leaflet</a></li>
<li><a href="multidimensional-scaling.html#multidimensional-scaling"><span class="toc-section-number">36</span> Multidimensional Scaling</a></li>
<li class="has-sub"><a href="principal-components.html#principal-components"><span class="toc-section-number">37</span> Principal Components</a><ul>
<li><a href="principal-components.html#the-weather-somewhere"><span class="toc-section-number">37.1</span> The weather, somewhere</a></li>
<li><a href="principal-components.html#the-weather-somewhere-1"><span class="toc-section-number">37.2</span> The weather, somewhere</a></li>
</ul></li>
<li><a href="factor-analysis.html#factor-analysis"><span class="toc-section-number">38</span> Factor Analysis</a></li>
<li><a href="frequency-table-analysis.html#frequency-table-analysis"><span class="toc-section-number">39</span> Frequency table analysis</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="analysis-of-covariance" class="section level1">
<h1><span class="header-section-number">Chapter 29</span> Analysis of covariance</h1>
<p>Packages for this chapter:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" title="1"><span class="kw">library</span>(MASS)</a>
<a class="sourceLine" id="cb132-2" title="2"><span class="kw">library</span>(car)</a>
<a class="sourceLine" id="cb132-3" title="3"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<div id="productivity-and-research-and-development" class="section level2">
<h2><span class="header-section-number">29.1</span> Productivity and research-and-development</h2>
<p>An economist compiled data on productivity improvements for
a sample of companies that produce electronic equipment. The companies
were classified according to their expenditures on research and
development in the last three years (classified as low, moderate,
high). Productivity improvement is measured on a 0–100 scale, with
most values being between 0 and 10. The economist also thought that
last year’s productivity improvement would be relevant, and so
recorded this as well.</p>
<p>The data set can be found at
<a href="http://ritsokiguess.site/datafiles/productivity.txt">link</a>.</p>
<p>Feel free to use “R&amp;D” as an abbreviation for
“research and development” in your answers below.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read in and display at least some of the data.</p></li>
<li><p>Plot productivity improvement for this year against last
year, identifying the points by the level of
research-and-development expenditure. On your plot, add regression
lines for each expenditure group.</p></li>
<li><p><a name="part:graph-comment">*</a>
Look at your graph of the previous part. Do you think that (i)
knowing last year’s productivity improvement tells you something
about this year’s, (ii) the level of expenditure on
research-and-development has an impact on this year’s productivity
improvement, (iii) there is an interaction effect between R&amp;D
expenditure and last year’s productivity increase on this year’s
productivity increase? In each case, explain briefly.</p></li>
<li><p>Fit an analysis of covariance model without interaction. Run
the results through <code>drop1</code> with <code>test="F"</code> (the
<code>F</code> must be in quotes). What do you conclude?</p></li>
<li><p>Now look at the <code>summary</code> of your analysis of
covariance model. Explain briefly how each of the <em>last three</em>
numbers in the <code>Estimate</code> column are consistent with your graph.</p></li>
<li><p>Add an interaction between <code>last</code> and
<code>expenditure</code> to your analysis of covariance model. Test it
for significance using <code>drop1</code>. In the light of what you
have seen, does this surprise you? Explain briefly why you are or
are not surprised.</p></li>
</ol>
</div>
<div id="treating-leprosy" class="section level2">
<h2><span class="header-section-number">29.2</span> Treating leprosy</h2>
<p>Two drugs are being tested in the treatment of
leprosy. These are labelled A and D. There is also a control drug,
labelled F. The response variable is a post-treatment score of leprosy
bacilli (measured at six different sites on each patient). A lower
score is better.</p>
<p>Thus far, we have a standard one-way analysis of variance. But the
researchers wanted greater precision in assessing the effects (if any)
of the drugs, so they also measured a pre-treatment score of leprosy
bacilli. The data are in the file
<a href="http://ritsokiguess.site/datafiles/leprosy.txt">link</a>. The
pre-treatment and post-treatment scores are labelled <code>pre</code> and
<code>post</code> respectively.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read in the data and check that you have apparently the
right thing.</p></li>
<li><p><a name="part:lepro-scatter">*</a> Make a scatterplot of post-treatment score against
pre-treatment score, with the points for each drug drawn in a
different colour.</p></li>
<li><p>Does it appear that including the pre-treatment score was a
good idea? Explain briefly.</p></li>
<li><p>What about this dataset suggests that analysis of
covariance is a method worth trying?</p></li>
<li><p>Fit an analysis of covariance model to predict
post-treatment score. Include an interaction between your
explanatory variables. (You don’t need to look at the output from
the model.)</p></li>
<li><p>Pass your fitted model of the last part into
<code>drop1</code>. Is
the interaction term significant?</p></li>
<li><p>Fit a model without the interaction. Is this a sensible thing to
do (in addition, that is, to the fact that I just asked you to do it)?</p></li>
<li><p>Take a look at the <code>summary</code> of your preferred
model. Is there a significant effect of pre-treatment score?
Describe the effects of the different drugs on the post-treatment
score. (Don’t do any tests for <code>drug</code>.) Does your comparison
of drugs make sense?</p></li>
<li><p>Obtain predicted values for <code>post</code> for each of the
three drugs at <code>pre</code> scores 5, 12 and 20. To do this, obtain
a new data frame that has all 9 combinations of drugs and
<code>pre</code> scores, and then feed this into <code>predict</code> using
your preferred model.<label for="tufte-sn-19" class="margin-toggle sidenote-number">19</label><input type="checkbox" id="tufte-sn-19" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">19</span> Analysis of covariance is just a linear model, so <em>predict</em> works the same here as in regression.</span></p></li>
<li><p>Now, plot the data with the fitted lines on. You’ll need to do
the trick of using the original data frame (and plot the points),
and the data frame of predictions (and join those points with lines).</p></li>
<li><p>Are the lines on your plot parallel, with the same slopes? Is this what you would
expect? Explain briefly.</p></li>
</ol>
<p>My solutions follow:</p>
</div>
<div id="productivity-and-research-and-development-1" class="section level2">
<h2><span class="header-section-number">29.3</span> Productivity and research-and-development</h2>
<p>An economist compiled data on productivity improvements for
a sample of companies that produce electronic equipment. The companies
were classified according to their expenditures on research and
development in the last three years (classified as low, moderate,
high). Productivity improvement is measured on a 0–100 scale, with
most values being between 0 and 10. The economist also thought that
last year’s productivity improvement would be relevant, and so
recorded this as well.</p>
<p>The data set can be found at
<a href="http://ritsokiguess.site/datafiles/productivity.txt">link</a>.</p>
<p>Feel free to use “R&amp;D” as an abbreviation for
“research and development” in your answers below.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in and display at least some of the data.</li>
</ol>
<p>Solution</p>
<p>The data values are separated by one space, so let’s use
<code>read_delim</code> and display whatever displays (probably the
first ten lines):</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" title="1">my_url &lt;-<span class="st"> &quot;http://ritsokiguess.site/datafiles/productivity.txt&quot;</span></a>
<a class="sourceLine" id="cb133-2" title="2">productivity &lt;-<span class="st"> </span><span class="kw">read_delim</span>(my_url, <span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## 
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
## cols(
##   expenditure = col_character(),
##   improvement = col_double(),
##   last = col_double()
## )</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" title="1">productivity</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["expenditure"],"name":[1],"type":["chr"],"align":["left"]},{"label":["improvement"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["last"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"low","2":"7.6","3":"8.2"},{"1":"low","2":"8.2","3":"7.9"},{"1":"low","2":"6.8","3":"7.0"},{"1":"low","2":"5.8","3":"5.7"},{"1":"low","2":"6.9","3":"7.2"},{"1":"low","2":"6.6","3":"7.0"},{"1":"low","2":"6.3","3":"6.5"},{"1":"low","2":"7.7","3":"7.9"},{"1":"low","2":"6.0","3":"6.3"},{"1":"moderate","2":"6.7","3":"8.8"},{"1":"moderate","2":"8.1","3":"10.0"},{"1":"moderate","2":"9.4","3":"10.7"},{"1":"moderate","2":"8.6","3":"10.0"},{"1":"moderate","2":"7.8","3":"9.7"},{"1":"moderate","2":"7.7","3":"9.4"},{"1":"moderate","2":"8.9","3":"10.6"},{"1":"moderate","2":"7.9","3":"9.8"},{"1":"moderate","2":"8.3","3":"10.0"},{"1":"moderate","2":"8.7","3":"10.3"},{"1":"moderate","2":"7.1","3":"8.9"},{"1":"moderate","2":"8.4","3":"10.0"},{"1":"high","2":"8.5","3":"11.5"},{"1":"high","2":"9.7","3":"12.2"},{"1":"high","2":"10.1","3":"12.8"},{"1":"high","2":"7.8","3":"11.0"},{"1":"high","2":"9.6","3":"12.3"},{"1":"high","2":"9.5","3":"12.1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>There is a column classifying expenditure along with numerical values
for productivity improvement for this year and last year (labelled
<code>improvement</code> and <code>last</code>), so it looks as if we are
good.</p>
<p>You are free to give the data frame a shorter name to make it easier
to keep typing it!</p>
<p>Extra: those expenditure levels (that are currently text) will get
sorted into alphabetical order unless we stop them. They are actually
in the right order in the data file, so maybe we should turn them into
a factor (with the levels in the right order) now:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1">productivity <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">expenditure =</span> <span class="kw">fct_inorder</span>(expenditure)) -&gt;<span class="st"> </span>productivity</a></code></pre></div>
<p>If you don’t do this, your answers below will be different from
mine. Probably not in any kind of consequential way, but different
nonetheless.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Plot productivity improvement for this year against last
year, identifying the points by the level of
research-and-development expenditure. On your plot, add regression
lines for each expenditure group.</li>
</ol>
<p>Solution</p>
<p>Two quantitative and one categorical variable, so plot the
categorical variable using colour (or <code>shape</code> etc., if you
know about that, but colour is the most obvious thing):</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" title="1"><span class="kw">ggplot</span>(productivity, <span class="kw">aes</span>(<span class="dt">x =</span> last, <span class="dt">y =</span> improvement, <span class="dt">colour =</span> expenditure)) <span class="op">+</span></a>
<a class="sourceLine" id="cb137-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> F)</a></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="pasias_files/figure-html/unnamed-chunk-103-1.png" width="672"  /></p>
<p>The <code>se=F</code> is optional; no problem if you don’t include it. (If
you miss it out, you’ll get those CI-of-mean-response grey envelopes
around each line.)</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li><a name="part:graph-comment">*</a>
Look at your graph of the previous part. Do you think that (i)
knowing last year’s productivity improvement tells you something
about this year’s, (ii) the level of expenditure on
research-and-development has an impact on this year’s productivity
improvement, (iii) there is an interaction effect between R&amp;D
expenditure and last year’s productivity increase on this year’s
productivity increase? In each case, explain briefly.</li>
</ol>
<p>Solution</p>
<p>Taking the three things in turn:
(i) knowing about last year’s productivity increase definitely
helps, because the three trends definitely go up (extra: and are
pretty much linear).
(ii) knowing about the level of expenditure helps because the
coloured trends are in different places (low on the
left and high on the right, whatever colours they are for you).
(iii) I am guessing there is no interaction because the three
lines look more or less parallel (a judgement call: if you think
that there <em>will</em> be an interaction because you think the
lines are definitely not “approximately parallel” and therefore
there is an interaction, that’s OK too).</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Fit an analysis of covariance model without interaction. Run
the results through <code>drop1</code> with <code>test="F"</code> (the
<code>F</code> must be in quotes). What do you conclude?</li>
</ol>
<p>Solution</p>
<p>This looks exactly like a regression with a categorical variable,
and is. Just the two main effects, thus:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" title="1">improvement<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(improvement <span class="op">~</span><span class="st"> </span>last <span class="op">+</span><span class="st"> </span>expenditure, <span class="dt">data =</span> productivity)</a>
<a class="sourceLine" id="cb139-2" title="2"><span class="kw">drop1</span>(improvement<span class="fl">.1</span>, <span class="dt">test =</span> <span class="st">&quot;F&quot;</span>)</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Sum of Sq"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["RSS"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["F value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Pr(>F)"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"NA","3":"1.317535","4":"-73.542006","5":"NA","6":"NA","_rn_":"<none>"},{"1":"1","2":"14.044687","3":"15.362222","4":"-9.225988","5":"245.17589","6":"9.273750e-14","_rn_":"last"},{"1":"2","2":"4.195826","3":"5.513361","4":"-38.893885","5":"36.62294","6":"7.095379e-08","_rn_":"expenditure"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Both the P-values are small, so there is strong evidence of an effect
on this year’s productivity increase of last year’s productivity
increase and the level of R&amp;D expenditure.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Now look at the <code>summary</code> of your analysis of
covariance model. Explain briefly how each of the <em>last three</em>
numbers in the <code>Estimate</code> column are consistent with your graph.</li>
</ol>
<p>Solution</p>
<p>To begin:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1"><span class="kw">summary</span>(improvement<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = improvement ~ last + expenditure, data = productivity)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.52812 -0.16385 -0.00046  0.08379  0.45730 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         -1.00804    0.50991  -1.977   0.0602 .  
## last                 1.11417    0.07116  15.658 9.27e-14 ***
## expendituremoderate -1.83316    0.22372  -8.194 2.84e-08 ***
## expenditurehigh     -3.14338    0.37115  -8.469 1.59e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2393 on 23 degrees of freedom
## Multiple R-squared:  0.9629, Adjusted R-squared:  0.958 
## F-statistic: 198.8 on 3 and 23 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The last three numbers in the Estimate column are slopes for the
quantitative variable <code>last</code> and changes in intercept for the
levels of the categorical variable <code>expenditure</code>. Specifically:</p>
<ul>
<li><p>the slope for <code>last</code> is positive, so if last year’s
productivity increase is higher, this year’s will be higher as well.
This matches
the upward trends within each <code>expenditure</code> group on the
graph.</p></li>
<li><p><code>expenditure</code> is categorical, so everything is measured
relative to the baseline. Mine is <code>low</code>, but yours is probably <code>high</code>.</p></li>
<li><p>My two estimates for <code>expenditure</code> <code>high</code> and
<code>moderate</code> are both negative, so when expenditure on R&amp;D is
high or moderate, the productivity increase will be lower this year
(for the same productivity increase last year). Going back to the
graph, if you extend the lines for <code>moderate</code> and <code>high</code> to
a middling <code>last</code> value of something like 10, the
productivity increase this year will be higher when
<code>expenditure</code> is low or moderate then when it is high, which
is consistent with those slopes both being positive. (You don’t need
to go to this detail, but you should say something convincing from
the graph about how this year’s productivity increase is
<em>higher</em> if R&amp;D expenditure is low or moderate compared to
high.)</p></li>
</ul>
<p>Extra: the graph also indicates that the higher the
<code>expenditure</code> on R&amp;D is, the more likely last year’s
productivity improvement will be higher also. So in practice we are
not likely to be comparing actual companies with different
<code>expenditure</code> but the same <code>last</code>. Nonetheless, what I
said is what those positive coefficients for <code>expenditure</code>
actually mean. Be careful not to say that <code>low</code> is lowest
because it’s on the left; it’s whether it’s higher or lower than the
others <em>at the same value of <code>last</code></em> that matters.</p>
<p>Extra extra: I asked you to do the test from <code>drop1</code> because
there are three levels of <code>expenditure</code> (rather than just two),
and the <code>summary</code> output only gives you a comparison with the
baseline level, rather than comparing all three
levels. I prefer to do the right test (using <code>drop1</code>) first,
and then use <code>summary</code> to interpret what I have, or at least
the parts of it that are significant.</p>
<p>Extra extra extra: you would (or at least I would) expect a larger
productivity increase to go with a <em>larger</em> expenditure on R&amp;D,
but that’s not how it worked out. This is one of those cases where all
else isn’t really equal.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Add an interaction between <code>last</code> and
<code>expenditure</code> to your analysis of covariance model. Test it
for significance using <code>drop1</code>. In the light of what you
have seen, does this surprise you? Explain briefly why you are or
are not surprised.</li>
</ol>
<p>Solution</p>
<p>I like <code>update</code> for this (writing out the whole model is an
alternative):</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1">improvement<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">update</span>(improvement<span class="fl">.1</span>, . <span class="op">~</span><span class="st"> </span>. <span class="op">+</span><span class="st"> </span>last<span class="op">:</span>expenditure)</a>
<a class="sourceLine" id="cb142-2" title="2"><span class="kw">drop1</span>(improvement<span class="fl">.2</span>, <span class="dt">test =</span> <span class="st">&quot;F&quot;</span>)</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Sum of Sq"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["RSS"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["F value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Pr(>F)"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"NA","3":"0.9571826","4":"-78.16915","5":"NA","6":"NA","_rn_":"<none>"},{"1":"2","2":"0.3603524","3":"1.3175350","4":"-73.54201","5":"3.952956","6":"0.03490941","_rn_":"last:expenditure"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Yes, I too forgot the <code>test="F"</code> the first time.</p>
<p>The interaction term is actually significant, at least at
<span class="math inline">\(\alpha=0.05\)</span>. This is a surprise to me, because I thought those lines
on the graph were pretty close to parallel, so I wasn’t expecting to
see a significant interaction. (What I want from you here is to look
back at your answer to (iii) in part (<a href="#part:graph-comment">here</a>), and
to say how this small P-value is consistent or inconsistent with
whatever you said there. If you said that the lines weren’t parallel
enough, then this significant interaction should <em>not</em> be a
surprise to you.)</p>
<p>That’s all I’m after. I don’t need you to speculate on <em>why</em> the
test came out significant. I will, in a moment, but you don’t need to.</p>
<p>Extra: I didn’t expect the interaction to come out significant, but
the P-value is not nearly so small as the ones we had before. I guess
the explanation for this is that the data cluster pretty tightly about
the lines in the graph, so that even a small difference in slopes can
be signficant. You might argue that my red line is not <em>quite</em>
as steep as the others, but the difference does look very small.</p>
<p>Let’s take a look at the <code>summary</code> for my interaction model:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" title="1"><span class="kw">summary</span>(improvement<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = improvement ~ last + expenditure + last:expenditure, 
##     data = productivity)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.32417 -0.14885 -0.02465  0.13739  0.55556 
## 
## Coefficients:
##                          Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)               0.27827    0.64967   0.428  0.67278    
## last                      0.93243    0.09124  10.220 1.32e-09 ***
## expendituremoderate      -4.50268    1.25959  -3.575  0.00179 ** 
## expenditurehigh          -7.14795    1.91223  -3.738  0.00121 ** 
## last:expendituremoderate  0.32217    0.14243   2.262  0.03444 *  
## last:expenditurehigh      0.40858    0.17549   2.328  0.02997 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2135 on 21 degrees of freedom
## Multiple R-squared:  0.973,  Adjusted R-squared:  0.9666 
## F-statistic: 151.5 on 5 and 21 DF,  p-value: 9.763e-16</code></pre>
<p>The last two Estimates, the ones beginning with <code>last:</code>, came
from the interaction. Once again <code>low</code> is my baseline. These
say how the <em>slopes</em> for <code>last</code> for the other groups
differ from the slopes for <code>last</code> for <code>low</code>
expenditure. (Yes, this is confusing. Read it again until you get it.)</p>
<p>The biggest-size difference in slopes, about <span class="math inline">\(0.40\)</span>, is between low
expenditure and high expenditure. This says that the line for high
expenditure is this much more steep than the line for low
expenditure. That’s where the non-parallelism is on the graph, such as
it is. A small but significant difference in slopes. You can tell that
the effect is small by looking in the Estimate column; those changes
in slopes, <span class="math inline">\(0.40\)</span> and <span class="math inline">\(0.32\)</span>, are the smallest things in size out of
everything in that column.</p>
<p>Having seen this, you now realize that I did this question wrong (or,
at least, I led you through it wrong). The right way to do this would
have been to fit the interaction model <em>first</em>, see that it is
significant, and then done some predictions to assess the effects of
things:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" title="1">lasts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">11</span>)</a>
<a class="sourceLine" id="cb145-2" title="2">expenditures &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;low&quot;</span>, <span class="st">&quot;moderate&quot;</span>, <span class="st">&quot;high&quot;</span>)</a>
<a class="sourceLine" id="cb145-3" title="3">new &lt;-<span class="st"> </span><span class="kw">crossing</span>(<span class="dt">last =</span> lasts, <span class="dt">expenditure =</span> expenditures)</a>
<a class="sourceLine" id="cb145-4" title="4">new</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["last"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["expenditure"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"7","2":"high"},{"1":"7","2":"low"},{"1":"7","2":"moderate"},{"1":"9","2":"high"},{"1":"9","2":"low"},{"1":"9","2":"moderate"},{"1":"11","2":"high"},{"1":"11","2":"low"},{"1":"11","2":"moderate"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>(oh, how I wish I’d given those variables shorter names),<label for="tufte-sn-20" class="margin-toggle sidenote-number">20</label><input type="checkbox" id="tufte-sn-20" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">20</span> The expenditure levels have come out in alphabetical order again.</span> and then:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" title="1">p &lt;-<span class="st"> </span><span class="kw">predict</span>(improvement<span class="fl">.2</span>, new)</a>
<a class="sourceLine" id="cb146-2" title="2"><span class="kw">cbind</span>(new, p)</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["last"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["expenditure"],"name":[2],"type":["chr"],"align":["left"]},{"label":["p"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"7","2":"high","3":"2.517338","_rn_":"1"},{"1":"7","2":"low","3":"6.805256","_rn_":"2"},{"1":"7","2":"moderate","3":"4.557743","_rn_":"3"},{"1":"9","2":"high","3":"5.199343","_rn_":"4"},{"1":"9","2":"low","3":"8.670110","_rn_":"5"},{"1":"9","2":"moderate","3":"7.066929","_rn_":"6"},{"1":"11","2":"high","3":"7.881348","_rn_":"7"},{"1":"11","2":"low","3":"10.534963","_rn_":"8"},{"1":"11","2":"moderate","3":"9.576115","_rn_":"9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The effect is more or less as we described it before: as <code>last</code>
goes up (for fixed <code>expenditure</code>), the predicted productivity
improvements for this year go up, and as <code>expenditure</code> level
goes up, the predictions go <em>down</em>. But the rates at which they
go up or down are different, which is the significant interaction
coming into play. Having said that, they are not very different, so I
cheated and pretended the interaction was not significant (or that I
was using <span class="math inline">\(\alpha=0.01\)</span>), so that you would have something easier to
interpret. Qualitatively, the story is the same either way, because
the sizes of the interaction terms are small compared to the
others. So, even though I cheated, you ended up with more or less the
same conclusions doing it the way I asked you to do it, or doing it
the way I just did it.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="treating-leprosy-1" class="section level2">
<h2><span class="header-section-number">29.4</span> Treating leprosy</h2>
<p>Two drugs are being tested in the treatment of
leprosy. These are labelled A and D. There is also a control drug,
labelled F. The response variable is a post-treatment score of leprosy
bacilli (measured at six different sites on each patient). A lower
score is better.</p>
<p>Thus far, we have a standard one-way analysis of variance. But the
researchers wanted greater precision in assessing the effects (if any)
of the drugs, so they also measured a pre-treatment score of leprosy
bacilli. The data are in the file
<a href="http://ritsokiguess.site/datafiles/leprosy.txt">link</a>. The
pre-treatment and post-treatment scores are labelled <code>pre</code> and
<code>post</code> respectively.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data and check that you have apparently the
right thing.</li>
</ol>
<p>Solution</p>
<p>Take a look at the data file. The values have multiple spaces
between them, but they are aligned with each other and the
column headings, so <code>read_table</code> is the thing:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" title="1">my_url &lt;-<span class="st"> &quot;http://ritsokiguess.site/datafiles/leprosy.txt&quot;</span></a>
<a class="sourceLine" id="cb147-2" title="2">lepro &lt;-<span class="st"> </span><span class="kw">read_table</span>(my_url)</a></code></pre></div>
<pre><code>## 
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
## cols(
##   drug = col_character(),
##   pre = col_double(),
##   post = col_double()
## )</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" title="1">lepro</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["drug"],"name":[1],"type":["chr"],"align":["left"]},{"label":["pre"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["post"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"A","2":"11","3":"6"},{"1":"A","2":"6","3":"4"},{"1":"D","2":"6","3":"0"},{"1":"D","2":"8","3":"4"},{"1":"F","2":"16","3":"13"},{"1":"F","2":"16","3":"12"},{"1":"A","2":"8","3":"0"},{"1":"A","2":"10","3":"13"},{"1":"D","2":"6","3":"2"},{"1":"D","2":"19","3":"14"},{"1":"F","2":"13","3":"10"},{"1":"F","2":"12","3":"5"},{"1":"A","2":"5","3":"2"},{"1":"A","2":"6","3":"1"},{"1":"D","2":"7","3":"3"},{"1":"D","2":"8","3":"9"},{"1":"F","2":"11","3":"18"},{"1":"F","2":"12","3":"16"},{"1":"A","2":"14","3":"8"},{"1":"A","2":"11","3":"8"},{"1":"D","2":"8","3":"1"},{"1":"D","2":"5","3":"1"},{"1":"F","2":"9","3":"5"},{"1":"F","2":"7","3":"1"},{"1":"A","2":"19","3":"11"},{"1":"A","2":"3","3":"0"},{"1":"D","2":"18","3":"18"},{"1":"D","2":"15","3":"9"},{"1":"F","2":"21","3":"23"},{"1":"F","2":"12","3":"20"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Call it what you like.</p>
<p>That looks good, with variables of the right names.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li><a name="part:lepro-scatter">*</a> Make a scatterplot of post-treatment score against
pre-treatment score, with the points for each drug drawn in a
different colour.</li>
</ol>
<p>Solution</p>
<p>This is the kind of thing that <code>ggplot</code> does without
batting an eyelid:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" title="1"><span class="kw">ggplot</span>(lepro, <span class="kw">aes</span>(<span class="dt">x =</span> pre, <span class="dt">y =</span> post, <span class="dt">colour =</span> drug)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-112-1.png" width="672"  /></p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Does it appear that including the pre-treatment score was a
good idea? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>The overall trend on the scatterplot is that a higher <code>pre</code>
tends to go with a higher <code>post</code>, regardless of drug, so
including this information appears to be informative.
I personally suspect that there’s some fan-out happening on the
pre-post relationship, but I’m not planning to make you explore that.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>What about this dataset suggests that analysis of
covariance is a method worth trying?</li>
</ol>
<p>Solution</p>
<p>The key is a mixture of categorical and quantitative explanatory
variables. Here we have a categorical variable <code>drug</code> and a
quantitative one <code>pre</code>.
If we had only one type of explanatory variable, we could do a
regression or an ANOVA as appropriate. But we don’t. In some ways,
it’s not worth making a fuss about the distinction, because
regressions and ANOVAs are all linear models anyway. But you may
see the term “analysis of covariance”, so it’s worth your while
to know what it’s about.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Fit an analysis of covariance model to predict
post-treatment score. Include an interaction between your
explanatory variables. (You don’t need to look at the output from
the model.)</li>
</ol>
<p>Solution</p>
<p>This is what you’d guess. <code>lm</code> handles the interaction
properly, even though <code>pre</code> is a quantitative variable.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" title="1">lepro<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(post <span class="op">~</span><span class="st"> </span>pre <span class="op">*</span><span class="st"> </span>drug, <span class="dt">data =</span> lepro)</a></code></pre></div>
<p>I wanted to take a look, so I did:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" title="1"><span class="kw">summary</span>(lepro<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = post ~ pre * drug, data = lepro)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -6.225 -2.437 -0.586  1.126  8.775 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)  -1.6306     2.9455  -0.554   0.5850  
## pre           0.7452     0.2849   2.616   0.0152 *
## drugD        -2.9549     4.1246  -0.716   0.4806  
## drugF        -1.4780     5.4678  -0.270   0.7892  
## pre:drugD     0.3233     0.3846   0.841   0.4089  
## pre:drugF     0.4492     0.4458   1.008   0.3236  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.07 on 24 degrees of freedom
## Multiple R-squared:  0.6915, Adjusted R-squared:  0.6272 
## F-statistic: 10.76 on 5 and 24 DF,  p-value: 1.63e-05</code></pre>
<p>For testing the interaction, there are <em>two</em> slope coefficients
that should be zero if there is no interaction. So we have to test
this with <code>drop1</code>, which is next.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Pass your fitted model of the last part into
<code>drop1</code>. Is
the interaction term significant?</li>
</ol>
<p>Solution</p>
<p>Just this:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" title="1"><span class="kw">drop1</span>(lepro<span class="fl">.1</span>, <span class="dt">test =</span> <span class="st">&quot;F&quot;</span>)</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Sum of Sq"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["RSS"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["F value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Pr(>F)"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"NA","3":"397.5580","4":"89.52430","5":"NA","6":"NA","_rn_":"<none>"},{"1":"2","2":"19.64465","3":"417.2026","4":"86.97124","5":"0.5929594","6":"0.5605848","_rn_":"pre:drug"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>There is only a test for the interaction term because you can’t take out the main effects until you’ve taken out the interaction.</p>
<p>The P-value for the interaction is very large (0.5606) so it is
nowhere near significant. We can drop the interaction.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Fit a model without the interaction. Is this a sensible thing to
do (in addition, that is, to the fact that I just asked you to do it)?</li>
</ol>
<p>Solution</p>
<p>Change the <code>*</code> to a <code>+</code>:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" title="1">lepro<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(post <span class="op">~</span><span class="st"> </span>pre <span class="op">+</span><span class="st"> </span>drug, <span class="dt">data =</span> lepro)</a></code></pre></div>
<p>Or use <code>update</code> (not much in it, here):</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" title="1">lepro<span class="fl">.2</span>a &lt;-<span class="st"> </span><span class="kw">update</span>(lepro<span class="fl">.1</span>, . <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>pre<span class="op">:</span>drug)</a></code></pre></div>
<p>We just said that the interaction could come out, since it wasn’t
significant, so this is exactly the model that we should be fitting.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Take a look at the <code>summary</code> of your preferred
model. Is there a significant effect of pre-treatment score?
Describe the effects of the different drugs on the post-treatment
score. (Don’t do any tests for <code>drug</code>.) Does your comparison
of drugs make sense?</li>
</ol>
<p>Solution</p>
<p>Mine was the no-interaction model <code>lepro.2</code>:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" title="1"><span class="kw">summary</span>(lepro<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = post ~ pre + drug, data = lepro)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -6.4115 -2.3891 -0.5711  1.7237  8.5885 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -3.8808     1.9862  -1.954   0.0616 .  
## pre           0.9872     0.1645   6.001 2.45e-06 ***
## drugD         0.1090     1.7951   0.061   0.9521    
## drugF         3.4461     1.8868   1.826   0.0793 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.006 on 26 degrees of freedom
## Multiple R-squared:  0.6763, Adjusted R-squared:  0.6389 
## F-statistic:  18.1 on 3 and 26 DF,  p-value: 1.501e-06</code></pre>
<p>The pre-treatment term is definitely significant, with a P-value of
0.0000025. So pre-treatment score definitely has an impact on
post-treatment score.</p>
<p>I didn’t ask you to test for significance of drugs. I just wanted you
to assess their coefficients. Drug A is being used as the baseline, so
its coefficient is zero. Drug D has a slightly positive coefficient
(0.109) so its average bacilli score is slightly higher (for any
pre-treatment score) than for drug A. Drug F, which was the placebo,
has a slope of 3.446, so its average bacilli score is a fair bit
higher than for either of the other drugs. This makes sense because a
higher score is worse, and the two “real” drugs are both better than
the fake one.</p>
<p>Whether there is a real drug difference, I didn’t ask you to assess,
but you could do it by <code>drop1</code> again, this way:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" title="1"><span class="kw">drop1</span>(lepro<span class="fl">.2</span>, <span class="dt">test =</span> <span class="st">&quot;F&quot;</span>)</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Sum of Sq"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["RSS"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["F value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Pr(>F)"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"NA","3":"417.2026","4":"86.97124","5":"NA","6":"NA","_rn_":"<none>"},{"1":"1","2":"577.89740","3":"995.1000","4":"111.04938","5":"36.014475","6":"2.454330e-06","_rn_":"pre"},{"1":"2","2":"68.55371","3":"485.7563","4":"87.53529","5":"2.136128","6":"1.383793e-01","_rn_":"drug"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This is actually not significant.<label for="tufte-sn-21" class="margin-toggle sidenote-number">21</label><input type="checkbox" id="tufte-sn-21" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">21</span> This is why I didn’t ask you to test this, since it would have confused the story.</span>
This is one of those cases where the non-significant <code>drug</code> has
a slightly <em>bigger</em> AIC than <code>&lt;none&gt;</code>, so <code>drop1</code>
considers it best to leave it in the model.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol style="list-style-type: lower-roman">
<li>Obtain predicted values for <code>post</code> for each of the
three drugs at <code>pre</code> scores 5, 12 and 20. To do this, obtain
a new data frame that has all 9 combinations of drugs and
<code>pre</code> scores, and then feed this into <code>predict</code> using
your preferred model.<label for="tufte-sn-22" class="margin-toggle sidenote-number">22</label><input type="checkbox" id="tufte-sn-22" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">22</span> Analysis of covariance is just a linear model, so <em>predict</em> works the same here as in regression.</span></li>
</ol>
<p>Solution</p>
<p>First, make the new data frame for predicting from, using
<code>crossing</code>. I’m doing this in small steps for clarity:
first, I define all the drugs and <code>pre</code> values, and then I
feed them into <code>crossing</code>:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" title="1">drugs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;F&quot;</span>)</a>
<a class="sourceLine" id="cb160-2" title="2">pres &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">12</span>, <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb160-3" title="3">lepro.new &lt;-<span class="st"> </span><span class="kw">crossing</span>(<span class="dt">drug =</span> drugs, <span class="dt">pre =</span> pres)</a>
<a class="sourceLine" id="cb160-4" title="4">lepro.new</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["drug"],"name":[1],"type":["chr"],"align":["left"]},{"label":["pre"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"A","2":"5"},{"1":"A","2":"12"},{"1":"A","2":"20"},{"1":"D","2":"5"},{"1":"D","2":"12"},{"1":"D","2":"20"},{"1":"F","2":"5"},{"1":"F","2":"12"},{"1":"F","2":"20"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The names of the columns in the new data frame have to be
<em>exactly</em> <code>drug</code> and <code>pre</code>. Anything else, and
<code>predict</code> won’t work.</p>
<p>Now I obtain the predictions, from my best model <code>lepro.2</code>. I
don’t need intervals or anything like that:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" title="1">preds &lt;-<span class="st"> </span><span class="kw">predict</span>(lepro<span class="fl">.2</span>, lepro.new)</a>
<a class="sourceLine" id="cb161-2" title="2">preds</a></code></pre></div>
<pre><code>##         1         2         3         4         5         6         7         8         9 
##  1.055110  7.965396 15.862867  1.164081  8.074368 15.971838  4.501248 11.411535 19.309005</code></pre>
<p>only it would be easier to see the predictions side by side with the
values they are predictions for:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" title="1">allpreds &lt;-<span class="st"> </span><span class="kw">cbind</span>(lepro.new, preds)</a>
<a class="sourceLine" id="cb163-2" title="2">allpreds</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["drug"],"name":[1],"type":["chr"],"align":["left"]},{"label":["pre"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["preds"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"A","2":"5","3":"1.055110","_rn_":"1"},{"1":"A","2":"12","3":"7.965396","_rn_":"2"},{"1":"A","2":"20","3":"15.862867","_rn_":"3"},{"1":"D","2":"5","3":"1.164081","_rn_":"4"},{"1":"D","2":"12","3":"8.074368","_rn_":"5"},{"1":"D","2":"20","3":"15.971838","_rn_":"6"},{"1":"F","2":"5","3":"4.501248","_rn_":"7"},{"1":"F","2":"12","3":"11.411535","_rn_":"8"},{"1":"F","2":"20","3":"19.309005","_rn_":"9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>I gave this a name in case I feel like using it again later.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="10" style="list-style-type: lower-alpha">
<li>Now, plot the data with the fitted lines on. You’ll need to do
the trick of using the original data frame (and plot the points),
and the data frame of predictions (and join those points with lines).</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" title="1"><span class="kw">ggplot</span>(lepro, <span class="kw">aes</span>(<span class="dt">x =</span> pre, <span class="dt">y =</span> post, <span class="dt">colour =</span> drug)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb164-2" title="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> allpreds, <span class="kw">aes</span>(<span class="dt">y =</span> preds, <span class="dt">linetype =</span> drug))</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-123-1.png" width="672"  /></p>
<p>Inside the <code>aes</code> for the <code>geom_line</code>, I only have to
specify the things that have changed, so that the <code>x</code>
(<code>pre</code>) and the <code>colour</code> (<code>drug</code>) are
“inherited” unchanged from the first <code>aes</code>.</p>
<p><code>geom_line</code> has the <code>aes</code> as its default first argument,
so I have to specify <code>data=</code> by name.</p>
<p>The <code>linetype=</code> is really overkill, but I just wanted to show
you that you can distinguish the drugs by line type as
well.<label for="tufte-sn-23" class="margin-toggle sidenote-number">23</label><input type="checkbox" id="tufte-sn-23" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">23</span> The line types show up in the legend too, though they’re not so easy to see.</span></p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="11" style="list-style-type: lower-alpha">
<li>Are the lines on your plot parallel, with the same slopes? Is this what you would
expect? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>My lines are parallel. This is exactly what I would expect, since
my best model has no interaction, and the interaction is what
would make the lines <em>not</em> be parallel.
If your best model
<em>did</em> have the interaction term still in it, your predictions
would have been these:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" title="1">preds &lt;-<span class="st"> </span><span class="kw">predict</span>(lepro<span class="fl">.1</span>, lepro.new)</a>
<a class="sourceLine" id="cb165-2" title="2"><span class="kw">cbind</span>(lepro.new, preds)</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["drug"],"name":[1],"type":["chr"],"align":["left"]},{"label":["pre"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["preds"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"A","2":"5","3":"2.0955414","_rn_":"1"},{"1":"A","2":"12","3":"7.3121019","_rn_":"2"},{"1":"A","2":"20","3":"13.2738854","_rn_":"3"},{"1":"D","2":"5","3":"0.7572581","_rn_":"4"},{"1":"D","2":"12","3":"8.2370968","_rn_":"5"},{"1":"D","2":"20","3":"16.7854839","_rn_":"6"},{"1":"F","2":"5","3":"2.8637331","_rn_":"7"},{"1":"F","2":"12","3":"11.2249823","_rn_":"8"},{"1":"F","2":"20","3":"20.7806955","_rn_":"9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The slopes for each drug are no longer the same (because nothing is
forcing them to be the same). For example, if you compare drug A at
pre score 5 and 12, it goes up by 5.2, while drug D at the same pre
scores goes up by 7.5.</p>
<p>The <code>ggplot</code> in this case is actually a lot easier than the
other <code>ggplot</code>, because the lines are now just the regression
lines for each group. So <code>geom_smooth</code> will get them:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" title="1"><span class="kw">ggplot</span>(lepro, <span class="kw">aes</span>(<span class="dt">x =</span> pre, <span class="dt">y =</span> post, <span class="dt">colour =</span> drug)) <span class="op">+</span></a>
<a class="sourceLine" id="cb166-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="pasias_files/figure-html/unnamed-chunk-125-1.png" width="672"  /></p>
<p>The grey intervals are a bit confusing.<label for="tufte-sn-24" class="margin-toggle sidenote-number">24</label><input type="checkbox" id="tufte-sn-24" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">24</span> You can get rid of them by saying <em>se=F</em> inside the geom-smooth, as normal.</span> They are
confidence intervals for the mean <code>post</code> score (as we did for regression
early on in the course). But I left them there to show that they
overlap substantially and thus that those slopes are not
“really different”. That’s the lack of interaction. There is, as you see, a
substantial scatter in the points that would make it very difficult to
prove that those three slopes are really different.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>

</div>
</div>
<p style="text-align: center;">
<a href="analysis-of-variance-revisited.html"><button class="btn btn-default">Previous</button></a>
<a href="multivariate-analysis-of-variance.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
