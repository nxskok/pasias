<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 31 Analysis of covariance | Problems and Solutions in Applied Statistics</title>
  <meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 31 Analysis of covariance | Problems and Solutions in Applied Statistics" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
  <meta name="github-repo" content="nxskok/pasias" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 31 Analysis of covariance | Problems and Solutions in Applied Statistics" />
  
  <meta name="twitter:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
  

<meta name="author" content="Ken Butler" />


<meta name="date" content="2022-06-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="analysis-of-variance-revisited.html"/>
<link rel="next" href="multivariate-analysis-of-variance.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Problems and Solutions in Applied Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#packages-used-somewhere-in-this-book"><i class="fa fa-check"></i>Packages used somewhere in this book</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html"><i class="fa fa-check"></i><b>1</b> Getting used to R and R Studio</a></li>
<li class="chapter" data-level="2" data-path="reading-in-data.html"><a href="reading-in-data.html"><i class="fa fa-check"></i><b>2</b> Reading in data</a></li>
<li class="chapter" data-level="3" data-path="drawing-graphs.html"><a href="drawing-graphs.html"><i class="fa fa-check"></i><b>3</b> Drawing graphs</a></li>
<li class="chapter" data-level="4" data-path="data-exploration.html"><a href="data-exploration.html"><i class="fa fa-check"></i><b>4</b> Data exploration</a></li>
<li class="chapter" data-level="5" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html"><i class="fa fa-check"></i><b>5</b> Working with dataframes</a></li>
<li class="chapter" data-level="6" data-path="one-sample-inference.html"><a href="one-sample-inference.html"><i class="fa fa-check"></i><b>6</b> One-sample inference</a></li>
<li class="chapter" data-level="7" data-path="two-sample-inference.html"><a href="two-sample-inference.html"><i class="fa fa-check"></i><b>7</b> Two-sample inference</a></li>
<li class="chapter" data-level="8" data-path="power-and-sample-size.html"><a href="power-and-sample-size.html"><i class="fa fa-check"></i><b>8</b> Power and sample size</a></li>
<li class="chapter" data-level="9" data-path="the-sign-test.html"><a href="the-sign-test.html"><i class="fa fa-check"></i><b>9</b> The sign test</a></li>
<li class="chapter" data-level="10" data-path="mood-median-test.html"><a href="mood-median-test.html"><i class="fa fa-check"></i><b>10</b> Mood median test</a></li>
<li class="chapter" data-level="11" data-path="matched-pairs-t-and-sign-test.html"><a href="matched-pairs-t-and-sign-test.html"><i class="fa fa-check"></i><b>11</b> Matched pairs t and sign test</a></li>
<li class="chapter" data-level="12" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html"><i class="fa fa-check"></i><b>12</b> Normal quantile plots</a>
<ul>
<li class="chapter" data-level="12.1" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers"><i class="fa fa-check"></i><b>12.1</b> Lengths of heliconia flowers</a></li>
<li class="chapter" data-level="12.2" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#ferritin-and-normality"><i class="fa fa-check"></i><b>12.2</b> Ferritin and normality</a></li>
<li class="chapter" data-level="12.3" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers-1"><i class="fa fa-check"></i><b>12.3</b> Lengths of heliconia flowers</a></li>
<li class="chapter" data-level="12.4" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#ferritin-and-normality-1"><i class="fa fa-check"></i><b>12.4</b> Ferritin and normality</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="analysis-of-variance.html"><a href="analysis-of-variance.html"><i class="fa fa-check"></i><b>13</b> Analysis of variance</a></li>
<li class="chapter" data-level="14" data-path="writing-reports.html"><a href="writing-reports.html"><i class="fa fa-check"></i><b>14</b> Writing reports</a></li>
<li class="chapter" data-level="15" data-path="learning-to-code.html"><a href="learning-to-code.html"><i class="fa fa-check"></i><b>15</b> Learning to code</a>
<ul>
<li class="chapter" data-level="15.1" data-path="learning-to-code.html"><a href="learning-to-code.html#introduction-1"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="learning-to-code.html"><a href="learning-to-code.html#data-and-pre-processing"><i class="fa fa-check"></i><b>15.2</b> Data and pre-processing</a></li>
<li class="chapter" data-level="15.3" data-path="learning-to-code.html"><a href="learning-to-code.html#analysis"><i class="fa fa-check"></i><b>15.3</b> Analysis</a></li>
<li class="chapter" data-level="15.4" data-path="learning-to-code.html"><a href="learning-to-code.html#conclusions-see-note-9"><i class="fa fa-check"></i><b>15.4</b> Conclusions (see note 9)</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="treating-dandruff.html"><a href="treating-dandruff.html"><i class="fa fa-check"></i><b>16</b> Treating dandruff</a>
<ul>
<li class="chapter" data-level="16.1" data-path="treating-dandruff.html"><a href="treating-dandruff.html#introduction-2"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="treating-dandruff.html"><a href="treating-dandruff.html#exploratory-analysis"><i class="fa fa-check"></i><b>16.2</b> Exploratory analysis</a></li>
<li class="chapter" data-level="16.3" data-path="treating-dandruff.html"><a href="treating-dandruff.html#analysis-of-variance-1"><i class="fa fa-check"></i><b>16.3</b> Analysis of Variance</a></li>
<li class="chapter" data-level="16.4" data-path="treating-dandruff.html"><a href="treating-dandruff.html#assessment-of-assumptions"><i class="fa fa-check"></i><b>16.4</b> Assessment of Assumptions</a></li>
<li class="chapter" data-level="16.5" data-path="treating-dandruff.html"><a href="treating-dandruff.html#conclusions"><i class="fa fa-check"></i><b>16.5</b> Conclusions</a></li>
<li class="chapter" data-level="16.6" data-path="treating-dandruff.html"><a href="treating-dandruff.html#end"><i class="fa fa-check"></i><b>16.6</b> End</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="tidying-data.html"><a href="tidying-data.html"><i class="fa fa-check"></i><b>17</b> Tidying data</a></li>
<li class="chapter" data-level="18" data-path="simple-regression.html"><a href="simple-regression.html"><i class="fa fa-check"></i><b>18</b> Simple regression</a></li>
<li class="chapter" data-level="19" data-path="multiple-regression.html"><a href="multiple-regression.html"><i class="fa fa-check"></i><b>19</b> Multiple regression</a></li>
<li class="chapter" data-level="20" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html"><i class="fa fa-check"></i><b>20</b> Regression with categorical variables</a>
<ul>
<li class="chapter" data-level="20.1" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#crickets-revisited"><i class="fa fa-check"></i><b>20.1</b> Crickets revisited</a></li>
<li class="chapter" data-level="20.2" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#pulse-rates-and-marching"><i class="fa fa-check"></i><b>20.2</b> Pulse rates and marching</a></li>
<li class="chapter" data-level="20.3" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#crickets-revisited-1"><i class="fa fa-check"></i><b>20.3</b> Crickets revisited</a></li>
<li class="chapter" data-level="20.4" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#pulse-rates-and-marching-1"><i class="fa fa-check"></i><b>20.4</b> Pulse rates and marching</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>21</b> Dates and times</a></li>
<li class="chapter" data-level="22" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>22</b> Functions</a></li>
<li class="chapter" data-level="23" data-path="vector-and-matrix-algebra.html"><a href="vector-and-matrix-algebra.html"><i class="fa fa-check"></i><b>23</b> Vector and matrix algebra</a>
<ul>
<li class="chapter" data-level="23.1" data-path="vector-and-matrix-algebra.html"><a href="vector-and-matrix-algebra.html#heights-and-foot-lengths-again"><i class="fa fa-check"></i><b>23.1</b> Heights and foot lengths again</a></li>
<li class="chapter" data-level="23.2" data-path="vector-and-matrix-algebra.html"><a href="vector-and-matrix-algebra.html#heights-and-foot-lengths-again-1"><i class="fa fa-check"></i><b>23.2</b> Heights and foot lengths again</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="the-bootstrap.html"><a href="the-bootstrap.html"><i class="fa fa-check"></i><b>24</b> The Bootstrap</a></li>
<li class="chapter" data-level="25" data-path="bayesian-statistics-with-stan.html"><a href="bayesian-statistics-with-stan.html"><i class="fa fa-check"></i><b>25</b> Bayesian Statistics with Stan</a></li>
<li class="chapter" data-level="26" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>26</b> Logistic regression</a></li>
<li class="chapter" data-level="27" data-path="logistic-regression-with-ordinal-response.html"><a href="logistic-regression-with-ordinal-response.html"><i class="fa fa-check"></i><b>27</b> Logistic regression with ordinal response</a></li>
<li class="chapter" data-level="28" data-path="logistic-regression-with-nominal-response.html"><a href="logistic-regression-with-nominal-response.html"><i class="fa fa-check"></i><b>28</b> Logistic regression with nominal response</a></li>
<li class="chapter" data-level="29" data-path="survival-analysis.html"><a href="survival-analysis.html"><i class="fa fa-check"></i><b>29</b> Survival analysis</a></li>
<li class="chapter" data-level="30" data-path="analysis-of-variance-revisited.html"><a href="analysis-of-variance-revisited.html"><i class="fa fa-check"></i><b>30</b> Analysis of variance revisited</a></li>
<li class="chapter" data-level="31" data-path="analysis-of-covariance.html"><a href="analysis-of-covariance.html"><i class="fa fa-check"></i><b>31</b> Analysis of covariance</a>
<ul>
<li class="chapter" data-level="31.1" data-path="analysis-of-covariance.html"><a href="analysis-of-covariance.html#productivity-and-research-and-development"><i class="fa fa-check"></i><b>31.1</b> Productivity and research-and-development</a></li>
<li class="chapter" data-level="31.2" data-path="analysis-of-covariance.html"><a href="analysis-of-covariance.html#treating-leprosy"><i class="fa fa-check"></i><b>31.2</b> Treating leprosy</a></li>
<li class="chapter" data-level="31.3" data-path="analysis-of-covariance.html"><a href="analysis-of-covariance.html#productivity-and-research-and-development-1"><i class="fa fa-check"></i><b>31.3</b> Productivity and research-and-development</a></li>
<li class="chapter" data-level="31.4" data-path="analysis-of-covariance.html"><a href="analysis-of-covariance.html#treating-leprosy-1"><i class="fa fa-check"></i><b>31.4</b> Treating leprosy</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="multivariate-analysis-of-variance.html"><a href="multivariate-analysis-of-variance.html"><i class="fa fa-check"></i><b>32</b> Multivariate analysis of variance</a></li>
<li class="chapter" data-level="33" data-path="repeated-measures.html"><a href="repeated-measures.html"><i class="fa fa-check"></i><b>33</b> Repeated measures</a></li>
<li class="chapter" data-level="34" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html"><i class="fa fa-check"></i><b>34</b> Discriminant analysis</a></li>
<li class="chapter" data-level="35" data-path="hierarchical-cluster-analysis.html"><a href="hierarchical-cluster-analysis.html"><i class="fa fa-check"></i><b>35</b> Hierarchical cluster analysis</a></li>
<li class="chapter" data-level="36" data-path="k-means-cluster-analysis.html"><a href="k-means-cluster-analysis.html"><i class="fa fa-check"></i><b>36</b> K-means cluster analysis</a></li>
<li class="chapter" data-level="37" data-path="drawing-maps-with-leaflet.html"><a href="drawing-maps-with-leaflet.html"><i class="fa fa-check"></i><b>37</b> Drawing maps with Leaflet</a></li>
<li class="chapter" data-level="38" data-path="multidimensional-scaling.html"><a href="multidimensional-scaling.html"><i class="fa fa-check"></i><b>38</b> Multidimensional Scaling</a></li>
<li class="chapter" data-level="39" data-path="principal-components.html"><a href="principal-components.html"><i class="fa fa-check"></i><b>39</b> Principal Components</a>
<ul>
<li class="chapter" data-level="39.1" data-path="principal-components.html"><a href="principal-components.html#the-weather-somewhere"><i class="fa fa-check"></i><b>39.1</b> The weather, somewhere</a></li>
<li class="chapter" data-level="39.2" data-path="principal-components.html"><a href="principal-components.html#the-weather-somewhere-1"><i class="fa fa-check"></i><b>39.2</b> The weather, somewhere</a></li>
</ul></li>
<li class="chapter" data-level="40" data-path="factor-analysis.html"><a href="factor-analysis.html"><i class="fa fa-check"></i><b>40</b> Factor Analysis</a></li>
<li class="chapter" data-level="41" data-path="frequency-table-analysis.html"><a href="frequency-table-analysis.html"><i class="fa fa-check"></i><b>41</b> Frequency table analysis</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Problems and Solutions in Applied Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analysis-of-covariance" class="section level1 hasAnchor" number="31">
<h1><span class="header-section-number">Chapter 31</span> Analysis of covariance<a href="analysis-of-covariance.html#analysis-of-covariance" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Packages for this chapter:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="analysis-of-covariance.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb209-2"><a href="analysis-of-covariance.html#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb209-3"><a href="analysis-of-covariance.html#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="productivity-and-research-and-development" class="section level2 hasAnchor" number="31.1">
<h2><span class="header-section-number">31.1</span> Productivity and research-and-development<a href="analysis-of-covariance.html#productivity-and-research-and-development" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An economist compiled data on productivity improvements for
a sample of companies that produce electronic equipment. The companies
were classified according to their expenditures on research and
development in the last three years (classified as low, moderate,
high). Productivity improvement is measured on a 0–100 scale, with
most values being between 0 and 10. The economist also thought that
last year’s productivity improvement would be relevant, and so
recorded this as well.</p>
<p>The data set can be found at
<a href="http://ritsokiguess.site/datafiles/productivity.txt">link</a>.</p>
<p>Feel free to use “R&amp;D” as an abbreviation for
“research and development” in your answers below.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read in and display at least some of the data.</p></li>
<li><p>Plot productivity improvement for this year against last
year, identifying the points by the level of
research-and-development expenditure. On your plot, add regression
lines for each expenditure group.</p></li>
<li><p><a name="part:graph-comment">*</a>
Look at your graph of the previous part. Do you think that (i)
knowing last year’s productivity improvement tells you something
about this year’s, (ii) the level of expenditure on
research-and-development has an impact on this year’s productivity
improvement, (iii) there is an interaction effect between R&amp;D
expenditure and last year’s productivity increase on this year’s
productivity increase? In each case, explain briefly.</p></li>
<li><p>Fit an analysis of covariance model without interaction. Run
the results through <code>drop1</code> with <code>test="F"</code> (the
<code>F</code> must be in quotes). What do you conclude?</p></li>
<li><p>Now look at the <code>summary</code> of your analysis of
covariance model. Explain briefly how each of the <em>last three</em>
numbers in the <code>Estimate</code> column are consistent with your graph.</p></li>
<li><p>Add an interaction between <code>last</code> and
<code>expenditure</code> to your analysis of covariance model. Test it
for significance using <code>drop1</code>. In the light of what you
have seen, does this surprise you? Explain briefly why you are or
are not surprised.</p></li>
</ol>
</div>
<div id="treating-leprosy" class="section level2 hasAnchor" number="31.2">
<h2><span class="header-section-number">31.2</span> Treating leprosy<a href="analysis-of-covariance.html#treating-leprosy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Two drugs are being tested in the treatment of
leprosy. These are labelled A and D. There is also a control drug,
labelled F. The response variable is a post-treatment score of leprosy
bacilli (measured at six different sites on each patient). A lower
score is better.</p>
<p>Thus far, we have a standard one-way analysis of variance. But the
researchers wanted greater precision in assessing the effects (if any)
of the drugs, so they also measured a pre-treatment score of leprosy
bacilli. The data are in the file
<a href="http://ritsokiguess.site/datafiles/leprosy.txt">link</a>. The
pre-treatment and post-treatment scores are labelled <code>pre</code> and
<code>post</code> respectively.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read in the data and check that you have apparently the
right thing.</p></li>
<li><p><a name="part:lepro-scatter">*</a> Make a scatterplot of post-treatment score against
pre-treatment score, with the points for each drug drawn in a
different colour.</p></li>
<li><p>Does it appear that including the pre-treatment score was a
good idea? Explain briefly.</p></li>
<li><p>What about this dataset suggests that analysis of
covariance is a method worth trying?</p></li>
<li><p>Fit an analysis of covariance model to predict
post-treatment score. Include an interaction between your
explanatory variables. (You don’t need to look at the output from
the model.)</p></li>
<li><p>Pass your fitted model of the last part into
<code>drop1</code>. Is
the interaction term significant?</p></li>
<li><p>Fit a model without the interaction. Is this a sensible thing to
do (in addition, that is, to the fact that I just asked you to do it)?</p></li>
<li><p>Take a look at the <code>summary</code> of your preferred
model. Is there a significant effect of pre-treatment score?
Describe the effects of the different drugs on the post-treatment
score. (Don’t do any tests for <code>drug</code>.) Does your comparison
of drugs make sense?</p></li>
<li><p>Obtain predicted values for <code>post</code> for each of the
three drugs at <code>pre</code> scores 5, 12 and 20. To do this, obtain
a new data frame that has all 9 combinations of drugs and
<code>pre</code> scores, and then feed this into <code>predict</code> using
your preferred model.<a href="#fn36" class="footnote-ref" id="fnref36"><sup>36</sup></a></p></li>
<li><p>Now, plot the data with the fitted lines on.</p></li>
<li><p>Are the lines on your plot parallel, with the same slopes? Is this what you would
expect? Explain briefly.</p></li>
</ol>
<p>My solutions follow:</p>
</div>
<div id="productivity-and-research-and-development-1" class="section level2 hasAnchor" number="31.3">
<h2><span class="header-section-number">31.3</span> Productivity and research-and-development<a href="analysis-of-covariance.html#productivity-and-research-and-development-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An economist compiled data on productivity improvements for
a sample of companies that produce electronic equipment. The companies
were classified according to their expenditures on research and
development in the last three years (classified as low, moderate,
high). Productivity improvement is measured on a 0–100 scale, with
most values being between 0 and 10. The economist also thought that
last year’s productivity improvement would be relevant, and so
recorded this as well.</p>
<p>The data set can be found at
<a href="http://ritsokiguess.site/datafiles/productivity.txt">link</a>.</p>
<p>Feel free to use “R&amp;D” as an abbreviation for
“research and development” in your answers below.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in and display at least some of the data.</li>
</ol>
<p>Solution</p>
<p>The data values are separated by one space, so let’s use
<code>read_delim</code> and display whatever displays (probably the
first ten lines):</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="analysis-of-covariance.html#cb210-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">&quot;http://ritsokiguess.site/datafiles/productivity.txt&quot;</span></span>
<span id="cb210-2"><a href="analysis-of-covariance.html#cb210-2" aria-hidden="true" tabindex="-1"></a>productivity <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(my_url, <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 27 Columns: 3
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot; &quot;
## chr (1): expenditure
## dbl (2): improvement, last
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="analysis-of-covariance.html#cb212-1" aria-hidden="true" tabindex="-1"></a>productivity</span></code></pre></div>
<pre><code>## # A tibble: 27 × 3
##    expenditure improvement  last
##    &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;
##  1 low                 7.6   8.2
##  2 low                 8.2   7.9
##  3 low                 6.8   7  
##  4 low                 5.8   5.7
##  5 low                 6.9   7.2
##  6 low                 6.6   7  
##  7 low                 6.3   6.5
##  8 low                 7.7   7.9
##  9 low                 6     6.3
## 10 moderate            6.7   8.8
## # … with 17 more rows</code></pre>
<p>There is a column classifying expenditure along with numerical values
for productivity improvement for this year and last year (labelled
<code>improvement</code> and <code>last</code>), so it looks as if we are
good.</p>
<p>You are free to give the data frame a shorter name to make it easier
to keep typing it!</p>
<p>Extra: those expenditure levels (that are currently text) will get
sorted into alphabetical order unless we stop them. They are actually
in the right order in the data file, so maybe we should turn them into
a factor (with the levels in the right order) now:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="analysis-of-covariance.html#cb214-1" aria-hidden="true" tabindex="-1"></a>productivity <span class="sc">%&gt;%</span></span>
<span id="cb214-2"><a href="analysis-of-covariance.html#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">expenditure =</span> <span class="fu">fct_inorder</span>(expenditure)) <span class="ot">-&gt;</span> productivity</span></code></pre></div>
<p>If you don’t do this, your answers below will be different from
mine. Probably not in any kind of consequential way, but different
nonetheless.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Plot productivity improvement for this year against last
year, identifying the points by the level of
research-and-development expenditure. On your plot, add regression
lines for each expenditure group.</li>
</ol>
<p>Solution</p>
<p>Two quantitative and one categorical variable, so plot the
categorical variable using colour (or <code>shape</code> etc., if you
know about that, but colour is the most obvious thing):</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="analysis-of-covariance.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(productivity, <span class="fu">aes</span>(<span class="at">x =</span> last, <span class="at">y =</span> improvement, <span class="at">colour =</span> expenditure)) <span class="sc">+</span></span>
<span id="cb215-2"><a href="analysis-of-covariance.html#cb215-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> F)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="pasias_files/figure-html/productivity-3-1.png" width="672" /></p>
<p>The <code>se=F</code> is optional; no problem if you don’t include it. (If
you miss it out, you’ll get those CI-of-mean-response grey envelopes
around each line.)</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li><a name="part:graph-comment">*</a>
Look at your graph of the previous part. Do you think that (i)
knowing last year’s productivity improvement tells you something
about this year’s, (ii) the level of expenditure on
research-and-development has an impact on this year’s productivity
improvement, (iii) there is an interaction effect between R&amp;D
expenditure and last year’s productivity increase on this year’s
productivity increase? In each case, explain briefly.</li>
</ol>
<p>Solution</p>
<p>Taking the three things in turn:
(i) knowing about last year’s productivity increase definitely
helps, because the three trends definitely go up (extra: and are
pretty much linear).
(ii) knowing about the level of expenditure helps because the
coloured trends are in different places (low on the
left and high on the right, whatever colours they are for you).
(iii) I am guessing there is no interaction because the three
lines look more or less parallel (a judgement call: if you think
that there <em>will</em> be an interaction because you think the
lines are definitely not “approximately parallel” and therefore
there is an interaction, that’s OK too).</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Fit an analysis of covariance model without interaction. Run
the results through <code>drop1</code> with <code>test="F"</code> (the
<code>F</code> must be in quotes). What do you conclude?</li>
</ol>
<p>Solution</p>
<p>This looks exactly like a regression with a categorical variable,
and is. Just the two main effects, thus:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="analysis-of-covariance.html#cb217-1" aria-hidden="true" tabindex="-1"></a>improvement<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(improvement <span class="sc">~</span> last <span class="sc">+</span> expenditure, <span class="at">data =</span> productivity)</span>
<span id="cb217-2"><a href="analysis-of-covariance.html#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(improvement<span class="fl">.1</span>, <span class="at">test =</span> <span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## improvement ~ last + expenditure
##             Df Sum of Sq     RSS     AIC F value    Pr(&gt;F)    
## &lt;none&gt;                    1.3175 -73.542                      
## last         1   14.0447 15.3622  -9.226 245.176 9.274e-14 ***
## expenditure  2    4.1958  5.5134 -38.894  36.623 7.095e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Both the P-values are small, so there is strong evidence of an effect
on this year’s productivity increase of last year’s productivity
increase and the level of R&amp;D expenditure.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Now look at the <code>summary</code> of your analysis of
covariance model. Explain briefly how each of the <em>last three</em>
numbers in the <code>Estimate</code> column are consistent with your graph.</li>
</ol>
<p>Solution</p>
<p>To begin:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="analysis-of-covariance.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(improvement<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = improvement ~ last + expenditure, data = productivity)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.52812 -0.16385 -0.00046  0.08379  0.45730 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         -1.00804    0.50991  -1.977   0.0602 .  
## last                 1.11417    0.07116  15.658 9.27e-14 ***
## expendituremoderate -1.83316    0.22372  -8.194 2.84e-08 ***
## expenditurehigh     -3.14338    0.37115  -8.469 1.59e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2393 on 23 degrees of freedom
## Multiple R-squared:  0.9629, Adjusted R-squared:  0.958 
## F-statistic: 198.8 on 3 and 23 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The last three numbers in the Estimate column are slopes for the
quantitative variable <code>last</code> and changes in intercept for the
levels of the categorical variable <code>expenditure</code>. Specifically:</p>
<ul>
<li><p>the slope for <code>last</code> is positive, so if last year’s
productivity increase is higher, this year’s will be higher as well.
This matches
the upward trends within each <code>expenditure</code> group on the
graph.</p></li>
<li><p><code>expenditure</code> is categorical, so everything is measured
relative to the baseline. Mine is <code>low</code>, but yours is probably <code>high</code>.</p></li>
<li><p>My two estimates for <code>expenditure</code> <code>high</code> and
<code>moderate</code> are both negative, so when expenditure on R&amp;D is
high or moderate, the productivity increase will be lower this year
(for the same productivity increase last year). Going back to the
graph, if you extend the lines for <code>moderate</code> and <code>high</code> to
a middling <code>last</code> value of something like 10, the
productivity increase this year will be higher when
<code>expenditure</code> is low or moderate then when it is high, which
is consistent with those slopes both being positive. (You don’t need
to go to this detail, but you should say something convincing from
the graph about how this year’s productivity increase is
<em>higher</em> if R&amp;D expenditure is low or moderate compared to
high.)</p></li>
</ul>
<p>Extra: the graph also indicates that the higher the
<code>expenditure</code> on R&amp;D is, the more likely last year’s
productivity improvement will be higher also. So in practice we are
not likely to be comparing actual companies with different
<code>expenditure</code> but the same <code>last</code>. Nonetheless, what I
said is what those positive coefficients for <code>expenditure</code>
actually mean. Be careful not to say that <code>low</code> is lowest
because it’s on the left; it’s whether it’s higher or lower than the
others <em>at the same value of <code>last</code></em> that matters.</p>
<p>Extra extra: I asked you to do the test from <code>drop1</code> because
there are three levels of <code>expenditure</code> (rather than just two),
and the <code>summary</code> output only gives you a comparison with the
baseline level, rather than comparing all three
levels. I prefer to do the right test (using <code>drop1</code>) first,
and then use <code>summary</code> to interpret what I have, or at least
the parts of it that are significant.</p>
<p>Extra extra extra: you would (or at least I would) expect a larger
productivity increase to go with a <em>larger</em> expenditure on R&amp;D,
but that’s not how it worked out. This is one of those cases where all
else isn’t really equal.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Add an interaction between <code>last</code> and
<code>expenditure</code> to your analysis of covariance model. Test it
for significance using <code>drop1</code>. In the light of what you
have seen, does this surprise you? Explain briefly why you are or
are not surprised.</li>
</ol>
<p>Solution</p>
<p>I like <code>update</code> for this (writing out the whole model is an
alternative):</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="analysis-of-covariance.html#cb221-1" aria-hidden="true" tabindex="-1"></a>improvement<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(improvement<span class="fl">.1</span>, . <span class="sc">~</span> . <span class="sc">+</span> last<span class="sc">:</span>expenditure)</span>
<span id="cb221-2"><a href="analysis-of-covariance.html#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(improvement<span class="fl">.2</span>, <span class="at">test =</span> <span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## improvement ~ last + expenditure + last:expenditure
##                  Df Sum of Sq     RSS     AIC F value  Pr(&gt;F)  
## &lt;none&gt;                        0.95718 -78.169                  
## last:expenditure  2   0.36035 1.31753 -73.542   3.953 0.03491 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Yes, I too forgot the <code>test="F"</code> the first time.</p>
<p>The interaction term is actually significant, at least at
<span class="math inline">\(\alpha=0.05\)</span>. This is a surprise to me, because I thought those lines
on the graph were pretty close to parallel, so I wasn’t expecting to
see a significant interaction. (What I want from you here is to look
back at your answer to (iii) in part (<a href="#part:graph-comment">here</a>), and
to say how this small P-value is consistent or inconsistent with
whatever you said there. If you said that the lines weren’t parallel
enough, then this significant interaction should <em>not</em> be a
surprise to you.)</p>
<p>That’s all I’m after. I don’t need you to speculate on <em>why</em> the
test came out significant. I will, in a moment, but you don’t need to.</p>
<p>Extra: I didn’t expect the interaction to come out significant, but
the P-value is not nearly so small as the ones we had before. I guess
the explanation for this is that the data cluster pretty tightly about
the lines in the graph, so that even a small difference in slopes can
be signficant. You might argue that my red line is not <em>quite</em>
as steep as the others, but the difference does look very small.</p>
<p>Let’s take a look at the <code>summary</code> for my interaction model:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="analysis-of-covariance.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(improvement<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = improvement ~ last + expenditure + last:expenditure, 
##     data = productivity)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.32417 -0.14885 -0.02465  0.13739  0.55556 
## 
## Coefficients:
##                          Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)               0.27827    0.64967   0.428  0.67278    
## last                      0.93243    0.09124  10.220 1.32e-09 ***
## expendituremoderate      -4.50268    1.25959  -3.575  0.00179 ** 
## expenditurehigh          -7.14795    1.91223  -3.738  0.00121 ** 
## last:expendituremoderate  0.32217    0.14243   2.262  0.03444 *  
## last:expenditurehigh      0.40858    0.17549   2.328  0.02997 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2135 on 21 degrees of freedom
## Multiple R-squared:  0.973,  Adjusted R-squared:  0.9666 
## F-statistic: 151.5 on 5 and 21 DF,  p-value: 9.763e-16</code></pre>
<p>The last two Estimates, the ones beginning with <code>last:</code>, came
from the interaction. Once again <code>low</code> is my baseline. These
say how the <em>slopes</em> for <code>last</code> for the other groups
differ from the slopes for <code>last</code> for <code>low</code>
expenditure. (Yes, this is confusing. Read it again until you get it.)</p>
<p>The biggest-size difference in slopes, about <span class="math inline">\(0.40\)</span>, is between low
expenditure and high expenditure. This says that the line for high
expenditure is this much more steep than the line for low
expenditure. That’s where the non-parallelism is on the graph, such as
it is. A small but significant difference in slopes. You can tell that
the effect is small by looking in the Estimate column; those changes
in slopes, <span class="math inline">\(0.40\)</span> and <span class="math inline">\(0.32\)</span>, are the smallest things in size out of
everything in that column.</p>
<p>Having seen this, you now realize that I did this question wrong (or,
at least, I led you through it wrong). The right way to do this would
have been to fit the interaction model <em>first</em>, see that it is
significant, and then done some predictions to assess the effects of
things:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="analysis-of-covariance.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_cap</span>(improvement<span class="fl">.2</span>, <span class="at">condition =</span> <span class="fu">c</span>(<span class="st">&quot;last&quot;</span>, <span class="st">&quot;expenditure&quot;</span>))</span></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>The three lines are not quite parallel, and evidently non-parallel enough to be significant. (This graph does not give you any sense of how much variability there is in the <em>slopes</em>; the at-least partial non-overlapping of the confidence envelopes tells you that there is a significant effect of <em>expenditure</em>, but it doesn’t tell you about the interaction.)</p>
<p>The effect is more or less as we described it before: as <code>last</code>
goes up (for fixed <code>expenditure</code>), the predicted productivity
improvements for this year go up, and as <code>expenditure</code> level
goes up, the predictions go <em>down</em>. But the rates at which they
go up or down are different, which is the significant interaction
coming into play. Having said that, they are not very different, so I
cheated and pretended the interaction was not significant (or that I
was using <span class="math inline">\(\alpha=0.01\)</span>), so that you would have something easier to
interpret. Qualitatively, the story is the same either way, because
the sizes of the interaction terms are small compared to the
others. So, even though I cheated, you ended up with more or less the
same conclusions doing it the way I asked you to do it, or doing it
the way I just did it.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="treating-leprosy-1" class="section level2 hasAnchor" number="31.4">
<h2><span class="header-section-number">31.4</span> Treating leprosy<a href="analysis-of-covariance.html#treating-leprosy-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Two drugs are being tested in the treatment of
leprosy. These are labelled A and D. There is also a control drug,
labelled F. The response variable is a post-treatment score of leprosy
bacilli (measured at six different sites on each patient). A lower
score is better.</p>
<p>Thus far, we have a standard one-way analysis of variance. But the
researchers wanted greater precision in assessing the effects (if any)
of the drugs, so they also measured a pre-treatment score of leprosy
bacilli. The data are in the file
<a href="http://ritsokiguess.site/datafiles/leprosy.txt">link</a>. The
pre-treatment and post-treatment scores are labelled <code>pre</code> and
<code>post</code> respectively.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data and check that you have apparently the
right thing.</li>
</ol>
<p>Solution</p>
<p>Take a look at the data file. The values have multiple spaces
between them, but they are aligned with each other and the
column headings, so <code>read_table</code> is the thing:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="analysis-of-covariance.html#cb226-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">&quot;http://ritsokiguess.site/datafiles/leprosy.txt&quot;</span></span>
<span id="cb226-2"><a href="analysis-of-covariance.html#cb226-2" aria-hidden="true" tabindex="-1"></a>lepro <span class="ot">&lt;-</span> <span class="fu">read_table</span>(my_url)</span></code></pre></div>
<pre><code>## 
## ── Column specification ────────────────────────────────────────────────────────
## cols(
##   drug = col_character(),
##   pre = col_double(),
##   post = col_double()
## )</code></pre>
<pre><code>## Warning: 24 parsing failures.
## row col  expected    actual                                             file
##   1  -- 3 columns 4 columns &#39;http://ritsokiguess.site/datafiles/leprosy.txt&#39;
##   2  -- 3 columns 4 columns &#39;http://ritsokiguess.site/datafiles/leprosy.txt&#39;
##   3  -- 3 columns 4 columns &#39;http://ritsokiguess.site/datafiles/leprosy.txt&#39;
##   4  -- 3 columns 4 columns &#39;http://ritsokiguess.site/datafiles/leprosy.txt&#39;
##   5  -- 3 columns 4 columns &#39;http://ritsokiguess.site/datafiles/leprosy.txt&#39;
## ... ... ......... ......... ................................................
## See problems(...) for more details.</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="analysis-of-covariance.html#cb229-1" aria-hidden="true" tabindex="-1"></a>lepro</span></code></pre></div>
<pre><code>## # A tibble: 30 × 3
##    drug    pre  post
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 A        11     6
##  2 A         6     4
##  3 D         6     0
##  4 D         8     4
##  5 F        16    13
##  6 F        16    12
##  7 A         8     0
##  8 A        10    13
##  9 D         6     2
## 10 D        19    14
## # … with 20 more rows</code></pre>
<p>Call it what you like.</p>
<p>That looks good, with variables of the right names.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li><a name="part:lepro-scatter">*</a> Make a scatterplot of post-treatment score against
pre-treatment score, with the points for each drug drawn in a
different colour.</li>
</ol>
<p>Solution</p>
<p>This is the kind of thing that <code>ggplot</code> does without
batting an eyelid:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="analysis-of-covariance.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lepro, <span class="fu">aes</span>(<span class="at">x =</span> pre, <span class="at">y =</span> post, <span class="at">colour =</span> drug)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="pasias_files/figure-html/leprosy-3-1.png" width="672" /></p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Does it appear that including the pre-treatment score was a
good idea? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>The overall trend on the scatterplot is that a higher <code>pre</code>
tends to go with a higher <code>post</code>, regardless of drug, so
including this information appears to be informative.
I personally suspect that there’s some fan-out happening on the
pre-post relationship, but I’m not planning to make you explore that.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>What about this dataset suggests that analysis of
covariance is a method worth trying?</li>
</ol>
<p>Solution</p>
<p>The key is a mixture of categorical and quantitative explanatory
variables. Here we have a categorical variable <code>drug</code> and a
quantitative one <code>pre</code>.
If we had only one type of explanatory variable, we could do a
regression or an ANOVA as appropriate. But we don’t. In some ways,
it’s not worth making a fuss about the distinction, because
regressions and ANOVAs are all linear models anyway. But you may
see the term “analysis of covariance”, so it’s worth your while
to know what it’s about.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Fit an analysis of covariance model to predict
post-treatment score. Include an interaction between your
explanatory variables. (You don’t need to look at the output from
the model.)</li>
</ol>
<p>Solution</p>
<p>This is what you’d guess. <code>lm</code> handles the interaction
properly, even though <code>pre</code> is a quantitative variable.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="analysis-of-covariance.html#cb232-1" aria-hidden="true" tabindex="-1"></a>lepro<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(post <span class="sc">~</span> pre <span class="sc">*</span> drug, <span class="at">data =</span> lepro)</span></code></pre></div>
<p>I wanted to take a look, so I did:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="analysis-of-covariance.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lepro<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = post ~ pre * drug, data = lepro)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -6.225 -2.437 -0.586  1.126  8.775 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)  -1.6306     2.9455  -0.554   0.5850  
## pre           0.7452     0.2849   2.616   0.0152 *
## drugD        -2.9549     4.1246  -0.716   0.4806  
## drugF        -1.4780     5.4678  -0.270   0.7892  
## pre:drugD     0.3233     0.3846   0.841   0.4089  
## pre:drugF     0.4492     0.4458   1.008   0.3236  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.07 on 24 degrees of freedom
## Multiple R-squared:  0.6915, Adjusted R-squared:  0.6272 
## F-statistic: 10.76 on 5 and 24 DF,  p-value: 1.63e-05</code></pre>
<p>For testing the interaction, there are <em>two</em> slope coefficients
that should be zero if there is no interaction. So we have to test
this with <code>drop1</code>, which is next.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Pass your fitted model of the last part into
<code>drop1</code>. Is
the interaction term significant?</li>
</ol>
<p>Solution</p>
<p>Just this:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="analysis-of-covariance.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(lepro<span class="fl">.1</span>, <span class="at">test =</span> <span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## post ~ pre * drug
##          Df Sum of Sq    RSS    AIC F value Pr(&gt;F)
## &lt;none&gt;                397.56 89.524               
## pre:drug  2    19.645 417.20 86.971   0.593 0.5606</code></pre>
<p>There is only a test for the interaction term because you can’t take out the main effects until you’ve taken out the interaction.</p>
<p>The P-value for the interaction is very large (0.5606) so it is
nowhere near significant. We can drop the interaction.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Fit a model without the interaction. Is this a sensible thing to
do (in addition, that is, to the fact that I just asked you to do it)?</li>
</ol>
<p>Solution</p>
<p>Change the <code>*</code> to a <code>+</code>:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="analysis-of-covariance.html#cb237-1" aria-hidden="true" tabindex="-1"></a>lepro<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(post <span class="sc">~</span> pre <span class="sc">+</span> drug, <span class="at">data =</span> lepro)</span></code></pre></div>
<p>Or use <code>update</code> (not much in it, here):</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="analysis-of-covariance.html#cb238-1" aria-hidden="true" tabindex="-1"></a>lepro<span class="fl">.2</span>a <span class="ot">&lt;-</span> <span class="fu">update</span>(lepro<span class="fl">.1</span>, . <span class="sc">~</span> . <span class="sc">-</span> pre<span class="sc">:</span>drug)</span></code></pre></div>
<p>We just said that the interaction could come out, since it wasn’t
significant, so this is exactly the model that we should be fitting.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Take a look at the <code>summary</code> of your preferred
model. Is there a significant effect of pre-treatment score?
Describe the effects of the different drugs on the post-treatment
score. (Don’t do any tests for <code>drug</code>.) Does your comparison
of drugs make sense?</li>
</ol>
<p>Solution</p>
<p>Mine was the no-interaction model <code>lepro.2</code>:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="analysis-of-covariance.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lepro<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = post ~ pre + drug, data = lepro)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -6.4115 -2.3891 -0.5711  1.7237  8.5885 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -3.8808     1.9862  -1.954   0.0616 .  
## pre           0.9872     0.1645   6.001 2.45e-06 ***
## drugD         0.1090     1.7951   0.061   0.9521    
## drugF         3.4461     1.8868   1.826   0.0793 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.006 on 26 degrees of freedom
## Multiple R-squared:  0.6763, Adjusted R-squared:  0.6389 
## F-statistic:  18.1 on 3 and 26 DF,  p-value: 1.501e-06</code></pre>
<p>The pre-treatment term is definitely significant, with a P-value of
0.0000025. So pre-treatment score definitely has an impact on
post-treatment score.</p>
<p>I didn’t ask you to test for significance of drugs. I just wanted you
to assess their coefficients. Drug A is being used as the baseline, so
its coefficient is zero. Drug D has a slightly positive coefficient
(0.109) so its average bacilli score is slightly higher (for any
pre-treatment score) than for drug A. Drug F, which was the placebo,
has a slope of 3.446, so its average bacilli score is a fair bit
higher than for either of the other drugs. This makes sense because a
higher score is worse, and the two “real” drugs are both better than
the fake one.</p>
<p>Whether there is a real drug difference, I didn’t ask you to assess,
but you could do it by <code>drop1</code> again, this way:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="analysis-of-covariance.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(lepro<span class="fl">.2</span>, <span class="at">test =</span> <span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## post ~ pre + drug
##        Df Sum of Sq    RSS     AIC F value    Pr(&gt;F)    
## &lt;none&gt;              417.20  86.971                      
## pre     1    577.90 995.10 111.049 36.0145 2.454e-06 ***
## drug    2     68.55 485.76  87.535  2.1361    0.1384    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>This is actually not significant.<a href="#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a>
This is one of those cases where the non-significant <code>drug</code> has
a slightly <em>bigger</em> AIC than <code>&lt;none&gt;</code>, so <code>drop1</code>
considers it best to leave it in the model.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol style="list-style-type: lower-roman">
<li>Obtain predicted values for <code>post</code> for each of the
three drugs at <code>pre</code> scores 5, 12 and 20. To do this, obtain
a new data frame that has all 9 combinations of drugs and
<code>pre</code> scores, and then feed this into <code>predict</code> using
your preferred model.<a href="#fn38" class="footnote-ref" id="fnref38"><sup>38</sup></a></li>
</ol>
<p>Solution</p>
<p>First, make the new data frame for predicting from, using
<code>crossing</code>. I’m doing this in small steps for clarity:
first, I define all the drugs and <code>pre</code> values, and then I
feed them into <code>datagrid</code>:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="analysis-of-covariance.html#cb243-1" aria-hidden="true" tabindex="-1"></a>drugs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;F&quot;</span>)</span>
<span id="cb243-2"><a href="analysis-of-covariance.html#cb243-2" aria-hidden="true" tabindex="-1"></a>pres <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">12</span>, <span class="dv">20</span>)</span>
<span id="cb243-3"><a href="analysis-of-covariance.html#cb243-3" aria-hidden="true" tabindex="-1"></a>new <span class="ot">&lt;-</span> <span class="fu">datagrid</span>(<span class="at">model =</span> lepro<span class="fl">.2</span>, <span class="at">drug =</span> drugs, <span class="at">pre =</span> pres)</span>
<span id="cb243-4"><a href="analysis-of-covariance.html#cb243-4" aria-hidden="true" tabindex="-1"></a>new</span></code></pre></div>
<pre><code>##    drug pre
## 1:    A   5
## 2:    A  12
## 3:    A  20
## 4:    D   5
## 5:    D  12
## 6:    D  20
## 7:    F   5
## 8:    F  12
## 9:    F  20</code></pre>
<p>Now I obtain the predictions, from my best model <code>lepro.2</code>. I
don’t need intervals or anything like that:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="analysis-of-covariance.html#cb245-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predictions</span>(lepro<span class="fl">.2</span>, <span class="at">newdata =</span> new)</span>
<span id="cb245-2"><a href="analysis-of-covariance.html#cb245-2" aria-hidden="true" tabindex="-1"></a>preds</span></code></pre></div>
<pre><code>##   rowid     type predicted std.error  conf.low conf.high drug pre
## 1     1 response  1.055110  1.450846 -1.927147  4.037367    A   5
## 2     2 response  7.965396  1.342345  5.206168 10.724625    A  12
## 3     3 response 15.862867  2.168562 11.405323 20.320410    A  20
## 4     4 response  1.164081  1.510335 -1.940457  4.268619    D   5
## 5     5 response  8.074368  1.308764  5.384165 10.764571    D  12
## 6     6 response 15.971838  2.076191 11.704166 20.239510    D  20
## 7     7 response  4.501248  1.814774  0.770926  8.231570    F   5
## 8     8 response 11.411535  1.275360  8.789994 14.033075    F  12
## 9     9 response 19.309005  1.722989 15.767350 22.850660    F  20</code></pre>
<p>I gave this a name in case I feel like using it again later.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="10" style="list-style-type: lower-alpha">
<li>Now, plot the data with the fitted lines on.</li>
</ol>
<p>Solution</p>
<p>The starting point is to plot the predictions, which is <code>plot_cap</code>:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="analysis-of-covariance.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_cap</span>(lepro<span class="fl">.2</span>, <span class="at">condition =</span> <span class="fu">c</span>(<span class="st">&quot;pre&quot;</span>, <span class="st">&quot;drug&quot;</span>))</span></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>The olive-coloured line is actually the red and green lines right next to each other. You can check from the previous part that the predictions for drugs A and D are very close together, with those for drug F (the placebo) being higher (worse).</p>
<p>This is a <code>ggplot</code>, so we can add things to it. The idea is to say that the next thing to plot comes from some other dataframe, and to specify everything we need (that is, not to inherit from the original <code>ggplot</code> that is lurking within <code>plot_cap</code>):</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="analysis-of-covariance.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_cap</span>(lepro<span class="fl">.2</span>, <span class="at">condition =</span> <span class="fu">c</span>(<span class="st">&quot;pre&quot;</span>, <span class="st">&quot;drug&quot;</span>)) <span class="sc">+</span></span>
<span id="cb248-2"><a href="analysis-of-covariance.html#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> lepro, <span class="fu">aes</span>(<span class="at">x =</span> pre, <span class="at">y =</span> post, <span class="at">colour =</span> drug), <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>There is quite a lot of variability (which is why those confidence bands are so wide), but at least some of the blue points from drug F are above the others (worse), and there is very little to choose between drugs A and D.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="11" style="list-style-type: lower-alpha">
<li>Are the lines on your plot parallel, with the same slopes? Is this what you would
expect? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>My lines are parallel. This is exactly what I would expect, since
my best model has no interaction, and the interaction is what
would make the lines <em>not</em> be parallel.
If your best model
<em>did</em> have the interaction term still in it, your predictions
would have been these:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="analysis-of-covariance.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_cap</span>(lepro<span class="fl">.1</span>, <span class="at">condition =</span> <span class="fu">c</span>(<span class="st">&quot;pre&quot;</span>, <span class="st">&quot;drug&quot;</span>)) <span class="sc">+</span></span>
<span id="cb249-2"><a href="analysis-of-covariance.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> lepro, <span class="fu">aes</span>(<span class="at">x =</span> pre, <span class="at">y =</span> post, <span class="at">colour =</span> drug), <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>There is, as you see, a
substantial scatter in the points that would make it very difficult to
prove that those three slopes are really different, even though the lines cross.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="36">
<li id="fn36"><p>Analysis of covariance is just a linear model, so <em>predict</em> works the same here as in regression.<a href="analysis-of-covariance.html#fnref36" class="footnote-back">↩︎</a></p></li>
<li id="fn37"><p>This is why I didn’t ask you to test this, since it would have confused the story.<a href="analysis-of-covariance.html#fnref37" class="footnote-back">↩︎</a></p></li>
<li id="fn38"><p>Analysis of covariance is just a linear model, so <em>predict</em> works the same here as in regression.<a href="analysis-of-covariance.html#fnref38" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="analysis-of-variance-revisited.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multivariate-analysis-of-variance.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["pasias.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
