<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Chapter 8 Power and sample size | Problems and Solutions in Applied Statistics" />
<meta property="og:type" content="book" />
<meta property="og:url" content="http://ritsokiguess.site/pasias" />

<meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
<meta name="github-repo" content="nxskok/pasias" />

<meta name="author" content="Ken Butler" />

<meta name="date" content="2021-04-26" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics">

<title>Chapter 8 Power and sample size | Problems and Solutions in Applied Statistics</title>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/jquery-1.12.4/jquery.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="index.html#packages-used-somewhere-in-this-book"><span class="toc-section-number">1.1</span> Packages used somewhere in this book</a></li>
</ul></li>
<li><a href="getting-used-to-r-and-r-studio.html#getting-used-to-r-and-r-studio"><span class="toc-section-number">2</span> Getting used to R and R Studio</a>
<ul>
<li><a href="getting-used-to-r-and-r-studio.html#getting-an-r-studio-cloud-account"><span class="toc-section-number">2.1</span> Getting an R Studio Cloud account</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#getting-started"><span class="toc-section-number">2.2</span> Getting started</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#reading-data-from-a-file"><span class="toc-section-number">2.3</span> Reading data from a file</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#reading-files-different-ways"><span class="toc-section-number">2.4</span> Reading files different ways</a></li>
</ul></li>
<li><a href="reading-in-data.html#reading-in-data"><span class="toc-section-number">3</span> Reading in data</a>
<ul>
<li><a href="reading-in-data.html#orange-juice"><span class="toc-section-number">3.1</span> Orange juice</a></li>
<li><a href="reading-in-data.html#making-soap"><span class="toc-section-number">3.2</span> Making soap</a></li>
<li><a href="reading-in-data.html#handling-shipments"><span class="toc-section-number">3.3</span> Handling shipments</a></li>
</ul></li>
<li><a href="drawing-graphs.html#drawing-graphs"><span class="toc-section-number">4</span> Drawing graphs</a>
<ul>
<li><a href="drawing-graphs.html#orange-juice-1"><span class="toc-section-number">4.1</span> Orange juice</a></li>
<li><a href="drawing-graphs.html#making-soap-1"><span class="toc-section-number">4.2</span> Making soap</a></li>
<li><a href="drawing-graphs.html#handling-shipments-1"><span class="toc-section-number">4.3</span> Handling shipments</a></li>
</ul></li>
<li><a href="data-exploration.html#data-exploration"><span class="toc-section-number">5</span> Data exploration</a>
<ul>
<li><a href="data-exploration.html#north-carolina-births"><span class="toc-section-number">5.1</span> North Carolina births</a></li>
<li><a href="data-exploration.html#more-about-the-nc-births"><span class="toc-section-number">5.2</span> More about the NC births</a></li>
<li><a href="data-exploration.html#nenana-alaska"><span class="toc-section-number">5.3</span> Nenana, Alaska</a></li>
<li><a href="data-exploration.html#computerized-accounting"><span class="toc-section-number">5.4</span> Computerized accounting</a></li>
<li><a href="data-exploration.html#test-scores-in-two-classes"><span class="toc-section-number">5.5</span> Test scores in two classes</a></li>
<li><a href="data-exploration.html#working-with-dataframes"><span class="toc-section-number">5.6</span> Working with dataframes</a></li>
<li><a href="data-exploration.html#tidying-the-jays-data"><span class="toc-section-number">5.7</span> Tidying the Jays data</a></li>
<li><a href="data-exploration.html#cars"><span class="toc-section-number">5.8</span> Cars</a></li>
</ul></li>
<li><a href="one-sample-inference.html#one-sample-inference"><span class="toc-section-number">6</span> One-sample inference</a>
<ul>
<li><a href="one-sample-inference.html#hunter-gatherers-in-australia"><span class="toc-section-number">6.1</span> Hunter-gatherers in Australia</a></li>
<li><a href="one-sample-inference.html#buses-to-boulder"><span class="toc-section-number">6.2</span> Buses to Boulder</a></li>
<li><a href="one-sample-inference.html#length-of-gestation-in-north-carolina"><span class="toc-section-number">6.3</span> Length of gestation in North Carolina</a></li>
<li><a href="one-sample-inference.html#inferring-ice-break-up-in-nenana"><span class="toc-section-number">6.4</span> Inferring ice break-up in Nenana</a></li>
</ul></li>
<li><a href="two-sample-inference.html#two-sample-inference"><span class="toc-section-number">7</span> Two-sample inference</a>
<ul>
<li><a href="two-sample-inference.html#children-and-electronic-devices"><span class="toc-section-number">7.1</span> Children and electronic devices</a></li>
<li><a href="two-sample-inference.html#parking-close-to-the-curb"><span class="toc-section-number">7.2</span> Parking close to the curb</a></li>
<li><a href="two-sample-inference.html#bell-peppers-and-too-much-water"><span class="toc-section-number">7.3</span> Bell peppers and too much water</a></li>
<li><a href="two-sample-inference.html#exercise-and-anxiety-and-bullying-mice"><span class="toc-section-number">7.4</span> Exercise and anxiety and bullying mice</a></li>
<li><a href="two-sample-inference.html#diet-and-growth-in-boys"><span class="toc-section-number">7.5</span> Diet and growth in boys</a></li>
</ul></li>
<li><a href="power-and-sample-size.html#power-and-sample-size"><span class="toc-section-number">8</span> Power and sample size</a>
<ul>
<li><a href="power-and-sample-size.html#simulating-power"><span class="toc-section-number">8.1</span> Simulating power</a></li>
<li><a href="power-and-sample-size.html#calculating-power-and-sample-size-for-estimating-mean"><span class="toc-section-number">8.2</span> Calculating power and sample size for estimating mean</a></li>
<li><a href="power-and-sample-size.html#simulating-power-for-proportions"><span class="toc-section-number">8.3</span> Simulating power for proportions</a></li>
</ul></li>
<li><a href="the-sign-test-and-moods-median-test.html#the-sign-test-and-moods-median-test"><span class="toc-section-number">9</span> The sign test and Mood’s median test</a>
<ul>
<li><a href="the-sign-test-and-moods-median-test.html#running-a-maze"><span class="toc-section-number">9.1</span> Running a maze</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#chocolate-chips"><span class="toc-section-number">9.2</span> Chocolate chips</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#the-power-of-the-sign-test"><span class="toc-section-number">9.3</span> The power of the sign test</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#sugar-in-breakfast-cereals"><span class="toc-section-number">9.4</span> Sugar in breakfast cereals</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#fear-of-math"><span class="toc-section-number">9.5</span> Fear of math</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#medical-instructions"><span class="toc-section-number">9.6</span> Medical instructions</a></li>
</ul></li>
<li><a href="matched-pairs-t-and-sign-test.html#matched-pairs-t-and-sign-test"><span class="toc-section-number">10</span> Matched pairs t and sign test</a>
<ul>
<li><a href="matched-pairs-t-and-sign-test.html#measuring-body-fat"><span class="toc-section-number">10.1</span> Measuring body fat</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#throwing-baseballs-and-softballs"><span class="toc-section-number">10.2</span> Throwing baseballs and softballs</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#throwing-baseballs-and-softballs-again"><span class="toc-section-number">10.3</span> Throwing baseballs and softballs, again</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#changes-in-salary"><span class="toc-section-number">10.4</span> Changes in salary</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#body-fat-revisited"><span class="toc-section-number">10.5</span> Body fat revisited</a></li>
</ul></li>
<li><a href="normal-quantile-plots.html#normal-quantile-plots"><span class="toc-section-number">11</span> Normal quantile plots</a>
<ul>
<li><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers"><span class="toc-section-number">11.1</span> Lengths of heliconia flowers</a></li>
<li><a href="normal-quantile-plots.html#ferritin-and-normality"><span class="toc-section-number">11.2</span> Ferritin and normality</a></li>
</ul></li>
<li><a href="analysis-of-variance.html#analysis-of-variance"><span class="toc-section-number">12</span> Analysis of variance</a>
<ul>
<li><a href="analysis-of-variance.html#movie-ratings-and-lengths"><span class="toc-section-number">12.1</span> Movie ratings and lengths</a></li>
<li><a href="analysis-of-variance.html#deer-and-how-much-they-eat"><span class="toc-section-number">12.2</span> Deer and how much they eat</a></li>
<li><a href="analysis-of-variance.html#movie-ratings-again"><span class="toc-section-number">12.3</span> Movie ratings again</a></li>
<li><a href="analysis-of-variance.html#atomic-weight-of-carbon"><span class="toc-section-number">12.4</span> Atomic weight of carbon</a></li>
<li><a href="analysis-of-variance.html#can-caffeine-improve-your-performance-on-a-test"><span class="toc-section-number">12.5</span> Can caffeine improve your performance on a test?</a></li>
</ul></li>
<li><a href="tidying-data.html#tidying-data"><span class="toc-section-number">13</span> Tidying data</a>
<ul>
<li><a href="tidying-data.html#baseball-and-softball-spaghetti"><span class="toc-section-number">13.1</span> Baseball and softball spaghetti</a></li>
<li><a href="tidying-data.html#ethanol-and-sleep-time-in-rats"><span class="toc-section-number">13.2</span> Ethanol and sleep time in rats</a></li>
<li><a href="tidying-data.html#growth-of-tomatoes"><span class="toc-section-number">13.3</span> Growth of tomatoes</a></li>
<li><a href="tidying-data.html#pain-relief-in-migraine-headaches-again"><span class="toc-section-number">13.4</span> Pain relief in migraine headaches (again)</a></li>
<li><a href="tidying-data.html#location-species-and-disease-in-plants"><span class="toc-section-number">13.5</span> Location, species and disease in plants</a></li>
<li><a href="tidying-data.html#mating-songs-in-crickets"><span class="toc-section-number">13.6</span> Mating songs in crickets</a></li>
<li><a href="tidying-data.html#number-1-songs"><span class="toc-section-number">13.7</span> Number 1 songs</a></li>
<li><a href="tidying-data.html#bikes-on-college"><span class="toc-section-number">13.8</span> Bikes on College</a></li>
<li><a href="tidying-data.html#feeling-the-heat"><span class="toc-section-number">13.9</span> Feeling the heat</a></li>
</ul></li>
<li><a href="regression.html#regression"><span class="toc-section-number">14</span> Regression</a>
<ul>
<li><a href="regression.html#rainfall-in-california"><span class="toc-section-number">14.1</span> Rainfall in California</a></li>
<li><a href="regression.html#carbon-monoxide-in-cigarettes"><span class="toc-section-number">14.2</span> Carbon monoxide in cigarettes</a></li>
<li><a href="regression.html#maximal-oxygen-uptake-in-young-boys"><span class="toc-section-number">14.3</span> Maximal oxygen uptake in young boys</a></li>
<li><a href="regression.html#facebook-friends-and-grey-matter"><span class="toc-section-number">14.4</span> Facebook friends and grey matter</a></li>
<li><a href="regression.html#endogenous-nitrogen-excretion-in-carp"><span class="toc-section-number">14.5</span> Endogenous nitrogen excretion in carp</a></li>
<li><a href="regression.html#sparrowhawks"><span class="toc-section-number">14.6</span> Sparrowhawks</a></li>
<li><a href="regression.html#salaries-of-social-workers"><span class="toc-section-number">14.7</span> Salaries of social workers</a></li>
<li><a href="regression.html#predicting-volume-of-wood-in-pine-trees"><span class="toc-section-number">14.8</span> Predicting volume of wood in pine trees</a></li>
<li><a href="regression.html#tortoise-shells-and-eggs"><span class="toc-section-number">14.9</span> Tortoise shells and eggs</a></li>
<li><a href="regression.html#crickets-revisited"><span class="toc-section-number">14.10</span> Crickets revisited</a></li>
<li><a href="regression.html#roller-coasters"><span class="toc-section-number">14.11</span> Roller coasters</a></li>
<li><a href="regression.html#running-and-blood-sugar"><span class="toc-section-number">14.12</span> Running and blood sugar</a></li>
<li><a href="regression.html#calories-and-fat-in-pizza"><span class="toc-section-number">14.13</span> Calories and fat in pizza</a></li>
<li><a href="regression.html#where-should-the-fire-stations-be"><span class="toc-section-number">14.14</span> Where should the fire stations be?</a></li>
<li><a href="regression.html#being-satisfied-with-hospital"><span class="toc-section-number">14.15</span> Being satisfied with hospital</a></li>
<li><a href="regression.html#handling-shipments-of-chemicals"><span class="toc-section-number">14.16</span> Handling shipments of chemicals</a></li>
<li><a href="regression.html#salaries-of-mathematicians"><span class="toc-section-number">14.17</span> Salaries of mathematicians</a></li>
<li><a href="regression.html#predicting-gpa-of-computer-science-students"><span class="toc-section-number">14.18</span> Predicting GPA of computer science students</a></li>
</ul></li>
<li><a href="dates-and-times.html#dates-and-times"><span class="toc-section-number">15</span> Dates and times</a>
<ul>
<li><a href="dates-and-times.html#dealing-with-dates-in-the-worcester-heart-attack-study"><span class="toc-section-number">15.1</span> Dealing with dates in the Worcester Heart Attack study</a></li>
<li><a href="dates-and-times.html#growth-of-mizuna-lettuce-seeds"><span class="toc-section-number">15.2</span> Growth of Mizuna lettuce seeds</a></li>
<li><a href="dates-and-times.html#types-of-childbirth"><span class="toc-section-number">15.3</span> Types of childbirth</a></li>
<li><a href="dates-and-times.html#wolves-and-caribou"><span class="toc-section-number">15.4</span> Wolves and caribou</a></li>
</ul></li>
<li><a href="functions.html#functions"><span class="toc-section-number">16</span> Functions</a>
<ul>
<li><a href="functions.html#making-some-r-functions"><span class="toc-section-number">16.1</span> Making some R functions</a></li>
<li><a href="functions.html#the-collatz-sequence"><span class="toc-section-number">16.2</span> The Collatz sequence</a></li>
</ul></li>
<li><a href="the-bootstrap.html#the-bootstrap"><span class="toc-section-number">17</span> The Bootstrap</a>
<ul>
<li><a href="the-bootstrap.html#air-conditioning-failures"><span class="toc-section-number">17.1</span> Air conditioning failures</a></li>
<li><a href="the-bootstrap.html#air-conditioning-failures-bootstrapping-the-median"><span class="toc-section-number">17.2</span> Air conditioning failures: bootstrapping the median</a></li>
</ul></li>
<li><a href="bayesian-statistics-with-stan.html#bayesian-statistics-with-stan"><span class="toc-section-number">18</span> Bayesian Statistics with Stan</a>
<ul>
<li><a href="bayesian-statistics-with-stan.html#estimating-proportion-in-favour-from-a-survey"><span class="toc-section-number">18.1</span> Estimating proportion in favour from a survey</a></li>
<li><a href="bayesian-statistics-with-stan.html#bayesian-regression"><span class="toc-section-number">18.2</span> Bayesian regression</a></li>
</ul></li>
<li><a href="logistic-regression.html#logistic-regression"><span class="toc-section-number">19</span> Logistic regression</a>
<ul>
<li><a href="logistic-regression.html#finding-wolf-spiders-on-the-beach"><span class="toc-section-number">19.1</span> Finding wolf spiders on the beach</a></li>
<li><a href="logistic-regression.html#killing-aphids"><span class="toc-section-number">19.2</span> Killing aphids</a></li>
<li><a href="logistic-regression.html#the-effects-of-substance-a"><span class="toc-section-number">19.3</span> The effects of Substance A</a></li>
<li><a href="logistic-regression.html#what-makes-an-animal-get-infected"><span class="toc-section-number">19.4</span> What makes an animal get infected?</a></li>
<li><a href="logistic-regression.html#the-brain-of-a-cat"><span class="toc-section-number">19.5</span> The brain of a cat</a></li>
<li><a href="logistic-regression.html#how-not-to-get-heart-disease"><span class="toc-section-number">19.6</span> How not to get heart disease</a></li>
<li><a href="logistic-regression.html#successful-breastfeeding"><span class="toc-section-number">19.7</span> Successful breastfeeding</a></li>
<li><a href="logistic-regression.html#making-it-over-the-mountains"><span class="toc-section-number">19.8</span> Making it over the mountains</a></li>
<li><a href="logistic-regression.html#who-needs-the-most-intensive-care"><span class="toc-section-number">19.9</span> Who needs the most intensive care?</a></li>
<li><a href="logistic-regression.html#go-away-and-dont-come-back"><span class="toc-section-number">19.10</span> Go away and don’t come back!</a></li>
</ul></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#logistic-regression-with-ordinal-or-nominal-response"><span class="toc-section-number">20</span> Logistic regression with ordinal or nominal response</a>
<ul>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#do-you-like-your-mobile-phone"><span class="toc-section-number">20.1</span> Do you like your mobile phone?</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#attitudes-towards-abortion"><span class="toc-section-number">20.2</span> Attitudes towards abortion</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#finding-non-missing-values"><span class="toc-section-number">20.3</span> Finding non-missing values</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#european-social-survey-and-voting"><span class="toc-section-number">20.4</span> European Social Survey and voting</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#alligator-food"><span class="toc-section-number">20.5</span> Alligator food</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#how-do-you-like-your-steak-the-data"><span class="toc-section-number">20.6</span> How do you like your steak – the data</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#crimes-in-san-francisco-the-data"><span class="toc-section-number">20.7</span> Crimes in San Francisco – the data</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#how-do-you-like-your-steak"><span class="toc-section-number">20.8</span> How do you like your steak?</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#crimes-in-san-francisco"><span class="toc-section-number">20.9</span> Crimes in San Francisco</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#high-school-and-beyond"><span class="toc-section-number">20.10</span> High School and Beyond</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#what-sports-do-these-athletes-play"><span class="toc-section-number">20.11</span> What sports do these athletes play?</a></li>
</ul></li>
<li><a href="survival-analysis.html#survival-analysis"><span class="toc-section-number">21</span> Survival analysis</a>
<ul>
<li><a href="survival-analysis.html#the-worcester-survey"><span class="toc-section-number">21.1</span> The Worcester survey</a></li>
<li><a href="survival-analysis.html#drug-treatment-programs"><span class="toc-section-number">21.2</span> Drug treatment programs</a></li>
<li><a href="survival-analysis.html#multiple-myeloma"><span class="toc-section-number">21.3</span> Multiple myeloma</a></li>
<li><a href="survival-analysis.html#ovarian-cancer"><span class="toc-section-number">21.4</span> Ovarian cancer</a></li>
</ul></li>
<li><a href="analysis-of-variance-revisited.html#analysis-of-variance-revisited"><span class="toc-section-number">22</span> Analysis of variance revisited</a>
<ul>
<li><a href="analysis-of-variance-revisited.html#acid-rain"><span class="toc-section-number">22.1</span> Acid rain</a></li>
<li><a href="analysis-of-variance-revisited.html#treating-hay-fever"><span class="toc-section-number">22.2</span> Treating hay fever</a></li>
<li><a href="analysis-of-variance-revisited.html#focused-comparisons-of-the-effect-of-caffeine"><span class="toc-section-number">22.3</span> Focused comparisons of the effect of caffeine</a></li>
<li><a href="analysis-of-variance-revisited.html#who-studies-the-most-outside-class"><span class="toc-section-number">22.4</span> Who studies the most outside class?</a></li>
<li><a href="analysis-of-variance-revisited.html#mental-context"><span class="toc-section-number">22.5</span> Mental context</a></li>
<li><a href="analysis-of-variance-revisited.html#trying-on-shirts"><span class="toc-section-number">22.6</span> Trying on shirts</a></li>
<li><a href="analysis-of-variance-revisited.html#productivity-and-research-and-development"><span class="toc-section-number">22.7</span> Productivity and research-and-development</a></li>
<li><a href="analysis-of-variance-revisited.html#treating-leprosy"><span class="toc-section-number">22.8</span> Treating leprosy</a></li>
</ul></li>
<li><a href="multivariate-analysis-of-variance.html#multivariate-analysis-of-variance"><span class="toc-section-number">23</span> Multivariate analysis of variance</a>
<ul>
<li><a href="multivariate-analysis-of-variance.html#fabricated-data"><span class="toc-section-number">23.1</span> Fabricated data</a></li>
<li><a href="multivariate-analysis-of-variance.html#do-characteristics-of-urine-depend-on-obesity"><span class="toc-section-number">23.2</span> Do characteristics of urine depend on obesity?</a></li>
<li><a href="multivariate-analysis-of-variance.html#how-do-height-and-weight-depend-on-sport-played-by-elite-athletes"><span class="toc-section-number">23.3</span> How do height and weight depend on sport played by elite athletes?</a></li>
</ul></li>
<li><a href="repeated-measures.html#repeated-measures"><span class="toc-section-number">24</span> Repeated measures</a>
<ul>
<li><a href="repeated-measures.html#effect-of-drug-on-rat-weight"><span class="toc-section-number">24.1</span> Effect of drug on rat weight</a></li>
<li><a href="repeated-measures.html#social-interaction-among-old-people"><span class="toc-section-number">24.2</span> Social interaction among old people</a></li>
<li><a href="repeated-measures.html#childrens-stress-levels-and-airports"><span class="toc-section-number">24.3</span> Children’s stress levels and airports</a></li>
<li><a href="repeated-measures.html#body-fat-as-repeated-measures"><span class="toc-section-number">24.4</span> Body fat as repeated measures</a></li>
<li><a href="repeated-measures.html#investigating-motor-activity-in-rats"><span class="toc-section-number">24.5</span> Investigating motor activity in rats</a></li>
<li><a href="repeated-measures.html#repeated-measures-with-no-background"><span class="toc-section-number">24.6</span> Repeated measures with no background</a></li>
</ul></li>
<li><a href="discriminant-analysis.html#discriminant-analysis"><span class="toc-section-number">25</span> Discriminant analysis</a>
<ul>
<li><a href="discriminant-analysis.html#telling-whether-a-banknote-is-real-or-counterfeit"><span class="toc-section-number">25.1</span> Telling whether a banknote is real or counterfeit</a></li>
<li><a href="discriminant-analysis.html#urine-and-obesity-what-makes-a-difference"><span class="toc-section-number">25.2</span> Urine and obesity: what makes a difference?</a></li>
<li><a href="discriminant-analysis.html#understanding-a-manova"><span class="toc-section-number">25.3</span> Understanding a MANOVA</a></li>
<li><a href="discriminant-analysis.html#what-distinguishes-people-who-do-different-jobs"><span class="toc-section-number">25.4</span> What distinguishes people who do different jobs?</a></li>
<li><a href="discriminant-analysis.html#observing-children-with-adhd"><span class="toc-section-number">25.5</span> Observing children with ADHD</a></li>
<li><a href="discriminant-analysis.html#growing-corn"><span class="toc-section-number">25.6</span> Growing corn</a></li>
<li><a href="discriminant-analysis.html#understanding-athletes-height-weight-sport-and-gender"><span class="toc-section-number">25.7</span> Understanding athletes’ height, weight, sport and gender</a></li>
</ul></li>
<li><a href="cluster-analysis.html#cluster-analysis"><span class="toc-section-number">26</span> Cluster analysis</a>
<ul>
<li><a href="cluster-analysis.html#sites-on-the-sea-bed"><span class="toc-section-number">26.1</span> Sites on the sea bed</a></li>
<li><a href="cluster-analysis.html#dissimilarities-between-fruits"><span class="toc-section-number">26.2</span> Dissimilarities between fruits</a></li>
<li><a href="cluster-analysis.html#similarity-of-species"><span class="toc-section-number">26.3</span> Similarity of species</a></li>
<li><a href="cluster-analysis.html#rating-beer"><span class="toc-section-number">26.4</span> Rating beer</a></li>
<li><a href="cluster-analysis.html#clustering-the-swiss-bills"><span class="toc-section-number">26.5</span> Clustering the Swiss bills</a></li>
<li><a href="cluster-analysis.html#grouping-similar-cars"><span class="toc-section-number">26.6</span> Grouping similar cars</a></li>
<li><a href="cluster-analysis.html#running-jumping-and-throwing"><span class="toc-section-number">26.7</span> Running, jumping, and throwing</a></li>
<li><a href="cluster-analysis.html#bridges-in-pittsburgh"><span class="toc-section-number">26.8</span> Bridges in Pittsburgh</a></li>
<li><a href="cluster-analysis.html#clustering-the-australian-athletes"><span class="toc-section-number">26.9</span> Clustering the Australian athletes</a></li>
</ul></li>
<li><a href="drawing-maps-with-leaflet.html#drawing-maps-with-leaflet"><span class="toc-section-number">27</span> Drawing maps with Leaflet</a>
<ul>
<li><a href="drawing-maps-with-leaflet.html#the-brain-of-a-cat-revisited"><span class="toc-section-number">27.1</span> The brain of a cat, revisited</a></li>
<li><a href="drawing-maps-with-leaflet.html#making-a-map-of-wisconsin"><span class="toc-section-number">27.2</span> Making a map of Wisconsin</a></li>
</ul></li>
<li><a href="multidimensional-scaling.html#multidimensional-scaling"><span class="toc-section-number">28</span> Multidimensional Scaling</a>
<ul>
<li><a href="multidimensional-scaling.html#making-a-map-of-wisconsin-1"><span class="toc-section-number">28.1</span> Making a map of Wisconsin</a></li>
<li><a href="multidimensional-scaling.html#things-that-feel-similar-to-each-other"><span class="toc-section-number">28.2</span> Things that feel similar to each other</a></li>
<li><a href="multidimensional-scaling.html#confusing-letters"><span class="toc-section-number">28.3</span> Confusing letters</a></li>
<li><a href="multidimensional-scaling.html#more-beer-please"><span class="toc-section-number">28.4</span> More beer please</a></li>
<li><a href="multidimensional-scaling.html#feeling-similar-again"><span class="toc-section-number">28.5</span> Feeling similar, again</a></li>
</ul></li>
<li><a href="principal-components-and-factor-analysis.html#principal-components-and-factor-analysis"><span class="toc-section-number">29</span> Principal Components and Factor Analysis</a>
<ul>
<li><a href="principal-components-and-factor-analysis.html#the-weather-somewhere"><span class="toc-section-number">29.1</span> The weather, somewhere</a></li>
<li><a href="principal-components-and-factor-analysis.html#air-pollution"><span class="toc-section-number">29.2</span> Air pollution</a></li>
<li><a href="principal-components-and-factor-analysis.html#a-correlation-matrix"><span class="toc-section-number">29.3</span> A correlation matrix</a></li>
<li><a href="principal-components-and-factor-analysis.html#the-interpersonal-circumplex"><span class="toc-section-number">29.4</span> The Interpersonal Circumplex</a></li>
</ul></li>
<li><a href="frequency-table-analysis.html#frequency-table-analysis"><span class="toc-section-number">30</span> Frequency table analysis</a>
<ul>
<li><a href="frequency-table-analysis.html#college-plans"><span class="toc-section-number">30.1</span> College plans</a></li>
<li><a href="frequency-table-analysis.html#predicting-voting"><span class="toc-section-number">30.2</span> Predicting voting</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="power-and-sample-size" class="section level1" number="8">
<h1><span class="header-section-number">Chapter 8</span> Power and sample size</h1>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="power-and-sample-size.html#cb338-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<div id="simulating-power" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Simulating power</h2>
<p>This question investigates power by
simulation.</p>
<ol style="list-style-type: lower-alpha">
<li>Use <code>rnorm</code> to generate 10 random values from a
normal distribution with mean 20 and SD 2. Do your values look
reasonable? Explain briefly. (You don’t need to draw a graph.)</li>
</ol>
<p>Solution</p>
<p><code>rnorm</code> with the number of values first, then the mean,
then the SD:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="power-and-sample-size.html#cb339-1"></a>x=<span class="kw">rnorm</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">2</span>)</span>
<span id="cb339-2"><a href="power-and-sample-size.html#cb339-2"></a>x</span></code></pre></div>
<pre><code>##  [1] 21.59476 18.64044 21.83231 18.76556 18.64861 21.81889 21.62614 20.18249 16.91266
## [10] 20.63490</code></pre>
<p>95% of the sampled values should be within 2 SDs of the mean, that
is, between 16 and 24 (or 99.7% should be within 3 SDs of the mean,
between 14 and 26). None of my values are even outside the interval 16
to 24, though yours may be different.</p>
<p>I saved mine in a variable and then displayed them, which you don’t
need to do. I did because there’s another way of assessing them for
reasonableness: turn the sample into <span class="math inline">\(z\)</span>-scores and see whether the
values you get look like <span class="math inline">\(z\)</span>-scores (that is, most of them are between
<span class="math inline">\(-2\)</span> and 2, for example):</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="power-and-sample-size.html#cb341-1"></a>(x<span class="dv">-20</span>)<span class="op">/</span><span class="dv">2</span></span></code></pre></div>
<pre><code>##  [1]  0.79738130 -0.67977910  0.91615386 -0.61722168 -0.67569291  0.90944266
##  [7]  0.81307163  0.09124563 -1.54367207  0.31744905</code></pre>
<p>These ones look very much like <span class="math inline">\(z\)</span>-scores. This, if you think about
it, is really the flip-side of 68–95–99.7, so it’s another way of
implementing the same idea.</p>
<p>You might also think of finding the <em>sample</em> mean and SD, and
demonstrating that they are close to the right answers. Mine are:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="power-and-sample-size.html#cb343-1"></a><span class="kw">mean</span>(x)</span></code></pre></div>
<pre><code>## [1] 20.06568</code></pre>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="power-and-sample-size.html#cb345-1"></a><span class="kw">sd</span>(x)</span></code></pre></div>
<pre><code>## [1] 1.731305</code></pre>
<p>The sample SD is more variable than the sample mean, so it can get
further away from the population SD than the sample mean does from the
population mean.</p>
<p>The downside to this idea is that it doesn’t get at
assessing the normality, which looking at <span class="math inline">\(z\)</span>-scores or equivalent
does. Maybe coupling the above with a boxplot would have helped, had I
not said “no graphs”, since then you’d (hopefully) see no outliers
and a roughly symmetric shape.</p>
<p>This is old-fashioned “base R” technology; you could do it with a
data frame like this:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="power-and-sample-size.html#cb347-1"></a>d=<span class="kw">tibble</span>(<span class="dt">x=</span><span class="kw">rnorm</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">2</span>))</span>
<span id="cb347-2"><a href="power-and-sample-size.html#cb347-2"></a>d</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["x"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"20.57935"},{"1":"19.26708"},{"1":"20.19318"},{"1":"18.67661"},{"1":"21.29402"},{"1":"17.80969"},{"1":"19.83071"},{"1":"20.92705"},{"1":"21.65211"},{"1":"20.62795"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="power-and-sample-size.html#cb348-1"></a>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">m=</span><span class="kw">mean</span>(x), <span class="dt">s=</span><span class="kw">sd</span>(x))</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["m"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["s"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"20.08577","2":"1.205163"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>These are different random numbers, but are about equally what you’d
expect. (These ones are a bit less variable than you’d expect, but
with only ten values, don’t expect perfection.)</p>
<p>Some discussion about the kind of values you should get, and whether
or not you get them, is what is called for here. I want you to say
something convincing about how the values you get come from a normal
distribution with mean 20 <em>and</em> SD 2. “Close to 20” is not the
whole answer here, because that doesn’t get at “how close to 20?”:
that is, it talks about the mean but not about the SD.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Estimate by simulation the power of a <span class="math inline">\(t\)</span>-test to reject a
null hypothesis of 20 when the true mean is also 20, the
population SD is 2, and the sample size is 10, against a (default)
two-sided alternative. Remember the
steps: (i) generate a lot of random samples from the true
distribution, (ii) run the <span class="math inline">\(t\)</span>-test with the required null mean, (iii) pull out the P-values, (iv) count how many of them are 0.05
or less.</li>
</ol>
<p>Solution</p>
<p>Once you get the hang of these, they all look almost the
same. This one is easier than some because we don’t have to do
anything special to get a two-sided alternative hypothesis. The initial setup is to make a dataframe with a column called something like <code>sim</code> to label the simulations, and then a <code>rowwise</code> to generate one random sample, <span class="math inline">\(t\)</span>-test and P-value for each simulation:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="power-and-sample-size.html#cb349-1"></a><span class="kw">tibble</span>(<span class="dt">sim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb349-2"><a href="power-and-sample-size.html#cb349-2"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb349-3"><a href="power-and-sample-size.html#cb349-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">norm_sample =</span> <span class="kw">list</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">2</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb349-4"><a href="power-and-sample-size.html#cb349-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">t_test =</span> <span class="kw">list</span>(<span class="kw">t.test</span>(norm_sample, <span class="dt">mu =</span> <span class="dv">20</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb349-5"><a href="power-and-sample-size.html#cb349-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pval =</span> t_test<span class="op">$</span>p.value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb349-6"><a href="power-and-sample-size.html#cb349-6"></a><span class="st">  </span><span class="kw">count</span>(pval <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["pval <= 0.05"],"name":[1],"type":["lgl"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"FALSE","2":"958"},{"1":"TRUE","2":"42"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The power is about 4.2%. This seems depressingly small, but see the
next part. (Are you confused about something in this one? You have a right to be.)</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>In the simulation you just did, was the null hypothesis true
or false? Do you want to reject the null hypothesis or not?
Explain briefly why the simulation results you got were (or were
not) about what you would expect.</li>
</ol>
<p>Solution</p>
<p>The null mean and the true mean were both 20: that is, the
null hypothesis was correct, and rejecting it would be a
mistake, to be precise a type I error. We were doing the test
at <span class="math inline">\(\alpha=0.05\)</span> (by comparing our collection of simulated
P-values with 0.05), so we should be making a type I error 5%
of the time. This is entirely in line with the 4.2% of
(wrong) rejections that I had.
Your estimation is likely to be different from mine, but you
should be rejecting about 5% of the time. If your result is
very different from 5%, that’s an invitation to go back and
check your code. On the other hand, if it <em>is</em> about 5%,
that ought to give you confidence to go on and use the same
ideas for the next part.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>By copying, pasting and editing your code from the previous
part, estimate the power of the test of <span class="math inline">\(H_0: \mu=20\)</span> (against a
two-sided alternative) when the true population mean is 22 (rather
than 20).</li>
</ol>
<p>Solution</p>
<p>Here’s the code we just used:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="power-and-sample-size.html#cb350-1"></a><span class="kw">tibble</span>(<span class="dt">sim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb350-2"><a href="power-and-sample-size.html#cb350-2"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb350-3"><a href="power-and-sample-size.html#cb350-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">norm_sample =</span> <span class="kw">list</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">2</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb350-4"><a href="power-and-sample-size.html#cb350-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">t_test =</span> <span class="kw">list</span>(<span class="kw">t.test</span>(norm_sample, <span class="dt">mu =</span> <span class="dv">20</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb350-5"><a href="power-and-sample-size.html#cb350-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pval =</span> t_test<span class="op">$</span>p.value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb350-6"><a href="power-and-sample-size.html#cb350-6"></a><span class="st">  </span><span class="kw">count</span>(pval <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>)</span></code></pre></div>
<p>One of those 20s needs to become 22. Not the one in the
<code>t.test</code>, since the hypotheses have not changed. So we need to
change the 20 in the <code>rnorm</code> line to 22, since that’s where
we’re generating data from the true distribution. The rest of it stays
the same:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="power-and-sample-size.html#cb351-1"></a><span class="kw">tibble</span>(<span class="dt">sim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb351-2"><a href="power-and-sample-size.html#cb351-2"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb351-3"><a href="power-and-sample-size.html#cb351-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">norm_sample =</span> <span class="kw">list</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">2</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb351-4"><a href="power-and-sample-size.html#cb351-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">t_test =</span> <span class="kw">list</span>(<span class="kw">t.test</span>(norm_sample, <span class="dt">mu =</span> <span class="dv">22</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb351-5"><a href="power-and-sample-size.html#cb351-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pval =</span> t_test<span class="op">$</span>p.value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb351-6"><a href="power-and-sample-size.html#cb351-6"></a><span class="st">  </span><span class="kw">count</span>(pval <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["pval <= 0.05"],"name":[1],"type":["lgl"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"FALSE","2":"192"},{"1":"TRUE","2":"808"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This time, we <em>want</em> to reject, since the null hypothesis is
false. So look at the <code>TRUE</code> count: the power is about
<span class="math inline">\(80\%\)</span>. We are very likely to correctly reject a null
of 20 when the mean is actually 22.</p>
<p>Extra: another way to reason that the power should be fairly large is to
think about what kind of sample you are likely to get from the true
distribution: one with a mean around 22 and an SD around 2. Thus the
<span class="math inline">\(t\)</span>-statistic should be somewhere around this (we have a sample size
of 10):</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="power-and-sample-size.html#cb352-1"></a>t_stat=(<span class="dv">22-20</span>)<span class="op">/</span>(<span class="dv">2</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">10</span>))</span>
<span id="cb352-2"><a href="power-and-sample-size.html#cb352-2"></a>t_stat</span></code></pre></div>
<pre><code>## [1] 3.162278</code></pre>
<p>and the two-sided P-value should be about</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="power-and-sample-size.html#cb354-1"></a><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">pt</span>(t_stat,<span class="dv">10-1</span>))</span></code></pre></div>
<pre><code>## [1] 0.01150799</code></pre>
<p>Of course, with your actual data, you will sometimes be less lucky
than this (a sample mean nearer 20 or a larger sample SD), but
sometimes you will be luckier. But the suggestion is that most of the
time, the P-value will be pretty small and you will end up correctly
rejecting.</p>
<p>The quantity <code>t_stat</code> above, 3.16, is known to some
people as an “effect size”, and summarizes how far apart the null
and true means are, relative to the amount of variability present (in
the sampling distribution of the sample mean). As effect sizes go,
this one is pretty large.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Use R to calculate this power exactly (without
simulation). Compare the exact result with your simulation.</li>
</ol>
<p>Solution</p>
<p>This is <code>power.t.test</code>. The quantity <code>delta</code> is
the difference between true and null means:</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="power-and-sample-size.html#cb356-1"></a><span class="kw">power.t.test</span>(<span class="dt">n=</span><span class="dv">10</span>,<span class="dt">delta=</span><span class="dv">22-20</span>,<span class="dt">sd=</span><span class="dv">2</span>,<span class="dt">type=</span><span class="st">&quot;one.sample&quot;</span>,<span class="dt">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##      One-sample t test power calculation 
## 
##               n = 10
##           delta = 2
##              sd = 2
##       sig.level = 0.05
##           power = 0.8030962
##     alternative = two.sided</code></pre>
<p>This, 0.803, is very close to the value I got from my
simulation. Which makes me think I did them both right. This is not a watertight proof, though: for example, I might have made a mistake and gotten lucky somewhere. But it does at least give me confidence.</p>
<p>Extra: when you estimate power by simulation, what you are doing is
rejecting or not with a certain probability (which is the same for all
simulations). So the number of times you actually <em>do</em> reject has
a binomial distribution with <span class="math inline">\(n\)</span> equal to the number of simulated
P-values you got (1000 in my case; you could do more) and a <span class="math inline">\(p\)</span> that
the simulation is trying to estimate. This is inference for a
proportion, exactly what <code>prop.test</code> does.</p>
<p>Recall that <code>prop.test</code> has as input:</p>
<ul>
<li><p>a number of “successes” (rejections of the null in our case)</p></li>
<li><p>the number of trials (simulated tests)</p></li>
<li><p>the null-hypothesis value of <code>p</code> (optional if you only
want a CI)</p></li>
<li><p>(optional) a confidence level <code>conf.level</code>.</p></li>
</ul>
<p>In part (b), we knew that the probability of
(incorrectly) rejecting should have been 0.05 and we rejected 42 times
out of 1000:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="power-and-sample-size.html#cb358-1"></a><span class="kw">prop.test</span>(<span class="dv">42</span>,<span class="dv">1000</span>,<span class="fl">0.05</span>)</span></code></pre></div>
<pre><code>## 
##  1-sample proportions test with continuity correction
## 
## data:  42 out of 1000, null probability 0.05
## X-squared = 1.1842, df = 1, p-value = 0.2765
## alternative hypothesis: true p is not equal to 0.05
## 95 percent confidence interval:
##  0.03079269 0.05685194
## sample estimates:
##     p 
## 0.042</code></pre>
<p>** check that the values are correct below **</p>
<p>Looking at the P-value, we definitely fail to reject that the
probability of (incorrectly) rejecting is the 0.05 that it should
be. Ouch. That’s true, but unnecessarily confusing. Look at the
confidence interval instead, 0.031 to 0.057. The right answer is 0.05,
which is inside that interval, so good.</p>
<p>In part (c), we didn’t know what the power was going
to be (not until we calculated it with <code>power.t.test</code>, anyway),
so we go straight for a confidence interval; the default 95% confidence
level is fine. We (correctly) rejected 798 times out of 1000:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="power-and-sample-size.html#cb360-1"></a><span class="kw">prop.test</span>(<span class="dv">798</span>,<span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## 
##  1-sample proportions test with continuity correction
## 
## data:  798 out of 1000, null probability 0.5
## X-squared = 354.02, df = 1, p-value &lt; 2.2e-16
## alternative hypothesis: true p is not equal to 0.5
## 95 percent confidence interval:
##  0.7714759 0.8221976
## sample estimates:
##     p 
## 0.798</code></pre>
<p>I left out the 3rd input since we’re not doing a test, and ignore the
P-value that comes out. (The default null proportion is 0.5, which
often makes sense, but not here.)</p>
<p>According to the confidence interval, the estimated power is between
0.771 and 0.822. This interval definitely includes what we now know is
the right answer of 0.803.</p>
<p>This might be an accurate enough assessment of the power for you, but
if not, you can do more simulations, say 10,000:</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="power-and-sample-size.html#cb362-1"></a><span class="kw">tibble</span>(<span class="dt">sim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb362-2"><a href="power-and-sample-size.html#cb362-2"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb362-3"><a href="power-and-sample-size.html#cb362-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">norm_sample =</span> <span class="kw">list</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">2</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb362-4"><a href="power-and-sample-size.html#cb362-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">t_test =</span> <span class="kw">list</span>(<span class="kw">t.test</span>(norm_sample, <span class="dt">mu =</span> <span class="dv">22</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb362-5"><a href="power-and-sample-size.html#cb362-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pval =</span> t_test<span class="op">$</span>p.value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb362-6"><a href="power-and-sample-size.html#cb362-6"></a><span class="st">  </span><span class="kw">count</span>(pval <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["pval <= 0.05"],"name":[1],"type":["lgl"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"FALSE","2":"1923"},{"1":"TRUE","2":"8077"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>I copied and pasted my code again, which means that I’m dangerously
close to turning it into a function, but anyway.</p>
<p>The confidence interval for the power is then</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="power-and-sample-size.html#cb363-1"></a><span class="kw">prop.test</span>(<span class="dv">7996</span>,<span class="dv">10000</span>)</span></code></pre></div>
<pre><code>## 
##  1-sample proportions test with continuity correction
## 
## data:  7996 out of 10000, null probability 0.5
## X-squared = 3589.2, df = 1, p-value &lt; 2.2e-16
## alternative hypothesis: true p is not equal to 0.5
## 95 percent confidence interval:
##  0.7915892 0.8073793
## sample estimates:
##      p 
## 0.7996</code></pre>
<p>that is, from 0.792 to 0.807, which once again includes the right
answer of 0.803. The first interval, based on 1,000 simulations, has
length 0.051, while this interval has length 0.015. The first
interval is more than three times as long as the second, which is
about what you’d expect since the first one is based on 10 times fewer
simulations, and thus ought to be a factor of <span class="math inline">\(\sqrt{10}\simeq 3.16\)</span>
times longer.</p>
<p>This means that you can estimate power as accurately as you like by
doing a large enough (possibly very large) number of simulations. Provided, that is, that
you are prepared to wait a possibly long time for it to finish working!</p>
</div>
<div id="calculating-power-and-sample-size-for-estimating-mean" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Calculating power and sample size for estimating mean</h2>
<p>We are planning a study to estimate a population mean. The
population standard deviation is believed to be 20, and the population
distribution is believed to be approximately normal. We will be
testing the null hypothesis that the population mean is 100. Suppose
the population mean is actually 110, and we want to determine how
likely we are to (correctly) reject the null hypothesis in this case,
using a two-sided (but one-sample) test with <span class="math inline">\(\alpha=0.05\)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li>We will take a sample of size <span class="math inline">\(n=30\)</span>. Calculate the power of
this test.</li>
</ol>
<p>Solution</p>
<p><code>power.t.test</code>. Fill in: sample size <code>n</code>, difference
in means <code>delta</code> (<span class="math inline">\(10=110-100\)</span>), population SD <code>sd</code>,
type of test <code>type</code> (<code>one.sample</code>) and kind of
alternative hypothesis <code>alternative</code>
(<code>two.sided</code>). Leave out <code>power</code> since that’s what
we want:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="power-and-sample-size.html#cb365-1"></a><span class="kw">power.t.test</span>(<span class="dt">n=</span><span class="dv">30</span>,<span class="dt">delta=</span><span class="dv">10</span>,<span class="dt">sd=</span><span class="dv">20</span>,<span class="dt">type=</span><span class="st">&quot;one.sample&quot;</span>,<span class="dt">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##      One-sample t test power calculation 
## 
##               n = 30
##           delta = 10
##              sd = 20
##       sig.level = 0.05
##           power = 0.7539627
##     alternative = two.sided</code></pre>
<p>I meant “calculate” exactly rather than “estimate” (by
simulation). Though if you want to, you can do that as well, thus:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="power-and-sample-size.html#cb367-1"></a><span class="kw">tibble</span>(<span class="dt">sim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb367-2"><a href="power-and-sample-size.html#cb367-2"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb367-3"><a href="power-and-sample-size.html#cb367-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">samples =</span> <span class="kw">list</span>(<span class="kw">rnorm</span>(<span class="dv">30</span>, <span class="dv">110</span>, <span class="dv">20</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb367-4"><a href="power-and-sample-size.html#cb367-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ttest =</span> <span class="kw">list</span>(<span class="kw">t.test</span>(samples, <span class="dt">mu=</span> <span class="dv">100</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb367-5"><a href="power-and-sample-size.html#cb367-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pvals =</span> ttest<span class="op">$</span>p.value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb367-6"><a href="power-and-sample-size.html#cb367-6"></a><span class="st">  </span><span class="kw">count</span>(pvals<span class="op">&lt;=</span><span class="fl">0.05</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["pvals <= 0.05"],"name":[1],"type":["lgl"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"FALSE","2":"257"},{"1":"TRUE","2":"743"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>That came out alarmingly close to the exact answer.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Find the sample size necessary to obtain a power
of at least 0.80 under these conditions. What sample size do you
need? Explain briefly how your answer is
consistent with (a).</li>
</ol>
<p>Solution</p>
<p>Again, the implication is “by calculation”.
This time, in <code>power.t.test</code>, put in 0.80 for
<code>power</code> and leave out <code>n</code>. The order of things
doesn’t matter (since I have named everything that’s going into
<code>power.t.test</code>):</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="power-and-sample-size.html#cb368-1"></a><span class="kw">power.t.test</span>(<span class="dt">delta=</span><span class="dv">10</span>,<span class="dt">power=</span><span class="fl">0.80</span>,<span class="dt">sd=</span><span class="dv">20</span>,<span class="dt">type=</span><span class="st">&quot;one.sample&quot;</span>,<span class="dt">alternative=</span><span class="st">&quot;two.sided&quot;</span>)  </span></code></pre></div>
<pre><code>## 
##      One-sample t test power calculation 
## 
##               n = 33.3672
##           delta = 10
##              sd = 20
##       sig.level = 0.05
##           power = 0.8
##     alternative = two.sided</code></pre>
<p>To get sample size for power at least 0.80, we have to round 33.36
<em>up</em> to the next whole number, ie. <span class="math inline">\(n=34\)</span> is needed. (A sample
of size 33 wouldn’t quite have enough power.)</p>
<p>This answer is consistent with (a) because a sample size of 30 gave a
power a bit less than 0.80, and so to increase the power by a little
(0.75 to 0.80),
we had to increase the sample size by a little (30 to 34).</p>
<p>Estimating sample sizes by simulation is tricky, because the sample size
has to be input to the simulation. That means your only strategy is to
try different sample sizes until you find one that gives the right power.</p>
<p>In this case, we know that a sample of size 30 doesn’t give quite
enough power, so we have to up the sample size a bit. How about we try
40? I copied and pasted my code from above and changed 30 to 40:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="power-and-sample-size.html#cb370-1"></a><span class="kw">tibble</span>(<span class="dt">sim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb370-2"><a href="power-and-sample-size.html#cb370-2"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb370-3"><a href="power-and-sample-size.html#cb370-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">samples =</span> <span class="kw">list</span>(<span class="kw">rnorm</span>(<span class="dv">40</span>, <span class="dv">110</span>, <span class="dv">20</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb370-4"><a href="power-and-sample-size.html#cb370-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ttest =</span> <span class="kw">list</span>(<span class="kw">t.test</span>(samples, <span class="dt">mu=</span> <span class="dv">100</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb370-5"><a href="power-and-sample-size.html#cb370-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pvals =</span> ttest<span class="op">$</span>p.value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb370-6"><a href="power-and-sample-size.html#cb370-6"></a><span class="st">  </span><span class="kw">count</span>(pvals<span class="op">&lt;=</span><span class="fl">0.05</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["pvals <= 0.05"],"name":[1],"type":["lgl"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"FALSE","2":"130"},{"1":"TRUE","2":"870"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Now the power is a bit too big, so we don’t need a sample size quite
as big as 40. So probably our next guess would be 35. But before we
copy and paste again, we should be thinking about making a function of
it first, with the sample size as input. Copy-paste once more and edit:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="power-and-sample-size.html#cb371-1"></a>sim_power=<span class="cf">function</span>(n) {</span>
<span id="cb371-2"><a href="power-and-sample-size.html#cb371-2"></a>  <span class="kw">tibble</span>(<span class="dt">sim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb371-3"><a href="power-and-sample-size.html#cb371-3"></a><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb371-4"><a href="power-and-sample-size.html#cb371-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">samples =</span> <span class="kw">list</span>(<span class="kw">rnorm</span>(n, <span class="dv">110</span>, <span class="dv">20</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb371-5"><a href="power-and-sample-size.html#cb371-5"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">ttest =</span> <span class="kw">list</span>(<span class="kw">t.test</span>(samples, <span class="dt">mu=</span> <span class="dv">100</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb371-6"><a href="power-and-sample-size.html#cb371-6"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">pvals =</span> ttest<span class="op">$</span>p.value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb371-7"><a href="power-and-sample-size.html#cb371-7"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb371-8"><a href="power-and-sample-size.html#cb371-8"></a><span class="st">    </span><span class="kw">count</span>(pvals<span class="op">&lt;=</span><span class="fl">0.05</span>)</span>
<span id="cb371-9"><a href="power-and-sample-size.html#cb371-9"></a>}</span></code></pre></div>
<p>In the grand scheme of things, we might want to have the null and true
means, population SD and <span class="math inline">\(\alpha\)</span> be inputs to the function as well,
so that we have a more general tool, but this will do for now.</p>
<p>Let’s run it with a sample size of 35:</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="power-and-sample-size.html#cb372-1"></a><span class="kw">sim_power</span>(<span class="dv">35</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["pvals <= 0.05"],"name":[1],"type":["lgl"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"FALSE","2":"183"},{"1":"TRUE","2":"817"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>and I’m going to call that good. (Because there is randomness in the
estimation of the power, don’t expect to get <em>too</em> close to the
right answer. This one came out a fair bit less than the right answer;
the power for <span class="math inline">\(n=35\)</span> should be a bit <em>more</em> than 0.80.)</p>
<p>Now that you have the software to do it, you can see that figuring out
a sample size like this, at least roughly, won’t take very long: each
one of these simulations takes maybe seconds to run, and all you have
to do is copy and paste the previous one, and edit it to contain the
new sample size before running it again. You’re making the computer
work hard while you lazily sip your coffee, but there’s no harm in
that: programmer’s brain cells are more valuable than computer CPU
cycles, and you might as well save your brain cells for when you
really need them.</p>
<p>You might even think about automating this further. The easiest way, now that we have the function, is something like this:</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="power-and-sample-size.html#cb373-1"></a><span class="kw">tibble</span>(<span class="dt">ns =</span> <span class="kw">seq</span>(<span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb373-2"><a href="power-and-sample-size.html#cb373-2"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb373-3"><a href="power-and-sample-size.html#cb373-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">power_tab =</span> <span class="kw">list</span>(<span class="kw">sim_power</span>(ns))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb373-4"><a href="power-and-sample-size.html#cb373-4"></a><span class="st">  </span><span class="kw">unnest</span>(power_tab) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb373-5"><a href="power-and-sample-size.html#cb373-5"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> <span class="st">`</span><span class="dt">pvals &lt;= 0.05</span><span class="st">`</span>, <span class="dt">values_from =</span> n)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["ns"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["FALSE"],"name":[2],"type":["int"],"align":["right"]},{"label":["TRUE"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"20","2":"402","3":"598"},{"1":"25","2":"321","3":"679"},{"1":"30","2":"258","3":"742"},{"1":"35","2":"188","3":"812"},{"1":"40","2":"132","3":"868"},{"1":"45","2":"100","3":"900"},{"1":"50","2":"89","3":"911"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The business end of this is happening in the first three lines. I wasn’t thinking of this when I originally wrote <code>sim_power</code> to return a dataframe, so there is a bit more fiddling after the simulations are done: I have to <code>unnest</code> to see what the list-column <code>power_tab</code> actually contains, and because of the layout of the output from unnesting <code>sim_power</code> (long format), it looks better if I pivot it wider, so that I can just cast my eye down the TRUE column and see the power increasing as the sample size increases.</p>
<p>You might also think of something like bisection to find the sample size that has power 0.8, but it starts getting tricky because of the randomness; just by chance, it may be that sometimes the simulated power goes <em>down</em> as the sample size goes up. With 1000 simulations each time, it seems that the power ought to hit 80% with a sample size between 30 and 35.</p>
</div>
<div id="simulating-power-for-proportions" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Simulating power for proportions</h2>
<p>In opinion surveys (and other places), we are testing for a
proportion <span class="math inline">\(p\)</span> (for example, the proportion of people agreeing with
some statement). Often, we want to know whether the proportion is
“really” greater than 0.5.
<label for="tufte-mn-29" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-29" class="margin-toggle"><span class="marginnote">That would mean assessing whether an observed proportion could be greater than 0.5 just by chance, or whether it is bigger enough than 0.5 to reject chance as a plausible explanation.</span><br />
That would entail testing a null
<span class="math inline">\(H_0: p=0.5\)</span> against an alternative <span class="math inline">\(H_a: p&gt;0.5\)</span>. This is usually done
by calculating the test statistic
<span class="math display">\[ z = { \hat{p} - 0.5 \over \sqrt{0.25/n}},\]</span>
where <span class="math inline">\(\hat{p}\)</span> is the observed proportion in the sample,
and getting a P-value from the upper tail of a standard normal
distribution. (The 0.25 is <span class="math inline">\(p(1-p)\)</span> where <span class="math inline">\(p=0.5\)</span>.) This is what
<code>prop.test</code> does, as we investigate shortly.</p>
<ol style="list-style-type: lower-alpha">
<li>Use <code>rbinom</code> to generate a random value from a
binomial distribution with <span class="math inline">\(n=100\)</span> and <span class="math inline">\(p=0.6\)</span>. There are three
inputs to <code>rbinom</code>: the first one should be the number 1, and
the second and third are the <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span> of the binomial distribution.</li>
</ol>
<p>Solution</p>
<p>I am doing some preparatory work that you don’t need to do:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="power-and-sample-size.html#cb374-1"></a><span class="kw">set.seed</span>(<span class="dv">457299</span>)</span></code></pre></div>
<p>By setting the “seed” for the random number generator, I guarantee
that I will get the same answers every time I run my code below (and
therefore I can talk about my answers without worrying that they will
change). Up to you whether you do this. You can “seed” the random
number generator with any number you like. A lot of people use
<code>1</code>. Mahinda seems to like <code>123</code>. Mine is an old phone
number.</p>
<p>And so to work:</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="power-and-sample-size.html#cb375-1"></a><span class="kw">rbinom</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="fl">0.6</span>)</span></code></pre></div>
<pre><code>## [1] 60</code></pre>
<p>I got exactly 60% successes this time. You probably won’t get exactly
60, but you should get somewhere close. (If you use my random number
seed and use the random number generator exactly the same way I did,
you should get the same values I did.)</p>
<p>For fun, you can see what happens if you change the 1:</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="power-and-sample-size.html#cb377-1"></a><span class="kw">rbinom</span>(<span class="dv">3</span>, <span class="dv">100</span>, <span class="fl">0.6</span>)</span></code></pre></div>
<pre><code>## [1] 58 57 55</code></pre>
<p>Three random binomials, that happened to come out just below 60. We’re
going to leave the first input as 1, though, and let <code>rowwise</code>
handle “lots of sampled values” later.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Using the random binomial that you generated just above, use
<code>prop.test</code> to test whether it could reasonably have come
from a binomial population with <span class="math inline">\(n=100\)</span> and <span class="math inline">\(p=0.5\)</span>, or whether <span class="math inline">\(p\)</span>
is actually bigger than 0.5. (Of course,
you know it actually did not come from a population with <span class="math inline">\(p=0.5\)</span>.)
<code>prop.test</code> has, for us, four inputs, thus:</li>
</ol>
<ul>
<li><p>the observed number of successes</p></li>
<li><p>the <code>n</code> of the binomial distribution</p></li>
<li><p>the null-hypothesis <code>p</code> of the binomial distribution</p></li>
<li><p>the alternative hypothesis, here “greater”</p></li>
</ul>
<p>Solution</p>
<p>I got exactly 60 successes, so I do this:</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="power-and-sample-size.html#cb379-1"></a><span class="kw">prop.test</span>(<span class="dv">60</span>, <span class="dv">100</span>, <span class="fl">0.5</span>, <span class="dt">alternative =</span> <span class="st">&quot;greater&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  1-sample proportions test with continuity correction
## 
## data:  60 out of 100, null probability 0.5
## X-squared = 3.61, df = 1, p-value = 0.02872
## alternative hypothesis: true p is greater than 0.5
## 95 percent confidence interval:
##  0.5127842 1.0000000
## sample estimates:
##   p 
## 0.6</code></pre>
<p>The P-value should at least be fairly small, since 60 is a bit bigger
than 50. (Think about tossing a coin 100 times; would 60 heads make
you doubt the coin’s fairness? The above says it should.)</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Run <code>prop.test</code> again, just as you did before, but this
time save the result, and extract the piece of it called
<code>p.value</code>. Is that the P-value from your test?</li>
</ol>
<p>Solution</p>
<p>Copying and pasting:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="power-and-sample-size.html#cb381-1"></a>p_test &lt;-<span class="st"> </span><span class="kw">prop.test</span>(<span class="dv">60</span>, <span class="dv">100</span>, <span class="fl">0.5</span>, <span class="dt">alternative =</span> <span class="st">&quot;greater&quot;</span>)</span>
<span id="cb381-2"><a href="power-and-sample-size.html#cb381-2"></a>p_test<span class="op">$</span>p.value</span></code></pre></div>
<pre><code>## [1] 0.02871656</code></pre>
<p>Yep, the same.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Estimate the power of a test of
<span class="math inline">\(H_0: p=0.5\)</span> against <span class="math inline">\(H_a: p&gt;0.5\)</span> when <span class="math inline">\(n=500\)</span> and <span class="math inline">\(p=0.56\)</span>, using
<span class="math inline">\(\alpha=0.05\)</span>. There are three steps:</li>
</ol>
<ul>
<li><p>generate random samples from binomial
distributions with <span class="math inline">\(n=500\)</span> and <span class="math inline">\(p=0.56\)</span>, repeated “many” times
(something like 1000 or 10,000 is good)</p></li>
<li><p>run <code>prop.test</code> on each of those
random samples</p></li>
<li><p>extract the P-value for each test and
save the results (in a column called, perhaps, <code>pvals</code>).</p></li>
</ul>
<p>So I lied: the fourth and final step is to count how many of
those P-values are 0.05 or less.</p>
<p>Solution</p>
<p>The first part of the first step is to create a column called something like <code>sim</code> that labels each simulated sample, and to make sure that everything happens rowwise. After that, you follow the procedure:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="power-and-sample-size.html#cb383-1"></a><span class="kw">tibble</span>(<span class="dt">sim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb383-2"><a href="power-and-sample-size.html#cb383-2"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb383-3"><a href="power-and-sample-size.html#cb383-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sample =</span> <span class="kw">rbinom</span>(<span class="dv">1</span>, <span class="dv">500</span>, <span class="fl">0.56</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb383-4"><a href="power-and-sample-size.html#cb383-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">test =</span> <span class="kw">list</span>(<span class="kw">prop.test</span>(sample, <span class="dv">500</span>, <span class="fl">0.5</span>, <span class="dt">alternative =</span> <span class="st">&quot;greater&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb383-5"><a href="power-and-sample-size.html#cb383-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pvals =</span> test<span class="op">$</span>p.value) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb383-6"><a href="power-and-sample-size.html#cb383-6"></a><span class="st">  </span><span class="kw">count</span>(pvals <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["pvals <= 0.05"],"name":[1],"type":["lgl"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"FALSE","2":"143"},{"1":"TRUE","2":"857"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The previous parts, using <code>rbinom</code> and <code>prop.test</code>,
were meant to provide you with the ingredients for this part.
The first step is to use <code>rbinom</code>. The first input is 1 since
we only want one random binomial each time (the <code>rowwise</code> will
handle the fact that you actually want lots of them; you only want one <em>per row</em> since you are working rowwise). The second step
runs <code>prop.test</code>; the first input to that is each one of the
numbers of successes from the first step. The last part is to pull out all the P-values and
make a table of them, just like the example in lecture.</p>
<p>The estimated power is about 85%. That is, if <span class="math inline">\(p\)</span> is actually 0.56
and we have a sample of size 500, we have a good chance of (correctly)
rejecting that <span class="math inline">\(p=0.5\)</span>.</p>
<p>Extra: It turns out that SAS can work out this power by calculation
(using <code>proc power</code>).
SAS says our power is also about 85%, as our simulation
said. I was actually pleased that my simulation came
out so close to the right answer.</p>
<p>In contrast to <code>power.t.test</code>, SAS’s <code>proc power</code>
handles power analyses for a lot of things, including analysis of
variance, correlation and (multiple) regression. What these have in
common is some normal-based theory that allows you (under assumptions
of sufficiently normal-shaped populations) to calculate the exact
answer (that is, the distribution of the test statistic when the
<em>alternative</em> hypothesis is true). The case we looked at is one
of those because of the normal approximation to the binomial: once <span class="math inline">\(n\)</span>
gets big, particularly if <span class="math inline">\(p\)</span> is somewhere near 0.5, the binomial is
very well approximated by a normal with the right mean and SD.</p>
<p>The moral of this story is that when you have a decently large sample,
<span class="math inline">\(n=500\)</span> in this case, <span class="math inline">\(p\)</span> doesn’t have to get very far away from 0.5
before you can correctly reject 0.5. Bear in mind that sample sizes
for estimating proportions need to be larger than those for estimating
means, so <span class="math inline">\(n=500\)</span> is large without being huge. The practical upshot
is that if you design a survey and give it to 500 (or more) randomly
chosen people, the proportion of people in favour doesn’t have to be
much above 50% for you to correctly infer that it <em>is</em> above
50%, most of the time.</p>

</div>
</div>
<p style="text-align: center;">
<a href="two-sample-inference.html"><button class="btn btn-default">Previous</button></a>
<a href="the-sign-test-and-moods-median-test.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
