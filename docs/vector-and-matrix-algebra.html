<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Chapter 1 Vector and matrix algebra | Problems and Solutions in Applied Statistics" />
<meta property="og:type" content="book" />
<meta property="og:url" content="http://ritsokiguess.site/pasias" />

<meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
<meta name="github-repo" content="nxskok/pasias" />

<meta name="author" content="Ken Butler" />

<meta name="date" content="2021-04-26" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="/usr/share/javascript/mathjax/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics">

<title>Chapter 1 Vector and matrix algebra | Problems and Solutions in Applied Statistics</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#introduction">Introduction</a><ul>
<li><a href="index.html#packages-used-somewhere-in-this-book">Packages used somewhere in this book</a></li>
</ul></li>
<li class="has-sub"><a href="vector-and-matrix-algebra.html#vector-and-matrix-algebra"><span class="toc-section-number">1</span> Vector and matrix algebra</a><ul>
<li><a href="vector-and-matrix-algebra.html#heights-and-foot-lengths-again"><span class="toc-section-number">1.1</span> Heights and foot lengths again</a></li>
<li><a href="vector-and-matrix-algebra.html#heights-and-foot-lengths-again-1"><span class="toc-section-number">1.2</span> Heights and foot lengths again</a></li>
</ul></li>
<li class="has-sub"><a href="the-bootstrap.html#the-bootstrap"><span class="toc-section-number">2</span> The Bootstrap</a><ul>
<li><a href="the-bootstrap.html#air-conditioning-failures"><span class="toc-section-number">2.1</span> Air conditioning failures</a></li>
<li><a href="the-bootstrap.html#air-conditioning-failures-bootstrapping-the-median"><span class="toc-section-number">2.2</span> Air conditioning failures: bootstrapping the median</a></li>
<li><a href="the-bootstrap.html#comparing-eyesight"><span class="toc-section-number">2.3</span> Comparing eyesight</a></li>
<li><a href="the-bootstrap.html#bootstrapping-the-irs-data"><span class="toc-section-number">2.4</span> Bootstrapping the IRS data</a></li>
<li><a href="the-bootstrap.html#air-conditioning-failures-1"><span class="toc-section-number">2.5</span> Air conditioning failures</a></li>
<li><a href="the-bootstrap.html#air-conditioning-failures-bootstrapping-the-median-1"><span class="toc-section-number">2.6</span> Air conditioning failures: bootstrapping the median</a></li>
<li><a href="the-bootstrap.html#comparing-eyesight-1"><span class="toc-section-number">2.7</span> Comparing eyesight</a></li>
<li><a href="the-bootstrap.html#bootstrapping-the-irs-data-1"><span class="toc-section-number">2.8</span> Bootstrapping the IRS data</a></li>
</ul></li>
<li class="has-sub"><a href="bayesian-statistics-with-stan.html#bayesian-statistics-with-stan"><span class="toc-section-number">3</span> Bayesian Statistics with Stan</a><ul>
<li><a href="bayesian-statistics-with-stan.html#estimating-proportion-in-favour-from-a-survey"><span class="toc-section-number">3.1</span> Estimating proportion in favour from a survey</a></li>
<li><a href="bayesian-statistics-with-stan.html#bayesian-regression"><span class="toc-section-number">3.2</span> Bayesian regression</a></li>
<li><a href="bayesian-statistics-with-stan.html#estimating-p-the-bayesian-way"><span class="toc-section-number">3.3</span> Estimating <span class="math inline">\(p\)</span> the Bayesian way</a></li>
<li><a href="bayesian-statistics-with-stan.html#estimating-proportion-in-favour-from-a-survey-1"><span class="toc-section-number">3.4</span> Estimating proportion in favour from a survey</a></li>
<li><a href="bayesian-statistics-with-stan.html#bayesian-regression-1"><span class="toc-section-number">3.5</span> Bayesian regression</a></li>
<li><a href="bayesian-statistics-with-stan.html#estimating-p-the-bayesian-way-1"><span class="toc-section-number">3.6</span> Estimating <span class="math inline">\(p\)</span> the Bayesian way</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="vector-and-matrix-algebra" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Vector and matrix algebra</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<div id="heights-and-foot-lengths-again" class="section level2">
<h2><span class="header-section-number">1.1</span> Heights and foot lengths again</h2>
<p>Earlier, we investigated some data on predicting the height of a person from the length of their foot. The data were in .</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read in and display (some of) the data.</p></li>
<li><p>In your regression course, you learned (or will learn) the matrix formulation of the least squares estimates of intercept and slope. This produces a vector <span class="math inline">\(\hat\beta\)</span> containing estimates of both the intercept and the slope, from the formula</p></li>
</ol>
<p><span class="math display">\[ \hat\beta = (X^T X)^{-1} X^T y, \]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(X\)</span> is a matrix containing a column of 1s followed by all the columns of explanatory variables</li>
<li><span class="math inline">\(X^T\)</span> denotes the (matrix) transpose of <span class="math inline">\(X\)</span></li>
<li><span class="math inline">\(M^{-1}\)</span> denotes the inverse of the matrix <span class="math inline">\(M\)</span></li>
<li><span class="math inline">\(y\)</span> denotes the column of response variable values.</li>
</ul>
<p>Use the formula above to obtain the least squares estimates of intercepts and slope for this regression, using R’s vector-matrix algebra. Hint: you are advised to do the calculation in steps, or else it will be very hard to read, and hard for the grader to check that it is correct.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Verify that your calculation is correct by running the regression.</li>
</ol>
<p>My solutions follow:</p>
</div>
<div id="heights-and-foot-lengths-again-1" class="section level2">
<h2><span class="header-section-number">1.2</span> Heights and foot lengths again</h2>
<p>Earlier, we investigated some data on predicting the height of a person from the length of their foot. The data were in .</p>
<ol style="list-style-type: lower-alpha">
<li>Read in and display (some of) the data.</li>
</ol>
<p>Solution</p>
<p>Copy what you did before:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">my_url &lt;-<span class="st"> &quot;http://ritsokiguess.site/datafiles/heightfoot.csv&quot;</span></a>
<a class="sourceLine" id="cb3-2" title="2">hf &lt;-<span class="st"> </span><span class="kw">read_csv</span>(my_url)</a></code></pre></div>
<pre><code>## 
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
## cols(
##   height = col_double(),
##   foot = col_double()
## )</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">hf</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["height"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["foot"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"66.5","2":"27.0"},{"1":"73.5","2":"29.0"},{"1":"70.0","2":"25.5"},{"1":"71.0","2":"27.9"},{"1":"73.0","2":"27.0"},{"1":"71.0","2":"26.0"},{"1":"71.0","2":"29.0"},{"1":"69.5","2":"27.0"},{"1":"73.0","2":"29.0"},{"1":"71.0","2":"27.0"},{"1":"69.0","2":"29.0"},{"1":"69.0","2":"27.2"},{"1":"73.0","2":"29.0"},{"1":"75.0","2":"29.0"},{"1":"73.0","2":"27.2"},{"1":"72.0","2":"27.5"},{"1":"69.0","2":"25.0"},{"1":"68.0","2":"25.0"},{"1":"72.5","2":"28.0"},{"1":"78.0","2":"31.5"},{"1":"79.0","2":"30.0"},{"1":"71.0","2":"28.0"},{"1":"74.0","2":"29.0"},{"1":"66.0","2":"25.5"},{"1":"71.0","2":"26.7"},{"1":"71.0","2":"29.0"},{"1":"71.0","2":"28.0"},{"1":"84.0","2":"27.0"},{"1":"77.0","2":"29.0"},{"1":"72.0","2":"28.0"},{"1":"70.0","2":"26.0"},{"1":"76.0","2":"30.0"},{"1":"68.0","2":"27.0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>In your regression course, you learned (or will learn) the matrix formulation of the least squares estimates of intercept and slope. This produces a vector <span class="math inline">\(\hat\beta\)</span> containing estimates of both the intercept and the slope, from the formula</li>
</ol>
<p><span class="math display">\[ \hat\beta = (X^T X)^{-1} X^T y, \]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(X\)</span> is a matrix containing a column of 1s followed by all the columns of explanatory variables</li>
<li><span class="math inline">\(X^T\)</span> denotes the (matrix) transpose of <span class="math inline">\(X\)</span></li>
<li><span class="math inline">\(M^{-1}\)</span> denotes the inverse of the matrix <span class="math inline">\(M\)</span></li>
<li><span class="math inline">\(y\)</span> denotes the column of response variable values.</li>
</ul>
<p>Use the formula above to obtain the least squares estimates of intercepts and slope for this regression, using R’s vector-matrix algebra. Hint: you are advised to do the calculation in steps, or else it will be very hard to read, and hard for the grader to check that it is correct.</p>
<p>Solution</p>
<p>There is some setup first: we have to get hold of <span class="math inline">\(X\)</span> and <span class="math inline">\(y\)</span> from the data as a matrix and a vector respectively. I would use tidyverse ideas to do this, and then turn them into a matrix at the end, which I think is best. Don’t forget to create a column of 1s to make the first column of <span class="math inline">\(X\)</span></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">hf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">one=</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">select</span>(one, foot) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">as.matrix</span>() -&gt;<span class="st"> </span>X</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw">head</span>(X)</a></code></pre></div>
<pre><code>##      one foot
## [1,]   1 27.0
## [2,]   1 29.0
## [3,]   1 25.5
## [4,]   1 27.9
## [5,]   1 27.0
## [6,]   1 26.0</code></pre>
<p>(<code>head</code> displays the first six rows, or else you’ll be displaying all 33, which is too many.)</p>
<p>Another approach is this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">X &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dv">1</span>, hf<span class="op">$</span>foot)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">head</span>(X)</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1 27.0
## [2,]    1 29.0
## [3,]    1 25.5
## [4,]    1 27.9
## [5,]    1 27.0
## [6,]    1 26.0</code></pre>
<p>Note that the recycling rules mean that a column with only one value in it will be repeated to the length of the other one, and so this is better than working out how many observations there are and repeating <code>1</code> that many times.</p>
<p>The choice here is whether to use tidyverse stuff and turn into a matrix at the end, or make a matrix at the start (which is what <code>cbind</code> from base R is doing). I don’t believe you’ve seen that in this course, so you ought to cite your source if you go that way.</p>
<p>The simplest choice for making <span class="math inline">\(y\)</span> is this:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">y &lt;-<span class="st"> </span>hf<span class="op">$</span>height</a>
<a class="sourceLine" id="cb10-2" title="2">y</a></code></pre></div>
<pre><code>##  [1] 66.5 73.5 70.0 71.0 73.0 71.0 71.0 69.5 73.0 71.0 69.0 69.0 73.0 75.0 73.0 72.0 69.0 68.0 72.5
## [20] 78.0 79.0 71.0 74.0 66.0 71.0 71.0 71.0 84.0 77.0 72.0 70.0 76.0 68.0</code></pre>
<p>This also works:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">hf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(height) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(height)</a></code></pre></div>
<pre><code>##  [1] 66.5 73.5 70.0 71.0 73.0 71.0 71.0 69.5 73.0 71.0 69.0 69.0 73.0 75.0 73.0 72.0 69.0 68.0 72.5
## [20] 78.0 79.0 71.0 74.0 66.0 71.0 71.0 71.0 84.0 77.0 72.0 70.0 76.0 68.0</code></pre>
<p>(remembering that you don’t want to have anything that’s a dataframe), or this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">hf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(height) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.matrix</span>() -&gt;<span class="st"> </span>yy</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">head</span>(yy)</a></code></pre></div>
<pre><code>##      height
## [1,]   66.5
## [2,]   73.5
## [3,]   70.0
## [4,]   71.0
## [5,]   73.0
## [6,]   71.0</code></pre>
<p>remembering that a (column) vector and a 1-column matrix are the same thing as R is concerned.</p>
<p>Now we want to construct some things. I would go at it this way, rather than trying to do everything at once (if you do, you will either get lost now, or in six months when you try to figure out what you did):</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">Xt &lt;-<span class="st"> </span><span class="kw">t</span>(X) <span class="co"># X-transpose</span></a>
<a class="sourceLine" id="cb16-2" title="2">XtX &lt;-<span class="st"> </span>Xt <span class="op">%*%</span><span class="st"> </span>X </a>
<a class="sourceLine" id="cb16-3" title="3">XtXi &lt;-<span class="st"> </span><span class="kw">solve</span>(XtX)</a>
<a class="sourceLine" id="cb16-4" title="4">Xty &lt;-<span class="st"> </span>Xt <span class="op">%*%</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb16-5" title="5">XtXi <span class="op">%*%</span><span class="st"> </span>Xty</a></code></pre></div>
<pre><code>##           [,1]
## [1,] 34.336335
## [2,]  1.359062</code></pre>
<p>The intercept is 34.33 and the slope is 1.36.</p>
<p>These compute, respectively, <span class="math inline">\(X^T\)</span>, <span class="math inline">\(X^T X\)</span>, the inverse of that, <span class="math inline">\(X^T y\)</span> and <span class="math inline">\(\hat\beta\)</span>. Expect credit for laying out your calculation clearly.</p>
<p>Extra: the value of this formula is that it applies no matter whether you have one <span class="math inline">\(x\)</span>-variable, as here (or in the windmill data), or whether you have a lot (as in the asphalt data). In either case, <span class="math inline">\(\hat\beta\)</span> contains the estimate of the intercept followed by all the slope estimates, however many there are. There are also matrix formulas that tell you how the slopes or the residuals will change if you remove one observation or one explanatory variable, so that something like <code>step</code> will work very efficiently, and calculations for leverages likewise.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Verify that your calculation is correct by running the regression.</li>
</ol>
<p>Solution</p>
<p>The usual <code>lm</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">hf<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(height <span class="op">~</span><span class="st"> </span>foot, <span class="dt">data =</span> hf)</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="kw">summary</span>(hf<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = height ~ foot, data = hf)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.7491 -1.3901 -0.0310  0.8918 12.9690 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  34.3363     9.9541   3.449 0.001640 ** 
## foot          1.3591     0.3581   3.795 0.000643 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.102 on 31 degrees of freedom
## Multiple R-squared:  0.3173, Adjusted R-squared:  0.2952 
## F-statistic: 14.41 on 1 and 31 DF,  p-value: 0.0006428</code></pre>
<p>The same.</p>
<p>Extra:
in this “well-conditioned” case,<label for="tufte-sn-1" class="margin-toggle sidenote-number">1</label><input type="checkbox" id="tufte-sn-1" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">1</span> Which in this case means that the column of 1s and the actual x values are not strongly correlated, which means that the x-values vary enough.</span> it makes no difference, but if <span class="math inline">\(X^T X\)</span> is almost singular, so that it almost doesn’t have an inverse (for example, some of your explanatory variables are highly correlated with each other), you can get into trouble. Regression calculations in practice use something more sophisticated like the
<a href="https://en.wikipedia.org/wiki/Singular_value_decomposition">singular value decomposition</a> of <span class="math inline">\(X^TX\)</span> to diagnose whether <span class="math inline">\(X^TX\)</span> is actually singular or almost so, which from a numerical point of view is almost as bad, and to produce a sensible answer in that case.</p>
<p>I guess I should try to make up one where it struggles. Let me do one with two <span class="math inline">\(x\)</span>’s that are strongly correlated:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">d &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb20-2" title="2"><span class="op">~</span>x1, <span class="op">~</span>x2, <span class="op">~</span>y,</a>
<a class="sourceLine" id="cb20-3" title="3"><span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">55</span>,</a>
<a class="sourceLine" id="cb20-4" title="4"><span class="dv">11</span>, <span class="fl">19.0001</span>, <span class="dv">60</span>,</a>
<a class="sourceLine" id="cb20-5" title="5"><span class="dv">12</span>, <span class="fl">17.9999</span>, <span class="dv">61</span>,</a>
<a class="sourceLine" id="cb20-6" title="6"><span class="dv">13</span>, <span class="fl">17.0001</span>, <span class="dv">64</span>,</a>
<a class="sourceLine" id="cb20-7" title="7"><span class="dv">14</span>, <span class="fl">15.9998</span>, <span class="dv">66</span>,</a>
<a class="sourceLine" id="cb20-8" title="8"><span class="dv">15</span>, <span class="fl">15.0001</span>, <span class="dv">67</span></a>
<a class="sourceLine" id="cb20-9" title="9">)</a>
<a class="sourceLine" id="cb20-10" title="10">d</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["x1"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["x2"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["y"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"10","2":"20.0000","3":"55"},{"1":"11","2":"19.0001","3":"60"},{"1":"12","2":"17.9999","3":"61"},{"1":"13","2":"17.0001","3":"64"},{"1":"14","2":"15.9998","3":"66"},{"1":"15","2":"15.0001","3":"67"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>x2</code> is almost exactly equal to 30 minus <code>x1</code>. What’s the right answer?</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">d<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> d)</a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw">summary</span>(d<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 + x2, data = d)
## 
## Residuals:
##        1        2        3        4        5        6 
## -1.37530  1.26859  0.03118  0.63549  0.43765 -0.99760 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept) -11837.3   138685.6  -0.085    0.937
## x1             398.0     4622.9   0.086    0.937
## x2             395.7     4622.8   0.086    0.937
## 
## Residual standard error: 1.303 on 3 degrees of freedom
## Multiple R-squared:  0.9485, Adjusted R-squared:  0.9141 
## F-statistic: 27.61 on 2 and 3 DF,  p-value: 0.0117</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">coef</span>(d<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## (Intercept)          x1          x2 
## -11837.2938    398.0000    395.6835</code></pre>
<p>You should be right away suspicious here: the R-squared is high, but neither of the explanatory variables are significant! (This actually means that you can remove one of them, either one.) The standard errors are also suspiciously large, never a good sign. If you’ve done C67, you might be thinking about variance inflation factors here:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">library</span>(car)</a>
<a class="sourceLine" id="cb25-2" title="2"><span class="kw">vif</span>(d<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##        x1        x2 
## 220326265 220326265</code></pre>
<p>These are both huge (greater than 5 or 10 or whatever guideline you use), indicating that they are highly correlated with each other (as we know they are).</p>
<p>All right, how does the matrix algebra work? This is just the same as before:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">one=</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="kw">select</span>(one, <span class="kw">starts_with</span>(<span class="st">&quot;x&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-3" title="3"><span class="kw">as.matrix</span>() -&gt;<span class="st"> </span>X</a>
<a class="sourceLine" id="cb27-4" title="4"><span class="kw">head</span>(X)</a></code></pre></div>
<pre><code>##      one x1      x2
## [1,]   1 10 20.0000
## [2,]   1 11 19.0001
## [3,]   1 12 17.9999
## [4,]   1 13 17.0001
## [5,]   1 14 15.9998
## [6,]   1 15 15.0001</code></pre>
<p>and then</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">y &lt;-<span class="st"> </span>d<span class="op">$</span>y</a>
<a class="sourceLine" id="cb29-2" title="2">Xt &lt;-<span class="st"> </span><span class="kw">t</span>(X) <span class="co"># X-transpose</span></a>
<a class="sourceLine" id="cb29-3" title="3">XtX &lt;-<span class="st"> </span>Xt <span class="op">%*%</span><span class="st"> </span>X </a>
<a class="sourceLine" id="cb29-4" title="4">XtXi &lt;-<span class="st"> </span><span class="kw">solve</span>(XtX)</a>
<a class="sourceLine" id="cb29-5" title="5">Xty &lt;-<span class="st"> </span>Xt <span class="op">%*%</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb29-6" title="6">XtXi <span class="op">%*%</span><span class="st"> </span>Xty</a></code></pre></div>
<pre><code>##            [,1]
## one -11837.2051
## x1     397.9970
## x2     395.6805</code></pre>
<p>These answers are actually noticeably different from the right answers (with a few more decimals here):</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">coef</span>(d<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## (Intercept)          x1          x2 
## -11837.2938    398.0000    395.6835</code></pre>
<p>One way of finding out how nearly singular <span class="math inline">\(X^TX\)</span> is is to look at its eigenvalues. You’ll recall that a singular matrix has one or more zero eigenvalues:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">eigen</span>(XtX)</a></code></pre></div>
<pre><code>## eigen() decomposition
## $values
## [1] 2.781956e+03 3.404456e+01 8.805997e-11
## 
## $vectors
##             [,1]        [,2]        [,3]
## [1,] -0.04643281 -0.00782885  0.99889074
## [2,] -0.57893109 -0.81469635 -0.03329647
## [3,] -0.81405331  0.57983495 -0.03329628</code></pre>
<p>The third eigenvalue is <span class="math inline">\(8.8 \times 10^{-11}\)</span>, which is very close to zero, especially compared to the other two, which are 34 and over two <em>thousand</em>. This is a very nearly singular matrix, and hence <span class="math inline">\((X^TX)^{-1}\)</span> is very close to not existing at all, and <em>that</em> would mean that you couldn’t even compute the intercept and slope estimates, never mind hope to get close to the right answer.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>

</div>
</div>
<p style="text-align: center;">
<a href="index.html"><button class="btn btn-default">Previous</button></a>
<a href="the-bootstrap.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
