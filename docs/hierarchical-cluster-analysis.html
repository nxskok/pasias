<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 35 Hierarchical cluster analysis | Problems and Solutions in Applied Statistics</title>
  <meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 35 Hierarchical cluster analysis | Problems and Solutions in Applied Statistics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://ritsokiguess.site/pasias" />
  
  <meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
  <meta name="github-repo" content="nxskok/pasias" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 35 Hierarchical cluster analysis | Problems and Solutions in Applied Statistics" />
  
  <meta name="twitter:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
  

<meta name="author" content="Ken Butler" />


<meta name="date" content="2021-06-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="discriminant-analysis.html"/>
<link rel="next" href="k-means-cluster-analysis.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Problems and Solutions in Applied Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#packages-used-somewhere-in-this-book"><i class="fa fa-check"></i>Packages used somewhere in this book</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html"><i class="fa fa-check"></i><b>1</b> Getting used to R and R Studio</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html#running-r-studio-on-jupyterhub"><i class="fa fa-check"></i><b>1.1</b> Running R Studio on Jupyterhub</a></li>
<li class="chapter" data-level="1.2" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html#getting-an-r-studio-cloud-account"><i class="fa fa-check"></i><b>1.2</b> Getting an R Studio Cloud account</a></li>
<li class="chapter" data-level="1.3" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html#getting-started"><i class="fa fa-check"></i><b>1.3</b> Getting started</a></li>
<li class="chapter" data-level="1.4" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html#reading-data-from-a-file"><i class="fa fa-check"></i><b>1.4</b> Reading data from a file</a></li>
<li class="chapter" data-level="1.5" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html#reading-files-different-ways"><i class="fa fa-check"></i><b>1.5</b> Reading files different ways</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reading-in-data.html"><a href="reading-in-data.html"><i class="fa fa-check"></i><b>2</b> Reading in data</a></li>
<li class="chapter" data-level="3" data-path="drawing-graphs.html"><a href="drawing-graphs.html"><i class="fa fa-check"></i><b>3</b> Drawing graphs</a></li>
<li class="chapter" data-level="4" data-path="data-exploration.html"><a href="data-exploration.html"><i class="fa fa-check"></i><b>4</b> Data exploration</a></li>
<li class="chapter" data-level="5" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html"><i class="fa fa-check"></i><b>5</b> Working with dataframes</a></li>
<li class="chapter" data-level="6" data-path="one-sample-inference.html"><a href="one-sample-inference.html"><i class="fa fa-check"></i><b>6</b> One-sample inference</a></li>
<li class="chapter" data-level="7" data-path="two-sample-inference.html"><a href="two-sample-inference.html"><i class="fa fa-check"></i><b>7</b> Two-sample inference</a></li>
<li class="chapter" data-level="8" data-path="power-and-sample-size.html"><a href="power-and-sample-size.html"><i class="fa fa-check"></i><b>8</b> Power and sample size</a></li>
<li class="chapter" data-level="9" data-path="the-sign-test.html"><a href="the-sign-test.html"><i class="fa fa-check"></i><b>9</b> The sign test</a></li>
<li class="chapter" data-level="10" data-path="mood-median-test.html"><a href="mood-median-test.html"><i class="fa fa-check"></i><b>10</b> Mood median test</a></li>
<li class="chapter" data-level="11" data-path="matched-pairs-t-and-sign-test.html"><a href="matched-pairs-t-and-sign-test.html"><i class="fa fa-check"></i><b>11</b> Matched pairs t and sign test</a></li>
<li class="chapter" data-level="12" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html"><i class="fa fa-check"></i><b>12</b> Normal quantile plots</a><ul>
<li class="chapter" data-level="12.1" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers"><i class="fa fa-check"></i><b>12.1</b> Lengths of heliconia flowers</a></li>
<li class="chapter" data-level="12.2" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#ferritin-and-normality"><i class="fa fa-check"></i><b>12.2</b> Ferritin and normality</a></li>
<li class="chapter" data-level="12.3" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers-1"><i class="fa fa-check"></i><b>12.3</b> Lengths of heliconia flowers</a></li>
<li class="chapter" data-level="12.4" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#ferritin-and-normality-1"><i class="fa fa-check"></i><b>12.4</b> Ferritin and normality</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="analysis-of-variance.html"><a href="analysis-of-variance.html"><i class="fa fa-check"></i><b>13</b> Analysis of variance</a></li>
<li class="chapter" data-level="14" data-path="writing-reports.html"><a href="writing-reports.html"><i class="fa fa-check"></i><b>14</b> Writing reports</a></li>
<li class="chapter" data-level="15" data-path="learning-to-code.html"><a href="learning-to-code.html"><i class="fa fa-check"></i><b>15</b> Learning to code</a><ul>
<li class="chapter" data-level="15.1" data-path="learning-to-code.html"><a href="learning-to-code.html#introduction-1"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="learning-to-code.html"><a href="learning-to-code.html#data-and-pre-processing"><i class="fa fa-check"></i><b>15.2</b> Data and pre-processing</a></li>
<li class="chapter" data-level="15.3" data-path="learning-to-code.html"><a href="learning-to-code.html#analysis"><i class="fa fa-check"></i><b>15.3</b> Analysis</a></li>
<li class="chapter" data-level="15.4" data-path="learning-to-code.html"><a href="learning-to-code.html#conclusions-see-note-9"><i class="fa fa-check"></i><b>15.4</b> Conclusions (see note 9)</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="treating-dandruff.html"><a href="treating-dandruff.html"><i class="fa fa-check"></i><b>16</b> Treating dandruff</a><ul>
<li class="chapter" data-level="16.1" data-path="treating-dandruff.html"><a href="treating-dandruff.html#introduction-2"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="treating-dandruff.html"><a href="treating-dandruff.html#exploratory-analysis"><i class="fa fa-check"></i><b>16.2</b> Exploratory analysis</a></li>
<li class="chapter" data-level="16.3" data-path="treating-dandruff.html"><a href="treating-dandruff.html#analysis-of-variance-1"><i class="fa fa-check"></i><b>16.3</b> Analysis of Variance</a></li>
<li class="chapter" data-level="16.4" data-path="treating-dandruff.html"><a href="treating-dandruff.html#assessment-of-assumptions"><i class="fa fa-check"></i><b>16.4</b> Assessment of Assumptions</a></li>
<li class="chapter" data-level="16.5" data-path="treating-dandruff.html"><a href="treating-dandruff.html#conclusions"><i class="fa fa-check"></i><b>16.5</b> Conclusions</a></li>
<li class="chapter" data-level="16.6" data-path="treating-dandruff.html"><a href="treating-dandruff.html#end"><i class="fa fa-check"></i><b>16.6</b> End</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="tidying-data.html"><a href="tidying-data.html"><i class="fa fa-check"></i><b>17</b> Tidying data</a></li>
<li class="chapter" data-level="18" data-path="simple-regression.html"><a href="simple-regression.html"><i class="fa fa-check"></i><b>18</b> Simple regression</a></li>
<li class="chapter" data-level="19" data-path="multiple-regression.html"><a href="multiple-regression.html"><i class="fa fa-check"></i><b>19</b> Multiple regression</a></li>
<li class="chapter" data-level="20" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html"><i class="fa fa-check"></i><b>20</b> Regression with categorical variables</a><ul>
<li class="chapter" data-level="20.1" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#crickets-revisited"><i class="fa fa-check"></i><b>20.1</b> Crickets revisited</a></li>
<li class="chapter" data-level="20.2" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#pulse-rates-and-marching"><i class="fa fa-check"></i><b>20.2</b> Pulse rates and marching</a></li>
<li class="chapter" data-level="20.3" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#crickets-revisited-1"><i class="fa fa-check"></i><b>20.3</b> Crickets revisited</a></li>
<li class="chapter" data-level="20.4" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#pulse-rates-and-marching-1"><i class="fa fa-check"></i><b>20.4</b> Pulse rates and marching</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>21</b> Dates and times</a></li>
<li class="chapter" data-level="22" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>22</b> Functions</a></li>
<li class="chapter" data-level="23" data-path="vector-and-matrix-algebra.html"><a href="vector-and-matrix-algebra.html"><i class="fa fa-check"></i><b>23</b> Vector and matrix algebra</a><ul>
<li class="chapter" data-level="23.1" data-path="vector-and-matrix-algebra.html"><a href="vector-and-matrix-algebra.html#heights-and-foot-lengths-again"><i class="fa fa-check"></i><b>23.1</b> Heights and foot lengths again</a></li>
<li class="chapter" data-level="23.2" data-path="vector-and-matrix-algebra.html"><a href="vector-and-matrix-algebra.html#heights-and-foot-lengths-again-1"><i class="fa fa-check"></i><b>23.2</b> Heights and foot lengths again</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="the-bootstrap.html"><a href="the-bootstrap.html"><i class="fa fa-check"></i><b>24</b> The Bootstrap</a></li>
<li class="chapter" data-level="25" data-path="bayesian-statistics-with-stan.html"><a href="bayesian-statistics-with-stan.html"><i class="fa fa-check"></i><b>25</b> Bayesian Statistics with Stan</a></li>
<li class="chapter" data-level="26" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>26</b> Logistic regression</a></li>
<li class="chapter" data-level="27" data-path="logistic-regression-with-ordinal-response.html"><a href="logistic-regression-with-ordinal-response.html"><i class="fa fa-check"></i><b>27</b> Logistic regression with ordinal response</a></li>
<li class="chapter" data-level="28" data-path="logistic-regression-with-nominal-response.html"><a href="logistic-regression-with-nominal-response.html"><i class="fa fa-check"></i><b>28</b> Logistic regression with nominal response</a></li>
<li class="chapter" data-level="29" data-path="survival-analysis.html"><a href="survival-analysis.html"><i class="fa fa-check"></i><b>29</b> Survival analysis</a></li>
<li class="chapter" data-level="30" data-path="analysis-of-variance-revisited.html"><a href="analysis-of-variance-revisited.html"><i class="fa fa-check"></i><b>30</b> Analysis of variance revisited</a></li>
<li class="chapter" data-level="31" data-path="analysis-of-covariance.html"><a href="analysis-of-covariance.html"><i class="fa fa-check"></i><b>31</b> Analysis of covariance</a></li>
<li class="chapter" data-level="32" data-path="multivariate-analysis-of-variance.html"><a href="multivariate-analysis-of-variance.html"><i class="fa fa-check"></i><b>32</b> Multivariate analysis of variance</a></li>
<li class="chapter" data-level="33" data-path="repeated-measures.html"><a href="repeated-measures.html"><i class="fa fa-check"></i><b>33</b> Repeated measures</a></li>
<li class="chapter" data-level="34" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html"><i class="fa fa-check"></i><b>34</b> Discriminant analysis</a></li>
<li class="chapter" data-level="35" data-path="hierarchical-cluster-analysis.html"><a href="hierarchical-cluster-analysis.html"><i class="fa fa-check"></i><b>35</b> Hierarchical cluster analysis</a><ul>
<li class="chapter" data-level="35.1" data-path="hierarchical-cluster-analysis.html"><a href="hierarchical-cluster-analysis.html#sites-on-the-sea-bed"><i class="fa fa-check"></i><b>35.1</b> Sites on the sea bed</a></li>
<li class="chapter" data-level="35.2" data-path="hierarchical-cluster-analysis.html"><a href="hierarchical-cluster-analysis.html#dissimilarities-between-fruits"><i class="fa fa-check"></i><b>35.2</b> Dissimilarities between fruits</a></li>
<li class="chapter" data-level="35.3" data-path="hierarchical-cluster-analysis.html"><a href="hierarchical-cluster-analysis.html#similarity-of-species"><i class="fa fa-check"></i><b>35.3</b> Similarity of species</a></li>
<li class="chapter" data-level="35.4" data-path="hierarchical-cluster-analysis.html"><a href="hierarchical-cluster-analysis.html#bridges-in-pittsburgh"><i class="fa fa-check"></i><b>35.4</b> Bridges in Pittsburgh</a></li>
<li class="chapter" data-level="35.5" data-path="hierarchical-cluster-analysis.html"><a href="hierarchical-cluster-analysis.html#sites-on-the-sea-bed-1"><i class="fa fa-check"></i><b>35.5</b> Sites on the sea bed</a></li>
<li class="chapter" data-level="35.6" data-path="hierarchical-cluster-analysis.html"><a href="hierarchical-cluster-analysis.html#dissimilarities-between-fruits-1"><i class="fa fa-check"></i><b>35.6</b> Dissimilarities between fruits</a></li>
<li class="chapter" data-level="35.7" data-path="hierarchical-cluster-analysis.html"><a href="hierarchical-cluster-analysis.html#similarity-of-species-1"><i class="fa fa-check"></i><b>35.7</b> Similarity of species</a></li>
<li class="chapter" data-level="35.8" data-path="hierarchical-cluster-analysis.html"><a href="hierarchical-cluster-analysis.html#bridges-in-pittsburgh-1"><i class="fa fa-check"></i><b>35.8</b> Bridges in Pittsburgh</a></li>
</ul></li>
<li class="chapter" data-level="36" data-path="k-means-cluster-analysis.html"><a href="k-means-cluster-analysis.html"><i class="fa fa-check"></i><b>36</b> K-means cluster analysis</a></li>
<li class="chapter" data-level="37" data-path="drawing-maps-with-leaflet.html"><a href="drawing-maps-with-leaflet.html"><i class="fa fa-check"></i><b>37</b> Drawing maps with Leaflet</a></li>
<li class="chapter" data-level="38" data-path="multidimensional-scaling.html"><a href="multidimensional-scaling.html"><i class="fa fa-check"></i><b>38</b> Multidimensional Scaling</a></li>
<li class="chapter" data-level="39" data-path="principal-components.html"><a href="principal-components.html"><i class="fa fa-check"></i><b>39</b> Principal Components</a><ul>
<li class="chapter" data-level="39.1" data-path="principal-components.html"><a href="principal-components.html#the-weather-somewhere"><i class="fa fa-check"></i><b>39.1</b> The weather, somewhere</a></li>
<li class="chapter" data-level="39.2" data-path="principal-components.html"><a href="principal-components.html#the-weather-somewhere-1"><i class="fa fa-check"></i><b>39.2</b> The weather, somewhere</a></li>
</ul></li>
<li class="chapter" data-level="40" data-path="factor-analysis.html"><a href="factor-analysis.html"><i class="fa fa-check"></i><b>40</b> Factor Analysis</a></li>
<li class="chapter" data-level="41" data-path="frequency-table-analysis.html"><a href="frequency-table-analysis.html"><i class="fa fa-check"></i><b>41</b> Frequency table analysis</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Problems and Solutions in Applied Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="hierarchical-cluster-analysis" class="section level1">
<h1><span class="header-section-number">Chapter 35</span> Hierarchical cluster analysis</h1>
<p>Packages for this chapter:</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" title="1"><span class="kw">library</span>(MASS)</a>
<a class="sourceLine" id="cb254-2" title="2"><span class="kw">library</span>(ggbiplot)</a>
<a class="sourceLine" id="cb254-3" title="3"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<div id="sites-on-the-sea-bed" class="section level2">
<h2><span class="header-section-number">35.1</span> Sites on the sea bed</h2>
<p>Biologists investigate the prevalence of
species of organism by sampling sites where the organisms might be,
taking a “grab” from the site, and sending the grabs to a laboratory
for analysis. The data in this question come from the sea bed. There
were 30 sites, labelled <code>s1</code> through <code>s30</code>. At each
site, five species of organism, labelled <code>a</code> through
<code>e</code>, were of interest; the data shown in those columns of the
data set were the number of organisms of that species identified in
the grab from that site. There are some other columns in the
(original) data set that will not concern us. Our interest is in
seeing which sites are similar to which other sites, so that a cluster
analysis will be suitable.</p>
<p>When the data are counts of different species, as they are here,
biologists often measure the dissimilarity in species prevalence
profiles between two sites using something called the Bray-Curtis
dissimilarity. It is not important to understand this for this
question (though I explain it in my solutions). I calculated the
Bray-Curtis dissimilarity between each pair of sites and stored the
results in <a href="http://ritsokiguess.site/datafiles/seabed1.csv">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read in the dissimilarity data and check that you have 30
rows and 30 columns of dissimilarities.</p></li>
<li><p>Create a distance object out of your dissimilarities,
bearing in mind that the values are distances (well,
dissimilarities) already.</p></li>
<li><p>Fit a cluster analysis using single-linkage, and display a
dendrogram of the results.</p></li>
<li><p>Now fit a cluster analysis using Ward’s method, and display
a dendrogram of the results.</p></li>
<li><p><a name="part:prefclust">*</a> On the Ward’s method clustering, how many clusters would you
choose to divide the sites into? Draw rectangles around those clusters.</p></li>
<li><p><a name="part:original">*</a> The original data is in
<a href="http://ritsokiguess.site/datafiles/seabed.csv">link</a>. Read in the
original data and verify that you again have 30 sites, variables
called <code>a</code> through <code>e</code> and some others.</p></li>
<li><p>Go back to your Ward method dendrogram with the red
rectangles and find two sites in the same cluster. Display the
original data for your two sites and see if you can explain why they
are in the same cluster. It doesn’t matter which two sites you choose;
the grader will merely check that your results look reasonable.</p></li>
<li><p>Obtain the cluster memberships for each site, for your
preferred number of clusters from part (<a href="#part:prefclust">here</a>). Add a
column to the original data that you read in, in part
(<a href="#part:original">here</a>), containing those cluster memberships, <em>as a
factor</em>. Obtain a plot that will enable you to assess the
relationship between those clusters and <code>pollution</code>. (Once you
have the cluster memberships, you can add them to the data frame and
make the graph using a pipe.) What do you see?</p></li>
</ol>
</div>
<div id="dissimilarities-between-fruits" class="section level2">
<h2><span class="header-section-number">35.2</span> Dissimilarities between fruits</h2>
<p>Consider the fruits apple, orange, banana, pear,
strawberry, blueberry. We are going to work with these four
properties of fruits:</p>
<ul>
<li><p>has a round shape</p></li>
<li><p>Is sweet</p></li>
<li><p>Is crunchy</p></li>
<li><p>Is a berry</p></li>
</ul>
<ol style="list-style-type: lower-alpha">
<li><p>Make a table with fruits as columns, and with
rows “round shape”, “sweet”, “crunchy”, “berry”. In each cell
of the table, put a 1 if the fruit has the property named in the
row, and a 0 if it does not. (This is your opinion, and may not
agree with mine. That doesn’t matter, as long as you follow through
with whatever your choices were.)</p></li>
<li><p>We’ll define the dissimilarity between two fruits to be the
number of qualities they <em>disagree</em> on. Thus, for example, the
dissimilarity between Apple and Orange is 1 (an apple is crunchy and
an orange is not, but they agree on everything else). Calculate the
dissimilarity between each pair of fruits, and make a square table
that summarizes the results. (To save yourself some work, note that
the dissimilarity between a fruit and itself must be zero, and the
dissimilarity between fruits A and B is the same as that between B
and A.) Save your table of dissimilarities into a file for the next part.</p></li>
<li><p>Do a hierarchical cluster analysis using complete
linkage. Display your dendrogram.</p></li>
<li><p>How many clusters, of what fruits, do you seem to have?
Explain briefly.</p></li>
<li><p>Pick a pair of clusters (with at least 2 fruits in each)
from your dendrogram. Verify that
the complete-linkage distance on your dendrogram is correct.</p></li>
</ol>
</div>
<div id="similarity-of-species" class="section level2">
<h2><span class="header-section-number">35.3</span> Similarity of species</h2>
<p>Two scientists assessed the dissimilarity
between a number
of species by recording the number of positions in the protein
molecule cytochrome-<span class="math inline">\(c\)</span> where the two species being compared have
different amino acids. The dissimilarities that they recorded are in
<a href="http://ritsokiguess.site/datafiles/species.txt">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read the data into a data frame and take a look at it.</p></li>
<li><p>Bearing in mind that the values you read in are
<em>already</em> dissimilarities, convert them into a <code>dist</code>
object suitable for running a cluster analysis on, and display the
results. (Note that you need to get rid of any columns that don’t
contain numbers.)</p></li>
<li><p>Run a cluster analysis using single-linkage and obtain a dendrogram.</p></li>
<li><p>Run a cluster analysis using Ward’s method and obtain a dendrogram.</p></li>
<li><p>Describe how the two dendrograms from the last two parts
look different.</p></li>
<li><p>Looking at your clustering for Ward’s method, what seems to
be a sensible number of clusters? Draw boxes around those clusters.</p></li>
<li><p>List which cluster each species is in, for your preferred
number of clusters (from Ward’s method).</p></li>
</ol>
</div>
<div id="bridges-in-pittsburgh" class="section level2">
<h2><span class="header-section-number">35.4</span> Bridges in Pittsburgh</h2>
<p>The city of Pittsburgh, Pennsylvania, lies where three
rivers, the Allegheny, Monongahela, and Ohio,
meet.<a href="#fn36" class="footnote-ref" id="fnref36"><sup>36</sup></a>
It has long been important to build bridges there,
to enable its residents to cross the rivers safely. See
<a href="https://en.wikipedia.org/wiki/List_of_bridges_of_Pittsburgh">link</a> for
a listing (with pictures) of the bridges. The data at
<a href="https://raw.githubusercontent.com/nxskok/datafiles/master/bridges.csv">link</a> contains
detail for a large number of past and present bridges in
Pittsburgh. All the variables we will use are categorical. Here they
are:</p>
<ul>
<li><p><code>id</code> identifying the bridge (we ignore)</p></li>
<li><p><code>river</code>: initial letter of river that the bridge crosses</p></li>
<li><p><code>location</code>: a numerical code indicating the location
within Pittsburgh (we ignore)</p></li>
<li><p><code>erected</code>: time period in which the bridge was built (a
name, from <code>CRAFTS</code>, earliest, to <code>MODERN</code>, most
recent.</p></li>
<li><p><code>purpose</code>: what the bridge carries: foot traffic
(“walk”), water (aqueduct), road or railroad.</p></li>
<li><p><code>length</code> categorized as long, medium or short.</p></li>
<li><p><code>lanes</code> of traffic (or number of railroad tracks): a
number, 1, 2, 4 or 6, that we will count as categorical.</p></li>
<li><p><code>clear_g</code>: whether a vertical navigation requirement was
included in the bridge design (that is, ships of a certain height
had to be able to get under the bridge). I think <code>G</code> means
“yes”.</p></li>
<li><p><code>t_d</code>: method of construction. <code>DECK</code> means the
bridge deck is on top of the construction, <code>THROUGH</code> means
that when you cross the bridge, some of the bridge supports are next
to you or above you.</p></li>
<li><p><code>material</code> the bridge is made of: iron, steel or wood.</p></li>
<li><p><code>span</code>: whether the bridge covers a short, medium or long
distance.</p></li>
<li><p><code>rel_l</code>: Relative length of the main span of the
bridge (between the two central piers) to the total crossing length.
The categories are <code>S</code>, <code>S-F</code> and <code>F</code>. I don’t
know what these mean.</p></li>
<li><p><code>type</code> of bridge: wood, suspension, arch and three types
of truss bridge: cantilever, continuous and simple.</p></li>
</ul>
<p>The website <a href="https://www.steelconstruction.info/Bridges">link</a> is an
excellent source of information about bridges. (That’s where I learned
the difference between <code>THROUGH</code> and <code>DECK</code>.) Wikipedia
also has a good article at
<a href="https://en.wikipedia.org/wiki/Bridge">link</a>. I also found
<a href="http://www.metaeventos.net/inscricoes/formularios_off/resumo_preenchido/DINCON/Pina-A_Colimodio-V_Silva-A_PinaFilho-A.pdf">link</a>
which is the best description I’ve seen of the variables.</p>
<ol style="list-style-type: lower-alpha">
<li><p>The bridges are stored in CSV format. Some of the
information is not known and was recorded in the spreadsheet as
<code>?</code>. Turn these into genuine missing values by adding
<code>na="?"</code> to your file-reading command. Display some of your
data, enough to see that you have some missing data.</p></li>
<li><p>Verify that there are missing values in this dataset. To see
them, convert the text columns temporarily to <code>factor</code>s using
<code>mutate</code>, and pass the resulting data frame into
<code>summary</code>.</p></li>
<li><p>Use <code>drop_na</code> to remove any rows of the data frame with missing values in them. How many rows do you have left?</p></li>
<li><p>We are going to assess the dissimilarity between two bridges
by the number of the categorical variables they <em>disagree</em>
on. This is called a “simple matching coefficient”, and is the
same thing we did in the question about clustering fruits based on
their properties. This time, though, we want to count matches in
things that are <em>rows</em> of our data frame (properties of two
different bridges), so we will need to use a strategy like the one I
used in calculating the Bray-Curtis distances.
First, write a function that takes as input two vectors <code>v</code>
and <code>w</code> and counts the number of their entries that differ
(comparing the first with the first, the second with the second,
, the last with the last. I can think of a quick way and a
slow way, but either way is good.) To test your function, create two
vectors (using <code>c</code>) of the same length, and see whether it
correctly counts the number of corresponding values that are
different.</p></li>
<li><p>Write a function that has as input two row numbers and a data
frame to take those rows from. The function needs to select all the
columns except for <code>id</code> and <code>location</code>, select the
rows required one at a time, and turn them into vectors. (There may
be some repetitiousness here. That’s OK.) Then those two vectors
are passed into the function you wrote in the previous part, and the
count of the number of differences is returned. This is like the
code in the Bray-Curtis problem. Test your function on rows 3 and 4
of your bridges data set (with the missings removed). There should
be six variables that are different.</p></li>
<li><p>Create a matrix or data frame of pairwise dissimilarities
between each pair of bridges (using only the ones with no missing
values). Use loops, or <code>crossing</code> and <code>rowwise</code>, as
you prefer. Display the first six rows of
your matrix (using <code>head</code>) or the first few rows of your data
frame. (The whole thing is big, so don’t display it all.)</p></li>
<li><p>Turn your matrix or data frame into a <code>dist</code>
object. (If you couldn’t create a matrix or data frame of
dissimilarities, read them in from
<a href="https://raw.githubusercontent.com/nxskok/datafiles/master/mm.csv">link</a>.) Do not
display your distance object.</p></li>
<li><p>Run a cluster analysis using Ward’s method, and display a
dendrogram. The labels for the bridges (rows of the data frame) may
come out too big; experiment with a <code>cex</code> less than 1 on the
plot so that you can see them.</p></li>
<li><p>How many clusters do you think is reasonable for these
data? Draw them on your plot.</p></li>
<li><p>Pick three bridges in the same one of your clusters (it
doesn’t matter which three bridges or which cluster). Display the
data for these bridges. Does it make sense that these three bridges
ended up in the same cluster? Explain briefly.</p></li>
</ol>
<p>My solutions follow:</p>
</div>
<div id="sites-on-the-sea-bed-1" class="section level2">
<h2><span class="header-section-number">35.5</span> Sites on the sea bed</h2>
<p>Biologists investigate the prevalence of
species of organism by sampling sites where the organisms might be,
taking a “grab” from the site, and sending the grabs to a laboratory
for analysis. The data in this question come from the sea bed. There
were 30 sites, labelled <code>s1</code> through <code>s30</code>. At each
site, five species of organism, labelled <code>a</code> through
<code>e</code>, were of interest; the data shown in those columns of the
data set were the number of organisms of that species identified in
the grab from that site. There are some other columns in the
(original) data set that will not concern us. Our interest is in
seeing which sites are similar to which other sites, so that a cluster
analysis will be suitable.</p>
<p>When the data are counts of different species, as they are here,
biologists often measure the dissimilarity in species prevalence
profiles between two sites using something called the Bray-Curtis
dissimilarity. It is not important to understand this for this
question (though I explain it in my solutions). I calculated the
Bray-Curtis dissimilarity between each pair of sites and stored the
results in <a href="http://ritsokiguess.site/datafiles/seabed1.csv">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the dissimilarity data and check that you have 30
rows and 30 columns of dissimilarities.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" title="1">my_url &lt;-<span class="st"> &quot;http://ritsokiguess.site/datafiles/seabed1.csv&quot;</span></a>
<a class="sourceLine" id="cb255-2" title="2">seabed &lt;-<span class="st"> </span><span class="kw">read_csv</span>(my_url)</a></code></pre></div>
<pre><code>## 
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
## cols(
##   .default = col_double()
## )
## ℹ Use `spec()` for the full column specifications.</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" title="1">seabed</a></code></pre></div>
<pre><code>## # A tibble: 30 x 30
##       s1    s2    s3    s4    s5    s6    s7    s8    s9   s10   s11   s12   s13
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 0     0.457 0.296 0.467 0.477 0.522 0.455 0.933 0.333 0.403 0.357 0.375 0.577
##  2 0.457 0     0.481 0.556 0.348 0.229 0.415 0.930 0.222 0.447 0.566 0.215 0.671
##  3 0.296 0.481 0     0.467 0.508 0.522 0.491 1     0.407 0.343 0.214 0.325 0.654
##  4 0.467 0.556 0.467 0     0.786 0.692 0.870 1     0.639 0.379 0.532 0.549 0.302
##  5 0.477 0.348 0.508 0.786 0     0.419 0.212 0.854 0.196 0.564 0.373 0.319 0.714
##  6 0.522 0.229 0.522 0.692 0.419 0     0.509 0.933 0.243 0.571 0.530 0.237 0.676
##  7 0.455 0.415 0.491 0.870 0.212 0.509 0     0.806 0.317 0.588 0.509 0.358 0.925
##  8 0.933 0.930 1     1     0.854 0.933 0.806 0     0.895 1     0.938 0.929 0.929
##  9 0.333 0.222 0.407 0.639 0.196 0.243 0.317 0.895 0     0.489 0.349 0.159 0.595
## 10 0.403 0.447 0.343 0.379 0.564 0.571 0.588 1     0.489 0     0.449 0.419 0.415
## # … with 20 more rows, and 17 more variables: s14 &lt;dbl&gt;, s15 &lt;dbl&gt;, s16 &lt;dbl&gt;,
## #   s17 &lt;dbl&gt;, s18 &lt;dbl&gt;, s19 &lt;dbl&gt;, s20 &lt;dbl&gt;, s21 &lt;dbl&gt;, s22 &lt;dbl&gt;,
## #   s23 &lt;dbl&gt;, s24 &lt;dbl&gt;, s25 &lt;dbl&gt;, s26 &lt;dbl&gt;, s27 &lt;dbl&gt;, s28 &lt;dbl&gt;,
## #   s29 &lt;dbl&gt;, s30 &lt;dbl&gt;</code></pre>
<p>Check. The columns are labelled with
the site names. (As I originally set this question, the data file was
read in with <code>read.csv</code> instead, and the site names were read
in as row names as well: see discussion elsewhere about row names. But
in the <code>tidyverse</code> we don’t have row names.)</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Create a distance object out of your dissimilarities,
bearing in mind that the values are distances (well,
dissimilarities) already.</li>
</ol>
<p>Solution</p>
<p>This one needs <code>as.dist</code> to convert already-distances into
a <code>dist</code> object. (<code>dist</code> would have
<em>calculated</em> distances from things that were not
distances/dissimilarities yet.)</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" title="1">d &lt;-<span class="st"> </span><span class="kw">as.dist</span>(seabed)</a></code></pre></div>
<p>If you check, you’ll see that the site names are being used to label
rows <em>and</em> columns of the dissimilarity matrix as displayed. The
lack of row names is not hurting us.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Fit a cluster analysis using single-linkage, and display a
dendrogram of the results.</li>
</ol>
<p>Solution</p>
<p>This:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" title="1">d<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;single&quot;</span>)</a>
<a class="sourceLine" id="cb260-2" title="2"><span class="kw">plot</span>(d<span class="fl">.1</span>)</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-162-1.png" width="672" /></p>
<p>This is a base-graphics plot, it not having any of the nice
<code>ggplot</code> things. But it does the job.</p>
<p>Single-linkage tends to produce “stringy” clusters, since the
individual being added to a cluster only needs to be close to one
thing in the cluster. Here, that manifests itself in sites getting
added to clusters one at a time: for example, sites 25 and 26 get
joined together into a cluster, and then in sequence sites 6, 16, 27,
30 and 22 get joined on to it (rather than any of those sites being
formed into clusters first).</p>
<p>You might<a href="#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a> be wondering what else is in that
<code>hclust</code> object, and what it’s good for. Let’s take a look:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" title="1"><span class="kw">glimpse</span>(d<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## List of 7
##  $ merge      : int [1:29, 1:2] -3 -25 -6 -9 -28 -16 -27 -1 -30 -24 ...
##  $ height     : num [1:29] 0.1 0.137 0.152 0.159 0.159 ...
##  $ order      : int [1:30] 21 14 29 23 15 1 19 18 2 7 ...
##  $ labels     : chr [1:30] &quot;s1&quot; &quot;s2&quot; &quot;s3&quot; &quot;s4&quot; ...
##  $ method     : chr &quot;single&quot;
##  $ call       : language hclust(d = d, method = &quot;single&quot;)
##  $ dist.method: NULL
##  - attr(*, &quot;class&quot;)= chr &quot;hclust&quot;</code></pre>
<p>You might guess that <code>labels</code> contains the names of the sites,
and you’d be correct. Of the other things, the most interesting are
<code>merge</code> and <code>height</code>. Let’s display them side by side:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" title="1"><span class="kw">with</span>(d<span class="fl">.1</span>, <span class="kw">cbind</span>(height, merge))</a></code></pre></div>
<pre><code>##          height        
##  [1,] 0.1000000  -3 -20
##  [2,] 0.1369863 -25 -26
##  [3,] 0.1523179  -6   2
##  [4,] 0.1588785  -9 -12
##  [5,] 0.1588785 -28   4
##  [6,] 0.1617647 -16   3
##  [7,] 0.1633987 -27   6
##  [8,] 0.1692308  -1 -19
##  [9,] 0.1807229 -30   7
## [10,] 0.1818182 -24   5
## [11,] 0.1956522  -5  10
## [12,] 0.2075472 -15   8
## [13,] 0.2083333 -14 -29
## [14,] 0.2121212  -7  11
## [15,] 0.2142857 -11   1
## [16,] 0.2149533  -2  14
## [17,] 0.2191781 -18  16
## [18,] 0.2205882 -22   9
## [19,] 0.2285714  17  18
## [20,] 0.2307692  12  19
## [21,] 0.2328767 -10  15
## [22,] 0.2558140  20  21
## [23,] 0.2658228 -23  22
## [24,] 0.2666667  13  23
## [25,] 0.3023256  -4 -13
## [26,] 0.3333333  24  25
## [27,] 0.3571429 -21  26
## [28,] 0.4285714  -8 -17
## [29,] 0.6363636  27  28</code></pre>
<p><code>height</code> is the vertical scale of the dendrogram. The first
height is 0.1, and if you look at the bottom of the dendrogram, the
first sites to be joined together are sites 3 and 20 at height 0.1
(the horizontal bar joining sites 3 and 20 is what you are looking
for). In the last two columns, which came from <code>merge</code>, you see
what got joined together, with negative numbers meaning individuals
(individual sites), and positive numbers meaning clusters formed
earlier. So, if you look at the third line, at height 0.152, site 6
gets joined to the cluster formed on line 2, which (looking back) we
see consists of sites 25 and 26. Go back now to the dendrogram; about
<span class="math inline">\({3\over 4}\)</span> of the way across, you’ll see sites 25 and 26 joined
together into a cluster, and a little higher up the page, site 6 joins
that cluster.</p>
<p>I said that single linkage produces stringy clusters, and the way that
shows up in <code>merge</code> is that you often get an individual site
(negative number) joined onto a previously-formed cluster (positive
number). This is in contrast to Ward’s method, below.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Now fit a cluster analysis using Ward’s method, and display
a dendrogram of the results.</li>
</ol>
<p>Solution</p>
<p>Same thing, with small changes. The hard part is getting the name
of the <code>method</code> right:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" title="1">d<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;ward.D&quot;</span>)</a>
<a class="sourceLine" id="cb265-2" title="2"><span class="kw">plot</span>(d<span class="fl">.2</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-165-1.png" width="672" /></p>
<p>The site numbers were a bit close together, so I printed them out
smaller than usual size (which is what the <code>cex</code> and a number
less than 1 is doing: 70% of normal size).<a href="#fn38" class="footnote-ref" id="fnref38"><sup>38</sup></a>
This time, there is a greater tendency for sites to be joined into
small clusters first, then these small clusters are joined
together. It’s not perfect, but there is a greater tendency for it to
happen here.</p>
<p>This shows up in <code>merge</code> too:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" title="1">d<span class="fl">.2</span><span class="op">$</span>merge</a></code></pre></div>
<pre><code>##       [,1] [,2]
##  [1,]   -3  -20
##  [2,]  -25  -26
##  [3,]   -9  -12
##  [4,]  -28    3
##  [5,]   -1  -19
##  [6,]   -6    2
##  [7,]  -14  -29
##  [8,]   -5   -7
##  [9,]  -18  -24
## [10,]  -27    6
## [11,]  -16  -22
## [12,]   -2    4
## [13,]  -30   10
## [14,]  -15    5
## [15,]  -23    8
## [16,]   -4  -13
## [17,]  -11    1
## [18,]    9   12
## [19,]  -10   17
## [20,]   -8  -17
## [21,]   11   13
## [22,]  -21   15
## [23,]    7   22
## [24,]   14   19
## [25,]   16   24
## [26,]   18   21
## [27,]   20   23
## [28,]   26   27
## [29,]   25   28</code></pre>
<p>There are relatively few instances of a site being joined to a cluster
of sites. Usually, individual sites get joined together (negative with
a negative, mainly at the top of the list), or clusters get joined to
clusters (positive with positive, mainly lower down the list).</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li><a name="part:prefclust">*</a> On the Ward’s method clustering, how many clusters would you
choose to divide the sites into? Draw rectangles around those clusters.</li>
</ol>
<p>Solution</p>
<p>You may need to draw the plot again. In any case, a second line of
code draws the rectangles. I think three clusters is good, but you
can have a few more than that if you like:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" title="1"><span class="kw">plot</span>(d<span class="fl">.2</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb268-2" title="2"><span class="kw">rect.hclust</span>(d<span class="fl">.2</span>, <span class="dv">3</span>)</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-167-1.png" width="672" /></p>
<p>What I want to see is a not-unreasonable choice of number of clusters
(I think you could go up to about six), and then a depiction of that
number of clusters on the plot. This is six clusters:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" title="1"><span class="kw">plot</span>(d<span class="fl">.2</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb269-2" title="2"><span class="kw">rect.hclust</span>(d<span class="fl">.2</span>, <span class="dv">6</span>)</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-168-1.png" width="672" /></p>
<p>In all your plots, the <code>cex</code> is optional, but you can compare
the plots with it and without it and see which you prefer.</p>
<p>Looking at this, even seven clusters might work, but I doubt you’d
want to go beyond that. The choice of the number of clusters is mainly
an aesthetic<a href="#fn39" class="footnote-ref" id="fnref39"><sup>39</sup></a> decision.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li><a name="part:original">*</a> The original data is in
<a href="http://ritsokiguess.site/datafiles/seabed.csv">link</a>. Read in the
original data and verify that you again have 30 sites, variables
called <code>a</code> through <code>e</code> and some others.</li>
</ol>
<p>Solution</p>
<p>Thus:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" title="1">my_url &lt;-<span class="st"> &quot;http://ritsokiguess.site/datafiles/seabed.csv&quot;</span></a>
<a class="sourceLine" id="cb270-2" title="2">seabed.z &lt;-<span class="st"> </span><span class="kw">read_csv</span>(my_url)</a></code></pre></div>
<pre><code>## 
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
## cols(
##   site = col_character(),
##   a = col_double(),
##   b = col_double(),
##   c = col_double(),
##   d = col_double(),
##   e = col_double(),
##   depth = col_double(),
##   pollution = col_double(),
##   temp = col_double(),
##   sediment = col_character()
## )</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" title="1">seabed.z</a></code></pre></div>
<pre><code>## # A tibble: 30 x 10
##    site      a     b     c     d     e depth pollution  temp sediment
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
##  1 s1        0     2     9    14     2    72       4.8   3.5 s       
##  2 s2       26     4    13    11     0    75       2.8   2.5 c       
##  3 s3        0    10     9     8     0    59       5.4   2.7 c       
##  4 s4        0     0    15     3     0    64       8.2   2.9 s       
##  5 s5       13     5     3    10     7    61       3.9   3.1 c       
##  6 s6       31    21    13    16     5    94       2.6   3.5 g       
##  7 s7        9     6     0    11     2    53       4.6   2.9 s       
##  8 s8        2     0     0     0     1    61       5.1   3.3 c       
##  9 s9       17     7    10    14     6    68       3.9   3.4 c       
## 10 s10       0     5    26     9     0    69      10     3   s       
## # … with 20 more rows</code></pre>
<p>30 observations of 10 variables, including <code>a</code> through
<code>e</code>. Check.</p>
<p>I gave this a weird name so that it didn’t overwrite my original
<code>seabed</code>, the one I turned into a distance object, though I
don’t think I really needed to worry.</p>
<p>These data came from
<a href="http://www.fbbva.es/TLFU/dat/DE_2013_multivariate.pdf">link</a>,<a href="#fn40" class="footnote-ref" id="fnref40"><sup>40</sup></a> from which I also got the definition of the Bray-Curtis
dissimilarity that I calculated for you. The data are in Exhibit 1.1
of that book.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Go back to your Ward method dendrogram with the red
rectangles and find two sites in the same cluster. Display the
original data for your two sites and see if you can explain why they
are in the same cluster. It doesn’t matter which two sites you choose;
the grader will merely check that your results look reasonable.</li>
</ol>
<p>Solution</p>
<p>I want my two sites to be very similar, so I’m looking at two sites
that were joined into a cluster very early on, sites <code>s3</code> and
<code>s20</code>. As I said, I don’t mind which ones you pick, but being
in the same cluster will be easiest to justify if you pick sites
that were joined together early.
Then you need to display just those rows of the original data (that
you just read in), which is a <code>filter</code> with an “or” in it:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" title="1">seabed.z <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(site <span class="op">==</span><span class="st"> &quot;s3&quot;</span> <span class="op">|</span><span class="st"> </span>site <span class="op">==</span><span class="st"> &quot;s20&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 10
##   site      a     b     c     d     e depth pollution  temp sediment
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
## 1 s3        0    10     9     8     0    59       5.4   2.7 c       
## 2 s20       0    10    14     9     0    73       5.6   3   s</code></pre>
<p>I think this odd-looking thing also works:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb276-1" title="1">seabed.z <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(site <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;s3&quot;</span>, <span class="st">&quot;s20&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 10
##   site      a     b     c     d     e depth pollution  temp sediment
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
## 1 s3        0    10     9     8     0    59       5.4   2.7 c       
## 2 s20       0    10    14     9     0    73       5.6   3   s</code></pre>
<p>I’ll also take displaying the lines one at a time, though it is easier
to compare them if they are next to each other.</p>
<p>Why are they in the same cluster? To be similar (that is, have a low
dissimilarity), the values of <code>a</code> through <code>e</code> should be
close together. Here, they certainly are: <code>a</code> and <code>e</code>
are both zero for both sites, and <code>b</code>, <code>c</code> and
<code>d</code> are around 10 for both sites. So I’d call that similar.</p>
<p>You will probably pick a different pair of sites, and thus your
detailed discussion will differ from mine, but the general point of it
should be the same: pick a pair of sites in the same cluster (1 mark),
display those two rows of the original data (1 mark), some sensible
discussion of how the sites are similar (1 mark). As long as you pick
two sites in the same one of your clusters, I don’t mind which ones
you pick. The grader will check that your two sites were indeed in the
same one of your clusters, then will check that you do indeed display
those two sites from the original data.</p>
<p>What happens if you pick sites from different clusters? Let’s pick two
very dissimilar ones, sites 4 and 7 from opposite ends of my dendrogram:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb278-1" title="1">seabed.z <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(site <span class="op">==</span><span class="st"> &quot;s4&quot;</span> <span class="op">|</span><span class="st"> </span>site <span class="op">==</span><span class="st"> &quot;s7&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 10
##   site      a     b     c     d     e depth pollution  temp sediment
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
## 1 s4        0     0    15     3     0    64       8.2   2.9 s       
## 2 s7        9     6     0    11     2    53       4.6   2.9 s</code></pre>
<p>Site <code>s4</code> has no <code>a</code> or <code>b</code> at all, and site
<code>s7</code> has quite a few; site <code>s7</code> has no <code>c</code> at
all, while site <code>s4</code> has a lot. These are very different sites.</p>
<p>Extra: now that you’ve seen what the original data look like, I should
explain how I got the Bray-Curtis dissimilarities. As I said, only the
counts of species <code>a</code> through <code>e</code> enter into the
calculation; the other variables have nothing to do with it.</p>
<p>Let’s simplify matters by pretending that we have only two species (we
can call them A and B), and a vector like this:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb280-1" title="1">v1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">3</span>)</a></code></pre></div>
<p>which says that we have 10 organisms of species A and 3 of species B
at a site. This is rather similar to this site:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" title="1">v2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">4</span>)</a></code></pre></div>
<p>but very different from this site:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" title="1">v3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">7</span>)</a></code></pre></div>
<p>The way you calculate the Bray-Curtis dissimilarity is to take the
absolute difference of counts of organisms of each species:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" title="1"><span class="kw">abs</span>(v1 <span class="op">-</span><span class="st"> </span>v2)</a></code></pre></div>
<pre><code>## [1] 2 1</code></pre>
<p>and add those up:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb285-1" title="1"><span class="kw">sum</span>(<span class="kw">abs</span>(v1 <span class="op">-</span><span class="st"> </span>v2))</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>and then divide by the total of all the frequencies:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb287-1" title="1"><span class="kw">sum</span>(<span class="kw">abs</span>(v1 <span class="op">-</span><span class="st"> </span>v2)) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(v1 <span class="op">+</span><span class="st"> </span>v2)</a></code></pre></div>
<pre><code>## [1] 0.12</code></pre>
<p>The smaller this number is, the more similar the sites are. So you
might imagine that <code>v1</code> and <code>v3</code> would be more dissimilar:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb289-1" title="1"><span class="kw">sum</span>(<span class="kw">abs</span>(v1 <span class="op">-</span><span class="st"> </span>v3)) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(v1 <span class="op">+</span><span class="st"> </span>v3)</a></code></pre></div>
<pre><code>## [1] 0.7</code></pre>
<p>and so it is. The scaling of the Bray-Curtis dissimilarity is that the
smallest it can be is 0, if the frequencies of each of the species are
exactly the same at the two sites, and the largest it can be is 1, if
one site has only species A and the other has only species B. (I’ll
demonstrate that in a moment.)
You might imagine that we’ll be doing this calculation a lot, and so
we should define a function to automate it. Hadley Wickham
(in “R for Data Science”) says that you should copy and paste some code (as
I did above) no more than twice; if you need to do it again, you
should write a function instead. The thinking behind this is if you
copy and paste and change something (like a variable name), you’ll
need to make the change <em>everywhere</em>, and it’s so easy to miss
one.
So, my function is (copying and pasting my code from above into the
body of the function, which is Wickham-approved since it’s only my
second time):</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb291-1" title="1">braycurtis &lt;-<span class="st"> </span><span class="cf">function</span>(v1, v2) {</a>
<a class="sourceLine" id="cb291-2" title="2">  <span class="kw">sum</span>(<span class="kw">abs</span>(v1 <span class="op">-</span><span class="st"> </span>v2)) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(v1 <span class="op">+</span><span class="st"> </span>v2)</a>
<a class="sourceLine" id="cb291-3" title="3">}</a></code></pre></div>
<p>Let’s test it on my made-up sites, making up one more:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb292-1" title="1"><span class="kw">braycurtis</span>(v1, v2)</a></code></pre></div>
<pre><code>## [1] 0.12</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb294-1" title="1"><span class="kw">braycurtis</span>(v1, v3)</a></code></pre></div>
<pre><code>## [1] 0.7</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb296-1" title="1"><span class="kw">braycurtis</span>(v2, v2)</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb298-1" title="1">v4 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb298-2" title="2"><span class="kw">braycurtis</span>(v3, v4)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>These all check out. The first two are repeats of the ones we did
before. The third one says that if you calculate Bray-Curtis for two
sites with the exact same frequencies all the way along, you get the
minimum value of 0; the fourth one says that when site <code>v3</code>
only has species B and site <code>v4</code> only has species A, you get
the maximum value of 1.</p>
<p>But note this:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb300-1" title="1">v2</a></code></pre></div>
<pre><code>## [1] 8 4</code></pre>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb302-1" title="1"><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>v2</a></code></pre></div>
<pre><code>## [1] 16  8</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb304-1" title="1"><span class="kw">braycurtis</span>(v2, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>v2)</a></code></pre></div>
<pre><code>## [1] 0.3333333</code></pre>
<p>You might say that <code>v2</code> and <code>2*v2</code> are the same
distribution, and so they are, proportionately. But Bray-Curtis is
assessing whether the frequencies are <em>the same</em> (as opposed to
something like a chi-squared test that is assessing
proportionality).<a href="#fn41" class="footnote-ref" id="fnref41"><sup>41</sup></a></p>
<p>So far so good. Now we have to do this for the actual data. The first
issue<a href="#fn42" class="footnote-ref" id="fnref42"><sup>42</sup></a> is that the data is some of the
row of the original data frame; specifically, it’s columns 2 through
6. For example, sites <code>s3</code> and <code>s20</code> of the original
data frame look like this:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb306-1" title="1">seabed.z <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(site <span class="op">==</span><span class="st"> &quot;s3&quot;</span> <span class="op">|</span><span class="st"> </span>site <span class="op">==</span><span class="st"> &quot;s20&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 10
##   site      a     b     c     d     e depth pollution  temp sediment
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
## 1 s3        0    10     9     8     0    59       5.4   2.7 c       
## 2 s20       0    10    14     9     0    73       5.6   3   s</code></pre>
<p>and we don’t want to feed the whole of those into <code>braycurtis</code>,
just the second through sixth elements of them. So let’s write another
function that extracts the columns <code>a</code> through <code>e</code> of its
inputs for given rows, and passes those on to the <code>braycurtis</code>
that we wrote before. This is a little fiddly, but bear with me. The
input to the function is the data frame, then the two sites that we want:
First, though, what happens if <code>filter</code> site <code>s3</code>?</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb308-1" title="1">seabed.z <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(site <span class="op">==</span><span class="st"> &quot;s3&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 10
##   site      a     b     c     d     e depth pollution  temp sediment
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
## 1 s3        0    10     9     8     0    59       5.4   2.7 c</code></pre>
<p>This is a one-row data frame, not a vector as our function expects.
Do we need to worry about it? First, grab the right columns, so that we will know what our function has to do:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb310-1" title="1">seabed.z <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb310-2" title="2"><span class="st">  </span><span class="kw">filter</span>(site <span class="op">==</span><span class="st"> &quot;s3&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb310-3" title="3"><span class="st">  </span><span class="kw">select</span>(a<span class="op">:</span>e)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##       a     b     c     d     e
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0    10     9     8     0</code></pre>
<p>That leads us to this function, which is a bit repetitious, but for
two repeats I can handle it. I haven’t done anything about the fact
that <code>x</code> and <code>y</code> below are actually data frames:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb312-1" title="1">braycurtis.spec &lt;-<span class="st"> </span><span class="cf">function</span>(d, i, j) {</a>
<a class="sourceLine" id="cb312-2" title="2">  d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(site <span class="op">==</span><span class="st"> </span>i) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(a<span class="op">:</span>e) -&gt;<span class="st"> </span>x</a>
<a class="sourceLine" id="cb312-3" title="3">  d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(site <span class="op">==</span><span class="st"> </span>j) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(a<span class="op">:</span>e) -&gt;<span class="st"> </span>y</a>
<a class="sourceLine" id="cb312-4" title="4">  <span class="kw">braycurtis</span>(x, y)</a>
<a class="sourceLine" id="cb312-5" title="5">}</a></code></pre></div>
<p>The first time I did this, I had the <code>filter</code> and the
<code>select</code> in the opposite order, so I was neatly <em>removing</em>
the column I wanted to <code>filter</code> by <em>before</em> I did the
<code>filter</code>!</p>
<p>The first two lines pull out columns <code>a</code> through <code>e</code> of
(respectively) sites <code>i</code> and <code>j</code>.</p>
<p>If I were going to create more than two things like <code>x</code> and
<code>y</code>, I would have hived that off
into a separate function as well, but I didn’t.</p>
<p>Sites 3 and 20 were the two sites I chose before as being similar ones (in the
same cluster). So the dissimilarity should be small:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb313-1" title="1"><span class="kw">braycurtis.spec</span>(seabed.z, <span class="st">&quot;s3&quot;</span>, <span class="st">&quot;s20&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 0.1</code></pre>
<p>and so it is. Is it about right? The <code>c</code> differ by 5, the
<code>d</code> differ by one, and the total frequency in both rows is
about 60, so the dissimilarity should be about <span class="math inline">\(6/60=0.1\)</span>, as it is
(exactly, in fact).</p>
<p>This, you will note, works. I think R has taken the attitude that it
can treat these one-row data frames as if they were vectors.
This is the cleaned-up version of my function. When I first wrote it,
I <code>print</code>ed out <code>x</code> and <code>y</code>, so that I could
check that they were what I was expecting (they were).<a href="#fn43" class="footnote-ref" id="fnref43"><sup>43</sup></a>
We have almost all the machinery we need. Now what we have to do is to
compare every site with every other site and compute the dissimilarity
between them. If you’re used to Python or another similar language,
you’ll recognize this as two loops, one inside the other. This can be done in R (and I’ll show you how), but I’d rather show you the Tidyverse way first.</p>
<p>The starting point is to make a vector containing all the sites, which
is easier than you would guess:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb315-1" title="1">sites &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;s&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">30</span>)</a>
<a class="sourceLine" id="cb315-2" title="2">sites</a></code></pre></div>
<pre><code>##  [1] &quot;s1&quot;  &quot;s2&quot;  &quot;s3&quot;  &quot;s4&quot;  &quot;s5&quot;  &quot;s6&quot;  &quot;s7&quot;  &quot;s8&quot;  &quot;s9&quot;  &quot;s10&quot; &quot;s11&quot; &quot;s12&quot;
## [13] &quot;s13&quot; &quot;s14&quot; &quot;s15&quot; &quot;s16&quot; &quot;s17&quot; &quot;s18&quot; &quot;s19&quot; &quot;s20&quot; &quot;s21&quot; &quot;s22&quot; &quot;s23&quot; &quot;s24&quot;
## [25] &quot;s25&quot; &quot;s26&quot; &quot;s27&quot; &quot;s28&quot; &quot;s29&quot; &quot;s30&quot;</code></pre>
<p>Next, we need to make all possible <em>pairs</em> of sites, which we
also know how to do:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb317-1" title="1">site_pairs &lt;-<span class="st"> </span><span class="kw">crossing</span>(<span class="dt">site1 =</span> sites, <span class="dt">site2 =</span> sites)</a>
<a class="sourceLine" id="cb317-2" title="2">site_pairs</a></code></pre></div>
<pre><code>## # A tibble: 900 x 2
##    site1 site2
##    &lt;chr&gt; &lt;chr&gt;
##  1 s1    s1   
##  2 s1    s10  
##  3 s1    s11  
##  4 s1    s12  
##  5 s1    s13  
##  6 s1    s14  
##  7 s1    s15  
##  8 s1    s16  
##  9 s1    s17  
## 10 s1    s18  
## # … with 890 more rows</code></pre>
<p>Now, think about what to do in English first: “for each of the sites in <code>site1</code>, and for each of the sites in <code>site2</code>, taken in parallel, work out the Bray-Curtis distance.” This is, I hope,
making you think of <code>rowwise</code>:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb319-1" title="1">site_pairs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb319-2" title="2"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb319-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">bray_curtis =</span> <span class="kw">braycurtis.spec</span>(seabed.z, site1, site2)) -&gt;<span class="st"> </span>bc</a>
<a class="sourceLine" id="cb319-4" title="4">bc</a></code></pre></div>
<pre><code>## # A tibble: 900 x 3
## # Rowwise: 
##    site1 site2 bray_curtis
##    &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;
##  1 s1    s1          0    
##  2 s1    s10         0.403
##  3 s1    s11         0.357
##  4 s1    s12         0.375
##  5 s1    s13         0.577
##  6 s1    s14         0.633
##  7 s1    s15         0.208
##  8 s1    s16         0.857
##  9 s1    s17         1    
## 10 s1    s18         0.569
## # … with 890 more rows</code></pre>
<p>(you might notice that this takes a noticeable time to run.)</p>
<p>This is a “long” data frame, but for the cluster analysis, we need a wide one with sites in rows and columns, so let’s create that:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb321-1" title="1">(bc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pivot_wider</span>(<span class="dt">names_from=</span>site2, <span class="dt">values_from=</span>bray_curtis) -&gt;<span class="st"> </span>bc2)</a></code></pre></div>
<pre><code>## # A tibble: 30 x 31
##    site1    s1   s10   s11   s12   s13   s14   s15   s16   s17   s18   s19    s2
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 s1    0     0.403 0.357 0.375 0.577 0.633 0.208 0.857 1     0.569 0.169 0.457
##  2 s10   0.403 0     0.449 0.419 0.415 0.710 0.424 0.856 1     0.380 0.333 0.447
##  3 s11   0.357 0.449 0     0.463 0.481 0.765 0.491 0.66  1     0.627 0.343 0.566
##  4 s12   0.375 0.419 0.463 0     0.667 0.413 0.342 0.548 0.860 0.254 0.253 0.215
##  5 s13   0.577 0.415 0.481 0.667 0     1     0.608 0.875 1     0.667 0.524 0.671
##  6 s14   0.633 0.710 0.765 0.413 1     0     0.458 0.656 0.692 0.604 0.633 0.421
##  7 s15   0.208 0.424 0.491 0.342 0.608 0.458 0     0.856 0.733 0.548 0.25  0.375
##  8 s16   0.857 0.856 0.66  0.548 0.875 0.656 0.856 0     0.893 0.512 0.761 0.472
##  9 s17   1     1     1     0.860 1     0.692 0.733 0.893 0     0.914 0.905 0.862
## 10 s18   0.569 0.380 0.627 0.254 0.667 0.604 0.548 0.512 0.914 0     0.449 0.315
## # … with 20 more rows, and 18 more variables: s20 &lt;dbl&gt;, s21 &lt;dbl&gt;, s22 &lt;dbl&gt;,
## #   s23 &lt;dbl&gt;, s24 &lt;dbl&gt;, s25 &lt;dbl&gt;, s26 &lt;dbl&gt;, s27 &lt;dbl&gt;, s28 &lt;dbl&gt;,
## #   s29 &lt;dbl&gt;, s3 &lt;dbl&gt;, s30 &lt;dbl&gt;, s4 &lt;dbl&gt;, s5 &lt;dbl&gt;, s6 &lt;dbl&gt;, s7 &lt;dbl&gt;,
## #   s8 &lt;dbl&gt;, s9 &lt;dbl&gt;</code></pre>
<p>That’s the data frame I shared with you.</p>
<p>The more Python-like way of doing it is a loop inside a loop. This
works in R, but it has more housekeeping and a few possibly unfamiliar
ideas. We are going to work with a <code>matrix</code>, and we access
elements of a matrix with two numbers inside square brackets, a row
number and a column number. We also have to initialize our matrix that
we’re going to fill with Bray-Curtis distances; I’ll fill it with <span class="math inline">\(-1\)</span>
values, so that if any are left at the end, I’ll know I missed
something.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb323-1" title="1">m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">30</span>, <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb323-2" title="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">30</span>) {</a>
<a class="sourceLine" id="cb323-3" title="3">  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">30</span>) {</a>
<a class="sourceLine" id="cb323-4" title="4">    m[i, j] &lt;-<span class="st"> </span><span class="kw">braycurtis.spec</span>(seabed.z, sites[i], sites[j])</a>
<a class="sourceLine" id="cb323-5" title="5">  }</a>
<a class="sourceLine" id="cb323-6" title="6">}</a>
<a class="sourceLine" id="cb323-7" title="7"><span class="kw">rownames</span>(m) &lt;-<span class="st"> </span>sites</a>
<a class="sourceLine" id="cb323-8" title="8"><span class="kw">colnames</span>(m) &lt;-<span class="st"> </span>sites</a>
<a class="sourceLine" id="cb323-9" title="9"><span class="kw">head</span>(m)</a></code></pre></div>
<pre><code>##           s1        s2        s3        s4        s5        s6        s7
## s1 0.0000000 0.4567901 0.2962963 0.4666667 0.4769231 0.5221239 0.4545455
## s2 0.4567901 0.0000000 0.4814815 0.5555556 0.3478261 0.2285714 0.4146341
## s3 0.2962963 0.4814815 0.0000000 0.4666667 0.5076923 0.5221239 0.4909091
## s4 0.4666667 0.5555556 0.4666667 0.0000000 0.7857143 0.6923077 0.8695652
## s5 0.4769231 0.3478261 0.5076923 0.7857143 0.0000000 0.4193548 0.2121212
## s6 0.5221239 0.2285714 0.5221239 0.6923077 0.4193548 0.0000000 0.5087719
##           s8        s9       s10       s11       s12       s13       s14
## s1 0.9333333 0.3333333 0.4029851 0.3571429 0.3750000 0.5769231 0.6326531
## s2 0.9298246 0.2222222 0.4468085 0.5662651 0.2149533 0.6708861 0.4210526
## s3 1.0000000 0.4074074 0.3432836 0.2142857 0.3250000 0.6538462 0.6734694
## s4 1.0000000 0.6388889 0.3793103 0.5319149 0.5492958 0.3023256 0.8500000
## s5 0.8536585 0.1956522 0.5641026 0.3731343 0.3186813 0.7142857 0.2666667
## s6 0.9325843 0.2428571 0.5714286 0.5304348 0.2374101 0.6756757 0.5925926
##          s15       s16       s17       s18       s19       s20       s21
## s1 0.2075472 0.8571429 1.0000000 0.5689655 0.1692308 0.3333333 0.7333333
## s2 0.3750000 0.4720000 0.8620690 0.3146853 0.3695652 0.4022989 0.6666667
## s3 0.3584906 0.7346939 1.0000000 0.5344828 0.3230769 0.1000000 0.8222222
## s4 0.4090909 0.9325843 1.0000000 0.6635514 0.4642857 0.3333333 0.8333333
## s5 0.4687500 0.5045872 0.8095238 0.5118110 0.3947368 0.5211268 0.3571429
## s6 0.5357143 0.2484076 0.9111111 0.2571429 0.3870968 0.4621849 0.6730769
##          s22       s23       s24       s25       s26       s27       s28
## s1 0.7346939 0.4411765 0.5714286 0.7037037 0.6956522 0.6363636 0.3250000
## s2 0.3760000 0.5368421 0.2432432 0.3925926 0.3277311 0.3809524 0.2149533
## s3 0.6326531 0.5294118 0.3809524 0.6666667 0.6086957 0.6363636 0.5000000
## s4 0.9325843 0.8644068 0.5200000 0.9393939 0.9277108 0.9333333 0.5774648
## s5 0.3761468 0.2658228 0.4105263 0.5294118 0.4174757 0.3818182 0.3186813
## s6 0.2993631 0.4488189 0.3006993 0.1856287 0.1523179 0.2151899 0.2949640
##          s29       s30
## s1 0.4339623 0.6071429
## s2 0.3500000 0.3669065
## s3 0.4339623 0.5892857
## s4 0.5454545 0.8446602
## s5 0.3125000 0.4796748
## s6 0.5357143 0.2163743</code></pre>
<p>Because my loops work with site <em>numbers</em> and my function works
with site <em>names</em>, I have to remember to refer to the site names
when I call my function. I also have to supply row and column names
(the site names).</p>
<p>That looks all right. Are all my Bray-Curtis distances between 0 and 1? I can smoosh my matrix into a vector and summarize it:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb325-1" title="1"><span class="kw">summary</span>(<span class="kw">as.vector</span>(m))</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0000  0.3571  0.5023  0.5235  0.6731  1.0000</code></pre>
<p>All the
dissimilarities are correctly between 0 and 1. We can also check the
one we did before:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb327-1" title="1">bc2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(site1 <span class="op">==</span><span class="st"> &quot;s3&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(s20)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##     s20
##   &lt;dbl&gt;
## 1   0.1</code></pre>
<p>or</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb329-1" title="1">m[<span class="dv">3</span>, <span class="dv">20</span>]</a></code></pre></div>
<pre><code>## [1] 0.1</code></pre>
<p>Check.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Obtain the cluster memberships for each site, for your
preferred number of clusters from part (<a href="#part:prefclust">here</a>). Add a
column to the original data that you read in, in part
(<a href="#part:original">here</a>), containing those cluster memberships, <em>as a
factor</em>. Obtain a plot that will enable you to assess the
relationship between those clusters and <code>pollution</code>. (Once you
have the cluster memberships, you can add them to the data frame and
make the graph using a pipe.) What do you see?</li>
</ol>
<p>Solution</p>
<p>Start by getting the clusters with <code>cutree</code>. I’m going with 3
clusters, though you can use the number of clusters you chose
before. (This is again making the grader’s life a misery, but her
instructions from me are to check that you have done something
reasonable, with the actual answer being less important.)</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb331-1" title="1">cluster &lt;-<span class="st"> </span><span class="kw">cutree</span>(d<span class="fl">.2</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb331-2" title="2">cluster</a></code></pre></div>
<pre><code>##  s1  s2  s3  s4  s5  s6  s7  s8  s9 s10 s11 s12 s13 s14 s15 s16 s17 s18 s19 s20 
##   1   2   1   1   3   2   3   3   2   1   1   2   1   3   1   2   3   2   1   1 
## s21 s22 s23 s24 s25 s26 s27 s28 s29 s30 
##   3   2   3   2   2   2   2   2   3   2</code></pre>
<p>Now, we add that to the original data, the data frame I called
<code>seabed.z</code>, and make a plot. The best one is a boxplot:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb333-1" title="1">seabed.z <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cluster =</span> <span class="kw">factor</span>(cluster)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> cluster, <span class="dt">y =</span> pollution)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-197-1.png" width="672" /></p>
<p>The clusters differ substantially in terms of the amount of pollution,
with my cluster 1 being highest and my cluster 2 being
lowest. (Cluster 3 has a low outlier.)</p>
<p>Any sensible plot will do here. I think boxplots are the best, but you
could also do something like vertically-faceted histograms:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb334-1" title="1">seabed.z <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb334-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cluster =</span> <span class="kw">factor</span>(cluster)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb334-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> pollution)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb334-4" title="4"><span class="st">  </span><span class="kw">facet_grid</span>(cluster <span class="op">~</span><span class="st"> </span>.)</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-198-1.png" width="672" /></p>
<p>which to my mind doesn’t show the differences as dramatically. (The bins are
determined from all the data together, so that each facet actually has
fewer than 8 bins. You can see where the bins would be if they had any
data in them.)</p>
<p>Here’s how 5 clusters looks:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb335-1" title="1">cluster &lt;-<span class="st"> </span><span class="kw">cutree</span>(d<span class="fl">.2</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb335-2" title="2">cluster</a></code></pre></div>
<pre><code>##  s1  s2  s3  s4  s5  s6  s7  s8  s9 s10 s11 s12 s13 s14 s15 s16 s17 s18 s19 s20 
##   1   2   1   1   3   4   3   5   2   1   1   2   1   3   1   4   5   2   1   1 
## s21 s22 s23 s24 s25 s26 s27 s28 s29 s30 
##   3   4   3   2   4   4   4   2   3   4</code></pre>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb337-1" title="1">seabed.z <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb337-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cluster =</span> <span class="kw">factor</span>(cluster)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb337-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> cluster, <span class="dt">y =</span> pollution)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-199-1.png" width="672" /></p>
<p>This time, the picture isn’t quite so clear-cut, but clusters 1 and 5
are the highest in terms of pollution and cluster 4 is the lowest. I’m
guessing that whatever number of clusters you choose, you’ll see some
differences in terms of pollution.</p>
<p>What is interesting is that <code>pollution</code> had <em>nothing</em> to
do with the original formation of the clusters: that was based only on
which species were found at each site. So, what we have shown here is that
the amount of pollution has some association with what species are found at a
site.</p>
<p>A way to go on with this is to use the clusters as “known groups”
and predict the cluster membership from <code>depth</code>,
<code>pollution</code> and <code>temp</code> using a discriminant
analysis. Then you could plot the sites, colour-coded by what cluster
they were in, and even though you had three variables, you could plot
it in two dimensions (or maybe even one dimension, depending how many
LD’s were important).</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="dissimilarities-between-fruits-1" class="section level2">
<h2><span class="header-section-number">35.6</span> Dissimilarities between fruits</h2>
<p>Consider the fruits apple, orange, banana, pear,
strawberry, blueberry. We are going to work with these four
properties of fruits:</p>
<ul>
<li><p>has a round shape</p></li>
<li><p>Is sweet</p></li>
<li><p>Is crunchy</p></li>
<li><p>Is a berry</p></li>
</ul>
<ol style="list-style-type: lower-alpha">
<li>Make a table with fruits as columns, and with
rows “round shape”, “sweet”, “crunchy”, “berry”. In each cell
of the table, put a 1 if the fruit has the property named in the
row, and a 0 if it does not. (This is your opinion, and may not
agree with mine. That doesn’t matter, as long as you follow through
with whatever your choices were.)</li>
</ol>
<p>Solution</p>
<p>Something akin to this:</p>
<pre><code>
Fruit        Apple Orange Banana Pear Strawberry Blueberry
Round shape    1      1      0     0       0         1
Sweet          1      1      0     0       1         0
Crunchy        1      0      0     1       0         0
Berry          0      0      0     0       1         1
</code></pre>
<p>You’ll have to make a choice about “crunchy”. I usually eat
pears before they’re fully ripe, so to me, they’re crunchy.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>We’ll define the dissimilarity between two fruits to be the
number of qualities they <em>disagree</em> on. Thus, for example, the
dissimilarity between Apple and Orange is 1 (an apple is crunchy and
an orange is not, but they agree on everything else). Calculate the
dissimilarity between each pair of fruits, and make a square table
that summarizes the results. (To save yourself some work, note that
the dissimilarity between a fruit and itself must be zero, and the
dissimilarity between fruits A and B is the same as that between B
and A.) Save your table of dissimilarities into a file for the next part.</li>
</ol>
<p>Solution</p>
<p>I got this, by counting them:</p>
<pre><code> 
Fruit         Apple  Orange   Banana   Pear  Strawberry  Blueberry
Apple           0       1       3       2        3          3
Orange          1       0       2       3        2          2
Banana          3       2       0       1        2          2
Pear            2       3       1       0        3          3
Strawberry      3       2       2       3        0          2
Blueberry       3       2       2       3        2          0
</code></pre>
<p>I copied this into a file <code>fruits.txt</code>. Note that (i) I
have aligned my columns, so that I will be able to use
<code>read_table</code> later, and (ii) I have given the first column
a name, since <code>read_table</code> wants the same number of column
names as columns.</p>
<p>Extra: yes, you can do this in R too. We’ve seen some of the tricks
before.</p>
<p>Let’s start by reading in my table of fruits and properties, which
I saved in
<a href="http://ritsokiguess.site/datafiles/fruit1.txt">link</a>:</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb340-1" title="1">my_url &lt;-<span class="st"> &quot;http://ritsokiguess.site/datafiles/fruit1.txt&quot;</span></a>
<a class="sourceLine" id="cb340-2" title="2">fruit1 &lt;-<span class="st"> </span><span class="kw">read_table</span>(my_url)</a></code></pre></div>
<pre><code>## 
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
## cols(
##   Property = col_character(),
##   Apple = col_double(),
##   Orange = col_double(),
##   Banana = col_double(),
##   Pear = col_double(),
##   Strawberry = col_double(),
##   Blueberry = col_double()
## )</code></pre>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb342-1" title="1">fruit1</a></code></pre></div>
<pre><code>## # A tibble: 4 x 7
##   Property    Apple Orange Banana  Pear Strawberry Blueberry
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1 Round.shape     1      1      0     0          0         1
## 2 Sweet           1      1      0     0          1         0
## 3 Crunchy         1      0      0     1          0         0
## 4 Berry           0      0      0     0          1         1</code></pre>
<p>We don’t need the first column, so we’ll get rid of it:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb344-1" title="1">fruit2 &lt;-<span class="st"> </span>fruit1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>Property)</a>
<a class="sourceLine" id="cb344-2" title="2">fruit2</a></code></pre></div>
<pre><code>## # A tibble: 4 x 6
##   Apple Orange Banana  Pear Strawberry Blueberry
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1     1      1      0     0          0         1
## 2     1      1      0     0          1         0
## 3     1      0      0     1          0         0
## 4     0      0      0     0          1         1</code></pre>
<p>The loop way is the most direct. We’re going to be looking at
combinations of fruits and other fruits, so we’ll need two loops one
inside the other. It’s easier for this to work with column numbers,
which here are 1 through 6, and we’ll make a matrix <code>m</code> with
the dissimilarities in it, which we have to initialize first. I’ll
initialize it to a <span class="math inline">\(6\times 6\)</span> matrix of <code>-1</code>, since the final
dissimilarities are 0 or bigger, and this way I’ll know if I forgot
anything.</p>
<p>Here’s where we are at so far:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb346-1" title="1">fruit_m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb346-2" title="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb346-3" title="3">  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb346-4" title="4">    fruit_m[i, j] &lt;-<span class="st"> </span><span class="dv">3</span> <span class="co"># dissim between fruit i and fruit j</span></a>
<a class="sourceLine" id="cb346-5" title="5">  }</a>
<a class="sourceLine" id="cb346-6" title="6">}</a></code></pre></div>
<p>This, of course, doesn’t run yet. The sticking point is how to
calculate the dissimilarity between two columns. I think that is a
separate thought process that should be in a function of its own. The
inputs are the two column numbers, and a data frame to get those
columns from:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb347-1" title="1">dissim &lt;-<span class="st"> </span><span class="cf">function</span>(i, j, d) {</a>
<a class="sourceLine" id="cb347-2" title="2">  x &lt;-<span class="st"> </span>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(i)</a>
<a class="sourceLine" id="cb347-3" title="3">  y &lt;-<span class="st"> </span>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(j)</a>
<a class="sourceLine" id="cb347-4" title="4">  <span class="kw">sum</span>(x <span class="op">!=</span><span class="st"> </span>y)</a>
<a class="sourceLine" id="cb347-5" title="5">}</a>
<a class="sourceLine" id="cb347-6" title="6"><span class="kw">dissim</span>(<span class="dv">1</span>, <span class="dv">2</span>, fruit2)</a></code></pre></div>
<pre><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(i)` instead of `i` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.</code></pre>
<pre><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(j)` instead of `j` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.</code></pre>
<pre><code>## [1] 1</code></pre>
<p>Apple and orange differ by one (not being crunchy). The process is:
grab the <span class="math inline">\(i\)</span>-th column and call it <code>x</code>, grab the <span class="math inline">\(j\)</span>-th column
and call it <code>y</code>. These are two one-column data frames with four
rows each (the four properties). <code>x!=y</code> goes down the rows, and
for each one gives a <code>TRUE</code> if they’re different and a
<code>FALSE</code> if they’re the same. So <code>x!=y</code> is a collection
of four T-or-F values. This seems backwards, but I was thinking of
what we want to do: we want to count the number of different
ones. Numerically, <code>TRUE</code> counts as 1 and <code>FALSE</code> as 0,
so we should make the thing we’re counting (the different ones) come
out as <code>TRUE</code>. To count the number of <code>TRUE</code>s (1s), add
them up.</p>
<p>That was a complicated thought process, so it was probably wise to
write a function to do it. Now, in our loop, we only have to call the
function (having put some thought into getting it right):</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb351-1" title="1">fruit_m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb351-2" title="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb351-3" title="3">  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb351-4" title="4">    fruit_m[i, j] &lt;-<span class="st"> </span><span class="kw">dissim</span>(i, j, fruit2)</a>
<a class="sourceLine" id="cb351-5" title="5">  }</a>
<a class="sourceLine" id="cb351-6" title="6">}</a>
<a class="sourceLine" id="cb351-7" title="7">fruit_m</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    0    1    3    2    3    3
## [2,]    1    0    2    3    2    2
## [3,]    3    2    0    1    2    2
## [4,]    2    3    1    0    3    3
## [5,]    3    2    2    3    0    2
## [6,]    3    2    2    3    2    0</code></pre>
<p>The last step is re-associate the fruit names with this matrix. This
is a <code>matrix</code> so it has a <code>rownames</code> and a
<code>colnames</code>. We set both of those, but first we have to get the
fruit names from <code>fruit2</code>:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb353-1" title="1">fruit_names &lt;-<span class="st"> </span><span class="kw">names</span>(fruit2)</a>
<a class="sourceLine" id="cb353-2" title="2"><span class="kw">rownames</span>(fruit_m) &lt;-<span class="st"> </span>fruit_names</a>
<a class="sourceLine" id="cb353-3" title="3"><span class="kw">colnames</span>(fruit_m) &lt;-<span class="st"> </span>fruit_names</a>
<a class="sourceLine" id="cb353-4" title="4">fruit_m</a></code></pre></div>
<pre><code>##            Apple Orange Banana Pear Strawberry Blueberry
## Apple          0      1      3    2          3         3
## Orange         1      0      2    3          2         2
## Banana         3      2      0    1          2         2
## Pear           2      3      1    0          3         3
## Strawberry     3      2      2    3          0         2
## Blueberry      3      2      2    3          2         0</code></pre>
<p>This is good to go into the cluster analysis (happening later).</p>
<p>There is a <code>tidyverse</code> way to do this also. It’s actually a lot
like the loop way in its conception, but the coding looks
different. We start by making all combinations of the fruit names with
each other, which is <code>crossing</code>:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb355-1" title="1">combos &lt;-<span class="st"> </span><span class="kw">crossing</span>(<span class="dt">fruit =</span> fruit_names, <span class="dt">other =</span> fruit_names)</a>
<a class="sourceLine" id="cb355-2" title="2">combos</a></code></pre></div>
<pre><code>## # A tibble: 36 x 2
##    fruit  other     
##    &lt;chr&gt;  &lt;chr&gt;     
##  1 Apple  Apple     
##  2 Apple  Banana    
##  3 Apple  Blueberry 
##  4 Apple  Orange    
##  5 Apple  Pear      
##  6 Apple  Strawberry
##  7 Banana Apple     
##  8 Banana Banana    
##  9 Banana Blueberry 
## 10 Banana Orange    
## # … with 26 more rows</code></pre>
<p>Now, we want a function that, given any two fruit <em>names</em>, works
out the dissimilarity between them. A happy coincidence is that we can
use the function we had before, <em>unmodified</em>! How? Take a look:</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb357-1" title="1">dissim &lt;-<span class="st"> </span><span class="cf">function</span>(i, j, d) {</a>
<a class="sourceLine" id="cb357-2" title="2">  x &lt;-<span class="st"> </span>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(i)</a>
<a class="sourceLine" id="cb357-3" title="3">  y &lt;-<span class="st"> </span>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(j)</a>
<a class="sourceLine" id="cb357-4" title="4">  <span class="kw">sum</span>(x <span class="op">!=</span><span class="st"> </span>y)</a>
<a class="sourceLine" id="cb357-5" title="5">}</a>
<a class="sourceLine" id="cb357-6" title="6"><span class="kw">dissim</span>(<span class="st">&quot;Apple&quot;</span>, <span class="st">&quot;Orange&quot;</span>, fruit2)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p><code>select</code> can take a column number <em>or a column name</em>, so
that running it with column names gives the right answer.</p>
<p>Now, we want to run this function for each of the pairs in
<code>combos</code>. This is <code>rowwise</code>, since our function takes only one <code>fruit</code> and one <code>other</code> fruit at a time, not all of them at once:</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb359-1" title="1">combos <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb359-2" title="2"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb359-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dissim =</span> <span class="kw">dissim</span>(fruit, other, fruit2))</a></code></pre></div>
<pre><code>## # A tibble: 36 x 3
## # Rowwise: 
##    fruit  other      dissim
##    &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt;
##  1 Apple  Apple           0
##  2 Apple  Banana          3
##  3 Apple  Blueberry       3
##  4 Apple  Orange          1
##  5 Apple  Pear            2
##  6 Apple  Strawberry      3
##  7 Banana Apple           3
##  8 Banana Banana          0
##  9 Banana Blueberry       2
## 10 Banana Orange          2
## # … with 26 more rows</code></pre>
<p>This would work just as well using <code>fruit1</code>, with the column of properties, rather than
<code>fruit2</code>, since we are picking out the columns by name rather
than number.</p>
<p>To make this into something we can turn into a <code>dist</code> object
later, we need to pivot-wider the column <code>other</code> to make a
square array:</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb361-1" title="1">combos <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb361-2" title="2"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb361-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dissim =</span> <span class="kw">dissim</span>(fruit, other, fruit2)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb361-4" title="4"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> other, <span class="dt">values_from =</span> dissim) -&gt;<span class="st"> </span>fruit_spread</a>
<a class="sourceLine" id="cb361-5" title="5">fruit_spread</a></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##   fruit      Apple Banana Blueberry Orange  Pear Strawberry
##   &lt;chr&gt;      &lt;int&gt;  &lt;int&gt;     &lt;int&gt;  &lt;int&gt; &lt;int&gt;      &lt;int&gt;
## 1 Apple          0      3         3      1     2          3
## 2 Banana         3      0         2      2     1          2
## 3 Blueberry      3      2         0      2     3          2
## 4 Orange         1      2         2      0     3          2
## 5 Pear           2      1         3      3     0          3
## 6 Strawberry     3      2         2      2     3          0</code></pre>
<p>Done!</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Do a hierarchical cluster analysis using complete
linkage. Display your dendrogram.</li>
</ol>
<p>Solution</p>
<p>First, we need to take one of our matrices of dissimilarities
and turn it into a <code>dist</code> object. Since I asked you to
save yours into a file, let’s start from there. Mine is aligned
columns:</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb363-1" title="1">dissims &lt;-<span class="st"> </span><span class="kw">read_table</span>(<span class="st">&quot;fruits.txt&quot;</span>)</a></code></pre></div>
<pre><code>## 
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
## cols(
##   fruit = col_character(),
##   Apple = col_double(),
##   Orange = col_double(),
##   Banana = col_double(),
##   Pear = col_double(),
##   Strawberry = col_double(),
##   Blueberry = col_double()
## )</code></pre>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb365-1" title="1">dissims</a></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##   fruit      Apple Orange Banana  Pear Strawberry Blueberry
##   &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1 Apple          0      1      3     2          3         3
## 2 Orange         1      0      2     3          2         2
## 3 Banana         3      2      0     1          2         2
## 4 Pear           2      3      1     0          3         3
## 5 Strawberry     3      2      2     3          0         2
## 6 Blueberry      3      2      2     3          2         0</code></pre>
<p>Then turn it into a <code>dist</code> object. The first step is to take
off the first column, since <code>as.dist</code> can get the names from
the columns:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb367-1" title="1">d &lt;-<span class="st"> </span>dissims <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb367-2" title="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>fruit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb367-3" title="3"><span class="st">  </span><span class="kw">as.dist</span>()</a>
<a class="sourceLine" id="cb367-4" title="4">d</a></code></pre></div>
<pre><code>##            Apple Orange Banana Pear Strawberry
## Orange         1                              
## Banana         3      2                       
## Pear           2      3      1                
## Strawberry     3      2      2    3           
## Blueberry      3      2      2    3          2</code></pre>
<p>If you forget to take off the first column, this happens:</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb369-1" title="1"><span class="kw">as.dist</span>(dissims)</a></code></pre></div>
<pre><code>## Warning in storage.mode(m) &lt;- &quot;numeric&quot;: NAs introduced by coercion</code></pre>
<pre><code>## Warning in as.dist.default(dissims): non-square matrix</code></pre>
<pre><code>## Error in dimnames(df) &lt;- if (is.null(labels)) list(seq_len(size), seq_len(size)) else list(labels, : length of &#39;dimnames&#39; [1] not equal to array extent</code></pre>
<p>The key thing here is “non-square matrix”: you have one more column
than you have rows, since you have a column of fruit names.</p>
<p>This one is <code>as.dist</code> since you already have dissimilarities
and you want to arrange them into the right type of
thing. <code>dist</code> is for <em>calculating</em> dissimilarities, which
we did before, so we don’t want to do that now.</p>
<p>Now, after all that work, the actual cluster analysis and dendrogram:</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb373-1" title="1">fruits<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;complete&quot;</span>)</a>
<a class="sourceLine" id="cb373-2" title="2"><span class="kw">plot</span>(fruits<span class="fl">.1</span>)</a></code></pre></div>
<p><img src="pasias_files/figure-html/hkadh-1.png" width="672" /></p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>How many clusters, of what fruits, do you seem to have?
Explain briefly.</li>
</ol>
<p>Solution</p>
<p>I reckon I have three clusters: strawberry and blueberry in one,
apple and orange in the second, and banana and pear in the
third. (If your dissimilarities were different from mine, your
dendrogram will be different also.)</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Pick a pair of clusters (with at least 2 fruits in each)
from your dendrogram. Verify that
the complete-linkage distance on your dendrogram is correct.</li>
</ol>
<p>Solution</p>
<p>I’ll pick strawberry-blueberry and and apple-orange. I’ll arrange
the dissimilarities like this:</p>
<pre><code>
apple   orange
strawberry    3       2
blueberry     3       2
</code></pre>
<p>The largest of those is 3, so that’s the complete-linkage
distance. That’s also what the dendrogram says.
(Likewise, the smallest of those is 2, so 2 is the
single-linkage distance.) That is to say, the largest distance or
dissimilarity
from anything in one cluster to anything in the other is 3, and
the smallest is 2.
I don’t mind which pair of clusters you take, as long as you spell
out the dissimilarity (distance) between each fruit in each
cluster, and take the maximum of those. Besides, if your
dissimilarities are different from mine, your complete-linkage
distance could be different from mine also. The grader will have
to use her judgement!<a href="#fn44" class="footnote-ref" id="fnref44"><sup>44</sup></a><br />
The important point is that you assess the dissimilarities between
fruits in one cluster and fruits in the other. The dissimilarities
between fruits in the same cluster don’t enter into it.<a href="#fn45" class="footnote-ref" id="fnref45"><sup>45</sup></a>
As it happens, all my complete-linkage distances between clusters
(of at least 2 fruits) are 3. The single-linkage ones are
different, though:</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb375-1" title="1">fruits<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;single&quot;</span>)</a>
<a class="sourceLine" id="cb375-2" title="2"><span class="kw">plot</span>(fruits<span class="fl">.2</span>)</a></code></pre></div>
<p><img src="pasias_files/figure-html/lhsdjhad-1.png" width="672" /></p>
<p>All the single-linkage cluster distances are 2. (OK, so this wasn’t a
very interesting example, but I wanted to give you one where you could
calculate what was going on.)</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="similarity-of-species-1" class="section level2">
<h2><span class="header-section-number">35.7</span> Similarity of species</h2>
<p>Two scientists assessed the dissimilarity
between a number
of species by recording the number of positions in the protein
molecule cytochrome-<span class="math inline">\(c\)</span> where the two species being compared have
different amino acids. The dissimilarities that they recorded are in
<a href="http://ritsokiguess.site/datafiles/species.txt">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data into a data frame and take a look at it.</li>
</ol>
<p>Solution</p>
<p>Nothing much new here:</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb376-1" title="1">my_url &lt;-<span class="st"> &quot;http://ritsokiguess.site/datafiles/species.txt&quot;</span></a>
<a class="sourceLine" id="cb376-2" title="2">species &lt;-<span class="st"> </span><span class="kw">read_delim</span>(my_url, <span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## 
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
## cols(
##   what = col_character(),
##   Man = col_double(),
##   Monkey = col_double(),
##   Horse = col_double(),
##   Pig = col_double(),
##   Pigeon = col_double(),
##   Tuna = col_double(),
##   Mould = col_double(),
##   Fungus = col_double()
## )</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb378-1" title="1">species</a></code></pre></div>
<pre><code>## # A tibble: 8 x 9
##   what     Man Monkey Horse   Pig Pigeon  Tuna Mould Fungus
##   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 Man        0      1    17    13     16    31    63     66
## 2 Monkey     1      0    16    12     15    32    62     65
## 3 Horse     17     16     0     5     16    27    64     68
## 4 Pig       13     12     5     0     13    25    64     67
## 5 Pigeon    16     15    16    13      0    27    59     66
## 6 Tuna      31     32    27    25     27     0    72     69
## 7 Mould     63     62    64    64     59    72     0     61
## 8 Fungus    66     65    68    67     66    69    61      0</code></pre>
<p>This is a square array of dissimilarities between the eight species.</p>
<p>The data set came from the 1960s, hence the use of “Man” rather than
“human”. It probably also came from the UK, judging by the spelling
of <code>Mould</code>.</p>
<p>(I gave the first column the name <code>what</code> so that you could
safely use <code>species</code> for the whole data frame.)</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Bearing in mind that the values you read in are
<em>already</em> dissimilarities, convert them into a <code>dist</code>
object suitable for running a cluster analysis on, and display the
results. (Note that you need to get rid of any columns that don’t
contain numbers.)</li>
</ol>
<p>Solution</p>
<p>The point here is that the values you have are <em>already</em>
dissimilarities, so no conversion of the numbers is required. Thus
this is a job for <code>as.dist</code>, which merely changes how it
looks. Use a pipeline to get rid of the first column first:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb380-1" title="1">species <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb380-2" title="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>what) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb380-3" title="3"><span class="st">  </span><span class="kw">as.dist</span>() -&gt;<span class="st"> </span>d</a>
<a class="sourceLine" id="cb380-4" title="4">d</a></code></pre></div>
<pre><code>##        Man Monkey Horse Pig Pigeon Tuna Mould
## Monkey   1                                   
## Horse   17     16                            
## Pig     13     12     5                      
## Pigeon  16     15    16  13                  
## Tuna    31     32    27  25     27           
## Mould   63     62    64  64     59   72      
## Fungus  66     65    68  67     66   69    61</code></pre>
<p>This doesn’t display anything that it doesn’t need to: we know that the
dissimilarity between a species and itself is zero (no need to show
that), and that the dissimilarity between B and A is the same as
between A and B, so no need to show everything twice. It might look as
if you are missing a row and a column, but one of the species (Fungus)
appears only in a row and one of them (Man) only in a column.</p>
<p>This also works, to select only the numerical columns:</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb382-1" title="1">species <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb382-2" title="2"><span class="st">  </span><span class="kw">select</span>(<span class="kw">where</span>(is.numeric)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb382-3" title="3"><span class="st">  </span><span class="kw">as.dist</span>()</a></code></pre></div>
<pre><code>##        Man Monkey Horse Pig Pigeon Tuna Mould
## Monkey   1                                   
## Horse   17     16                            
## Pig     13     12     5                      
## Pigeon  16     15    16  13                  
## Tuna    31     32    27  25     27           
## Mould   63     62    64  64     59   72      
## Fungus  66     65    68  67     66   69    61</code></pre>
<p>Extra: data frames officially have an attribute called “row names”,
that is displayed where the row numbers display, but which isn’t
actually a column of the data frame. In the past, when we used
<code>read.table</code> with a dot, the first column of data read in from
the file could be nameless (that is, you could have one more column of
data than you had column names) and the first column would be treated
as row names. People used row names for things like identifier
variables. But row names have this sort of half-existence, and when
Hadley Wickham designed the <code>tidyverse</code>, he decided not to use
row names, taking the attitude that if it’s part of the data, it
should be in the data frame as a genuine column. This means that when
you use a <code>read_</code> function, you have to have exactly as many
column names as columns.</p>
<p>For these data, I previously had the column here called
<code>what</code> as row names, and <code>as.dist</code> automatically got rid
of the row names when formatting the distances. Now, it’s a
genuine column, so I have to get rid of it before running
<code>as.dist</code>. This is more work, but it’s also more honest, and
doesn’t involve thinking about row names at all. So, on balance, I
think it’s a win.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Run a cluster analysis using single-linkage and obtain a dendrogram.</li>
</ol>
<p>Solution</p>
<p>Something like this:</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb384-1" title="1">species<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;single&quot;</span>)</a>
<a class="sourceLine" id="cb384-2" title="2"><span class="kw">plot</span>(species<span class="fl">.1</span>)</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-216-1.png" width="672" /></p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Run a cluster analysis using Ward’s method and obtain a dendrogram.</li>
</ol>
<p>Solution</p>
<p>Not much changes here in the code, but the result is noticeably
different:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb385-1" title="1">species<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;ward.D&quot;</span>)</a>
<a class="sourceLine" id="cb385-2" title="2"><span class="kw">plot</span>(species<span class="fl">.2</span>)</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-217-1.png" width="672" /></p>
<p>Don’t forget to take care with the <code>method</code>: it has to be
<code>ward</code> in lowercase (even though it’s someone’s name) followed
by a D in uppercase.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Describe how the two dendrograms from the last two parts
look different.</li>
</ol>
<p>Solution</p>
<p>This is (as ever with this kind of thing) a judgement call. Your
job is to come up with something reasonable.
For myself, I was thinking about how single-linkage tends to
produce “stringy” clusters that join single objects (species)
onto already-formed clusters. Is that happening here? Apart from
the first two clusters, man and monkey, horse and pig,
<em>everything</em> that gets joined on is a single species joined
on to a bigger cluster, including mould and fungus right at the
end. Contrast that with the output from Ward’s method, where, for
the most part, groups are formed first and then joined onto other
groups. For example, in Ward’s method, mould and fungus are joined
earlier, and also the man-monkey group is joined to the
pigeon-horse-pig group.<a href="#fn46" class="footnote-ref" id="fnref46"><sup>46</sup></a>
You might prefer to look at the specifics of what gets joined. I
think the principal difference from this angle is that mould and
fungus get joined together (much) earlier in Ward. Also, pigeon
gets joined to horse and pig first under Ward, but <em>after</em>
those have been joined to man and monkey under
single-linkage. This is also a reasonable kind of observation.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Looking at your clustering for Ward’s method, what seems to
be a sensible number of clusters? Draw boxes around those clusters.</li>
</ol>
<p>Solution</p>
<p>Pretty much any number of clusters bigger than 1 and smaller than
8 is ok here, but I would prefer to see something between 2 and
5, because a number of clusters of that sort offers (i) some
insight (“these things are like these other things”) and (ii) a
number of clusters of that sort is supported by the data.
To draw those clusters, you need <code>rect.hclust</code>, and
before that you’ll need to plot the cluster object again. For 2
clusters, that would look like this:</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb386-1" title="1"><span class="kw">plot</span>(species<span class="fl">.2</span>)</a>
<a class="sourceLine" id="cb386-2" title="2"><span class="kw">rect.hclust</span>(species<span class="fl">.2</span>, <span class="dv">2</span>)</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-218-1.png" width="672" /></p>
<p>This one is “mould and fungus vs. everything else”. (My red boxes
seem to have gone off the side, sorry.)</p>
<p>Or we could go to the other end of the scale:</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb387-1" title="1"><span class="kw">plot</span>(species<span class="fl">.2</span>)</a>
<a class="sourceLine" id="cb387-2" title="2"><span class="kw">rect.hclust</span>(species<span class="fl">.2</span>, <span class="dv">5</span>)</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-219-1.png" width="672" /></p>
<p>Five is not really an insightful number of clusters with 8 species,
but it seems to correspond (for me at least) with a reasonable
division of these species into “kinds of living things”. That is, I
am bringing some outside knowledge into my number-of-clusters division.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" style="list-style-type: lower-alpha">
<li>List which cluster each species is in, for your preferred
number of clusters (from Ward’s method).</li>
</ol>
<p>Solution</p>
<p>This is <code>cutree</code>. For 2 clusters it would be this:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb388-1" title="1"><span class="kw">cutree</span>(species<span class="fl">.2</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    Man Monkey  Horse    Pig Pigeon   Tuna  Mould Fungus 
##      1      1      1      1      1      1      2      2</code></pre>
<p>For 5 it would be this:</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb390-1" title="1"><span class="kw">cutree</span>(species<span class="fl">.2</span>, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>##    Man Monkey  Horse    Pig Pigeon   Tuna  Mould Fungus 
##      1      1      2      2      2      3      4      5</code></pre>
<p>and anything in between is in between.</p>
<p>These ones came out sorted, so there is no need to sort them (so you
don’t need the methods of the next question).</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="bridges-in-pittsburgh-1" class="section level2">
<h2><span class="header-section-number">35.8</span> Bridges in Pittsburgh</h2>
<p>The city of Pittsburgh, Pennsylvania, lies where three
rivers, the Allegheny, Monongahela, and Ohio,
meet.<a href="#fn47" class="footnote-ref" id="fnref47"><sup>47</sup></a>
It has long been important to build bridges there,
to enable its residents to cross the rivers safely. See
<a href="https://en.wikipedia.org/wiki/List_of_bridges_of_Pittsburgh">link</a> for
a listing (with pictures) of the bridges. The data at
<a href="https://raw.githubusercontent.com/nxskok/datafiles/master/bridges.csv">link</a> contains
detail for a large number of past and present bridges in
Pittsburgh. All the variables we will use are categorical. Here they
are:</p>
<ul>
<li><p><code>id</code> identifying the bridge (we ignore)</p></li>
<li><p><code>river</code>: initial letter of river that the bridge crosses</p></li>
<li><p><code>location</code>: a numerical code indicating the location
within Pittsburgh (we ignore)</p></li>
<li><p><code>erected</code>: time period in which the bridge was built (a
name, from <code>CRAFTS</code>, earliest, to <code>MODERN</code>, most
recent.</p></li>
<li><p><code>purpose</code>: what the bridge carries: foot traffic
(“walk”), water (aqueduct), road or railroad.</p></li>
<li><p><code>length</code> categorized as long, medium or short.</p></li>
<li><p><code>lanes</code> of traffic (or number of railroad tracks): a
number, 1, 2, 4 or 6, that we will count as categorical.</p></li>
<li><p><code>clear_g</code>: whether a vertical navigation requirement was
included in the bridge design (that is, ships of a certain height
had to be able to get under the bridge). I think <code>G</code> means
“yes”.</p></li>
<li><p><code>t_d</code>: method of construction. <code>DECK</code> means the
bridge deck is on top of the construction, <code>THROUGH</code> means
that when you cross the bridge, some of the bridge supports are next
to you or above you.</p></li>
<li><p><code>material</code> the bridge is made of: iron, steel or wood.</p></li>
<li><p><code>span</code>: whether the bridge covers a short, medium or long
distance.</p></li>
<li><p><code>rel_l</code>: Relative length of the main span of the
bridge (between the two central piers) to the total crossing length.
The categories are <code>S</code>, <code>S-F</code> and <code>F</code>. I don’t
know what these mean.</p></li>
<li><p><code>type</code> of bridge: wood, suspension, arch and three types
of truss bridge: cantilever, continuous and simple.</p></li>
</ul>
<p>The website <a href="https://www.steelconstruction.info/Bridges">link</a> is an
excellent source of information about bridges. (That’s where I learned
the difference between <code>THROUGH</code> and <code>DECK</code>.) Wikipedia
also has a good article at
<a href="https://en.wikipedia.org/wiki/Bridge">link</a>. I also found
<a href="http://www.metaeventos.net/inscricoes/formularios_off/resumo_preenchido/DINCON/Pina-A_Colimodio-V_Silva-A_PinaFilho-A.pdf">link</a>
which is the best description I’ve seen of the variables.</p>
<ol style="list-style-type: lower-alpha">
<li>The bridges are stored in CSV format. Some of the
information is not known and was recorded in the spreadsheet as
<code>?</code>. Turn these into genuine missing values by adding
<code>na="?"</code> to your file-reading command. Display some of your
data, enough to see that you have some missing data.</li>
</ol>
<p>Solution</p>
<p>This sort of thing:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb392-1" title="1">my_url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/nxskok/datafiles/master/bridges.csv&quot;</span></a>
<a class="sourceLine" id="cb392-2" title="2">bridges0 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(my_url, <span class="dt">na =</span> <span class="st">&quot;?&quot;</span>)</a></code></pre></div>
<pre><code>## 
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
## cols(
##   id = col_character(),
##   river = col_character(),
##   location = col_double(),
##   erected = col_character(),
##   purpose = col_character(),
##   length = col_character(),
##   lanes = col_double(),
##   clear_g = col_character(),
##   t_d = col_character(),
##   material = col_character(),
##   span = col_character(),
##   rel_l = col_character(),
##   type = col_character()
## )</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb394-1" title="1">bridges0</a></code></pre></div>
<pre><code>## # A tibble: 108 x 13
##    id    river location erected purpose  length lanes clear_g t_d     material
##    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   
##  1 E1    M            3 CRAFTS  HIGHWAY  &lt;NA&gt;       2 N       THROUGH WOOD    
##  2 E2    A           25 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
##  3 E3    A           39 CRAFTS  AQUEDUCT &lt;NA&gt;       1 N       THROUGH WOOD    
##  4 E5    A           29 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
##  5 E6    M           23 CRAFTS  HIGHWAY  &lt;NA&gt;       2 N       THROUGH WOOD    
##  6 E7    A           27 CRAFTS  HIGHWAY  SHORT      2 N       THROUGH WOOD    
##  7 E8    A           28 CRAFTS  AQUEDUCT MEDIUM     1 N       THROUGH IRON    
##  8 E9    M            3 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH IRON    
##  9 E10   A           39 CRAFTS  AQUEDUCT &lt;NA&gt;       1 N       DECK    WOOD    
## 10 E11   A           29 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
## # … with 98 more rows, and 3 more variables: span &lt;chr&gt;, rel_l &lt;chr&gt;,
## #   type &lt;chr&gt;</code></pre>
<p>I have some missing values in the <code>length</code> column. (You
sometimes see <code>&lt;NA&gt;</code> instead of <code>NA</code>, as you do here;
this means the missing value is a missing piece of text rather than a
missing number.)<a href="#fn48" class="footnote-ref" id="fnref48"><sup>48</sup></a></p>
<p>There are 108 bridges in the data set.</p>
<p>I’m saving the name <code>bridges</code> for my final data set, after I’m
finished organizing it.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Verify that there are missing values in this dataset. To see
them, convert the text columns temporarily to <code>factor</code>s using
<code>mutate</code>, and pass the resulting data frame into
<code>summary</code>.</li>
</ol>
<p>Solution</p>
<p>I called my data frame <code>bridges0</code>, so this:</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb396-1" title="1">bridges0 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb396-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character), <span class="op">~</span><span class="st"> </span><span class="kw">factor</span>(.))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb396-3" title="3"><span class="st">  </span><span class="kw">summary</span>()</a></code></pre></div>
<pre><code>##        id      river     location         erected       purpose      length  
##  E1     :  1   A:49   Min.   : 1.00   CRAFTS  :18   AQUEDUCT: 4   LONG  :21  
##  E10    :  1   M:41   1st Qu.:15.50   EMERGING:15   HIGHWAY :71   MEDIUM:48  
##  E100   :  1   O:15   Median :27.00   MATURE  :54   RR      :32   SHORT :12  
##  E101   :  1   Y: 3   Mean   :25.98   MODERN  :21   WALK    : 1   NA&#39;s  :27  
##  E102   :  1          3rd Qu.:37.50                                          
##  E103   :  1          Max.   :52.00                                          
##  (Other):102          NA&#39;s   :1                                              
##      lanes      clear_g        t_d      material      span     rel_l   
##  Min.   :1.00   G   :80   DECK   :15   IRON :11   LONG  :30   F   :58  
##  1st Qu.:2.00   N   :26   THROUGH:87   STEEL:79   MEDIUM:53   S   :30  
##  Median :2.00   NA&#39;s: 2   NA&#39;s   : 6   WOOD :16   SHORT : 9   S-F :15  
##  Mean   :2.63                          NA&#39;s : 2   NA&#39;s  :16   NA&#39;s: 5  
##  3rd Qu.:4.00                                                          
##  Max.   :6.00                                                          
##  NA&#39;s   :16                                                            
##        type   
##  SIMPLE-T:44  
##  WOOD    :16  
##  ARCH    :13  
##  CANTILEV:11  
##  SUSPEN  :11  
##  (Other) :11  
##  NA&#39;s    : 2</code></pre>
<p>There are missing values all over the place. <code>length</code> has the
most, but <code>lanes</code> and <code>span</code> also have a fair few.</p>
<p><code>mutate</code> requires <code>across</code> and a logical condition, something that is true or false, about each column, and then something to do with it.
In words, “for each column that is text, replace it (temporarily) with the factor version of itself.”</p>
<p>Extra: I think the reason <code>summary</code> doesn’t handle text stuff very
well is that, originally, text columns that were read in from files
<em>got turned into</em> factors, and if you didn’t want that to happen,
you had to explicitly stop it yourself. Try mentioning
<code>stringsAsFactors=F</code> to a veteran R user, and watch their
reaction, or try it yourself by reading in a data file with text
columns using <code>read.table</code> instead of
<code>read_delim</code>. (This will read in an old-fashioned data frame,
so pipe it through <code>as_tibble</code> to see what the columns are.)</p>
<p>When Hadley Wickham designed <code>readr</code>, the corner of the
<code>tidyverse</code> where the <code>read_</code> functions live, he
deliberately chose to keep text as text (on the basis of being honest
about what kind of thing we have), with the result that we sometimes
have to create factors when what we are using requires them rather
than text.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Use <code>drop_na</code> to remove any rows of the data frame with missing values in them. How many rows do you have left?</li>
</ol>
<p>Solution</p>
<p>This is as simple as:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb398-1" title="1">bridges0 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>() -&gt;<span class="st"> </span>bridges</a>
<a class="sourceLine" id="cb398-2" title="2">bridges</a></code></pre></div>
<pre><code>## # A tibble: 70 x 13
##    id    river location erected purpose  length lanes clear_g t_d     material
##    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   
##  1 E2    A           25 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
##  2 E5    A           29 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
##  3 E7    A           27 CRAFTS  HIGHWAY  SHORT      2 N       THROUGH WOOD    
##  4 E8    A           28 CRAFTS  AQUEDUCT MEDIUM     1 N       THROUGH IRON    
##  5 E9    M            3 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH IRON    
##  6 E11   A           29 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
##  7 E14   M            6 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
##  8 E16   A           25 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH IRON    
##  9 E18   A           28 CRAFTS  RR       MEDIUM     2 N       THROUGH IRON    
## 10 E19   A           29 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
## # … with 60 more rows, and 3 more variables: span &lt;chr&gt;, rel_l &lt;chr&gt;,
## #   type &lt;chr&gt;</code></pre>
<p>I have 70 rows left (out of the original 108).</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>We are going to assess the dissimilarity between two bridges
by the number of the categorical variables they <em>disagree</em>
on. This is called a “simple matching coefficient”, and is the
same thing we did in the question about clustering fruits based on
their properties. This time, though, we want to count matches in
things that are <em>rows</em> of our data frame (properties of two
different bridges), so we will need to use a strategy like the one I
used in calculating the Bray-Curtis distances.
First, write a function that takes as input two vectors <code>v</code>
and <code>w</code> and counts the number of their entries that differ
(comparing the first with the first, the second with the second,
, the last with the last. I can think of a quick way and a
slow way, but either way is good.) To test your function, create two
vectors (using <code>c</code>) of the same length, and see whether it
correctly counts the number of corresponding values that are
different.</li>
</ol>
<p>Solution</p>
<p>The slow way is to loop through the elements of each vector, using
square brackets to pull out the ones you want, checking them for
differentness, then updating a counter which gets returned at the
end. If you’ve done Python, this is exactly the strategy you’d
use there:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb400-1" title="1">count_diff &lt;-<span class="st"> </span><span class="cf">function</span>(v, w) {</a>
<a class="sourceLine" id="cb400-2" title="2">  n &lt;-<span class="st"> </span><span class="kw">length</span>(v)</a>
<a class="sourceLine" id="cb400-3" title="3">  <span class="kw">stopifnot</span>(<span class="kw">length</span>(v) <span class="op">==</span><span class="st"> </span><span class="kw">length</span>(w)) <span class="co"># I explain this below</span></a>
<a class="sourceLine" id="cb400-4" title="4">  count &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb400-5" title="5">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</a>
<a class="sourceLine" id="cb400-6" title="6">    <span class="cf">if</span> (v[i] <span class="op">!=</span><span class="st"> </span>w[i]) count &lt;-<span class="st"> </span>count <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb400-7" title="7">  }</a>
<a class="sourceLine" id="cb400-8" title="8">  count</a>
<a class="sourceLine" id="cb400-9" title="9">}</a></code></pre></div>
<p>This function makes no sense if <code>v</code> and <code>w</code> are of
different lengths, since we’re comparing <em>corresponding</em> elements
of them. The <code>stopifnot</code> line checks to see whether <code>v</code>
and <code>w</code> have the same number of things in them, and stops with
an informative error if they are of different lengths. (The thing
inside the <code>stopifnot</code> is what has to be <em>true</em>.)</p>
<p>Does it work?</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb401-1" title="1">v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb401-2" title="2">w &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb401-3" title="3"><span class="kw">count_diff</span>(v, w)</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>Three of the values are the same and two are different, so this is right.</p>
<p>What happens if my two vectors are of different lengths?</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb403-1" title="1">v1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb403-2" title="2">w &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb403-3" title="3"><span class="kw">count_diff</span>(v1, w)</a></code></pre></div>
<pre><code>## Error in count_diff(v1, w): length(v) == length(w) is not TRUE</code></pre>
<p>Error, as produced by <code>stopifnot</code>. See how it’s perfectly clear
what went wrong?</p>
<p>R, though, is a “vectorized” language: it’s possible to work with
whole vectors at once, rather than pulling things out of them one at a
time. Check out this (which is like what I did with the fruits):</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb405-1" title="1">v <span class="op">!=</span><span class="st"> </span>w</a></code></pre></div>
<pre><code>## [1] FALSE  TRUE FALSE  TRUE FALSE</code></pre>
<p>The second and fourth values are different, and the others are the
same. But we can go one step further:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb407-1" title="1"><span class="kw">sum</span>(v <span class="op">!=</span><span class="st"> </span>w)</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>The true values count as 1 and the false ones as zero, so the sum is
counting up how many values are different, exactly what we want. So
the function can be as simple as:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb409-1" title="1">count_diff &lt;-<span class="st"> </span><span class="cf">function</span>(v, w) {</a>
<a class="sourceLine" id="cb409-2" title="2">  <span class="kw">sum</span>(v <span class="op">!=</span><span class="st"> </span>w)</a>
<a class="sourceLine" id="cb409-3" title="3">}</a></code></pre></div>
<p>I still think it’s worth writing a function do this, though, since
<code>count_diff</code> tells you what it does and <code>sum(v!=w)</code>
doesn’t, unless you happen to know.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Write a function that has as input two row numbers and a data
frame to take those rows from. The function needs to select all the
columns except for <code>id</code> and <code>location</code>, select the
rows required one at a time, and turn them into vectors. (There may
be some repetitiousness here. That’s OK.) Then those two vectors
are passed into the function you wrote in the previous part, and the
count of the number of differences is returned. This is like the
code in the Bray-Curtis problem. Test your function on rows 3 and 4
of your bridges data set (with the missings removed). There should
be six variables that are different.</li>
</ol>
<p>Solution</p>
<p>This is just like my function <code>braycurtis.spec</code>, except that
instead of calling <code>braycurtis</code> at the end, I call
<code>count_diff</code>:</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb410-1" title="1">row_diff &lt;-<span class="st"> </span><span class="cf">function</span>(i, j, d) {</a>
<a class="sourceLine" id="cb410-2" title="2">  d1 &lt;-<span class="st"> </span>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>id, <span class="op">-</span>location)</a>
<a class="sourceLine" id="cb410-3" title="3">  x &lt;-<span class="st"> </span>d1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(i) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>()</a>
<a class="sourceLine" id="cb410-4" title="4">  y &lt;-<span class="st"> </span>d1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(j) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>()</a>
<a class="sourceLine" id="cb410-5" title="5">  <span class="kw">count_diff</span>(x, y)</a>
<a class="sourceLine" id="cb410-6" title="6">}</a>
<a class="sourceLine" id="cb410-7" title="7"><span class="kw">row_diff</span>(<span class="dv">3</span>, <span class="dv">4</span>, bridges)</a></code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>That’s what I said.</p>
<p>Extra: is that right, though? Let’s print out those rows and count:</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb412-1" title="1">bridges <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)) </a></code></pre></div>
<pre><code>## # A tibble: 2 x 13
##   id    river location erected purpose length lanes clear_g t_d   material span 
##   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 E7    A           27 CRAFTS  HIGHWAY SHORT      2 N       THRO… WOOD     MEDI…
## 2 E8    A           28 CRAFTS  AQUEDU… MEDIUM     1 N       THRO… IRON     SHORT
## # … with 2 more variables: rel_l &lt;chr&gt;, type &lt;chr&gt;</code></pre>
<p>Out of the ones we’re counting, I see differences in purpose, length,
lanes, material, span and type. Six.</p>
<p>I actually think the <code>unlist</code> is not needed:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb414-1" title="1">row_diff2 &lt;-<span class="st"> </span><span class="cf">function</span>(i, j, d) {</a>
<a class="sourceLine" id="cb414-2" title="2">  d1 &lt;-<span class="st"> </span>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>id, <span class="op">-</span>location)</a>
<a class="sourceLine" id="cb414-3" title="3">  x &lt;-<span class="st"> </span>d1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(i)</a>
<a class="sourceLine" id="cb414-4" title="4">  y &lt;-<span class="st"> </span>d1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(j)</a>
<a class="sourceLine" id="cb414-5" title="5">  <span class="kw">count_diff</span>(x, y)</a>
<a class="sourceLine" id="cb414-6" title="6">}</a>
<a class="sourceLine" id="cb414-7" title="7"><span class="kw">row_diff2</span>(<span class="dv">3</span>, <span class="dv">4</span>, bridges)</a></code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>Here, <code>x</code> and <code>y</code> are one-row data frames, but R (via
<code>count_diff</code>) is sufficiently flexible to be able to cope with
these rather than vectors (it checks “corresponding elements” of
<code>x</code> and <code>y</code> for differentness). To my mind, though,
having the <code>unlist</code> in is clearer, since it makes it
unambiguous that <code>x</code> and <code>y</code> are vectors, and we know
that <code>count_diff</code> works for vectors since that’s what we
tested it with.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Create a matrix or data frame of pairwise dissimilarities
between each pair of bridges (using only the ones with no missing
values). Use loops, or <code>crossing</code> and <code>rowwise</code>, as
you prefer. Display the first six rows of
your matrix (using <code>head</code>) or the first few rows of your data
frame. (The whole thing is big, so don’t display it all.)</li>
</ol>
<p>Solution</p>
<p>First thing, either way, is to find out how many bridges we have left:</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb416-1" title="1">bridges</a></code></pre></div>
<pre><code>## # A tibble: 70 x 13
##    id    river location erected purpose  length lanes clear_g t_d     material
##    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   
##  1 E2    A           25 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
##  2 E5    A           29 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
##  3 E7    A           27 CRAFTS  HIGHWAY  SHORT      2 N       THROUGH WOOD    
##  4 E8    A           28 CRAFTS  AQUEDUCT MEDIUM     1 N       THROUGH IRON    
##  5 E9    M            3 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH IRON    
##  6 E11   A           29 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
##  7 E14   M            6 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
##  8 E16   A           25 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH IRON    
##  9 E18   A           28 CRAFTS  RR       MEDIUM     2 N       THROUGH IRON    
## 10 E19   A           29 CRAFTS  HIGHWAY  MEDIUM     2 N       THROUGH WOOD    
## # … with 60 more rows, and 3 more variables: span &lt;chr&gt;, rel_l &lt;chr&gt;,
## #   type &lt;chr&gt;</code></pre>
<ol start="70" style="list-style-type: decimal">
<li>So the loops (and the <code>crossing</code>) will go up to 70. Loops first:</li>
</ol>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb418-1" title="1">m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">70</span>, <span class="dv">70</span>)</a>
<a class="sourceLine" id="cb418-2" title="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">70</span>) {</a>
<a class="sourceLine" id="cb418-3" title="3">  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">70</span>) {</a>
<a class="sourceLine" id="cb418-4" title="4">    m[i, j] &lt;-<span class="st"> </span><span class="kw">row_diff</span>(i, j, bridges)</a>
<a class="sourceLine" id="cb418-5" title="5">  }</a>
<a class="sourceLine" id="cb418-6" title="6">}</a></code></pre></div>
<p>Even just the top six rows (of all 70 columns) takes up a lot of
space. The grader would only check that it looks about right:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb419-1" title="1"><span class="kw">head</span>(m)</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13] [,14]
## [1,]    0    0    2    4    3    1    2    4    3     1     2     3     7     6
## [2,]    0    0    2    4    3    1    2    4    3     1     2     3     7     6
## [3,]    2    2    0    6    5    1    2    4    5     1     2     5     7     6
## [4,]    4    4    6    0    3    5    6    4    3     5     6     6     8     8
## [5,]    3    3    5    3    0    4    3    3    3     4     5     6     6     5
## [6,]    1    1    1    5    4    0    1    3    4     0     1     4     6     5
##      [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25] [,26]
## [1,]     7     9     6     7     3     8     7     9     8     6     7     6
## [2,]     7     9     6     7     3     8     7     9     8     6     7     6
## [3,]     7     9     6     7     5     8     8     9     7     6     6     6
## [4,]     8    10     8     8     3    10     9    10     9     8     9     8
## [5,]     6     9     7     6     6     7     6    10     7     7     8     7
## [6,]     6     9     5     6     4     8     7     9     7     5     6     5
##      [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36] [,37] [,38]
## [1,]     7     7     8     8     9     6     8     7     9     7     8     8
## [2,]     7     7     8     8     9     6     8     7     9     7     8     8
## [3,]     7     6     8     8     7     7     9     8     9     8     8     7
## [4,]     8     8     9     9     9     8     9     9    10     8     9     9
## [5,]     6     8     7     7    10     7     8     7     9     8     9     9
## [6,]     6     6     7     7     8     6     8     7     9     7     8     7
##      [,39] [,40] [,41] [,42] [,43] [,44] [,45] [,46] [,47] [,48] [,49] [,50]
## [1,]     8     7     8     8     7     9     8     9     9     8     7     8
## [2,]     8     7     8     8     7     9     8     9     9     8     7     8
## [3,]     6     6     6     6     8     8     9     8     8     6     6     9
## [4,]     9     8     8     8     9    10     9    10    11     8     9     9
## [5,]     9     8     8     8     7     8     7    10     8     8     6     8
## [6,]     7     6     7     7     7     8     8     8     8     7     6     8
##      [,51] [,52] [,53] [,54] [,55] [,56] [,57] [,58] [,59] [,60] [,61] [,62]
## [1,]     7     8     8     8     8     8     6     8     7     9    10     8
## [2,]     7     8     8     8     8     8     6     8     7     9    10     8
## [3,]     8     9     9     8     8     6     6     8     7     7    10     9
## [4,]     8     8     9     9     9     9     8    10     9    10    11     9
## [5,]     7     6     7     9     9     9     7     8     6     8     9     7
## [6,]     7     8     8     7     7     7     5     8     6     8    10     8
##      [,63] [,64] [,65] [,66] [,67] [,68] [,69] [,70]
## [1,]     8     7     8     9    10     8     9     9
## [2,]     8     7     8     9    10     8     9     9
## [3,]     8     8     9     7    10     6     9     8
## [4,]     9     9     9    10    11     9    10    10
## [5,]     9     7     7    10     9     9     9     8
## [6,]     8     7     8     8    10     7     9     9</code></pre>
<p>A cursory glance at this shows that the bridges in the small-numbered
rows of the data frame are similar to each other and different from
the others. This suggests that these small-numbered bridges will end
up in the same cluster (later).</p>
<p>The <code>tidyverse</code> way is really similar in conception. First use
<code>crossing</code> to create all combinations of <code>i</code> and <code>j</code>:</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb421-1" title="1">mm &lt;-<span class="st"> </span><span class="kw">crossing</span>(<span class="dt">i =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">70</span>, <span class="dt">j =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">70</span>)</a></code></pre></div>
<p>and then use <code>rowwise</code>:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb422-1" title="1">mm <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb422-2" title="2"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb422-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">diff =</span> <span class="kw">row_diff</span>(i, j, bridges)) -&gt;<span class="st"> </span>mm</a>
<a class="sourceLine" id="cb422-4" title="4">mm</a></code></pre></div>
<pre><code>## # A tibble: 4,900 x 3
## # Rowwise: 
##        i     j  diff
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1     1     1     0
##  2     1     2     0
##  3     1     3     2
##  4     1     4     4
##  5     1     5     3
##  6     1     6     1
##  7     1     7     2
##  8     1     8     4
##  9     1     9     3
## 10     1    10     1
## # … with 4,890 more rows</code></pre>
<p>If you forget the <code>rowwise</code>, the answers (in <code>diff</code>) will all be the same, which should make you suspicious.</p>
<p>This is long format, though, so we need to <code>pivot_wider</code> the
<code>j</code> column to get a square array of dissimilarities:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb424-1" title="1">mm <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pivot_wider</span>(<span class="dt">names_from=</span>j, <span class="dt">values_from=</span>diff) -&gt;<span class="st"> </span>mm</a>
<a class="sourceLine" id="cb424-2" title="2">mm</a></code></pre></div>
<pre><code>## # A tibble: 70 x 71
##        i   `1`   `2`   `3`   `4`   `5`   `6`   `7`   `8`   `9`  `10`  `11`  `12`
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1     1     0     0     2     4     3     1     2     4     3     1     2     3
##  2     2     0     0     2     4     3     1     2     4     3     1     2     3
##  3     3     2     2     0     6     5     1     2     4     5     1     2     5
##  4     4     4     4     6     0     3     5     6     4     3     5     6     6
##  5     5     3     3     5     3     0     4     3     3     3     4     5     6
##  6     6     1     1     1     5     4     0     1     3     4     0     1     4
##  7     7     2     2     2     6     3     1     0     4     5     1     2     5
##  8     8     4     4     4     4     3     3     4     0     4     3     4     7
##  9     9     3     3     5     3     3     4     5     4     0     4     5     6
## 10    10     1     1     1     5     4     0     1     3     4     0     1     4
## # … with 60 more rows, and 58 more variables: 13 &lt;int&gt;, 14 &lt;int&gt;, 15 &lt;int&gt;,
## #   16 &lt;int&gt;, 17 &lt;int&gt;, 18 &lt;int&gt;, 19 &lt;int&gt;, 20 &lt;int&gt;, 21 &lt;int&gt;, 22 &lt;int&gt;,
## #   23 &lt;int&gt;, 24 &lt;int&gt;, 25 &lt;int&gt;, 26 &lt;int&gt;, 27 &lt;int&gt;, 28 &lt;int&gt;, 29 &lt;int&gt;,
## #   30 &lt;int&gt;, 31 &lt;int&gt;, 32 &lt;int&gt;, 33 &lt;int&gt;, 34 &lt;int&gt;, 35 &lt;int&gt;, 36 &lt;int&gt;,
## #   37 &lt;int&gt;, 38 &lt;int&gt;, 39 &lt;int&gt;, 40 &lt;int&gt;, 41 &lt;int&gt;, 42 &lt;int&gt;, 43 &lt;int&gt;,
## #   44 &lt;int&gt;, 45 &lt;int&gt;, 46 &lt;int&gt;, 47 &lt;int&gt;, 48 &lt;int&gt;, 49 &lt;int&gt;, 50 &lt;int&gt;,
## #   51 &lt;int&gt;, 52 &lt;int&gt;, 53 &lt;int&gt;, 54 &lt;int&gt;, 55 &lt;int&gt;, 56 &lt;int&gt;, 57 &lt;int&gt;,
## #   58 &lt;int&gt;, 59 &lt;int&gt;, 60 &lt;int&gt;, 61 &lt;int&gt;, 62 &lt;int&gt;, 63 &lt;int&gt;, 64 &lt;int&gt;,
## #   65 &lt;int&gt;, 66 &lt;int&gt;, 67 &lt;int&gt;, 68 &lt;int&gt;, 69 &lt;int&gt;, 70 &lt;int&gt;</code></pre>
<p>This shows what we found before, that bridges 3 and 4 differ on 6
variables.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Turn your matrix or data frame into a <code>dist</code>
object. (If you couldn’t create a matrix or data frame of
dissimilarities, read them in from
<a href="https://raw.githubusercontent.com/nxskok/datafiles/master/mm.csv">link</a>.) Do not
display your distance object.</li>
</ol>
<p>Solution</p>
<p>The only tricky thing is that the data frame that I called
<code>mm</code> has an extra column called <code>i</code> that needs to be
removed first. This also applies if you need to read it in from
the file. Thus:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb426-1" title="1">d1 &lt;-<span class="st"> </span><span class="kw">as.dist</span>(m)</a></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb427-1" title="1">mm <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>i) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.dist</span>() -&gt;<span class="st"> </span>d2</a></code></pre></div>
<p>or, if you got stuck,</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb428-1" title="1">my_url &lt;-<span class="st"> &quot;http://ritsokiguess.site/datafiles/mm.csv&quot;</span></a>
<a class="sourceLine" id="cb428-2" title="2">mmm &lt;-<span class="st"> </span><span class="kw">read_csv</span>(my_url)</a></code></pre></div>
<pre><code>## 
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
## cols(
##   .default = col_double()
## )
## ℹ Use `spec()` for the full column specifications.</code></pre>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb430-1" title="1">mmm</a></code></pre></div>
<pre><code>## # A tibble: 70 x 71
##        i   `1`   `2`   `3`   `4`   `5`   `6`   `7`   `8`   `9`  `10`  `11`  `12`
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1     0     0     2     4     3     1     2     4     3     1     2     3
##  2     2     0     0     2     4     3     1     2     4     3     1     2     3
##  3     3     2     2     0     6     5     1     2     4     5     1     2     5
##  4     4     4     4     6     0     3     5     6     4     3     5     6     6
##  5     5     3     3     5     3     0     4     3     3     3     4     5     6
##  6     6     1     1     1     5     4     0     1     3     4     0     1     4
##  7     7     2     2     2     6     3     1     0     4     5     1     2     5
##  8     8     4     4     4     4     3     3     4     0     4     3     4     7
##  9     9     3     3     5     3     3     4     5     4     0     4     5     6
## 10    10     1     1     1     5     4     0     1     3     4     0     1     4
## # … with 60 more rows, and 58 more variables: 13 &lt;dbl&gt;, 14 &lt;dbl&gt;, 15 &lt;dbl&gt;,
## #   16 &lt;dbl&gt;, 17 &lt;dbl&gt;, 18 &lt;dbl&gt;, 19 &lt;dbl&gt;, 20 &lt;dbl&gt;, 21 &lt;dbl&gt;, 22 &lt;dbl&gt;,
## #   23 &lt;dbl&gt;, 24 &lt;dbl&gt;, 25 &lt;dbl&gt;, 26 &lt;dbl&gt;, 27 &lt;dbl&gt;, 28 &lt;dbl&gt;, 29 &lt;dbl&gt;,
## #   30 &lt;dbl&gt;, 31 &lt;dbl&gt;, 32 &lt;dbl&gt;, 33 &lt;dbl&gt;, 34 &lt;dbl&gt;, 35 &lt;dbl&gt;, 36 &lt;dbl&gt;,
## #   37 &lt;dbl&gt;, 38 &lt;dbl&gt;, 39 &lt;dbl&gt;, 40 &lt;dbl&gt;, 41 &lt;dbl&gt;, 42 &lt;dbl&gt;, 43 &lt;dbl&gt;,
## #   44 &lt;dbl&gt;, 45 &lt;dbl&gt;, 46 &lt;dbl&gt;, 47 &lt;dbl&gt;, 48 &lt;dbl&gt;, 49 &lt;dbl&gt;, 50 &lt;dbl&gt;,
## #   51 &lt;dbl&gt;, 52 &lt;dbl&gt;, 53 &lt;dbl&gt;, 54 &lt;dbl&gt;, 55 &lt;dbl&gt;, 56 &lt;dbl&gt;, 57 &lt;dbl&gt;,
## #   58 &lt;dbl&gt;, 59 &lt;dbl&gt;, 60 &lt;dbl&gt;, 61 &lt;dbl&gt;, 62 &lt;dbl&gt;, 63 &lt;dbl&gt;, 64 &lt;dbl&gt;,
## #   65 &lt;dbl&gt;, 66 &lt;dbl&gt;, 67 &lt;dbl&gt;, 68 &lt;dbl&gt;, 69 &lt;dbl&gt;, 70 &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb432-1" title="1">mmm <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>i) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.dist</span>() -&gt;<span class="st"> </span>d3</a>
<a class="sourceLine" id="cb432-2" title="2">d3</a></code></pre></div>
<pre><code>##     1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
## 2   0                                                                        
## 3   2  2                                                                     
## 4   4  4  6                                                                  
## 5   3  3  5  3                                                               
## 6   1  1  1  5  4                                                            
## 7   2  2  2  6  3  1                                                         
## 8   4  4  4  4  3  3  4                                                      
## 9   3  3  5  3  3  4  5  4                                                   
## 10  1  1  1  5  4  0  1  3  4                                                
## 11  2  2  2  6  5  1  2  4  5  1                                             
## 12  3  3  5  6  6  4  5  7  6  4  3                                          
## 13  7  7  7  8  6  6  5  7  5  6  5  6                                       
## 14  6  6  6  8  5  5  4  6  7  5  4  5  2                                    
## 15  7  7  7  8  6  6  5  7  5  6  5  6  0  2                                 
## 16  9  9  9 10  9  9  9  9  7  9  8  8  4  6  4                              
## 17  6  6  6  8  7  5  6  5  6  5  5  6  4  4  4  5                           
## 18  7  7  7  8  6  6  5  7  5  6  6  7  1  3  1  5  3                        
## 19  3  3  5  3  6  4  5  7  5  4  4  4  8  8  8 10  7  7                     
## 20  8  8  8 10  7  8  7  8  8  8  8  8  5  5  5  3  3  4  9                  
## 21  7  7  8  9  6  7  6  7  8  7  7  7  5  3  5  5  3  4  8  2               
## 22  9  9  9 10 10  9 10  9  7  9  9  9  6  8  6  3  4  5  9  3  5            
## 23  8  8  7  9  7  7  6  8  6  7  7  8  2  4  2  4  4  1  8  3  5  4         
## 24  6  6  6  8  7  5  6  5  6  5  5  6  4  4  4  5  0  3  7  3  3  4  4      
## 25  7  7  6  9  8  6  7  6  7  6  6  7  5  5  5  4  1  4  8  2  4  3  3  1   
## 26  6  6  6  8  7  5  6  5  7  5  5  6  5  4  5  6  1  4  7  4  3  5  5  1  2
## 27  7  7  7  8  6  6  5  7  5  6  6  7  1  3  1  5  3  0  7  4  4  5  1  3  4
## 28  7  7  6  8  8  6  7  7  5  6  6  7  3  5  3  4  3  2  7  4  6  3  1  3  2
## 29  8  8  8  9  7  7  6  7  6  7  7  8  2  4  2  4  2  1  8  3  3  4  2  2  3
## 30  8  8  8  9  7  7  6  6  6  7  7  8  2  4  2  5  3  1  8  4  4  5  2  3  4
## 31  9  9  7  9 10  8  9  7  7  8  8  7  5  7  5  6  4  4  8  6  7  5  4  4  4
## 32  6  6  7  8  7  6  7  6  6  6  6  6  5  5  5  4  1  4  7  2  2  3  5  1  2
## 33  8  8  9  9  8  8  8  8  7  8  8  8  5  6  5  3  4  4  8  4  3  4  5  4  5
## 34  7  7  8  9  7  7  7  7  8  7  7  7  6  5  6  4  3  5  8  3  2  5  6  3  4
## 35  9  9  9 10  9  9  9  9  7  9  9  9  5  7  5  1  4  4  9  2  4  2  3  4  3
## 36  7  7  8  8  8  7  8  7  7  7  7  5  6  6  6  5  2  5  7  3  3  4  6  2  3
## 37  8  8  8  9  9  8  9  8  7  8  8 10  8  9  8  5  6  7  8  5  6  2  6  6  5
## 38  8  8  7  9  9  7  8  7  6  7  7  8  4  6  4  3  2  3  8  3  5  2  2  2  1
## 39  8  8  6  9  9  7  8  7  9  7  7  6  7  5  7  7  3  6  8  5  4  6  6  3  3
## 40  7  7  6  8  8  6  7  7  8  6  6  5  6  4  6  7  4  5  7  5  5  6  4  4  3
## 41  8  8  6  8  8  7  8  5  9  7  7  6  7  6  7  8  4  6  8  6  6  7  6  4  4
## 42  8  8  6  8  8  7  8  5  9  7  7  6  7  6  7  8  4  6  8  6  6  7  6  4  4
## 43  7  7  8  9  7  7  7  6  8  7  7  7  6  5  6  5  4  5  8  4  3  6  6  4  5
## 44  9  9  8 10  8  8  7  7 10  8  8  9  8  7  8  9  7  7  9  6  7  7  6  7  6
## 45  8  8  9  9  7  8  7  8  9  8  8  6  6  5  6  6  4  5  8  3  2  6  6  4  5
## 46  9  9  8 10 10  8  9  8 10  8  8  7  8  6  8  7  4  7  9  5  5  4  6  4  3
## 47  9  9  8 11  8  8  7  7 10  8  8  9  6  5  6  7  5  5 10  4  5  5  4  5  4
## 48  8  8  6  8  8  7  8  5  9  7  7  6  7  6  7  8  4  6  8  6  6  7  6  4  4
## 49  7  7  6  9  6  6  5  7  7  6  6  7  3  3  3  5  3  2  8  2  4  5  1  3  2
## 50  8  8  9  9  8  8  8  8  9  8  8  6  7  5  7  5  4  6  8  4  2  6  7  4  5
## 51  7  7  8  8  7  7  7  7  8  7  7  7  8  6  8  6  5  7  7  5  3  7  8  5  6
## 52  8  8  9  8  6  8  7  7  9  8  8  6  6  5  6  6  4  5  8  3  2  6  6  4  5
## 53  8  8  9  9  7  8  7  7  9  8  8  8  8  7  8  9  7  7  8  6  5  7  8  7  8
## 54  8  8  8  9  9  7  8  7  9  7  7  6  7  6  7  8  3  6  8  6  5  5  7  3  4
## 55  8  8  8  9  9  7  8  6  9  7  7  6  7  6  7  9  5  7  9  8  7  7  8  5  6
## 56  8  8  6  9  9  7  8  6  6  7  7  8  4  6  4  5  4  4  9  6  7  5  4  4  4
## 57  6  6  6  8  7  5  6  4  7  5  5  8  7  6  7  9  5  7  8  8  7  7  8  5  6
## 58  8  8  8 10  8  8  8  8  9  8  8  8  7  6  7  3  5  7 10  3  4  5  6  5  4
## 59  7  7  7  9  6  6  5  5  7  6  6  7  3  3  3  6  3  3  9  4  4  7  4  3  4
## 60  9  9  7 10  8  8  7  8 10  8  8  7  6  5  6  7  5  6 10  5  5  8  6  5  5
## 61 10 10 10 11  9 10  9 10 11 10 10  8  8  7  8  6  7  8 11  4  5  5  7  7  6
## 62  8  8  9  9  7  8  7  8  9  8  8  6  6  5  6  6  5  6  9  4  3  7  7  5  6
## 63  8  8  8  9  9  8  9  8  9  8  8  8 10  9 10  7  7 10  9  6  7  5  9  7  6
## 64  7  7  8  9  7  7  7  7  8  7  7  7  6  5  6  4  4  6  9  4  3  6  7  4  5
## 65  8  8  9  9  7  8  7  8  9  8  8  7  6  4  6  6  5  6  9  4  2  7  7  5  6
## 66  9  9  7 10 10  8  9  7 10  8  8  7  8  7  8  9  6  8 10  8  8  7  8  6  6
## 67 10 10 10 11  9 10  9 10 11 10 10  8  8  7  8  6  7  8 11  4  5  5  7  7  6
## 68  8  8  6  9  9  7  8  7  9  7  7  7  7  5  7  7  4  7  9  6  5  7  7  4  4
## 69  9  9  9 10  9  9  9  9 10  9  9  8  8  6  8  4  6  8 10  4  4  6  7  6  5
## 70  9  9  8 10  8  9  8  9 10  9  9  8  7  5  7  6  6  7 10  4  3  7  7  6  6
##    26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50
## 2                                                                            
## 3                                                                            
## 4                                                                            
## 5                                                                            
## 6                                                                            
## 7                                                                            
## 8                                                                            
## 9                                                                            
## 10                                                                           
## 11                                                                           
## 12                                                                           
## 13                                                                           
## 14                                                                           
## 15                                                                           
## 16                                                                           
## 17                                                                           
## 18                                                                           
## 19                                                                           
## 20                                                                           
## 21                                                                           
## 22                                                                           
## 23                                                                           
## 24                                                                           
## 25                                                                           
## 26                                                                           
## 27  4                                                                        
## 28  4  2                                                                     
## 29  3  1  3                                                                  
## 30  4  1  3  1                                                               
## 31  5  4  3  4  3                                                            
## 32  2  4  4  3  4  5                                                         
## 33  3  4  5  3  4  6  3                                                      
## 34  2  5  6  4  5  7  2  1                                                   
## 35  5  4  3  3  4  5  3  2  3                                                
## 36  3  5  5  4  5  4  1  4  3  4                                             
## 37  6  7  5  6  7  7  5  5  6  4  6                                          
## 38  3  3  1  2  3  3  3  4  5  2  4  4                                       
## 39  3  6  5  5  6  3  4  6  5  6  3  7  4                                    
## 40  4  5  3  6  6  4  5  7  6  6  4  7  4  2                                 
## 41  4  6  5  6  5  2  5  7  6  7  4  8  5  2  3                              
## 42  4  6  5  6  5  2  5  7  6  7  4  8  5  2  3  0                           
## 43  3  5  6  5  4  6  3  2  1  4  4  7  6  6  6  5  5                        
## 44  6  7  7  7  6  6  8  8  7  8  7  6  7  6  5  5  5  6                     
## 45  3  5  7  4  5  6  3  3  2  5  2  7  6  4  5  5  5  3  5                  
## 46  4  7  5  6  7  5  5  7  6  6  4  5  4  2  2  4  4  7  4  5               
## 47  4  5  5  5  4  6  6  6  5  6  7  6  5  6  5  5  5  4  2  5  4            
## 48  4  6  5  6  5  2  5  7  6  7  4  8  5  2  3  0  0  5  5  5  4  5         
## 49  4  2  2  3  3  5  4  6  5  4  5  7  3  5  3  5  5  5  5  5  5  3  5      
## 50  4  6  7  5  6  6  3  3  2  4  2  7  6  3  4  5  5  3  7  2  4  7  5  6   
## 51  5  7  8  6  7  7  4  4  3  5  3  6  7  4  5  6  6  4  6  3  5  8  6  7  1
## 52  4  5  7  4  5  6  3  4  3  5  2  7  6  4  5  4  4  4  6  1  5  6  4  5  2
## 53  7  7  9  7  6  7  6  7  6  8  5  5  9  7  7  6  6  5  3  4  6  5  6  7  5
## 54  2  6  6  5  6  5  4  5  4  7  3  6  5  3  4  4  4  5  4  3  2  4  4  6  4
## 55  5  7  7  7  6  5  6  8  7  9  5  7  7  5  5  4  4  6  5  6  4  5  4  7  6
## 56  5  4  3  4  3  2  5  6  7  5  6  7  3  5  6  4  4  6  8  8  7  6  4  5  8
## 57  5  7  7  7  6  7  6  8  7  9  7  5  7  7  7  6  6  6  5  8  6  5  6  7  8
## 58  4  7  6  6  7  8  4  3  2  3  5  6  5  6  6  7  7  3  7  4  6  5  7  5  4
## 59  4  3  5  3  2  5  4  6  5  6  5  9  5  6  6  5  5  4  6  5  7  4  5  3  6
## 60  5  6  7  5  6  5  6  7  6  7  5  8  6  3  5  4  4  7  6  4  5  6  4  5  5
## 61  7  8  8  7  8  8  6  7  6  6  5  5  7  6  6  7  7  7  5  4  4  5  7  6  5
## 62  4  6  8  5  6  7  4  4  3  6  3  8  7  5  6  6  6  4  6  1  6  6  6  6  3
## 63  7 10  8  9 10  8  6  8  7  7  5  3  7  6  6  7  7  8  5  6  4  7  7  8  6
## 64  4  6  7  5  6  8  3  3  2  4  4  6  6  6  7  7  7  3  9  4  7  7  7  6  3
## 65  5  6  8  5  6  8  4  5  4  6  4  8  7  5  6  7  7  5  8  3  6  7  7  6  3
## 66  6  8  7  8  7  4  7  9  8  9  6  7  7  4  5  3  3  7  5  7  4  5  3  7  7
## 67  7  8  8  7  8  8  6  7  6  6  5  5  7  6  6  7  7  7  5  4  4  5  7  6  5
## 68  4  7  6  6  7  5  5  7  6  7  5  8  5  2  4  4  4  7  8  6  4  7  4  6  5
## 69  6  8  7  7  8  8  5  5  4  4  5  7  6  5  5  7  7  5  8  5  5  7  7  6  3
## 70  6  7  8  6  7  7  5  6  5  6  5  8  7  4  6  6  6  6  8  4  6  7  6  6  4
##    51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
## 2                                                          
## 3                                                          
## 4                                                          
## 5                                                          
## 6                                                          
## 7                                                          
## 8                                                          
## 9                                                          
## 10                                                         
## 11                                                         
## 12                                                         
## 13                                                         
## 14                                                         
## 15                                                         
## 16                                                         
## 17                                                         
## 18                                                         
## 19                                                         
## 20                                                         
## 21                                                         
## 22                                                         
## 23                                                         
## 24                                                         
## 25                                                         
## 26                                                         
## 27                                                         
## 28                                                         
## 29                                                         
## 30                                                         
## 31                                                         
## 32                                                         
## 33                                                         
## 34                                                         
## 35                                                         
## 36                                                         
## 37                                                         
## 38                                                         
## 39                                                         
## 40                                                         
## 41                                                         
## 42                                                         
## 43                                                         
## 44                                                         
## 45                                                         
## 46                                                         
## 47                                                         
## 48                                                         
## 49                                                         
## 50                                                         
## 51                                                         
## 52  3                                                      
## 53  4  4                                                   
## 54  5  4  5                                                
## 55  7  6  4  3                                             
## 56  9  8  9  7  5                                          
## 57  7  8  4  5  2  5                                       
## 58  5  5  8  6  7  6  7                                    
## 59  7  5  6  6  4  3  4  5                                 
## 60  6  4  6  5  4  5  6  5  4                              
## 61  6  4  4  5  4  8  6  4  6  3                           
## 62  4  2  5  4  5  7  7  3  4  3  3                        
## 63  5  6  4  5  4  8  4  5  8  5  2  5                     
## 64  4  4  6  6  5  6  5  2  4  4  4  3  5                  
## 65  4  3  6  6  6  7  7  4  4  4  4  2  6  3               
## 66  8  7  5  4  1  4  3  7  5  3  4  6  4  6  7            
## 67  6  4  4  5  4  8  6  4  6  3  0  3  2  4  4  4         
## 68  6  6  9  5  5  4  6  5  5  3  6  5  6  5  3  4  6      
## 69  4  5  8  7  7  7  8  2  6  5  4  4  5  3  2  7  4  3   
## 70  5  4  7  7  7  6  8  4  5  3  4  3  6  4  1  6  4  2  2</code></pre>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Run a cluster analysis using Ward’s method, and display a
dendrogram. The labels for the bridges (rows of the data frame) may
come out too big; experiment with a <code>cex</code> less than 1 on the
plot so that you can see them.</li>
</ol>
<p>Solution</p>
<p>Home stretch now. I found that <code>cex=0.3</code> was good for me, though I had to enlarge the graph to see the bridge numbers:</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb434-1" title="1">bridges<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">hclust</span>(d1, <span class="dt">method =</span> <span class="st">&quot;ward.D&quot;</span>)</a>
<a class="sourceLine" id="cb434-2" title="2"><span class="kw">plot</span>(bridges<span class="fl">.1</span>, <span class="dt">cex =</span> <span class="fl">0.3</span>)</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-243-1.png" width="672" /></p>
<p><code>cex</code> stands for “character expansion”. This is one of the
myriad of things you could adjust on the old base graphics (of which
this is an example). If you wanted to make text <em>bigger</em>, you’d
set <code>cex</code> to a value bigger than 1.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol style="list-style-type: lower-roman">
<li>How many clusters do you think is reasonable for these
data? Draw them on your plot.</li>
</ol>
<p>Solution</p>
<p>I think you could go with any number from about 3 to something
like 15, but my choice is 5. What you want is for the bridges
within a cluster to be similar and bridges in different clusters
to be different, however you judge that.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" title="1"><span class="kw">plot</span>(bridges<span class="fl">.1</span>, <span class="dt">cex =</span> <span class="fl">0.3</span>)</a>
<a class="sourceLine" id="cb435-2" title="2"><span class="kw">rect.hclust</span>(bridges<span class="fl">.1</span>, <span class="dv">5</span>)</a></code></pre></div>
<p><img src="pasias_files/figure-html/unnamed-chunk-244-1.png" width="672" /></p>
<p>Whatever number of clusters you go with, draw a corresponding number
of red rectangles.</p>
<p>Note that the low-numbered bridges are all in my first cluster, as I
suspected they would be.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="10" style="list-style-type: lower-alpha">
<li>Pick three bridges in the same one of your clusters (it
doesn’t matter which three bridges or which cluster). Display the
data for these bridges. Does it make sense that these three bridges
ended up in the same cluster? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>What I want you to do is to display the data for your chosen three
bridges and make the case that they are “similar”. I’m picking
41, 42 and 48 from my third cluster. On yours, scroll right to see the other variables.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" title="1">bridges <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="kw">c</span>(<span class="dv">41</span>, <span class="dv">42</span>, <span class="dv">48</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 13
##   id    river location erected purpose length lanes clear_g t_d   material span 
##   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 E70   A           27 MATURE  HIGHWAY SHORT      4 G       THRO… STEEL    MEDI…
## 2 E69   A           26 MATURE  HIGHWAY SHORT      4 G       THRO… STEEL    MEDI…
## 3 E71   A           25 MATURE  HIGHWAY SHORT      4 G       THRO… STEEL    MEDI…
## # … with 2 more variables: rel_l &lt;chr&gt;, type &lt;chr&gt;</code></pre>
<p>These bridges are identical on everything except location (which we
weren’t considering anyway). So it makes perfect sense that they would
be in the same cluster.</p>
<p>You might not have been so lucky, for example, 10, 12 and 19, which
got joined together further up:</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb438-1" title="1">bridges <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">19</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 13
##   id    river location erected purpose length lanes clear_g t_d   material span 
##   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 E19   A           29 CRAFTS  HIGHWAY MEDIUM     2 N       THRO… WOOD     MEDI…
## 2 E22   A           24 EMERGI… HIGHWAY MEDIUM     4 G       THRO… WOOD     SHORT
## 3 E4    A           27 MATURE  AQUEDU… MEDIUM     1 N       THRO… WOOD     SHORT
## # … with 2 more variables: rel_l &lt;chr&gt;, type &lt;chr&gt;</code></pre>
<p>These differ on 3 or 4 variables and are the same on all the others,
so you can certainly say that they are more alike than different.</p>
<p>Extra: to get a feel for how different they might be, let’s compare
three bridges in different clusters:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" title="1">bridges <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">24</span>, <span class="dv">52</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 13
##   id    river location erected purpose length lanes clear_g t_d   material span 
##   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 E16   A           25 CRAFTS  HIGHWAY MEDIUM     2 N       THRO… IRON     MEDI…
## 2 E58   A           33 MATURE  HIGHWAY MEDIUM     2 G       THRO… STEEL    MEDI…
## 3 E76   M            6 MATURE  HIGHWAY MEDIUM     4 G       THRO… STEEL    LONG 
## # … with 2 more variables: rel_l &lt;chr&gt;, type &lt;chr&gt;</code></pre>
<p>These are not as different as I was expecting, but they are indeed
different on more of the variables.</p>
<p>It would be interesting to plot these bridges on a map of Pittsburgh,
colour-coded by which cluster they are in. This might give us some
insight about how bridges are alike or different.</p>
<p>I also remark that the discriminant analysis idea, using the clusters
as known groups, would not work here because we don’t have any
quantitative variables to use for the discriminant analysis.</p>
<p>The most interesting way I can think of is to cross-classify the
bridges by cluster and values of the other variables. These would be
complicated multi-way tables, though, which makes me wonder whether a
“classification tree” like <code>rpart</code> would be worth thinking
about.</p>
<p>I am curious enough to have a crack at this. First we need a data set
with the clusters in it. I’m going with my 5 clusters:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb442-1" title="1">bridges.rpart &lt;-<span class="st"> </span>bridges <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">cluster =</span> <span class="kw">cutree</span>(bridges<span class="fl">.1</span>, <span class="dv">5</span>))</a></code></pre></div>
<p>and then</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb443-1" title="1"><span class="kw">library</span>(rpart)</a>
<a class="sourceLine" id="cb443-2" title="2">bridges.tree &lt;-<span class="st"> </span><span class="kw">rpart</span>(<span class="kw">factor</span>(cluster) <span class="op">~</span><span class="st"> </span>river <span class="op">+</span><span class="st"> </span>erected <span class="op">+</span><span class="st"> </span>purpose <span class="op">+</span><span class="st"> </span>length <span class="op">+</span><span class="st"> </span>lanes <span class="op">+</span><span class="st"> </span>clear_g <span class="op">+</span></a>
<a class="sourceLine" id="cb443-3" title="3"><span class="st">  </span>t_d <span class="op">+</span><span class="st"> </span>material <span class="op">+</span><span class="st"> </span>span <span class="op">+</span><span class="st"> </span>rel_l <span class="op">+</span><span class="st"> </span>type, <span class="dt">data =</span> bridges.rpart, <span class="dt">method =</span> <span class="st">&quot;class&quot;</span>)</a>
<a class="sourceLine" id="cb443-4" title="4"><span class="kw">print</span>(bridges.tree)</a></code></pre></div>
<pre><code>## n= 70 
## 
## node), split, n, loss, yval, (yprob)
##       * denotes terminal node
## 
##  1) root 70 47 3 (0.19 0.16 0.33 0.2 0.13)  
##    2) span=MEDIUM,SHORT 45 31 4 (0.29 0.24 0.044 0.31 0.11)  
##      4) material=IRON,WOOD 13  0 1 (1 0 0 0 0) *
##      5) material=STEEL 32 18 4 (0 0.34 0.062 0.44 0.16)  
##       10) river=M 13  3 2 (0 0.77 0.077 0 0.15) *
##       11) river=A 19  5 4 (0 0.053 0.053 0.74 0.16) *
##    3) span=LONG 25  4 3 (0 0 0.84 0 0.16)  
##      6) type=ARCH,CANTILEV,SIMPLE-T 18  0 3 (0 0 1 0 0) *
##      7) type=CONT-T,SUSPEN 7  3 5 (0 0 0.43 0 0.57) *</code></pre>
<p>This takes some making sense of, so let’s grab a couple of bridges to
predict the cluster of:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb445-1" title="1">bridges.rpart <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">29</span>)) </a></code></pre></div>
<pre><code>## # A tibble: 2 x 14
##   id    river location erected purpose length lanes clear_g t_d   material span 
##   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 E42   M            9 MATURE  HIGHWAY LONG       2 G       THRO… STEEL    LONG 
## 2 E51   M            6 MATURE  RR      MEDIUM     2 G       THRO… STEEL    MEDI…
## # … with 3 more variables: rel_l &lt;chr&gt;, type &lt;chr&gt;, cluster &lt;int&gt;</code></pre>
<p>Let’s start with bridge 20 (with ID E42). The line in the printed
output marked 1 and “root” says that there are 70 bridges
altogether, and the best guess (if you know nothing) is to guess
cluster 3, which would guess 47 of the bridges wrong. The five numbers
in the brackets are the proportions of bridges in each cluster at this
point. But we <em>do</em> know more about bridge E42. We go to number 2,
which says to look at the <code>span</code>. For this bridge it is
<code>LONG</code>, so we go down to number 3. Under 3 are 6 and 7, which
say to look at <code>type</code>. Bridge E42 is of type <code>SIMPLE-T</code>,
so we go to 6. There is nothing under this (lower down in the tree),
and the line ends with a <code>*</code>, so we are ready to guess the
cluster. There are 18 bridges with this <code>span</code> and one of these
<code>type</code>s, and they are <em>all</em> in cluster 3, no
errors. Cluster 3 contains long-span bridges of one of those types.</p>
<p>Bridge 29, with ID E51, now. The first thing to look at is
<code>span</code> again; this one is <code>medium</code>, so we are at
2. Under 2 is 4 and 5; we are invited to look at <code>material</code>,
which is <code>STEEL</code>, number 5. We have another thing to look at,
10 and 11, which is <code>river</code>; in this case, <code>river</code> is
<code>M</code>, number 10. We are now at the end, guessing cluster 2
(which is also correct); there are 13 bridges of this <code>span</code>,
<code>material</code> and <code>river</code> and only 3 of them were in some
cluster other than 2.</p>
<p>By looking at the tree output, we can describe what makes a bridge be
predicted to land up in each cluster:</p>
<ul>
<li><p>Span is medium or short, material is iron or wood. (This
suggests old bridges.)</p></li>
<li><p>Span is medium or short, material is steel, river is M.</p></li>
<li><p>Span is long, type is arch, cantilever or simple-truss</p></li>
<li><p>Span is medium or short, material is steel, river is A.</p></li>
<li><p>Span is long, type is continuous-truss or suspension.</p></li>
</ul>
<p>This story is telling us that the clusters are determined by only a
few of our variables. <code>span</code> seems to be the most important,
then either type (if the span is long) or material and maybe river
(otherwise).</p>
<p>This is an example of a “classification tree” which is a nice
easy-to-follow version of logistic regression.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="36">
<li id="fn36"><p>For a long time, the Pittsburgh Steelers football team played at the Three Rivers Stadium.<a href="hierarchical-cluster-analysis.html#fnref36" class="footnote-back">↩</a></p></li>
<li id="fn37"><p>Conceivably.<a href="hierarchical-cluster-analysis.html#fnref37" class="footnote-back">↩</a></p></li>
<li id="fn38"><p>This is base-graphics code, which I learned a long time ago. There are a lot of options with weird names that are hard to remember, and that are sometimes inconsistent with each other. There is a package <code>ggdendro</code> that makes nice <code>ggplot</code> dendrograms, and another called <code>dendextend</code> that does all kinds of stuff with dendrograms. I decided that it wasn’t worth the trouble of teaching you (and therefore me) <code>ggdendro</code>, since the dendrograms look much the same.<a href="hierarchical-cluster-analysis.html#fnref38" class="footnote-back">↩</a></p></li>
<li id="fn39"><p>This, I think, is the British spelling, with the North American one being <em>esthetic</em>. My spelling is where the <em>aes</em> in a <em>ggplot</em> comes from.<a href="hierarchical-cluster-analysis.html#fnref39" class="footnote-back">↩</a></p></li>
<li id="fn40"><p>If you are a soccer fan, you might recognize BBVA as a former sponsor of the top Spanish soccer league, <em>La Liga BBVA</em> (as it was). BBVA is a Spanish bank that also has a Foundation that published this book.<a href="hierarchical-cluster-analysis.html#fnref40" class="footnote-back">↩</a></p></li>
<li id="fn41"><p>You could make a table out of the sites and species, and use the test statistic from a chi-squared test as a measure of dissimilarity: the smallest it can be is zero, if the species counts are exactly proportional at the two sites. It doesn’t have an upper limit.<a href="hierarchical-cluster-analysis.html#fnref41" class="footnote-back">↩</a></p></li>
<li id="fn42"><p>There are more issues.<a href="hierarchical-cluster-analysis.html#fnref42" class="footnote-back">↩</a></p></li>
<li id="fn43"><p>I am a paid-up member of the <em>print all the things</em> school of debugging. You probably know how to do this better.<a href="hierarchical-cluster-analysis.html#fnref43" class="footnote-back">↩</a></p></li>
<li id="fn44"><p>That’s two cups of coffee I owe the grader now.<a href="hierarchical-cluster-analysis.html#fnref44" class="footnote-back">↩</a></p></li>
<li id="fn45"><p>I now have a mental image of John Cleese saying “it don’t enter into it” in the <a href="https://www.youtube.com/watch?v=vnciwwsvNcc">infamous Dead Parrot sketch</a>. Not to mention <a href="https://www.youtube.com/watch?v=4JgbOkLdRaE.">How to defend yourself against an assailant armed with fresh fruit</a><a href="hierarchical-cluster-analysis.html#fnref45" class="footnote-back">↩</a></p></li>
<li id="fn46"><p>Tuna is an exception, but usually Ward tends to join fairly dissimilar things that are nonetheless more similar to each other than to anything else. This is like Hungarian and Finnish in the example in lecture: they are very dissimilar languages, but they are more similar to each other than to anything else.<a href="hierarchical-cluster-analysis.html#fnref46" class="footnote-back">↩</a></p></li>
<li id="fn47"><p>For a long time, the Pittsburgh Steelers football team played at the Three Rivers Stadium.<a href="hierarchical-cluster-analysis.html#fnref47" class="footnote-back">↩</a></p></li>
<li id="fn48"><p>Sometimes it’s necessary to distinguish between the different types of missing value; if that’s the case, you can use eg. <code>NA_real_</code> and <code>NA_character_-</code> to distinguish missing decimal numbers from missing text.<a href="hierarchical-cluster-analysis.html#fnref48" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="discriminant-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="k-means-cluster-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["pasias.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
