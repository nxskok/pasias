<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 37 Drawing maps with Leaflet | Problems and Solutions in Applied Statistics</title>
  <meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 37 Drawing maps with Leaflet | Problems and Solutions in Applied Statistics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://ritsokiguess.site/pasias" />
  
  <meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
  <meta name="github-repo" content="nxskok/pasias" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 37 Drawing maps with Leaflet | Problems and Solutions in Applied Statistics" />
  
  <meta name="twitter:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
  

<meta name="author" content="Ken Butler" />


<meta name="date" content="2021-06-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="k-means-cluster-analysis.html"/>
<link rel="next" href="multidimensional-scaling.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Problems and Solutions in Applied Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#packages-used-somewhere-in-this-book"><i class="fa fa-check"></i>Packages used somewhere in this book</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html"><i class="fa fa-check"></i><b>1</b> Getting used to R and R Studio</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html#running-r-studio-on-jupyterhub"><i class="fa fa-check"></i><b>1.1</b> Running R Studio on Jupyterhub</a></li>
<li class="chapter" data-level="1.2" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html#getting-an-r-studio-cloud-account"><i class="fa fa-check"></i><b>1.2</b> Getting an R Studio Cloud account</a></li>
<li class="chapter" data-level="1.3" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html#getting-started"><i class="fa fa-check"></i><b>1.3</b> Getting started</a></li>
<li class="chapter" data-level="1.4" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html#reading-data-from-a-file"><i class="fa fa-check"></i><b>1.4</b> Reading data from a file</a></li>
<li class="chapter" data-level="1.5" data-path="getting-used-to-r-and-r-studio.html"><a href="getting-used-to-r-and-r-studio.html#reading-files-different-ways"><i class="fa fa-check"></i><b>1.5</b> Reading files different ways</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reading-in-data.html"><a href="reading-in-data.html"><i class="fa fa-check"></i><b>2</b> Reading in data</a></li>
<li class="chapter" data-level="3" data-path="drawing-graphs.html"><a href="drawing-graphs.html"><i class="fa fa-check"></i><b>3</b> Drawing graphs</a></li>
<li class="chapter" data-level="4" data-path="data-exploration.html"><a href="data-exploration.html"><i class="fa fa-check"></i><b>4</b> Data exploration</a></li>
<li class="chapter" data-level="5" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html"><i class="fa fa-check"></i><b>5</b> Working with dataframes</a></li>
<li class="chapter" data-level="6" data-path="one-sample-inference.html"><a href="one-sample-inference.html"><i class="fa fa-check"></i><b>6</b> One-sample inference</a></li>
<li class="chapter" data-level="7" data-path="two-sample-inference.html"><a href="two-sample-inference.html"><i class="fa fa-check"></i><b>7</b> Two-sample inference</a></li>
<li class="chapter" data-level="8" data-path="power-and-sample-size.html"><a href="power-and-sample-size.html"><i class="fa fa-check"></i><b>8</b> Power and sample size</a></li>
<li class="chapter" data-level="9" data-path="the-sign-test.html"><a href="the-sign-test.html"><i class="fa fa-check"></i><b>9</b> The sign test</a></li>
<li class="chapter" data-level="10" data-path="mood-median-test.html"><a href="mood-median-test.html"><i class="fa fa-check"></i><b>10</b> Mood median test</a></li>
<li class="chapter" data-level="11" data-path="matched-pairs-t-and-sign-test.html"><a href="matched-pairs-t-and-sign-test.html"><i class="fa fa-check"></i><b>11</b> Matched pairs t and sign test</a></li>
<li class="chapter" data-level="12" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html"><i class="fa fa-check"></i><b>12</b> Normal quantile plots</a><ul>
<li class="chapter" data-level="12.1" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers"><i class="fa fa-check"></i><b>12.1</b> Lengths of heliconia flowers</a></li>
<li class="chapter" data-level="12.2" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#ferritin-and-normality"><i class="fa fa-check"></i><b>12.2</b> Ferritin and normality</a></li>
<li class="chapter" data-level="12.3" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers-1"><i class="fa fa-check"></i><b>12.3</b> Lengths of heliconia flowers</a></li>
<li class="chapter" data-level="12.4" data-path="normal-quantile-plots.html"><a href="normal-quantile-plots.html#ferritin-and-normality-1"><i class="fa fa-check"></i><b>12.4</b> Ferritin and normality</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="analysis-of-variance.html"><a href="analysis-of-variance.html"><i class="fa fa-check"></i><b>13</b> Analysis of variance</a></li>
<li class="chapter" data-level="14" data-path="writing-reports.html"><a href="writing-reports.html"><i class="fa fa-check"></i><b>14</b> Writing reports</a></li>
<li class="chapter" data-level="15" data-path="learning-to-code.html"><a href="learning-to-code.html"><i class="fa fa-check"></i><b>15</b> Learning to code</a><ul>
<li class="chapter" data-level="15.1" data-path="learning-to-code.html"><a href="learning-to-code.html#introduction-1"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="learning-to-code.html"><a href="learning-to-code.html#data-and-pre-processing"><i class="fa fa-check"></i><b>15.2</b> Data and pre-processing</a></li>
<li class="chapter" data-level="15.3" data-path="learning-to-code.html"><a href="learning-to-code.html#analysis"><i class="fa fa-check"></i><b>15.3</b> Analysis</a></li>
<li class="chapter" data-level="15.4" data-path="learning-to-code.html"><a href="learning-to-code.html#conclusions-see-note-9"><i class="fa fa-check"></i><b>15.4</b> Conclusions (see note 9)</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="treating-dandruff.html"><a href="treating-dandruff.html"><i class="fa fa-check"></i><b>16</b> Treating dandruff</a><ul>
<li class="chapter" data-level="16.1" data-path="treating-dandruff.html"><a href="treating-dandruff.html#introduction-2"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="treating-dandruff.html"><a href="treating-dandruff.html#exploratory-analysis"><i class="fa fa-check"></i><b>16.2</b> Exploratory analysis</a></li>
<li class="chapter" data-level="16.3" data-path="treating-dandruff.html"><a href="treating-dandruff.html#analysis-of-variance-1"><i class="fa fa-check"></i><b>16.3</b> Analysis of Variance</a></li>
<li class="chapter" data-level="16.4" data-path="treating-dandruff.html"><a href="treating-dandruff.html#assessment-of-assumptions"><i class="fa fa-check"></i><b>16.4</b> Assessment of Assumptions</a></li>
<li class="chapter" data-level="16.5" data-path="treating-dandruff.html"><a href="treating-dandruff.html#conclusions"><i class="fa fa-check"></i><b>16.5</b> Conclusions</a></li>
<li class="chapter" data-level="16.6" data-path="treating-dandruff.html"><a href="treating-dandruff.html#end"><i class="fa fa-check"></i><b>16.6</b> End</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="tidying-data.html"><a href="tidying-data.html"><i class="fa fa-check"></i><b>17</b> Tidying data</a></li>
<li class="chapter" data-level="18" data-path="simple-regression.html"><a href="simple-regression.html"><i class="fa fa-check"></i><b>18</b> Simple regression</a></li>
<li class="chapter" data-level="19" data-path="multiple-regression.html"><a href="multiple-regression.html"><i class="fa fa-check"></i><b>19</b> Multiple regression</a></li>
<li class="chapter" data-level="20" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html"><i class="fa fa-check"></i><b>20</b> Regression with categorical variables</a><ul>
<li class="chapter" data-level="20.1" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#crickets-revisited"><i class="fa fa-check"></i><b>20.1</b> Crickets revisited</a></li>
<li class="chapter" data-level="20.2" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#pulse-rates-and-marching"><i class="fa fa-check"></i><b>20.2</b> Pulse rates and marching</a></li>
<li class="chapter" data-level="20.3" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#crickets-revisited-1"><i class="fa fa-check"></i><b>20.3</b> Crickets revisited</a></li>
<li class="chapter" data-level="20.4" data-path="regression-with-categorical-variables.html"><a href="regression-with-categorical-variables.html#pulse-rates-and-marching-1"><i class="fa fa-check"></i><b>20.4</b> Pulse rates and marching</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>21</b> Dates and times</a></li>
<li class="chapter" data-level="22" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>22</b> Functions</a></li>
<li class="chapter" data-level="23" data-path="vector-and-matrix-algebra.html"><a href="vector-and-matrix-algebra.html"><i class="fa fa-check"></i><b>23</b> Vector and matrix algebra</a><ul>
<li class="chapter" data-level="23.1" data-path="vector-and-matrix-algebra.html"><a href="vector-and-matrix-algebra.html#heights-and-foot-lengths-again"><i class="fa fa-check"></i><b>23.1</b> Heights and foot lengths again</a></li>
<li class="chapter" data-level="23.2" data-path="vector-and-matrix-algebra.html"><a href="vector-and-matrix-algebra.html#heights-and-foot-lengths-again-1"><i class="fa fa-check"></i><b>23.2</b> Heights and foot lengths again</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="the-bootstrap.html"><a href="the-bootstrap.html"><i class="fa fa-check"></i><b>24</b> The Bootstrap</a></li>
<li class="chapter" data-level="25" data-path="bayesian-statistics-with-stan.html"><a href="bayesian-statistics-with-stan.html"><i class="fa fa-check"></i><b>25</b> Bayesian Statistics with Stan</a></li>
<li class="chapter" data-level="26" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>26</b> Logistic regression</a></li>
<li class="chapter" data-level="27" data-path="logistic-regression-with-ordinal-response.html"><a href="logistic-regression-with-ordinal-response.html"><i class="fa fa-check"></i><b>27</b> Logistic regression with ordinal response</a></li>
<li class="chapter" data-level="28" data-path="logistic-regression-with-nominal-response.html"><a href="logistic-regression-with-nominal-response.html"><i class="fa fa-check"></i><b>28</b> Logistic regression with nominal response</a></li>
<li class="chapter" data-level="29" data-path="survival-analysis.html"><a href="survival-analysis.html"><i class="fa fa-check"></i><b>29</b> Survival analysis</a></li>
<li class="chapter" data-level="30" data-path="analysis-of-variance-revisited.html"><a href="analysis-of-variance-revisited.html"><i class="fa fa-check"></i><b>30</b> Analysis of variance revisited</a></li>
<li class="chapter" data-level="31" data-path="analysis-of-covariance.html"><a href="analysis-of-covariance.html"><i class="fa fa-check"></i><b>31</b> Analysis of covariance</a></li>
<li class="chapter" data-level="32" data-path="multivariate-analysis-of-variance.html"><a href="multivariate-analysis-of-variance.html"><i class="fa fa-check"></i><b>32</b> Multivariate analysis of variance</a></li>
<li class="chapter" data-level="33" data-path="repeated-measures.html"><a href="repeated-measures.html"><i class="fa fa-check"></i><b>33</b> Repeated measures</a></li>
<li class="chapter" data-level="34" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html"><i class="fa fa-check"></i><b>34</b> Discriminant analysis</a></li>
<li class="chapter" data-level="35" data-path="hierarchical-cluster-analysis.html"><a href="hierarchical-cluster-analysis.html"><i class="fa fa-check"></i><b>35</b> Hierarchical cluster analysis</a></li>
<li class="chapter" data-level="36" data-path="k-means-cluster-analysis.html"><a href="k-means-cluster-analysis.html"><i class="fa fa-check"></i><b>36</b> K-means cluster analysis</a></li>
<li class="chapter" data-level="37" data-path="drawing-maps-with-leaflet.html"><a href="drawing-maps-with-leaflet.html"><i class="fa fa-check"></i><b>37</b> Drawing maps with Leaflet</a><ul>
<li class="chapter" data-level="37.1" data-path="drawing-maps-with-leaflet.html"><a href="drawing-maps-with-leaflet.html#the-brain-of-a-cat-revisited"><i class="fa fa-check"></i><b>37.1</b> The brain of a cat, revisited</a></li>
<li class="chapter" data-level="37.2" data-path="drawing-maps-with-leaflet.html"><a href="drawing-maps-with-leaflet.html#making-a-map-of-wisconsin"><i class="fa fa-check"></i><b>37.2</b> Making a map of Wisconsin</a></li>
<li class="chapter" data-level="37.3" data-path="drawing-maps-with-leaflet.html"><a href="drawing-maps-with-leaflet.html#the-cross-city-line"><i class="fa fa-check"></i><b>37.3</b> The Cross-City Line</a></li>
<li class="chapter" data-level="37.4" data-path="drawing-maps-with-leaflet.html"><a href="drawing-maps-with-leaflet.html#the-brain-of-a-cat-revisited-1"><i class="fa fa-check"></i><b>37.4</b> The brain of a cat, revisited</a></li>
<li class="chapter" data-level="37.5" data-path="drawing-maps-with-leaflet.html"><a href="drawing-maps-with-leaflet.html#making-a-map-of-wisconsin-1"><i class="fa fa-check"></i><b>37.5</b> Making a map of Wisconsin</a></li>
<li class="chapter" data-level="37.6" data-path="drawing-maps-with-leaflet.html"><a href="drawing-maps-with-leaflet.html#the-cross-city-line-1"><i class="fa fa-check"></i><b>37.6</b> The Cross-City Line</a></li>
</ul></li>
<li class="chapter" data-level="38" data-path="multidimensional-scaling.html"><a href="multidimensional-scaling.html"><i class="fa fa-check"></i><b>38</b> Multidimensional Scaling</a></li>
<li class="chapter" data-level="39" data-path="principal-components.html"><a href="principal-components.html"><i class="fa fa-check"></i><b>39</b> Principal Components</a><ul>
<li class="chapter" data-level="39.1" data-path="principal-components.html"><a href="principal-components.html#the-weather-somewhere"><i class="fa fa-check"></i><b>39.1</b> The weather, somewhere</a></li>
<li class="chapter" data-level="39.2" data-path="principal-components.html"><a href="principal-components.html#the-weather-somewhere-1"><i class="fa fa-check"></i><b>39.2</b> The weather, somewhere</a></li>
</ul></li>
<li class="chapter" data-level="40" data-path="factor-analysis.html"><a href="factor-analysis.html"><i class="fa fa-check"></i><b>40</b> Factor Analysis</a></li>
<li class="chapter" data-level="41" data-path="frequency-table-analysis.html"><a href="frequency-table-analysis.html"><i class="fa fa-check"></i><b>41</b> Frequency table analysis</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Problems and Solutions in Applied Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="drawing-maps-with-leaflet" class="section level1">
<h1><span class="header-section-number">Chapter 37</span> Drawing maps with Leaflet</h1>
<p>Packages for this chapter:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" title="1"><span class="kw">library</span>(ggbiplot)</a>
<a class="sourceLine" id="cb250-2" title="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb250-3" title="3"><span class="kw">library</span>(ggrepel)</a></code></pre></div>
<div id="the-brain-of-a-cat-revisited" class="section level2">
<h2><span class="header-section-number">37.1</span> The brain of a cat, revisited</h2>
<p>Earlier, we looked at an ethics study that had to do with a fictional brain of a fictional cat. I said
there was actually a <em>town</em> called Catbrain. It’s in England,
near Bristol, and seems to be home to a street of car dealerships.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Find the latitude and longitude of “Catbrain UK” (though I don’t think there are any others).</p></li>
<li><p>Draw a map of Catbrain using Leaflet.</p></li>
<li><p>Make a dataframe containing some other British cities as well as Catbrain, and find their latitudes and longitudes.</p></li>
<li><p>Draw a map containing the places you picked.</p></li>
</ol>
</div>
<div id="making-a-map-of-wisconsin" class="section level2">
<h2><span class="header-section-number">37.2</span> Making a map of Wisconsin</h2>
<p>The file
<a href="http://ritsokiguess.site/datafiles/wisconsin.txt">link</a> contains
the road distances (in miles) between 12 cities in Wisconsin and
neighbouring states. We are going to try to draw a map of the
area using Leaflet.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read in the data, displaying
the data that you read in.</p></li>
<li><p>Make a dataframe containing the names of the locations (get rid of the columns containing distances), and add a column of the abbreviations of the states they are in. All of them are in Wisconsin (WI), except for the
last three: Dubuque is in Iowa (IA), St. Paul is in Minnesota (MN) and Chicago
is in Illinois (IL).</p></li>
<li><p>Create a new column in which the abbreviation for the state is glued on to the end of each <code>location</code>, separated by a space.</p></li>
<li><p>Look up the latitudes and longitudes of these twelve places.</p></li>
<li><p>Obtain a Leaflet map of the area containing these
twelve cities.</p></li>
</ol>
</div>
<div id="the-cross-city-line" class="section level2">
<h2><span class="header-section-number">37.3</span> The Cross-City Line</h2>
<p>When I went to university (in Birmingham, England, a long time ago), I was very excited because I would be travelling to campus by train. My journey was on the Cross-City Line, a metro-type service with lots of stops short distances apart, but run in those days by diesel trains (the electrification came later).</p>
<p>A list of the stations on the line is in <a href="http://ritsokiguess.site/datafiles/cross-city.csv" class="uri">http://ritsokiguess.site/datafiles/cross-city.csv</a>. There is one column in the data file, called <code>station</code>. We are going to draw a map of these.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read in and display (some of) the station names.</p></li>
<li><p>In preparation for geocoding, create a second column in the dataframe that consists of the station names with “station UK” on the end. (This is to improve the chances of the geocoder finding the actual railway station.)</p></li>
<li><p>Look up the longitudes and latitudes of all the stations, organizing your dataframe so that they are visible.</p></li>
<li><p>Make a Leaflet map of the stations. Use circle markers or the “pin” markers as you prefer.</p></li>
<li><p>Zoom in to see whether the geocoding did indeed find each of the stations. Comment briefly on what you find.</p></li>
</ol>
<p>My solutions follow:</p>
</div>
<div id="the-brain-of-a-cat-revisited-1" class="section level2">
<h2><span class="header-section-number">37.4</span> The brain of a cat, revisited</h2>
<p>Earlier, we looked at an ethics study that had to do with a fictional brain of a fictional cat. I said
there was actually a <em>town</em> called Catbrain. It’s in England,
near Bristol, and seems to be home to a street of car dealerships.</p>
<ol style="list-style-type: lower-alpha">
<li>Find the latitude and longitude of “Catbrain UK” (though I don’t think there are any others).</li>
</ol>
<p>Solution</p>
<p>Make sure you have these two packages loaded:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" title="1"><span class="kw">library</span>(leaflet)</a>
<a class="sourceLine" id="cb251-2" title="2"><span class="kw">library</span>(tmaptools)</a></code></pre></div>
<p>To find the latitude and longitude of Catbrain:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb252-1" title="1">catbrain &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">place =</span> <span class="st">&quot;Catbrain UK&quot;</span>)</a>
<a class="sourceLine" id="cb252-2" title="2">catbrain <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">ll =</span> <span class="kw">list</span>(<span class="kw">geocode_OSM</span>(place))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb252-3" title="3"><span class="st">  </span><span class="kw">unnest_wider</span>(ll) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb252-4" title="4"><span class="st">  </span><span class="kw">unnest_wider</span>(coords) -&gt;<span class="st"> </span>catbrain</a></code></pre></div>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" title="1">catbrain</a></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   place       query           x     y bbox      
##   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    
## 1 Catbrain UK Catbrain UK -2.61  51.5 &lt;bbox [4]&gt;</code></pre>
<p>Remember that the output from <code>geocode_OSM</code> is a list, and it has in it a thing called <code>coords</code> that is the longitude and latitude together, and another thing called <code>bbox</code> that we don’t use. So we have to <code>unnest</code> <em>twice</em> to get the longitude (as <code>x</code>) and the latitude (as <code>y</code>) out for drawing in a moment.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Draw a map of Catbrain using Leaflet.</li>
</ol>
<p>Solution</p>
<p>That goes this way:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" title="1"><span class="kw">leaflet</span>(<span class="dt">data =</span> catbrain) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-2" title="2"><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-3" title="3"><span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> <span class="op">~</span>x, <span class="dt">lat =</span> <span class="op">~</span>y) -&gt;<span class="st"> </span>catbrain_map</a>
<a class="sourceLine" id="cb255-4" title="4">catbrain_map</a></code></pre></div>
<div id="htmlwidget-20f8758f092cd19316e7" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-20f8758f092cd19316e7">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[51.5228823,-2.6124662,10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[51.5228823,51.5228823],"lng":[-2.6124662,-2.6124662]}},"evals":[],"jsHooks":[]}</script>
<p>There are car dealerships are along Lysander Road. Zoom in
to see them. Or zoom out to see where this is. You can keep zooming out until you know where you are, using the plus and minus buttons, or your mouse wheel.</p>
<p>The name Catbrain, according to
<a href="http://www.bristolpost.co.uk/news/history/name-catbrain-hill-came-825247">link</a>,
means “rough stony soil”, from Middle English, and has nothing to do
with cats or their brains at all.</p>
<p>Extra: I was actually surprised that this worked at all, because with only one point, how does it know what scale to draw the map? Also, unless your UK geography is really good, you won’t have any clue about exactly where this is. That’s the reason for the next part.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Make a dataframe containing some other British cities as well as Catbrain, and find their latitudes and longitudes.</li>
</ol>
<p>Solution</p>
<p>I chose the cities below, mostly somewhere near Catbrain. You could fire up a Google map, zoom it out until it contains something you know, and pick some places you’ve heard of. (I happen to know British geography pretty well, so I just picked some mostly nearby places out of my head. I didn’t really want to pick London, but I figured this was the one <em>you</em> might know.)</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" title="1">catbrain2 &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb256-2" title="2">  <span class="op">~</span>where,</a>
<a class="sourceLine" id="cb256-3" title="3">  <span class="st">&quot;Catbrain UK&quot;</span>,</a>
<a class="sourceLine" id="cb256-4" title="4">  <span class="st">&quot;Bristol UK&quot;</span>,</a>
<a class="sourceLine" id="cb256-5" title="5">  <span class="st">&quot;Taunton UK&quot;</span>,</a>
<a class="sourceLine" id="cb256-6" title="6">  <span class="st">&quot;Newport UK&quot;</span>,</a>
<a class="sourceLine" id="cb256-7" title="7">  <span class="st">&quot;Gloucester UK&quot;</span>,</a>
<a class="sourceLine" id="cb256-8" title="8">  <span class="st">&quot;Cardiff UK&quot;</span>,</a>
<a class="sourceLine" id="cb256-9" title="9">  <span class="st">&quot;Birmingham UK&quot;</span>,</a>
<a class="sourceLine" id="cb256-10" title="10">  <span class="st">&quot;London UK&quot;</span>,</a>
<a class="sourceLine" id="cb256-11" title="11">  <span class="st">&quot;Caldicot UK&quot;</span></a>
<a class="sourceLine" id="cb256-12" title="12">)</a>
<a class="sourceLine" id="cb256-13" title="13">catbrain2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb256-14" title="14"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb256-15" title="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ll =</span> <span class="kw">list</span>(<span class="kw">geocode_OSM</span>(where))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb256-16" title="16"><span class="st">  </span><span class="kw">unnest_wider</span>(ll) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb256-17" title="17"><span class="st">  </span><span class="kw">unnest_wider</span>(coords) -&gt;<span class="st"> </span>catbrain2</a></code></pre></div>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" title="1">catbrain2</a></code></pre></div>
<pre><code>## # A tibble: 9 x 5
##   where         query              x     y bbox      
##   &lt;chr&gt;         &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    
## 1 Catbrain UK   Catbrain UK   -2.61   51.5 &lt;bbox [4]&gt;
## 2 Bristol UK    Bristol UK    -2.60   51.5 &lt;bbox [4]&gt;
## 3 Taunton UK    Taunton UK    -3.10   51.0 &lt;bbox [4]&gt;
## 4 Newport UK    Newport UK    -3.00   51.6 &lt;bbox [4]&gt;
## 5 Gloucester UK Gloucester UK -2.25   51.9 &lt;bbox [4]&gt;
## 6 Cardiff UK    Cardiff UK    -3.18   51.5 &lt;bbox [4]&gt;
## 7 Birmingham UK Birmingham UK -1.90   52.5 &lt;bbox [4]&gt;
## 8 London UK     London UK     -0.128  51.5 &lt;bbox [4]&gt;
## 9 Caldicot UK   Caldicot UK   -2.75   51.6 &lt;bbox [4]&gt;</code></pre>
<p>The first time I did this, I forgot the <code>rowwise</code>, which we didn’t need the first time (there was only one place), but here, it causes odd problems if you omit it.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Draw a map containing the places you picked.</li>
</ol>
<p>Solution</p>
<p>The map-drawing is almost the same, just changing the dataframe:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" title="1"><span class="kw">leaflet</span>(<span class="dt">data =</span> catbrain2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb259-2" title="2"><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb259-3" title="3"><span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> <span class="op">~</span>x, <span class="dt">lat =</span> <span class="op">~</span>y)</a></code></pre></div>
<div id="htmlwidget-14a601dd3dd8ae3d13db" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-14a601dd3dd8ae3d13db">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[51.5228823,51.4538022,51.0147895,51.5882332,51.8653705,51.4816546,52.4796992,51.5073219,51.5912466],[-2.6124662,-2.5972985,-3.1029086,-2.9974967,-2.2458192,-3.1791934,-1.9026911,-0.1276474,-2.7517629],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[51.0147895,52.4796992],"lng":[-3.1791934,-0.1276474]}},"evals":[],"jsHooks":[]}</script>
<p>Now, if you have any sense of the geography of the UK, you know where
you are. The big river (the Severn) is
the border between England and Wales, so
the places above and to the left of it are in Wales, including
Caldicot (see question about Roman pottery).</p>
<p>You can zoom this map <em>in</em> (once you have figured out which of the circles is Catbrain) and find Lysander Road again, and also the M5 (see below).</p>
<p>More irrelevant extra: the M5 is one of the English “motorways” (like 400-series highways
or US Interstates). The M5 goes from Birmingham to Exeter. You can
tell that this is England because of the huge number of traffic
circles, known there as “roundabouts”. One of the first things they
teach you in British driving schools is how to handle roundabouts:
which lane to approach them in, which (stick-shift) gear to be in, and
when you’re supposed to signal where you’re going. I hope I still
remember all that for when I next drive in England!</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="making-a-map-of-wisconsin-1" class="section level2">
<h2><span class="header-section-number">37.5</span> Making a map of Wisconsin</h2>
<p>The file
<a href="http://ritsokiguess.site/datafiles/wisconsin.txt">link</a> contains
the road distances (in miles) between 12 cities in Wisconsin and
neighbouring states. We are going to try to draw a map of the
area using Leaflet.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data, displaying
the data that you read in.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" title="1">my_url &lt;-<span class="st"> &quot;http://ritsokiguess.site/datafiles/wisconsin.txt&quot;</span></a>
<a class="sourceLine" id="cb260-2" title="2">wisc &lt;-<span class="st"> </span><span class="kw">read_table</span>(my_url)</a></code></pre></div>
<pre><code>## 
## ── Column specification ────────────────────────────────────────────────────────
## cols(
##   location = col_character(),
##   Appleton = col_double(),
##   Beloit = col_double(),
##   Fort.Atkinson = col_double(),
##   Madison = col_double(),
##   Marshfield = col_double(),
##   Milwaukee = col_double(),
##   Monroe = col_double(),
##   Superior = col_double(),
##   Wausau = col_double(),
##   Dubuque = col_double(),
##   St.Paul = col_double(),
##   Chicago = col_double()
## )</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" title="1">wisc</a></code></pre></div>
<pre><code>## # A tibble: 12 x 13
##    location      Appleton Beloit Fort.Atkinson Madison Marshfield Milwaukee Monroe Superior Wausau Dubuque St.Paul Chicago
##    &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 Appleton             0    130            98     102        103       100    149      315     91     196     257     186
##  2 Beloit             130      0            33      50        185        73     33      377    186      94     304      97
##  3 Fort.Atkinson       98     33             0      36        164        54     58      359    166     119     287     113
##  4 Madison            102     50            36       0        138        77     47      330    139      95     258     146
##  5 Marshfield         103    185           164     138          0       184    170      219     45     186     161     276
##  6 Milwaukee          100     73            54      77        184         0    107      394    181     168     322      92
##  7 Monroe             149     33            58      47        170       107      0      362    186      61     289     130
##  8 Superior           315    377           359     330        219       394    362        0    223     351     162     467
##  9 Wausau              91    186           166     139         45       181    186      223      0     215     175     275
## 10 Dubuque            196     94           119      95        186       168     61      351    215       0     274     184
## 11 St.Paul            257    304           287     258        161       322    289      162    175     274       0     395
## 12 Chicago            186     97           113     146        276        93    130      467    275     184     395       0</code></pre>
<p>The first time I did this, I had a blank line on the end of the data
file, so I had a blank <code>location</code> and missing values for all
the distances for it. I tidied that up before sharing the file with
you, though.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Make a dataframe containing the names of the locations (get rid of the columns containing distances), and add a column of the abbreviations of the states they are in. All of them are in Wisconsin (WI), except for the
last three: Dubuque is in Iowa (IA), St. Paul is in Minnesota (MN) and Chicago
is in Illinois (IL).</li>
</ol>
<p>Solution</p>
<p>There seems to be a bit of base R attached to this, however you do it. I am going to create a dataframe pretending they are all in Wisconsin, and then fix it up afterwards:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" title="1">wisc <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb264-2" title="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">!</span><span class="kw">where</span>(is.numeric)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb264-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="st">&quot;WI&quot;</span>) -&gt;<span class="st"> </span>wisc</a>
<a class="sourceLine" id="cb264-4" title="4">wisc</a></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    location      state
##    &lt;chr&gt;         &lt;chr&gt;
##  1 Appleton      WI   
##  2 Beloit        WI   
##  3 Fort.Atkinson WI   
##  4 Madison       WI   
##  5 Marshfield    WI   
##  6 Milwaukee     WI   
##  7 Monroe        WI   
##  8 Superior      WI   
##  9 Wausau        WI   
## 10 Dubuque       WI   
## 11 St.Paul       WI   
## 12 Chicago       WI</code></pre>
<p>(I checked that in this question I didn’t need the road distances for anything, so I saved it back into the original dataframe. Also, the <code>select</code> is unnecessarily fancy: I could have just selected the <code>location</code> column, but this one says “don’t select any of the columns that are numeric”.)</p>
<p>Now we have to fix up the states of the last three places, which is where the base R seems to come in (but see the Extra):</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" title="1">wisc<span class="op">$</span>state[<span class="dv">10</span>] &lt;-<span class="st"> &quot;IA&quot;</span></a>
<a class="sourceLine" id="cb266-2" title="2">wisc<span class="op">$</span>state[<span class="dv">11</span>] &lt;-<span class="st"> &quot;MN&quot;</span></a>
<a class="sourceLine" id="cb266-3" title="3">wisc<span class="op">$</span>state[<span class="dv">12</span>] &lt;-<span class="st"> &quot;IL&quot;</span></a>
<a class="sourceLine" id="cb266-4" title="4">wisc</a></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    location      state
##    &lt;chr&gt;         &lt;chr&gt;
##  1 Appleton      WI   
##  2 Beloit        WI   
##  3 Fort.Atkinson WI   
##  4 Madison       WI   
##  5 Marshfield    WI   
##  6 Milwaukee     WI   
##  7 Monroe        WI   
##  8 Superior      WI   
##  9 Wausau        WI   
## 10 Dubuque       IA   
## 11 St.Paul       MN   
## 12 Chicago       IL</code></pre>
<p>The states of the last three locations are now correct.</p>
<p>Extra: I didn’t know about the following until literally just now, but there is a <code>tidyverse</code> way to do this as well (that may look familiar to those of you that know about SQL). Let’s start by pretending again that everything is in Wisconsin:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" title="1">wisc <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb268-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="st">&quot;WI&quot;</span>) -&gt;<span class="st"> </span>wisc2</a>
<a class="sourceLine" id="cb268-3" title="3">wisc2</a></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    location      state
##    &lt;chr&gt;         &lt;chr&gt;
##  1 Appleton      WI   
##  2 Beloit        WI   
##  3 Fort.Atkinson WI   
##  4 Madison       WI   
##  5 Marshfield    WI   
##  6 Milwaukee     WI   
##  7 Monroe        WI   
##  8 Superior      WI   
##  9 Wausau        WI   
## 10 Dubuque       WI   
## 11 St.Paul       WI   
## 12 Chicago       WI</code></pre>
<p>and then change the ones that need changing. What you do is to make a little dataframe of the ones that need changing:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" title="1">changes &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb270-2" title="2">  <span class="op">~</span>location, <span class="op">~</span>state,</a>
<a class="sourceLine" id="cb270-3" title="3">  <span class="st">&quot;Dubuque&quot;</span>, <span class="st">&quot;IA&quot;</span>,</a>
<a class="sourceLine" id="cb270-4" title="4">  <span class="st">&quot;St.Paul&quot;</span>, <span class="st">&quot;MN&quot;</span>,</a>
<a class="sourceLine" id="cb270-5" title="5">  <span class="st">&quot;Chicago&quot;</span>, <span class="st">&quot;IL&quot;</span></a>
<a class="sourceLine" id="cb270-6" title="6">)</a>
<a class="sourceLine" id="cb270-7" title="7">changes</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   location state
##   &lt;chr&gt;    &lt;chr&gt;
## 1 Dubuque  IA   
## 2 St.Paul  MN   
## 3 Chicago  IL</code></pre>
<p>Note that the columns in here have <em>exactly</em> the same names as the ones in the original dataframe where everything was in Wisconsin.</p>
<p>I did this by copy-pasting the city names whose states needed changing out of the display of my <code>wisc2</code>. You might think that a left join is what we need now, and it almost is. Note that I want to match the locations but <em>not</em> the states:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" title="1">wisc2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(changes, <span class="dt">by =</span> <span class="st">&quot;location&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    location      state.x state.y
##    &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;  
##  1 Appleton      WI      &lt;NA&gt;   
##  2 Beloit        WI      &lt;NA&gt;   
##  3 Fort.Atkinson WI      &lt;NA&gt;   
##  4 Madison       WI      &lt;NA&gt;   
##  5 Marshfield    WI      &lt;NA&gt;   
##  6 Milwaukee     WI      &lt;NA&gt;   
##  7 Monroe        WI      &lt;NA&gt;   
##  8 Superior      WI      &lt;NA&gt;   
##  9 Wausau        WI      &lt;NA&gt;   
## 10 Dubuque       WI      IA     
## 11 St.Paul       WI      MN     
## 12 Chicago       WI      IL</code></pre>
<p>and the story here is that if <code>state.y</code> has a value, use that, otherwise use the value in <code>state.x</code>. This can even be done: there is a function <code>coalesce</code><a href="#fn36" class="footnote-ref" id="fnref36"><sup>36</sup></a> that will do exactly that:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" title="1">wisc2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(changes, <span class="dt">by =</span> <span class="st">&quot;location&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb274-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state=</span><span class="kw">coalesce</span>(state.y, state.x))</a></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    location      state.x state.y state
##    &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;
##  1 Appleton      WI      &lt;NA&gt;    WI   
##  2 Beloit        WI      &lt;NA&gt;    WI   
##  3 Fort.Atkinson WI      &lt;NA&gt;    WI   
##  4 Madison       WI      &lt;NA&gt;    WI   
##  5 Marshfield    WI      &lt;NA&gt;    WI   
##  6 Milwaukee     WI      &lt;NA&gt;    WI   
##  7 Monroe        WI      &lt;NA&gt;    WI   
##  8 Superior      WI      &lt;NA&gt;    WI   
##  9 Wausau        WI      &lt;NA&gt;    WI   
## 10 Dubuque       WI      IA      IA   
## 11 St.Paul       WI      MN      MN   
## 12 Chicago       WI      IL      IL</code></pre>
<p>The idea behind <code>coalesce</code> is that you give it a list of columns, and the first one of those that is <em>not missing</em> gives its value to the new column. So I feed it <code>state.y</code> <em>first</em>, and then <code>state.x</code>, and the new <code>state</code> contains the right things. (Can you explain what happens if you do it the other way around?)</p>
<p>But, there is a better way. Let’s go back to our all-Wisconsin dataframe:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb276-1" title="1">wisc2</a></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    location      state
##    &lt;chr&gt;         &lt;chr&gt;
##  1 Appleton      WI   
##  2 Beloit        WI   
##  3 Fort.Atkinson WI   
##  4 Madison       WI   
##  5 Marshfield    WI   
##  6 Milwaukee     WI   
##  7 Monroe        WI   
##  8 Superior      WI   
##  9 Wausau        WI   
## 10 Dubuque       WI   
## 11 St.Paul       WI   
## 12 Chicago       WI</code></pre>
<p>and our dataframe of corrections to make:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb278-1" title="1">changes</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   location state
##   &lt;chr&gt;    &lt;chr&gt;
## 1 Dubuque  IA   
## 2 St.Paul  MN   
## 3 Chicago  IL</code></pre>
<p>We can make those changes in one step, thus:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb280-1" title="1">wisc2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb280-2" title="2"><span class="st">  </span><span class="kw">rows_update</span>(changes) -&gt;<span class="st"> </span>wisc</a></code></pre></div>
<pre><code>## Matching, by = &quot;location&quot;</code></pre>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" title="1">wisc</a></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    location      state
##    &lt;chr&gt;         &lt;chr&gt;
##  1 Appleton      WI   
##  2 Beloit        WI   
##  3 Fort.Atkinson WI   
##  4 Madison       WI   
##  5 Marshfield    WI   
##  6 Milwaukee     WI   
##  7 Monroe        WI   
##  8 Superior      WI   
##  9 Wausau        WI   
## 10 Dubuque       IA   
## 11 St.Paul       MN   
## 12 Chicago       IL</code></pre>
<p>This works because the <em>first</em> column of <code>changes</code>, namely <code>location</code>, is the one that is looked up in <code>wisc2</code>. (<code>rows_update</code> has a <code>by</code> in the same way that <code>left_join</code> does if you want to change this.) So all three locations in <code>changes</code> are looked up in <code>wisc2</code>, and any that match have their <code>state</code> changed to the one in <code>changes</code>.</p>
<p>In database terms, the <code>location</code> is known as a “key” column. That means that each city appears <em>once only</em> in the column, and so the replacements in <code>wisc</code> are only happening once. To a statistician, <code>location</code> is an “identifier variable”, identifying the individuals in the dataset. Unless you are doing something like repeated measures, each individual will only give you one measurement, but even then, if you have wide format, the identifier variables will still only appear once.</p>
<p>Magic. Now that I have learned about this, I will be using it a lot.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Create a new column in which the abbreviation for the state is glued on to the end of each <code>location</code>, separated by a space.</li>
</ol>
<p>Solution</p>
<p>A couple of ways: a literal gluing, using <code>paste</code>:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" title="1">wisc <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb284-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lookup =</span> <span class="kw">paste</span>(location, state))</a></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    location      state lookup          
##    &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;           
##  1 Appleton      WI    Appleton WI     
##  2 Beloit        WI    Beloit WI       
##  3 Fort.Atkinson WI    Fort.Atkinson WI
##  4 Madison       WI    Madison WI      
##  5 Marshfield    WI    Marshfield WI   
##  6 Milwaukee     WI    Milwaukee WI    
##  7 Monroe        WI    Monroe WI       
##  8 Superior      WI    Superior WI     
##  9 Wausau        WI    Wausau WI       
## 10 Dubuque       IA    Dubuque IA      
## 11 St.Paul       MN    St.Paul MN      
## 12 Chicago       IL    Chicago IL</code></pre>
<p>or the same idea using <code>str_c</code> from <code>stringr</code> (part of the tidyverse), only this time you have to supply the space yourself:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb286-1" title="1">wisc <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb286-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lookup =</span> <span class="kw">str_c</span>(location, <span class="st">&quot; &quot;</span>, state))</a></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    location      state lookup          
##    &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;           
##  1 Appleton      WI    Appleton WI     
##  2 Beloit        WI    Beloit WI       
##  3 Fort.Atkinson WI    Fort.Atkinson WI
##  4 Madison       WI    Madison WI      
##  5 Marshfield    WI    Marshfield WI   
##  6 Milwaukee     WI    Milwaukee WI    
##  7 Monroe        WI    Monroe WI       
##  8 Superior      WI    Superior WI     
##  9 Wausau        WI    Wausau WI       
## 10 Dubuque       IA    Dubuque IA      
## 11 St.Paul       MN    St.Paul MN      
## 12 Chicago       IL    Chicago IL</code></pre>
<p>or a way you might have forgotten, using <code>unite</code> (which is the inverse of <code>separate</code>):</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" title="1">wisc <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb288-2" title="2"><span class="st">  </span><span class="kw">unite</span>(lookup, <span class="kw">c</span>(location, state), <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) -&gt;<span class="st"> </span>wisc</a>
<a class="sourceLine" id="cb288-3" title="3">wisc</a></code></pre></div>
<pre><code>## # A tibble: 12 x 1
##    lookup          
##    &lt;chr&gt;           
##  1 Appleton WI     
##  2 Beloit WI       
##  3 Fort.Atkinson WI
##  4 Madison WI      
##  5 Marshfield WI   
##  6 Milwaukee WI    
##  7 Monroe WI       
##  8 Superior WI     
##  9 Wausau WI       
## 10 Dubuque IA      
## 11 St.Paul MN      
## 12 Chicago IL</code></pre>
<p>This last one is my favourite, because it gets rid of the two constituent columns <code>location</code> and <code>state</code> that we don’t need any more. The syntax is the name of the new column, a vector of columns to unite together, and (optionally) what to separate the joined-together values with. The default for that is an underscore, but here we want a space because that’s what the geocoder (coming up) expects.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Look up the latitudes and longitudes of these twelve places.</li>
</ol>
<p>Solution</p>
<p>This is geocoding, with the disentangling afterwards that is (I hope) becoming familiar:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" title="1">wisc <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb290-2" title="2"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb290-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ll =</span> <span class="kw">list</span>(<span class="kw">geocode_OSM</span>(lookup))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb290-4" title="4"><span class="st">  </span><span class="kw">unnest_wider</span>(ll) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb290-5" title="5"><span class="st">  </span><span class="kw">unnest_wider</span>(coords) -&gt;<span class="st"> </span>wisc</a>
<a class="sourceLine" id="cb290-6" title="6">wisc</a></code></pre></div>
<pre><code>## # A tibble: 12 x 5
##    lookup           query                x     y bbox      
##    &lt;chr&gt;            &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    
##  1 Appleton WI      Appleton WI      -88.4  44.3 &lt;bbox [4]&gt;
##  2 Beloit WI        Beloit WI        -89.0  42.5 &lt;bbox [4]&gt;
##  3 Fort.Atkinson WI Fort.Atkinson WI -88.8  42.9 &lt;bbox [4]&gt;
##  4 Madison WI       Madison WI       -89.4  43.1 &lt;bbox [4]&gt;
##  5 Marshfield WI    Marshfield WI    -90.2  44.7 &lt;bbox [4]&gt;
##  6 Milwaukee WI     Milwaukee WI     -87.9  43.0 &lt;bbox [4]&gt;
##  7 Monroe WI        Monroe WI        -89.6  42.6 &lt;bbox [4]&gt;
##  8 Superior WI      Superior WI      -92.1  46.6 &lt;bbox [4]&gt;
##  9 Wausau WI        Wausau WI        -89.6  45.0 &lt;bbox [4]&gt;
## 10 Dubuque IA       Dubuque IA       -90.7  42.5 &lt;bbox [4]&gt;
## 11 St.Paul MN       St.Paul MN       -93.1  45.0 &lt;bbox [4]&gt;
## 12 Chicago IL       Chicago IL       -87.6  41.9 &lt;bbox [4]&gt;</code></pre>
<p>Yes, I forgot the <code>rowwise</code> as well the first time.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Obtain a Leaflet map of the area containing these
twelve cities.</li>
</ol>
<p>Solution</p>
<p>The usual:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb292-1" title="1"><span class="kw">leaflet</span>(<span class="dt">data =</span> wisc) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb292-2" title="2"><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb292-3" title="3"><span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> <span class="op">~</span>x, <span class="dt">lat =</span> <span class="op">~</span>y) -&gt;<span class="st"> </span>locs</a>
<a class="sourceLine" id="cb292-4" title="4">locs</a></code></pre></div>
<div id="htmlwidget-5fdf76225e626145dab2" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-5fdf76225e626145dab2">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[44.2611337,42.5083272,42.9288944,43.074761,44.6688524,43.0349931,42.6136586,46.623324,44.9596017,42.5006217,44.9504037,41.8755616],[-88.4067604,-89.031784,-88.8370509,-89.3837613,-90.1717987,-87.922497,-89.5852052208876,-92.117435,-89.6298239,-90.6647967,-93.1015026,-87.6244212],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[41.8755616,46.623324],"lng":[-93.1015026,-87.6244212]}},"evals":[],"jsHooks":[]}</script>
<p>The nice thing about this map is that you can play with it: zoom it (using the plus/minus on the map or your mouse wheel), or move it around by clicking and dragging. To identify the cities: well, the big ones are obvious, and you can zoom in to identify the others. (You have to zoom in quite a long way to find Monroe, and the geocoder seems to have found its airport, which is not actually in the city.)</p>
<p>I like identifying the cities with circles, but there are other possibilities, such as “icon markers” that look like Google map pins:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb293-1" title="1"><span class="kw">leaflet</span>(<span class="dt">data =</span> wisc) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb293-2" title="2"><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb293-3" title="3"><span class="st">  </span><span class="kw">addMarkers</span>(<span class="dt">lng =</span> <span class="op">~</span>x, <span class="dt">lat =</span> <span class="op">~</span>y) -&gt;<span class="st"> </span>locs</a>
<a class="sourceLine" id="cb293-4" title="4">locs</a></code></pre></div>
<div id="htmlwidget-40e73ce0d560c6225540" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-40e73ce0d560c6225540">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[[44.2611337,42.5083272,42.9288944,43.074761,44.6688524,43.0349931,42.6136586,46.623324,44.9596017,42.5006217,44.9504037,41.8755616],[-88.4067604,-89.031784,-88.8370509,-89.3837613,-90.1717987,-87.922497,-89.5852052208876,-92.117435,-89.6298239,-90.6647967,-93.1015026,-87.6244212],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[41.8755616,46.623324],"lng":[-93.1015026,-87.6244212]}},"evals":[],"jsHooks":[]}</script>
<p>You can even attach text to the markers that appears when you click on them, but that’s farther than I would go here.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="the-cross-city-line-1" class="section level2">
<h2><span class="header-section-number">37.6</span> The Cross-City Line</h2>
<p>When I went to university (in Birmingham, England, a long time ago), I was very excited because I would be travelling to campus by train. My journey was on the Cross-City Line, a metro-type service with lots of stops short distances apart, but run in those days by diesel trains (the electrification came later).</p>
<p>A list of the stations on the line is in <a href="http://ritsokiguess.site/datafiles/cross-city.csv" class="uri">http://ritsokiguess.site/datafiles/cross-city.csv</a>. There is one column in the data file, called <code>station</code>. We are going to draw a map of these.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in and display (some of) the station names.</li>
</ol>
<p>Solution</p>
<p>Nothing terribly unexpected here:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb294-1" title="1">stations &lt;-<span class="st"> </span><span class="kw">read_csv</span>(my_url)</a></code></pre></div>
<pre><code>## 
## ── Column specification ────────────────────────────────────────────────────────
## cols(
##   station = col_character()
## )</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb296-1" title="1">stations</a></code></pre></div>
<pre><code>## # A tibble: 24 x 1
##    station              
##    &lt;chr&gt;                
##  1 Redditch             
##  2 Alvechurch           
##  3 Barnt Green          
##  4 Longbridge           
##  5 Northfield           
##  6 King&#39;s Norton        
##  7 Bournville           
##  8 Selly Oak            
##  9 Birmingham University
## 10 Five Ways            
## # … with 14 more rows</code></pre>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>In preparation for geocoding, create a second column in the dataframe that consists of the station names with “station UK” on the end. (This is to improve the chances of the geocoder finding the actual railway station.)</li>
</ol>
<p>Solution</p>
<p>I wrote this back into the original dataframe. Create a new one if you prefer:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb298-1" title="1">stations <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb298-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">longname =</span> <span class="kw">str_c</span>(station, <span class="st">&quot; station UK&quot;</span>)) -&gt;<span class="st"> </span>stations</a>
<a class="sourceLine" id="cb298-3" title="3">stations</a></code></pre></div>
<pre><code>## # A tibble: 24 x 2
##    station               longname                        
##    &lt;chr&gt;                 &lt;chr&gt;                           
##  1 Redditch              Redditch station UK             
##  2 Alvechurch            Alvechurch station UK           
##  3 Barnt Green           Barnt Green station UK          
##  4 Longbridge            Longbridge station UK           
##  5 Northfield            Northfield station UK           
##  6 King&#39;s Norton         King&#39;s Norton station UK        
##  7 Bournville            Bournville station UK           
##  8 Selly Oak             Selly Oak station UK            
##  9 Birmingham University Birmingham University station UK
## 10 Five Ways             Five Ways station UK            
## # … with 14 more rows</code></pre>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Look up the longitudes and latitudes of all the stations, organizing your dataframe so that they are visible.</li>
</ol>
<p>Solution</p>
<p>Two steps: the first is to do the geocoding, and the second is to disentangle what comes back.</p>
<p>First, then:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb300-1" title="1">stations <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb300-2" title="2"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb300-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ll =</span> <span class="kw">list</span>(<span class="kw">geocode_OSM</span>(longname))) -&gt;<span class="st"> </span>stations</a>
<a class="sourceLine" id="cb300-4" title="4">stations</a></code></pre></div>
<pre><code>## # A tibble: 24 x 3
## # Rowwise: 
##    station               longname                         ll              
##    &lt;chr&gt;                 &lt;chr&gt;                            &lt;list&gt;          
##  1 Redditch              Redditch station UK              &lt;named list [3]&gt;
##  2 Alvechurch            Alvechurch station UK            &lt;named list [3]&gt;
##  3 Barnt Green           Barnt Green station UK           &lt;named list [3]&gt;
##  4 Longbridge            Longbridge station UK            &lt;named list [3]&gt;
##  5 Northfield            Northfield station UK            &lt;named list [3]&gt;
##  6 King&#39;s Norton         King&#39;s Norton station UK         &lt;named list [3]&gt;
##  7 Bournville            Bournville station UK            &lt;named list [3]&gt;
##  8 Selly Oak             Selly Oak station UK             &lt;named list [3]&gt;
##  9 Birmingham University Birmingham University station UK &lt;named list [3]&gt;
## 10 Five Ways             Five Ways station UK             &lt;named list [3]&gt;
## # … with 14 more rows</code></pre>
<p>The longitudes and latitudes are hidden in the list-column that I called <code>ll</code>, so the second step is to get them out:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb302-1" title="1">stations <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest_wider</span>(ll) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb302-2" title="2"><span class="st">  </span><span class="kw">unnest_wider</span>(coords) -&gt;<span class="st"> </span>stations</a>
<a class="sourceLine" id="cb302-3" title="3">stations</a></code></pre></div>
<pre><code>## # A tibble: 24 x 6
##    station               longname                         query                                x     y bbox      
##    &lt;chr&gt;                 &lt;chr&gt;                            &lt;chr&gt;                            &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    
##  1 Redditch              Redditch station UK              Redditch station UK              -1.94  52.3 &lt;bbox [4]&gt;
##  2 Alvechurch            Alvechurch station UK            Alvechurch station UK            -1.97  52.3 &lt;bbox [4]&gt;
##  3 Barnt Green           Barnt Green station UK           Barnt Green station UK           -1.99  52.4 &lt;bbox [4]&gt;
##  4 Longbridge            Longbridge station UK            Longbridge station UK            -1.98  52.4 &lt;bbox [4]&gt;
##  5 Northfield            Northfield station UK            Northfield station UK            -1.97  52.4 &lt;bbox [4]&gt;
##  6 King&#39;s Norton         King&#39;s Norton station UK         King&#39;s Norton station UK         -1.93  52.4 &lt;bbox [4]&gt;
##  7 Bournville            Bournville station UK            Bournville station UK            -1.94  52.4 &lt;bbox [4]&gt;
##  8 Selly Oak             Selly Oak station UK             Selly Oak station UK             -1.94  52.4 &lt;bbox [4]&gt;
##  9 Birmingham University Birmingham University station UK Birmingham University station UK -1.93  52.5 &lt;bbox [4]&gt;
## 10 Five Ways             Five Ways station UK             Five Ways station UK             -1.91  52.5 &lt;bbox [4]&gt;
## # … with 14 more rows</code></pre>
<p>The two <code>unnest_wider</code>s are because the longitudes and latitudes are hidden inside a thing called <code>coords</code> which is itself nested within <code>ll</code>. Do the first <code>unnest_wider</code>, and see what you have. This will tell you that you need to do another one.</p>
<p>The values seem reasonable; this is the UK, most of which is slightly west of the Greenwich meridian, and the latitudes look sensible given that the UK is north of southern Ontario.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Make a Leaflet map of the stations. Use circle markers or the “pin” markers as you prefer.</li>
</ol>
<p>Solution</p>
<p>I used the pin markers (with <code>addMarkers</code>), though <code>addCircleMarkers</code> is as good. The code for drawing the map is always the same; the work here is in setting up the geocoding:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb304-1" title="1"><span class="kw">leaflet</span>(<span class="dt">data =</span> stations) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb304-2" title="2"><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb304-3" title="3"><span class="st">  </span><span class="kw">addMarkers</span>(<span class="dt">lng =</span> <span class="op">~</span>x, <span class="dt">lat =</span> <span class="op">~</span>y)</a></code></pre></div>
<div id="htmlwidget-b429b796c896bd7c9f1f" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-b429b796c896bd7c9f1f">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[[52.3057655,52.3468403,52.3624014,52.3940521,52.4082951,52.414594,52.4271788,52.440222,52.45044325,52.4710941,52.4776459,52.4884888,52.5006916,52.5153876,52.5232514,52.5357946,52.545628,52.5623089,52.5795454,52.5925882,52.6043776,52.6400441,52.6798923,52.6871811],[-1.9417444,-1.9679618,-1.9876134,-1.9807506,-1.9651246,-1.9310034,-1.9364593,-1.9382689,-1.93196134052244,-1.9130708,-1.898694,-1.8712807,-1.8841916,-1.8527077,-1.8395109,-1.8324576,-1.8314247,-1.8239794,-1.8280314,-1.8383384,-1.8446597,-1.8337443,-1.8254904,-1.80135061714185],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[52.3057655,52.6871811],"lng":[-1.9876134,-1.80135061714185]}},"evals":[],"jsHooks":[]}</script>
<p>This seems to extend across the city of Birmingham, as it should. There are quite a lot of stations, so the pins overlap each other. Zoom in to see them in a bit more detail, or zoom out to orient yourself if your UK geography needs some work.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Zoom in to see whether the geocoding did indeed find each of the stations. Comment briefly on what you find.</li>
</ol>
<p>Solution</p>
<p>The stations go south to north, so the most southerly one you find should be Redditch and the most northerly is Lichfield Trent Valley.</p>
<p>If you zoom in enough, you’ll see where the railway line goes (a grey line). The points seem to be mainly close to it. But if you zoom in a bit more, some of the pins are right on the railway (such as Alvechurch), and some of them, like Redditch and Barnt Green, are a bit off, because the geocoder found the centre of the place rather than its railway station. This continues as you go north; Northfield and King’s Norton are right where they should be, but Bournville is not (Bournville station is about halfway between where you see Bournville and Stirchley on the map.) Likewise, Gravelly Hill station is right where it should be, but Aston is not.<a href="#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a></p>
<p>Extra: <code>geocode_OSM</code> uses a free geocoder called Nominatim. This has some options. The defaults are to return only the first “hit”, and to return just the coordinates and the “bounding box”. These can be changed. Let’s see what we can find for Aston:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb305-1" title="1"><span class="kw">tibble</span>(<span class="dt">where =</span> <span class="st">&quot;Aston UK&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb305-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">info =</span> <span class="kw">list</span>(<span class="kw">geocode_OSM</span>(where, <span class="dt">return.first.only =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb305-3" title="3">                            <span class="dt">details =</span> <span class="ot">TRUE</span>))) -&gt;<span class="st"> </span>d</a>
<a class="sourceLine" id="cb305-4" title="4">d         </a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   where    info       
##   &lt;chr&gt;    &lt;list&gt;     
## 1 Aston UK &lt;list [10]&gt;</code></pre>
<p>There are now 10 things returned. Let’s unnest this and see what we have:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb307-1" title="1">d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(info) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb307-2" title="2"><span class="st">  </span><span class="kw">unnest_wider</span>(info)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 13
##    where  query  coords  bbox    place_id  osm_type osm_id  place_rank display_name                       class type   importance  icon                 
##    &lt;chr&gt;  &lt;chr&gt;  &lt;list&gt;  &lt;list&gt;  &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;                              &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;                
##  1 Aston… Aston… &lt;dbl [… &lt;bbox … 9814552   node     966630… 18         Aston, Birmingham, West Midlands … place town   0.51410998… https://nominatim.op…
##  2 Aston… Aston… &lt;dbl [… &lt;bbox … 65583750  node     592022… 30         Aston, Lovers Walk, Aston, Birmin… rail… stati… 0.44157598… https://nominatim.op…
##  3 Aston… Aston… &lt;dbl [… &lt;bbox … 3972412   node     487080… 19         Aston, Flintshire, Cymru / Wales,… place villa… 0.44129130… https://nominatim.op…
##  4 Aston… Aston… &lt;dbl [… &lt;bbox … 126341    node     261278… 19         Aston, West Oxfordshire, Oxfordsh… place villa… 0.42689306… https://nominatim.op…
##  5 Aston… Aston… &lt;dbl [… &lt;bbox … 118240    node     237778… 19         Aston, East Hertfordshire, Hertfo… place villa… 0.385       https://nominatim.op…
##  6 Aston… Aston… &lt;dbl [… &lt;bbox … 17080467  node     170982… 19         Aston, Cheshire East, North West … place villa… 0.385       https://nominatim.op…
##  7 Aston… Aston… &lt;dbl [… &lt;bbox … 258605508 relation 3594185 20         Aston, East Hertfordshire, Hertfo… boun… admin… 0.36        https://nominatim.op…
##  8 Aston… Aston… &lt;dbl [… &lt;bbox … 258067004 relation 1440416 20         Aston, Cheshire West and Chester,… boun… admin… 0.36        https://nominatim.op…
##  9 Aston… Aston… &lt;dbl [… &lt;bbox … 2427860   node     356242… 20         Aston, Claverley, Heathton, Shrop… place hamlet 0.36        https://nominatim.op…
## 10 Aston… Aston… &lt;dbl [… &lt;bbox … 5573721   node     599656… 20         Aston, Maer, Newcastle-under-Lyme… place hamlet 0.36        https://nominatim.op…</code></pre>
<p>There are 10 locations it found matching “Aston UK”, and for each of those there is the information you see, a total of 12 columns’ worth in addition to the name of the place we are looking up. Perhaps the most interesting are the columns <code>class</code> and <code>type</code> near the end:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb309-1" title="1">d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(info) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb309-2" title="2"><span class="st">  </span><span class="kw">unnest_wider</span>(info) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb309-3" title="3"><span class="st">  </span><span class="kw">select</span>(where, class, type)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    where    class    type          
##    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;         
##  1 Aston UK place    town          
##  2 Aston UK railway  station       
##  3 Aston UK place    village       
##  4 Aston UK place    village       
##  5 Aston UK place    village       
##  6 Aston UK place    village       
##  7 Aston UK boundary administrative
##  8 Aston UK boundary administrative
##  9 Aston UK place    hamlet        
## 10 Aston UK place    hamlet</code></pre>
<p>Oh look, the second one is the station.</p>
<p>This makes me think that with sufficient patience we could do this for all our places, and pick out the one that is the station:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb311-1" title="1">stations &lt;-<span class="st"> </span><span class="kw">read_csv</span>(my_url)</a></code></pre></div>
<pre><code>## 
## ── Column specification ────────────────────────────────────────────────────────
## cols(
##   station = col_character()
## )</code></pre>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb313-1" title="1">stations <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb313-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">longname =</span> <span class="kw">str_c</span>(station, <span class="st">&quot; UK&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb313-3" title="3"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb313-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ll =</span> <span class="kw">list</span>(<span class="kw">geocode_OSM</span>(longname, </a>
<a class="sourceLine" id="cb313-5" title="5">                   <span class="dt">return.first.only =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb313-6" title="6">                   <span class="dt">details =</span> <span class="ot">TRUE</span>))) -&gt;<span class="st"> </span>stations</a></code></pre></div>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb314-1" title="1">stations <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(ll) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb314-2" title="2"><span class="st">  </span><span class="kw">unnest_wider</span>(ll) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb314-3" title="3"><span class="st">  </span><span class="kw">select</span>(station, coords, class, type) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb314-4" title="4"><span class="st">  </span><span class="kw">filter</span>(class <span class="op">==</span><span class="st"> &quot;railway&quot;</span>, type <span class="op">==</span><span class="st"> &quot;station&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb314-5" title="5"><span class="st">  </span><span class="kw">unnest_wider</span>(coords) -&gt;<span class="st"> </span>d</a></code></pre></div>
<pre><code>## New names:
## * `` -&gt; ...1
## New names:
## * `` -&gt; ...1
## New names:
## * `` -&gt; ...1
## New names:
## * `` -&gt; ...1
## New names:
## * `` -&gt; ...1
## New names:
## * `` -&gt; ...1
## New names:
## * `` -&gt; ...1
## New names:
## * `` -&gt; ...1
## New names:
## * `` -&gt; ...1
## New names:
## * `` -&gt; ...1</code></pre>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb316-1" title="1">d</a></code></pre></div>
<pre><code>## # A tibble: 22 x 5
##    station                   x     y class   type   
##    &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  
##  1 Redditch              -1.95  52.3 railway station
##  2 Alvechurch            -1.97  52.3 railway station
##  3 Barnt Green           -1.99  52.4 railway station
##  4 Longbridge            -1.98  52.4 railway station
##  5 Northfield            -1.97  52.4 railway station
##  6 King&#39;s Norton         -1.93  52.4 railway station
##  7 Bournville            -1.93  52.4 railway station
##  8 Selly Oak             -1.94  52.4 railway station
##  9 Five Ways             -1.91  52.5 railway station
## 10 Birmingham New Street -1.90  52.5 railway station
## # … with 12 more rows</code></pre>
<p>Almost. We’re missing University and Lichfield City stations, but it looks as if we got the rest:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb318-1" title="1"><span class="kw">leaflet</span>(<span class="dt">data =</span> d) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb318-2" title="2"><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb318-3" title="3"><span class="st">  </span><span class="kw">addMarkers</span>(<span class="dt">lng =</span> <span class="op">~</span>x, <span class="dt">lat =</span> <span class="op">~</span>y)</a></code></pre></div>
<div id="htmlwidget-b3903c9b213d658f759c" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-b3903c9b213d658f759c">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[[52.3063807,52.3468403,52.3609702,52.3970107,52.4082951,52.4142407,52.4273889,52.4418625,52.4710941,52.4776459,52.4884888,52.5044169,52.5153876,52.5285663,52.5357946,52.545628,52.5647207,52.5795454,52.5925882,52.6043776,52.6392159,52.6869627],[-1.9456089,-1.9679618,-1.9924997,-1.9807611,-1.9651246,-1.932615,-1.9266683,-1.9355913,-1.9130708,-1.898694,-1.8712807,-1.8720459,-1.8527077,-1.8392253,-1.8324576,-1.8314247,-1.8252548,-1.8280314,-1.8383384,-1.8446597,-1.8443329,-1.8001308],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[52.3063807,52.6869627],"lng":[-1.9924997,-1.8001308]}},"evals":[],"jsHooks":[]}</script>
<p>If you zoom in, you’ll see that the ones we got are all the actual stations, and not the area from which the station takes its name.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="36">
<li id="fn36"><p>I knew this existed, but I couldn’t remember what it was called, which made it hard to search for. My first port of call was <code>na_if</code>, which converts values to <code>NA</code>, the opposite of what I wanted. But from its See Also I got <code>na_replace</code>, and from the See Also of that, I found out what <code>coalesce</code> does.<a href="drawing-maps-with-leaflet.html#fnref36" class="footnote-back">↩</a></p></li>
<li id="fn37"><p>If you’re a soccer fan, this Aston is what Aston Villa is named after. See if you can find the team’s stadium Villa Park on your map.<a href="drawing-maps-with-leaflet.html#fnref37" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="k-means-cluster-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multidimensional-scaling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["pasias.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
