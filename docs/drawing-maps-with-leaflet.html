<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Chapter 27 Drawing maps with Leaflet | Problems and Solutions in Applied Statistics" />
<meta property="og:type" content="book" />
<meta property="og:url" content="http://ritsokiguess.site/pasias" />

<meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
<meta name="github-repo" content="nxskok/pasias" />

<meta name="author" content="Ken Butler" />

<meta name="date" content="2021-04-26" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics">

<title>Chapter 27 Drawing maps with Leaflet | Problems and Solutions in Applied Statistics</title>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/jquery-1.12.4/jquery.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="index.html#packages-used-somewhere-in-this-book"><span class="toc-section-number">1.1</span> Packages used somewhere in this book</a></li>
</ul></li>
<li><a href="getting-used-to-r-and-r-studio.html#getting-used-to-r-and-r-studio"><span class="toc-section-number">2</span> Getting used to R and R Studio</a>
<ul>
<li><a href="getting-used-to-r-and-r-studio.html#getting-an-r-studio-cloud-account"><span class="toc-section-number">2.1</span> Getting an R Studio Cloud account</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#getting-started"><span class="toc-section-number">2.2</span> Getting started</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#reading-data-from-a-file"><span class="toc-section-number">2.3</span> Reading data from a file</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#reading-files-different-ways"><span class="toc-section-number">2.4</span> Reading files different ways</a></li>
</ul></li>
<li><a href="reading-in-data.html#reading-in-data"><span class="toc-section-number">3</span> Reading in data</a>
<ul>
<li><a href="reading-in-data.html#orange-juice"><span class="toc-section-number">3.1</span> Orange juice</a></li>
<li><a href="reading-in-data.html#making-soap"><span class="toc-section-number">3.2</span> Making soap</a></li>
<li><a href="reading-in-data.html#handling-shipments"><span class="toc-section-number">3.3</span> Handling shipments</a></li>
</ul></li>
<li><a href="drawing-graphs.html#drawing-graphs"><span class="toc-section-number">4</span> Drawing graphs</a>
<ul>
<li><a href="drawing-graphs.html#orange-juice-1"><span class="toc-section-number">4.1</span> Orange juice</a></li>
<li><a href="drawing-graphs.html#making-soap-1"><span class="toc-section-number">4.2</span> Making soap</a></li>
<li><a href="drawing-graphs.html#handling-shipments-1"><span class="toc-section-number">4.3</span> Handling shipments</a></li>
</ul></li>
<li><a href="data-exploration.html#data-exploration"><span class="toc-section-number">5</span> Data exploration</a>
<ul>
<li><a href="data-exploration.html#north-carolina-births"><span class="toc-section-number">5.1</span> North Carolina births</a></li>
<li><a href="data-exploration.html#more-about-the-nc-births"><span class="toc-section-number">5.2</span> More about the NC births</a></li>
<li><a href="data-exploration.html#nenana-alaska"><span class="toc-section-number">5.3</span> Nenana, Alaska</a></li>
<li><a href="data-exploration.html#computerized-accounting"><span class="toc-section-number">5.4</span> Computerized accounting</a></li>
<li><a href="data-exploration.html#test-scores-in-two-classes"><span class="toc-section-number">5.5</span> Test scores in two classes</a></li>
<li><a href="data-exploration.html#working-with-dataframes"><span class="toc-section-number">5.6</span> Working with dataframes</a></li>
<li><a href="data-exploration.html#tidying-the-jays-data"><span class="toc-section-number">5.7</span> Tidying the Jays data</a></li>
<li><a href="data-exploration.html#cars"><span class="toc-section-number">5.8</span> Cars</a></li>
</ul></li>
<li><a href="one-sample-inference.html#one-sample-inference"><span class="toc-section-number">6</span> One-sample inference</a>
<ul>
<li><a href="one-sample-inference.html#hunter-gatherers-in-australia"><span class="toc-section-number">6.1</span> Hunter-gatherers in Australia</a></li>
<li><a href="one-sample-inference.html#buses-to-boulder"><span class="toc-section-number">6.2</span> Buses to Boulder</a></li>
<li><a href="one-sample-inference.html#length-of-gestation-in-north-carolina"><span class="toc-section-number">6.3</span> Length of gestation in North Carolina</a></li>
<li><a href="one-sample-inference.html#inferring-ice-break-up-in-nenana"><span class="toc-section-number">6.4</span> Inferring ice break-up in Nenana</a></li>
</ul></li>
<li><a href="two-sample-inference.html#two-sample-inference"><span class="toc-section-number">7</span> Two-sample inference</a>
<ul>
<li><a href="two-sample-inference.html#children-and-electronic-devices"><span class="toc-section-number">7.1</span> Children and electronic devices</a></li>
<li><a href="two-sample-inference.html#parking-close-to-the-curb"><span class="toc-section-number">7.2</span> Parking close to the curb</a></li>
<li><a href="two-sample-inference.html#bell-peppers-and-too-much-water"><span class="toc-section-number">7.3</span> Bell peppers and too much water</a></li>
<li><a href="two-sample-inference.html#exercise-and-anxiety-and-bullying-mice"><span class="toc-section-number">7.4</span> Exercise and anxiety and bullying mice</a></li>
<li><a href="two-sample-inference.html#diet-and-growth-in-boys"><span class="toc-section-number">7.5</span> Diet and growth in boys</a></li>
</ul></li>
<li><a href="power-and-sample-size.html#power-and-sample-size"><span class="toc-section-number">8</span> Power and sample size</a>
<ul>
<li><a href="power-and-sample-size.html#simulating-power"><span class="toc-section-number">8.1</span> Simulating power</a></li>
<li><a href="power-and-sample-size.html#calculating-power-and-sample-size-for-estimating-mean"><span class="toc-section-number">8.2</span> Calculating power and sample size for estimating mean</a></li>
<li><a href="power-and-sample-size.html#simulating-power-for-proportions"><span class="toc-section-number">8.3</span> Simulating power for proportions</a></li>
</ul></li>
<li><a href="the-sign-test-and-moods-median-test.html#the-sign-test-and-moods-median-test"><span class="toc-section-number">9</span> The sign test and Mood’s median test</a>
<ul>
<li><a href="the-sign-test-and-moods-median-test.html#running-a-maze"><span class="toc-section-number">9.1</span> Running a maze</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#chocolate-chips"><span class="toc-section-number">9.2</span> Chocolate chips</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#the-power-of-the-sign-test"><span class="toc-section-number">9.3</span> The power of the sign test</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#sugar-in-breakfast-cereals"><span class="toc-section-number">9.4</span> Sugar in breakfast cereals</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#fear-of-math"><span class="toc-section-number">9.5</span> Fear of math</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#medical-instructions"><span class="toc-section-number">9.6</span> Medical instructions</a></li>
</ul></li>
<li><a href="matched-pairs-t-and-sign-test.html#matched-pairs-t-and-sign-test"><span class="toc-section-number">10</span> Matched pairs t and sign test</a>
<ul>
<li><a href="matched-pairs-t-and-sign-test.html#measuring-body-fat"><span class="toc-section-number">10.1</span> Measuring body fat</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#throwing-baseballs-and-softballs"><span class="toc-section-number">10.2</span> Throwing baseballs and softballs</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#throwing-baseballs-and-softballs-again"><span class="toc-section-number">10.3</span> Throwing baseballs and softballs, again</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#changes-in-salary"><span class="toc-section-number">10.4</span> Changes in salary</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#body-fat-revisited"><span class="toc-section-number">10.5</span> Body fat revisited</a></li>
</ul></li>
<li><a href="normal-quantile-plots.html#normal-quantile-plots"><span class="toc-section-number">11</span> Normal quantile plots</a>
<ul>
<li><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers"><span class="toc-section-number">11.1</span> Lengths of heliconia flowers</a></li>
<li><a href="normal-quantile-plots.html#ferritin-and-normality"><span class="toc-section-number">11.2</span> Ferritin and normality</a></li>
</ul></li>
<li><a href="analysis-of-variance.html#analysis-of-variance"><span class="toc-section-number">12</span> Analysis of variance</a>
<ul>
<li><a href="analysis-of-variance.html#movie-ratings-and-lengths"><span class="toc-section-number">12.1</span> Movie ratings and lengths</a></li>
<li><a href="analysis-of-variance.html#deer-and-how-much-they-eat"><span class="toc-section-number">12.2</span> Deer and how much they eat</a></li>
<li><a href="analysis-of-variance.html#movie-ratings-again"><span class="toc-section-number">12.3</span> Movie ratings again</a></li>
<li><a href="analysis-of-variance.html#atomic-weight-of-carbon"><span class="toc-section-number">12.4</span> Atomic weight of carbon</a></li>
<li><a href="analysis-of-variance.html#can-caffeine-improve-your-performance-on-a-test"><span class="toc-section-number">12.5</span> Can caffeine improve your performance on a test?</a></li>
</ul></li>
<li><a href="tidying-data.html#tidying-data"><span class="toc-section-number">13</span> Tidying data</a>
<ul>
<li><a href="tidying-data.html#baseball-and-softball-spaghetti"><span class="toc-section-number">13.1</span> Baseball and softball spaghetti</a></li>
<li><a href="tidying-data.html#ethanol-and-sleep-time-in-rats"><span class="toc-section-number">13.2</span> Ethanol and sleep time in rats</a></li>
<li><a href="tidying-data.html#growth-of-tomatoes"><span class="toc-section-number">13.3</span> Growth of tomatoes</a></li>
<li><a href="tidying-data.html#pain-relief-in-migraine-headaches-again"><span class="toc-section-number">13.4</span> Pain relief in migraine headaches (again)</a></li>
<li><a href="tidying-data.html#location-species-and-disease-in-plants"><span class="toc-section-number">13.5</span> Location, species and disease in plants</a></li>
<li><a href="tidying-data.html#mating-songs-in-crickets"><span class="toc-section-number">13.6</span> Mating songs in crickets</a></li>
<li><a href="tidying-data.html#number-1-songs"><span class="toc-section-number">13.7</span> Number 1 songs</a></li>
<li><a href="tidying-data.html#bikes-on-college"><span class="toc-section-number">13.8</span> Bikes on College</a></li>
<li><a href="tidying-data.html#feeling-the-heat"><span class="toc-section-number">13.9</span> Feeling the heat</a></li>
</ul></li>
<li><a href="regression.html#regression"><span class="toc-section-number">14</span> Regression</a>
<ul>
<li><a href="regression.html#rainfall-in-california"><span class="toc-section-number">14.1</span> Rainfall in California</a></li>
<li><a href="regression.html#carbon-monoxide-in-cigarettes"><span class="toc-section-number">14.2</span> Carbon monoxide in cigarettes</a></li>
<li><a href="regression.html#maximal-oxygen-uptake-in-young-boys"><span class="toc-section-number">14.3</span> Maximal oxygen uptake in young boys</a></li>
<li><a href="regression.html#facebook-friends-and-grey-matter"><span class="toc-section-number">14.4</span> Facebook friends and grey matter</a></li>
<li><a href="regression.html#endogenous-nitrogen-excretion-in-carp"><span class="toc-section-number">14.5</span> Endogenous nitrogen excretion in carp</a></li>
<li><a href="regression.html#sparrowhawks"><span class="toc-section-number">14.6</span> Sparrowhawks</a></li>
<li><a href="regression.html#salaries-of-social-workers"><span class="toc-section-number">14.7</span> Salaries of social workers</a></li>
<li><a href="regression.html#predicting-volume-of-wood-in-pine-trees"><span class="toc-section-number">14.8</span> Predicting volume of wood in pine trees</a></li>
<li><a href="regression.html#tortoise-shells-and-eggs"><span class="toc-section-number">14.9</span> Tortoise shells and eggs</a></li>
<li><a href="regression.html#crickets-revisited"><span class="toc-section-number">14.10</span> Crickets revisited</a></li>
<li><a href="regression.html#roller-coasters"><span class="toc-section-number">14.11</span> Roller coasters</a></li>
<li><a href="regression.html#running-and-blood-sugar"><span class="toc-section-number">14.12</span> Running and blood sugar</a></li>
<li><a href="regression.html#calories-and-fat-in-pizza"><span class="toc-section-number">14.13</span> Calories and fat in pizza</a></li>
<li><a href="regression.html#where-should-the-fire-stations-be"><span class="toc-section-number">14.14</span> Where should the fire stations be?</a></li>
<li><a href="regression.html#being-satisfied-with-hospital"><span class="toc-section-number">14.15</span> Being satisfied with hospital</a></li>
<li><a href="regression.html#handling-shipments-of-chemicals"><span class="toc-section-number">14.16</span> Handling shipments of chemicals</a></li>
<li><a href="regression.html#salaries-of-mathematicians"><span class="toc-section-number">14.17</span> Salaries of mathematicians</a></li>
<li><a href="regression.html#predicting-gpa-of-computer-science-students"><span class="toc-section-number">14.18</span> Predicting GPA of computer science students</a></li>
</ul></li>
<li><a href="dates-and-times.html#dates-and-times"><span class="toc-section-number">15</span> Dates and times</a>
<ul>
<li><a href="dates-and-times.html#dealing-with-dates-in-the-worcester-heart-attack-study"><span class="toc-section-number">15.1</span> Dealing with dates in the Worcester Heart Attack study</a></li>
<li><a href="dates-and-times.html#growth-of-mizuna-lettuce-seeds"><span class="toc-section-number">15.2</span> Growth of Mizuna lettuce seeds</a></li>
<li><a href="dates-and-times.html#types-of-childbirth"><span class="toc-section-number">15.3</span> Types of childbirth</a></li>
<li><a href="dates-and-times.html#wolves-and-caribou"><span class="toc-section-number">15.4</span> Wolves and caribou</a></li>
</ul></li>
<li><a href="functions.html#functions"><span class="toc-section-number">16</span> Functions</a>
<ul>
<li><a href="functions.html#making-some-r-functions"><span class="toc-section-number">16.1</span> Making some R functions</a></li>
<li><a href="functions.html#the-collatz-sequence"><span class="toc-section-number">16.2</span> The Collatz sequence</a></li>
</ul></li>
<li><a href="the-bootstrap.html#the-bootstrap"><span class="toc-section-number">17</span> The Bootstrap</a>
<ul>
<li><a href="the-bootstrap.html#air-conditioning-failures"><span class="toc-section-number">17.1</span> Air conditioning failures</a></li>
<li><a href="the-bootstrap.html#air-conditioning-failures-bootstrapping-the-median"><span class="toc-section-number">17.2</span> Air conditioning failures: bootstrapping the median</a></li>
</ul></li>
<li><a href="bayesian-statistics-with-stan.html#bayesian-statistics-with-stan"><span class="toc-section-number">18</span> Bayesian Statistics with Stan</a>
<ul>
<li><a href="bayesian-statistics-with-stan.html#estimating-proportion-in-favour-from-a-survey"><span class="toc-section-number">18.1</span> Estimating proportion in favour from a survey</a></li>
<li><a href="bayesian-statistics-with-stan.html#bayesian-regression"><span class="toc-section-number">18.2</span> Bayesian regression</a></li>
</ul></li>
<li><a href="logistic-regression.html#logistic-regression"><span class="toc-section-number">19</span> Logistic regression</a>
<ul>
<li><a href="logistic-regression.html#finding-wolf-spiders-on-the-beach"><span class="toc-section-number">19.1</span> Finding wolf spiders on the beach</a></li>
<li><a href="logistic-regression.html#killing-aphids"><span class="toc-section-number">19.2</span> Killing aphids</a></li>
<li><a href="logistic-regression.html#the-effects-of-substance-a"><span class="toc-section-number">19.3</span> The effects of Substance A</a></li>
<li><a href="logistic-regression.html#what-makes-an-animal-get-infected"><span class="toc-section-number">19.4</span> What makes an animal get infected?</a></li>
<li><a href="logistic-regression.html#the-brain-of-a-cat"><span class="toc-section-number">19.5</span> The brain of a cat</a></li>
<li><a href="logistic-regression.html#how-not-to-get-heart-disease"><span class="toc-section-number">19.6</span> How not to get heart disease</a></li>
<li><a href="logistic-regression.html#successful-breastfeeding"><span class="toc-section-number">19.7</span> Successful breastfeeding</a></li>
<li><a href="logistic-regression.html#making-it-over-the-mountains"><span class="toc-section-number">19.8</span> Making it over the mountains</a></li>
<li><a href="logistic-regression.html#who-needs-the-most-intensive-care"><span class="toc-section-number">19.9</span> Who needs the most intensive care?</a></li>
<li><a href="logistic-regression.html#go-away-and-dont-come-back"><span class="toc-section-number">19.10</span> Go away and don’t come back!</a></li>
</ul></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#logistic-regression-with-ordinal-or-nominal-response"><span class="toc-section-number">20</span> Logistic regression with ordinal or nominal response</a>
<ul>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#do-you-like-your-mobile-phone"><span class="toc-section-number">20.1</span> Do you like your mobile phone?</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#attitudes-towards-abortion"><span class="toc-section-number">20.2</span> Attitudes towards abortion</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#finding-non-missing-values"><span class="toc-section-number">20.3</span> Finding non-missing values</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#european-social-survey-and-voting"><span class="toc-section-number">20.4</span> European Social Survey and voting</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#alligator-food"><span class="toc-section-number">20.5</span> Alligator food</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#how-do-you-like-your-steak-the-data"><span class="toc-section-number">20.6</span> How do you like your steak – the data</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#crimes-in-san-francisco-the-data"><span class="toc-section-number">20.7</span> Crimes in San Francisco – the data</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#how-do-you-like-your-steak"><span class="toc-section-number">20.8</span> How do you like your steak?</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#crimes-in-san-francisco"><span class="toc-section-number">20.9</span> Crimes in San Francisco</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#high-school-and-beyond"><span class="toc-section-number">20.10</span> High School and Beyond</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#what-sports-do-these-athletes-play"><span class="toc-section-number">20.11</span> What sports do these athletes play?</a></li>
</ul></li>
<li><a href="survival-analysis.html#survival-analysis"><span class="toc-section-number">21</span> Survival analysis</a>
<ul>
<li><a href="survival-analysis.html#the-worcester-survey"><span class="toc-section-number">21.1</span> The Worcester survey</a></li>
<li><a href="survival-analysis.html#drug-treatment-programs"><span class="toc-section-number">21.2</span> Drug treatment programs</a></li>
<li><a href="survival-analysis.html#multiple-myeloma"><span class="toc-section-number">21.3</span> Multiple myeloma</a></li>
<li><a href="survival-analysis.html#ovarian-cancer"><span class="toc-section-number">21.4</span> Ovarian cancer</a></li>
</ul></li>
<li><a href="analysis-of-variance-revisited.html#analysis-of-variance-revisited"><span class="toc-section-number">22</span> Analysis of variance revisited</a>
<ul>
<li><a href="analysis-of-variance-revisited.html#acid-rain"><span class="toc-section-number">22.1</span> Acid rain</a></li>
<li><a href="analysis-of-variance-revisited.html#treating-hay-fever"><span class="toc-section-number">22.2</span> Treating hay fever</a></li>
<li><a href="analysis-of-variance-revisited.html#focused-comparisons-of-the-effect-of-caffeine"><span class="toc-section-number">22.3</span> Focused comparisons of the effect of caffeine</a></li>
<li><a href="analysis-of-variance-revisited.html#who-studies-the-most-outside-class"><span class="toc-section-number">22.4</span> Who studies the most outside class?</a></li>
<li><a href="analysis-of-variance-revisited.html#mental-context"><span class="toc-section-number">22.5</span> Mental context</a></li>
<li><a href="analysis-of-variance-revisited.html#trying-on-shirts"><span class="toc-section-number">22.6</span> Trying on shirts</a></li>
<li><a href="analysis-of-variance-revisited.html#productivity-and-research-and-development"><span class="toc-section-number">22.7</span> Productivity and research-and-development</a></li>
<li><a href="analysis-of-variance-revisited.html#treating-leprosy"><span class="toc-section-number">22.8</span> Treating leprosy</a></li>
</ul></li>
<li><a href="multivariate-analysis-of-variance.html#multivariate-analysis-of-variance"><span class="toc-section-number">23</span> Multivariate analysis of variance</a>
<ul>
<li><a href="multivariate-analysis-of-variance.html#fabricated-data"><span class="toc-section-number">23.1</span> Fabricated data</a></li>
<li><a href="multivariate-analysis-of-variance.html#do-characteristics-of-urine-depend-on-obesity"><span class="toc-section-number">23.2</span> Do characteristics of urine depend on obesity?</a></li>
<li><a href="multivariate-analysis-of-variance.html#how-do-height-and-weight-depend-on-sport-played-by-elite-athletes"><span class="toc-section-number">23.3</span> How do height and weight depend on sport played by elite athletes?</a></li>
</ul></li>
<li><a href="repeated-measures.html#repeated-measures"><span class="toc-section-number">24</span> Repeated measures</a>
<ul>
<li><a href="repeated-measures.html#effect-of-drug-on-rat-weight"><span class="toc-section-number">24.1</span> Effect of drug on rat weight</a></li>
<li><a href="repeated-measures.html#social-interaction-among-old-people"><span class="toc-section-number">24.2</span> Social interaction among old people</a></li>
<li><a href="repeated-measures.html#childrens-stress-levels-and-airports"><span class="toc-section-number">24.3</span> Children’s stress levels and airports</a></li>
<li><a href="repeated-measures.html#body-fat-as-repeated-measures"><span class="toc-section-number">24.4</span> Body fat as repeated measures</a></li>
<li><a href="repeated-measures.html#investigating-motor-activity-in-rats"><span class="toc-section-number">24.5</span> Investigating motor activity in rats</a></li>
<li><a href="repeated-measures.html#repeated-measures-with-no-background"><span class="toc-section-number">24.6</span> Repeated measures with no background</a></li>
</ul></li>
<li><a href="discriminant-analysis.html#discriminant-analysis"><span class="toc-section-number">25</span> Discriminant analysis</a>
<ul>
<li><a href="discriminant-analysis.html#telling-whether-a-banknote-is-real-or-counterfeit"><span class="toc-section-number">25.1</span> Telling whether a banknote is real or counterfeit</a></li>
<li><a href="discriminant-analysis.html#urine-and-obesity-what-makes-a-difference"><span class="toc-section-number">25.2</span> Urine and obesity: what makes a difference?</a></li>
<li><a href="discriminant-analysis.html#understanding-a-manova"><span class="toc-section-number">25.3</span> Understanding a MANOVA</a></li>
<li><a href="discriminant-analysis.html#what-distinguishes-people-who-do-different-jobs"><span class="toc-section-number">25.4</span> What distinguishes people who do different jobs?</a></li>
<li><a href="discriminant-analysis.html#observing-children-with-adhd"><span class="toc-section-number">25.5</span> Observing children with ADHD</a></li>
<li><a href="discriminant-analysis.html#growing-corn"><span class="toc-section-number">25.6</span> Growing corn</a></li>
<li><a href="discriminant-analysis.html#understanding-athletes-height-weight-sport-and-gender"><span class="toc-section-number">25.7</span> Understanding athletes’ height, weight, sport and gender</a></li>
</ul></li>
<li><a href="cluster-analysis.html#cluster-analysis"><span class="toc-section-number">26</span> Cluster analysis</a>
<ul>
<li><a href="cluster-analysis.html#sites-on-the-sea-bed"><span class="toc-section-number">26.1</span> Sites on the sea bed</a></li>
<li><a href="cluster-analysis.html#dissimilarities-between-fruits"><span class="toc-section-number">26.2</span> Dissimilarities between fruits</a></li>
<li><a href="cluster-analysis.html#similarity-of-species"><span class="toc-section-number">26.3</span> Similarity of species</a></li>
<li><a href="cluster-analysis.html#rating-beer"><span class="toc-section-number">26.4</span> Rating beer</a></li>
<li><a href="cluster-analysis.html#clustering-the-swiss-bills"><span class="toc-section-number">26.5</span> Clustering the Swiss bills</a></li>
<li><a href="cluster-analysis.html#grouping-similar-cars"><span class="toc-section-number">26.6</span> Grouping similar cars</a></li>
<li><a href="cluster-analysis.html#running-jumping-and-throwing"><span class="toc-section-number">26.7</span> Running, jumping, and throwing</a></li>
<li><a href="cluster-analysis.html#bridges-in-pittsburgh"><span class="toc-section-number">26.8</span> Bridges in Pittsburgh</a></li>
<li><a href="cluster-analysis.html#clustering-the-australian-athletes"><span class="toc-section-number">26.9</span> Clustering the Australian athletes</a></li>
</ul></li>
<li><a href="drawing-maps-with-leaflet.html#drawing-maps-with-leaflet"><span class="toc-section-number">27</span> Drawing maps with Leaflet</a>
<ul>
<li><a href="drawing-maps-with-leaflet.html#the-brain-of-a-cat-revisited"><span class="toc-section-number">27.1</span> The brain of a cat, revisited</a></li>
<li><a href="drawing-maps-with-leaflet.html#making-a-map-of-wisconsin"><span class="toc-section-number">27.2</span> Making a map of Wisconsin</a></li>
</ul></li>
<li><a href="multidimensional-scaling.html#multidimensional-scaling"><span class="toc-section-number">28</span> Multidimensional Scaling</a>
<ul>
<li><a href="multidimensional-scaling.html#making-a-map-of-wisconsin-1"><span class="toc-section-number">28.1</span> Making a map of Wisconsin</a></li>
<li><a href="multidimensional-scaling.html#things-that-feel-similar-to-each-other"><span class="toc-section-number">28.2</span> Things that feel similar to each other</a></li>
<li><a href="multidimensional-scaling.html#confusing-letters"><span class="toc-section-number">28.3</span> Confusing letters</a></li>
<li><a href="multidimensional-scaling.html#more-beer-please"><span class="toc-section-number">28.4</span> More beer please</a></li>
<li><a href="multidimensional-scaling.html#feeling-similar-again"><span class="toc-section-number">28.5</span> Feeling similar, again</a></li>
</ul></li>
<li><a href="principal-components-and-factor-analysis.html#principal-components-and-factor-analysis"><span class="toc-section-number">29</span> Principal Components and Factor Analysis</a>
<ul>
<li><a href="principal-components-and-factor-analysis.html#the-weather-somewhere"><span class="toc-section-number">29.1</span> The weather, somewhere</a></li>
<li><a href="principal-components-and-factor-analysis.html#air-pollution"><span class="toc-section-number">29.2</span> Air pollution</a></li>
<li><a href="principal-components-and-factor-analysis.html#a-correlation-matrix"><span class="toc-section-number">29.3</span> A correlation matrix</a></li>
<li><a href="principal-components-and-factor-analysis.html#the-interpersonal-circumplex"><span class="toc-section-number">29.4</span> The Interpersonal Circumplex</a></li>
</ul></li>
<li><a href="frequency-table-analysis.html#frequency-table-analysis"><span class="toc-section-number">30</span> Frequency table analysis</a>
<ul>
<li><a href="frequency-table-analysis.html#college-plans"><span class="toc-section-number">30.1</span> College plans</a></li>
<li><a href="frequency-table-analysis.html#predicting-voting"><span class="toc-section-number">30.2</span> Predicting voting</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="drawing-maps-with-leaflet" class="section level1" number="27">
<h1><span class="header-section-number">Chapter 27</span> Drawing maps with Leaflet</h1>
<p>Packages for this chapter:</p>
<div class="sourceCode" id="cb3161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3161-1"><a href="drawing-maps-with-leaflet.html#cb3161-1"></a><span class="kw">library</span>(ggbiplot)</span>
<span id="cb3161-2"><a href="drawing-maps-with-leaflet.html#cb3161-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb3161-3"><a href="drawing-maps-with-leaflet.html#cb3161-3"></a><span class="kw">library</span>(ggrepel)</span></code></pre></div>
<div id="the-brain-of-a-cat-revisited" class="section level2" number="27.1">
<h2><span class="header-section-number">27.1</span> The brain of a cat, revisited</h2>
<p>Earlier, we looked at an ethics study that had to do with a fictional brain of a fictional cat. I said
there was actually a <em>town</em> called Catbrain. It’s in England,
near Bristol, and seems to be home to a street of car dealerships.</p>
<ol style="list-style-type: lower-alpha">
<li>Find the latitude and longitude of “Catbrain UK” (though I don’t think there are any others).</li>
</ol>
<p>Solution</p>
<p>Make sure you have these two packages loaded:</p>
<div class="sourceCode" id="cb3162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3162-1"><a href="drawing-maps-with-leaflet.html#cb3162-1"></a><span class="kw">library</span>(leaflet)</span>
<span id="cb3162-2"><a href="drawing-maps-with-leaflet.html#cb3162-2"></a><span class="kw">library</span>(tmaptools)</span></code></pre></div>
<p>To find the latitude and longitude of Catbrain:</p>
<div class="sourceCode" id="cb3163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3163-1"><a href="drawing-maps-with-leaflet.html#cb3163-1"></a>catbrain &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">place =</span> <span class="st">&quot;Catbrain UK&quot;</span>)</span>
<span id="cb3163-2"><a href="drawing-maps-with-leaflet.html#cb3163-2"></a>catbrain <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">ll =</span> <span class="kw">list</span>(<span class="kw">geocode_OSM</span>(place))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3163-3"><a href="drawing-maps-with-leaflet.html#cb3163-3"></a><span class="st">  </span><span class="kw">unnest_wider</span>(ll) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3163-4"><a href="drawing-maps-with-leaflet.html#cb3163-4"></a><span class="st">  </span><span class="kw">unnest_wider</span>(coords) -&gt;<span class="st"> </span>catbrain</span></code></pre></div>
<div class="sourceCode" id="cb3164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3164-1"><a href="drawing-maps-with-leaflet.html#cb3164-1"></a>catbrain</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["place"],"name":[1],"type":["chr"],"align":["left"]},{"label":["query"],"name":[2],"type":["chr"],"align":["left"]},{"label":["x"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["y"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["bbox"],"name":[5],"type":["list"],"align":["right"]}],"data":[{"1":"Catbrain UK","2":"Catbrain UK","3":"-2.612466","4":"51.52288","5":"<bbox>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Remember that the output from <code>geocode_OSM</code> is a list, and it has in it a thing called <code>coords</code> that is the longitude and latitude together, and another thing called <code>bbox</code> that we don’t use. So we have to <code>unnest</code> <em>twice</em> to get the longitude (as <code>x</code>) and the latitude (as <code>y</code>) out for drawing in a moment.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Draw a map of Catbrain using Leaflet.</li>
</ol>
<p>Solution</p>
<p>That goes this way:</p>
<div class="sourceCode" id="cb3165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3165-1"><a href="drawing-maps-with-leaflet.html#cb3165-1"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> catbrain) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3165-2"><a href="drawing-maps-with-leaflet.html#cb3165-2"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3165-3"><a href="drawing-maps-with-leaflet.html#cb3165-3"></a><span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> <span class="op">~</span>x, <span class="dt">lat =</span> <span class="op">~</span>y) -&gt;<span class="st"> </span>catbrain_map</span>
<span id="cb3165-4"><a href="drawing-maps-with-leaflet.html#cb3165-4"></a>catbrain_map</span></code></pre></div>
<div id="htmlwidget-0a87c6a0d08653faea9d" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-0a87c6a0d08653faea9d">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[51.5228823,-2.6124662,10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[51.5228823,51.5228823],"lng":[-2.6124662,-2.6124662]}},"evals":[],"jsHooks":[]}</script>
<p>There are car dealerships are along Lysander Road. Zoom in
to see them. Or zoom out to see where this is. You can keep zooming out until you know where you are, using the plus and minus buttons, or your mouse wheel.</p>
<p>The name Catbrain, according to
<a href="http://www.bristolpost.co.uk/news/history/name-catbrain-hill-came-825247">link</a>,
means “rough stony soil”, from Middle English, and has nothing to do
with cats or their brains at all.</p>
<p>Extra: I was actually surprised that this worked at all, because with only one point, how does it know what scale to draw the map? Also, unless your UK geography is really good, you won’t have any clue about exactly where this is. That’s the reason for the next part.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Make a dataframe containing some other British cities as well as Catbrain, and find their latitudes and longitudes.</li>
</ol>
<p>Solution</p>
<p>I chose the cities below, mostly somewhere near Catbrain. You could fire up a Google map, zoom it out until it contains something you know, and pick some places you’ve heard of. (I happen to know British geography pretty well, so I just picked some mostly nearby places out of my head. I didn’t really want to pick London, but I figured this was the one <em>you</em> might know.)</p>
<div class="sourceCode" id="cb3166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3166-1"><a href="drawing-maps-with-leaflet.html#cb3166-1"></a>catbrain2 &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb3166-2"><a href="drawing-maps-with-leaflet.html#cb3166-2"></a>  <span class="op">~</span>where,</span>
<span id="cb3166-3"><a href="drawing-maps-with-leaflet.html#cb3166-3"></a>  <span class="st">&quot;Catbrain UK&quot;</span>,</span>
<span id="cb3166-4"><a href="drawing-maps-with-leaflet.html#cb3166-4"></a>  <span class="st">&quot;Bristol UK&quot;</span>,</span>
<span id="cb3166-5"><a href="drawing-maps-with-leaflet.html#cb3166-5"></a>  <span class="st">&quot;Taunton UK&quot;</span>,</span>
<span id="cb3166-6"><a href="drawing-maps-with-leaflet.html#cb3166-6"></a>  <span class="st">&quot;Newport UK&quot;</span>,</span>
<span id="cb3166-7"><a href="drawing-maps-with-leaflet.html#cb3166-7"></a>  <span class="st">&quot;Gloucester UK&quot;</span>,</span>
<span id="cb3166-8"><a href="drawing-maps-with-leaflet.html#cb3166-8"></a>  <span class="st">&quot;Cardiff UK&quot;</span>,</span>
<span id="cb3166-9"><a href="drawing-maps-with-leaflet.html#cb3166-9"></a>  <span class="st">&quot;Birmingham UK&quot;</span>,</span>
<span id="cb3166-10"><a href="drawing-maps-with-leaflet.html#cb3166-10"></a>  <span class="st">&quot;London UK&quot;</span>,</span>
<span id="cb3166-11"><a href="drawing-maps-with-leaflet.html#cb3166-11"></a>  <span class="st">&quot;Caldicot UK&quot;</span></span>
<span id="cb3166-12"><a href="drawing-maps-with-leaflet.html#cb3166-12"></a>)</span>
<span id="cb3166-13"><a href="drawing-maps-with-leaflet.html#cb3166-13"></a>catbrain2 <span class="op">%&gt;%</span></span>
<span id="cb3166-14"><a href="drawing-maps-with-leaflet.html#cb3166-14"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3166-15"><a href="drawing-maps-with-leaflet.html#cb3166-15"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ll =</span> <span class="kw">list</span>(<span class="kw">geocode_OSM</span>(where))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3166-16"><a href="drawing-maps-with-leaflet.html#cb3166-16"></a><span class="st">  </span><span class="kw">unnest_wider</span>(ll) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3166-17"><a href="drawing-maps-with-leaflet.html#cb3166-17"></a><span class="st">  </span><span class="kw">unnest_wider</span>(coords) -&gt;<span class="st"> </span>catbrain2</span></code></pre></div>
<div class="sourceCode" id="cb3167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3167-1"><a href="drawing-maps-with-leaflet.html#cb3167-1"></a>catbrain2</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["where"],"name":[1],"type":["chr"],"align":["left"]},{"label":["query"],"name":[2],"type":["chr"],"align":["left"]},{"label":["x"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["y"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["bbox"],"name":[5],"type":["list"],"align":["right"]}],"data":[{"1":"Catbrain UK","2":"Catbrain UK","3":"-2.6124662","4":"51.52288","5":"<bbox>"},{"1":"Bristol UK","2":"Bristol UK","3":"-2.5972985","4":"51.45380","5":"<bbox>"},{"1":"Taunton UK","2":"Taunton UK","3":"-3.1029086","4":"51.01479","5":"<bbox>"},{"1":"Newport UK","2":"Newport UK","3":"-2.9974967","4":"51.58823","5":"<bbox>"},{"1":"Gloucester UK","2":"Gloucester UK","3":"-2.2458192","4":"51.86537","5":"<bbox>"},{"1":"Cardiff UK","2":"Cardiff UK","3":"-3.1791934","4":"51.48165","5":"<bbox>"},{"1":"Birmingham UK","2":"Birmingham UK","3":"-1.9026911","4":"52.47970","5":"<bbox>"},{"1":"London UK","2":"London UK","3":"-0.1276474","4":"51.50732","5":"<bbox>"},{"1":"Caldicot UK","2":"Caldicot UK","3":"-2.7517629","4":"51.59125","5":"<bbox>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The first time I did this, I forgot the <code>rowwise</code>, which we didn’t need the first time (there was only one place), but here, it causes odd problems if you omit it.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Draw a map containing the places you picked.</li>
</ol>
<p>Solution</p>
<p>The map-drawing is almost the same, just changing the dataframe:</p>
<div class="sourceCode" id="cb3168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3168-1"><a href="drawing-maps-with-leaflet.html#cb3168-1"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> catbrain2) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3168-2"><a href="drawing-maps-with-leaflet.html#cb3168-2"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3168-3"><a href="drawing-maps-with-leaflet.html#cb3168-3"></a><span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> <span class="op">~</span>x, <span class="dt">lat =</span> <span class="op">~</span>y)</span></code></pre></div>
<div id="htmlwidget-2cb9940361b514dc3251" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-2cb9940361b514dc3251">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[51.5228823,51.4538022,51.0147895,51.5882332,51.8653705,51.4816546,52.4796992,51.5073219,51.5912466],[-2.6124662,-2.5972985,-3.1029086,-2.9974967,-2.2458192,-3.1791934,-1.9026911,-0.1276474,-2.7517629],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[51.0147895,52.4796992],"lng":[-3.1791934,-0.1276474]}},"evals":[],"jsHooks":[]}</script>
<p>Now, if you have any sense of the geography of the UK, you know where
you are. The big river (the Severn) is
the border between England and Wales, so
the places above and to the left of it are in Wales, including
Caldicot (see question about Roman pottery).</p>
<p>You can zoom this map <em>in</em> (once you have figured out which of the circles is Catbrain) and find Lysander Road again, and also the M5 (see below).</p>
<p>More irrelevant extra: the M5 is one of the English “motorways” (like 400-series highways
or US Interstates). The M5 goes from Birmingham to Exeter. You can
tell that this is England because of the huge number of traffic
circles, known there as “roundabouts”. One of the first things they
teach you in British driving schools is how to handle roundabouts:
which lane to approach them in, which (stick-shift) gear to be in, and
when you’re supposed to signal where you’re going. I hope I still
remember all that for when I next drive in England!</p>
</div>
<div id="making-a-map-of-wisconsin" class="section level2" number="27.2">
<h2><span class="header-section-number">27.2</span> Making a map of Wisconsin</h2>
<p>The file
<a href="http://ritsokiguess.site/datafiles/wisconsin.txt">link</a> contains
the road distances (in miles) between 12 cities in Wisconsin and
neighbouring states. We are going to try to draw a map of the
area using Leaflet.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data, displaying
the data that you read in.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb3169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3169-1"><a href="drawing-maps-with-leaflet.html#cb3169-1"></a>my_url &lt;-<span class="st"> &quot;http://ritsokiguess.site/datafiles/wisconsin.txt&quot;</span></span>
<span id="cb3169-2"><a href="drawing-maps-with-leaflet.html#cb3169-2"></a>wisc &lt;-<span class="st"> </span><span class="kw">read_table</span>(my_url)</span></code></pre></div>
<pre><code>## 
## ── Column specification ──────────────────────────────────────────────────────────────────
## cols(
##   location = col_character(),
##   Appleton = col_double(),
##   Beloit = col_double(),
##   Fort.Atkinson = col_double(),
##   Madison = col_double(),
##   Marshfield = col_double(),
##   Milwaukee = col_double(),
##   Monroe = col_double(),
##   Superior = col_double(),
##   Wausau = col_double(),
##   Dubuque = col_double(),
##   St.Paul = col_double(),
##   Chicago = col_double()
## )</code></pre>
<div class="sourceCode" id="cb3171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3171-1"><a href="drawing-maps-with-leaflet.html#cb3171-1"></a>wisc</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Appleton"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Beloit"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Fort.Atkinson"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Madison"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Marshfield"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Milwaukee"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Monroe"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["Superior"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["Wausau"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["Dubuque"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["St.Paul"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["Chicago"],"name":[13],"type":["dbl"],"align":["right"]}],"data":[{"1":"Appleton","2":"0","3":"130","4":"98","5":"102","6":"103","7":"100","8":"149","9":"315","10":"91","11":"196","12":"257","13":"186"},{"1":"Beloit","2":"130","3":"0","4":"33","5":"50","6":"185","7":"73","8":"33","9":"377","10":"186","11":"94","12":"304","13":"97"},{"1":"Fort.Atkinson","2":"98","3":"33","4":"0","5":"36","6":"164","7":"54","8":"58","9":"359","10":"166","11":"119","12":"287","13":"113"},{"1":"Madison","2":"102","3":"50","4":"36","5":"0","6":"138","7":"77","8":"47","9":"330","10":"139","11":"95","12":"258","13":"146"},{"1":"Marshfield","2":"103","3":"185","4":"164","5":"138","6":"0","7":"184","8":"170","9":"219","10":"45","11":"186","12":"161","13":"276"},{"1":"Milwaukee","2":"100","3":"73","4":"54","5":"77","6":"184","7":"0","8":"107","9":"394","10":"181","11":"168","12":"322","13":"92"},{"1":"Monroe","2":"149","3":"33","4":"58","5":"47","6":"170","7":"107","8":"0","9":"362","10":"186","11":"61","12":"289","13":"130"},{"1":"Superior","2":"315","3":"377","4":"359","5":"330","6":"219","7":"394","8":"362","9":"0","10":"223","11":"351","12":"162","13":"467"},{"1":"Wausau","2":"91","3":"186","4":"166","5":"139","6":"45","7":"181","8":"186","9":"223","10":"0","11":"215","12":"175","13":"275"},{"1":"Dubuque","2":"196","3":"94","4":"119","5":"95","6":"186","7":"168","8":"61","9":"351","10":"215","11":"0","12":"274","13":"184"},{"1":"St.Paul","2":"257","3":"304","4":"287","5":"258","6":"161","7":"322","8":"289","9":"162","10":"175","11":"274","12":"0","13":"395"},{"1":"Chicago","2":"186","3":"97","4":"113","5":"146","6":"276","7":"93","8":"130","9":"467","10":"275","11":"184","12":"395","13":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The first time I did this, I had a blank line on the end of the data
file, so I had a blank <code>location</code> and missing values for all
the distances for it. I tidied that up before sharing the file with
you, though.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Make a dataframe containing the names of the locations (get rid of the columns containing distances), and add a column of the abbreviations of the states they are in. All of them are in Wisconsin (WI), except for the
last three: Dubuque is in Iowa (IA), St. Paul is in Minnesota (MN) and Chicago
is in Illinois (IL).</li>
</ol>
<p>Solution</p>
<p>There seems to be a bit of base R attached to this, however you do it. I am going to create a dataframe pretending they are all in Wisconsin, and then fix it up afterwards:</p>
<div class="sourceCode" id="cb3172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3172-1"><a href="drawing-maps-with-leaflet.html#cb3172-1"></a>wisc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3172-2"><a href="drawing-maps-with-leaflet.html#cb3172-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">!</span><span class="kw">where</span>(is.numeric)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3172-3"><a href="drawing-maps-with-leaflet.html#cb3172-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="st">&quot;WI&quot;</span>) -&gt;<span class="st"> </span>wisc</span>
<span id="cb3172-4"><a href="drawing-maps-with-leaflet.html#cb3172-4"></a>wisc</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["state"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"Appleton","2":"WI"},{"1":"Beloit","2":"WI"},{"1":"Fort.Atkinson","2":"WI"},{"1":"Madison","2":"WI"},{"1":"Marshfield","2":"WI"},{"1":"Milwaukee","2":"WI"},{"1":"Monroe","2":"WI"},{"1":"Superior","2":"WI"},{"1":"Wausau","2":"WI"},{"1":"Dubuque","2":"WI"},{"1":"St.Paul","2":"WI"},{"1":"Chicago","2":"WI"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>(I checked that in this question I didn’t need the road distances for anything, so I saved it back into the original dataframe. Also, the <code>select</code> is unnecessarily fancy: I could have just selected the <code>location</code> column, but this one says “don’t select any of the columns that are numeric”.)</p>
<p>Now we have to fix up the states of the last three places, which is where the base R seems to come in (but see the Extra):</p>
<div class="sourceCode" id="cb3173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3173-1"><a href="drawing-maps-with-leaflet.html#cb3173-1"></a>wisc<span class="op">$</span>state[<span class="dv">10</span>] &lt;-<span class="st"> &quot;IA&quot;</span></span>
<span id="cb3173-2"><a href="drawing-maps-with-leaflet.html#cb3173-2"></a>wisc<span class="op">$</span>state[<span class="dv">11</span>] &lt;-<span class="st"> &quot;MN&quot;</span></span>
<span id="cb3173-3"><a href="drawing-maps-with-leaflet.html#cb3173-3"></a>wisc<span class="op">$</span>state[<span class="dv">12</span>] &lt;-<span class="st"> &quot;IL&quot;</span></span>
<span id="cb3173-4"><a href="drawing-maps-with-leaflet.html#cb3173-4"></a>wisc</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["state"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"Appleton","2":"WI"},{"1":"Beloit","2":"WI"},{"1":"Fort.Atkinson","2":"WI"},{"1":"Madison","2":"WI"},{"1":"Marshfield","2":"WI"},{"1":"Milwaukee","2":"WI"},{"1":"Monroe","2":"WI"},{"1":"Superior","2":"WI"},{"1":"Wausau","2":"WI"},{"1":"Dubuque","2":"IA"},{"1":"St.Paul","2":"MN"},{"1":"Chicago","2":"IL"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The states of the last three locations are now correct.</p>
<p>Extra: I didn’t know about this until literally just now, but there is a <code>tidyverse</code> way to do this as well (that may look familiar to those of you that know about SQL). Let’s start by pretending again that everything is in Wisconsin:</p>
<div class="sourceCode" id="cb3174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3174-1"><a href="drawing-maps-with-leaflet.html#cb3174-1"></a>wisc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3174-2"><a href="drawing-maps-with-leaflet.html#cb3174-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="st">&quot;WI&quot;</span>) -&gt;<span class="st"> </span>wisc2</span>
<span id="cb3174-3"><a href="drawing-maps-with-leaflet.html#cb3174-3"></a>wisc2</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["state"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"Appleton","2":"WI"},{"1":"Beloit","2":"WI"},{"1":"Fort.Atkinson","2":"WI"},{"1":"Madison","2":"WI"},{"1":"Marshfield","2":"WI"},{"1":"Milwaukee","2":"WI"},{"1":"Monroe","2":"WI"},{"1":"Superior","2":"WI"},{"1":"Wausau","2":"WI"},{"1":"Dubuque","2":"WI"},{"1":"St.Paul","2":"WI"},{"1":"Chicago","2":"WI"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>and then change the ones that need changing. What you do is to make a little dataframe of the ones that need changing:</p>
<div class="sourceCode" id="cb3175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3175-1"><a href="drawing-maps-with-leaflet.html#cb3175-1"></a>changes &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb3175-2"><a href="drawing-maps-with-leaflet.html#cb3175-2"></a>  <span class="op">~</span>location, <span class="op">~</span>state,</span>
<span id="cb3175-3"><a href="drawing-maps-with-leaflet.html#cb3175-3"></a>  <span class="st">&quot;Dubuque&quot;</span>, <span class="st">&quot;IA&quot;</span>,</span>
<span id="cb3175-4"><a href="drawing-maps-with-leaflet.html#cb3175-4"></a>  <span class="st">&quot;St.Paul&quot;</span>, <span class="st">&quot;MN&quot;</span>,</span>
<span id="cb3175-5"><a href="drawing-maps-with-leaflet.html#cb3175-5"></a>  <span class="st">&quot;Chicago&quot;</span>, <span class="st">&quot;IL&quot;</span></span>
<span id="cb3175-6"><a href="drawing-maps-with-leaflet.html#cb3175-6"></a>)</span>
<span id="cb3175-7"><a href="drawing-maps-with-leaflet.html#cb3175-7"></a>changes</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["state"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"Dubuque","2":"IA"},{"1":"St.Paul","2":"MN"},{"1":"Chicago","2":"IL"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Note that the columns in here have <em>exactly</em> the same names as the ones in the original dataframe where everything was in Wisconsin.</p>
<p>I did this by copy-pasting the city names whose states needed changing out of the display of my <code>wisc2</code>. You might think that a left join is what we need now, and it almost is. Note that I want to match the locations but <em>not</em> the states:</p>
<div class="sourceCode" id="cb3176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3176-1"><a href="drawing-maps-with-leaflet.html#cb3176-1"></a>wisc2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(changes, <span class="dt">by =</span> <span class="st">&quot;location&quot;</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["state.x"],"name":[2],"type":["chr"],"align":["left"]},{"label":["state.y"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"Appleton","2":"WI","3":"NA"},{"1":"Beloit","2":"WI","3":"NA"},{"1":"Fort.Atkinson","2":"WI","3":"NA"},{"1":"Madison","2":"WI","3":"NA"},{"1":"Marshfield","2":"WI","3":"NA"},{"1":"Milwaukee","2":"WI","3":"NA"},{"1":"Monroe","2":"WI","3":"NA"},{"1":"Superior","2":"WI","3":"NA"},{"1":"Wausau","2":"WI","3":"NA"},{"1":"Dubuque","2":"WI","3":"IA"},{"1":"St.Paul","2":"WI","3":"MN"},{"1":"Chicago","2":"WI","3":"IL"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>and the story here is that if <code>state.y</code> has a value, use that, otherwise use the value in <code>state.x</code>. This can even be done: there is a function <code>coalesce</code> that will do exactly that:</p>
<p><label for="tufte-mn-256" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-256" class="margin-toggle"><span class="marginnote">I knew this existed, but I couldn’t remember what it was called, which made it hard to search for. My first port of call was { t na-if}, which converts values to NA, the opposite of what I wanted. But from See Also I got { t na-replace}, and from the See Also of that, I found out what { t coalesce} does.</span></p>
<div class="sourceCode" id="cb3177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3177-1"><a href="drawing-maps-with-leaflet.html#cb3177-1"></a>wisc2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(changes, <span class="dt">by =</span> <span class="st">&quot;location&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3177-2"><a href="drawing-maps-with-leaflet.html#cb3177-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state=</span><span class="kw">coalesce</span>(state.y, state.x))</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["state.x"],"name":[2],"type":["chr"],"align":["left"]},{"label":["state.y"],"name":[3],"type":["chr"],"align":["left"]},{"label":["state"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"Appleton","2":"WI","3":"NA","4":"WI"},{"1":"Beloit","2":"WI","3":"NA","4":"WI"},{"1":"Fort.Atkinson","2":"WI","3":"NA","4":"WI"},{"1":"Madison","2":"WI","3":"NA","4":"WI"},{"1":"Marshfield","2":"WI","3":"NA","4":"WI"},{"1":"Milwaukee","2":"WI","3":"NA","4":"WI"},{"1":"Monroe","2":"WI","3":"NA","4":"WI"},{"1":"Superior","2":"WI","3":"NA","4":"WI"},{"1":"Wausau","2":"WI","3":"NA","4":"WI"},{"1":"Dubuque","2":"WI","3":"IA","4":"IA"},{"1":"St.Paul","2":"WI","3":"MN","4":"MN"},{"1":"Chicago","2":"WI","3":"IL","4":"IL"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The idea behind <code>coalesce</code> is that you give it a list of columns, and the first one of those that is <em>not missing</em> gives its value to the new column. So I feed it <code>state.y</code> <em>first</em>, and then <code>state.x</code>, and the new <code>state</code> contains the right things. (Can you explain what happens if you do it the other way around?)</p>
<p>But, there is a better way. Let’s go back to our all-Wisconsin dataframe:</p>
<div class="sourceCode" id="cb3178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3178-1"><a href="drawing-maps-with-leaflet.html#cb3178-1"></a>wisc2</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["state"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"Appleton","2":"WI"},{"1":"Beloit","2":"WI"},{"1":"Fort.Atkinson","2":"WI"},{"1":"Madison","2":"WI"},{"1":"Marshfield","2":"WI"},{"1":"Milwaukee","2":"WI"},{"1":"Monroe","2":"WI"},{"1":"Superior","2":"WI"},{"1":"Wausau","2":"WI"},{"1":"Dubuque","2":"WI"},{"1":"St.Paul","2":"WI"},{"1":"Chicago","2":"WI"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>and our dataframe of corrections to make:</p>
<div class="sourceCode" id="cb3179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3179-1"><a href="drawing-maps-with-leaflet.html#cb3179-1"></a>changes</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["state"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"Dubuque","2":"IA"},{"1":"St.Paul","2":"MN"},{"1":"Chicago","2":"IL"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>We can make those changes in one step, thus:</p>
<div class="sourceCode" id="cb3180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3180-1"><a href="drawing-maps-with-leaflet.html#cb3180-1"></a>wisc2 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3180-2"><a href="drawing-maps-with-leaflet.html#cb3180-2"></a><span class="st">  </span><span class="kw">rows_update</span>(changes) -&gt;<span class="st"> </span>wisc</span></code></pre></div>
<pre><code>## Matching, by = &quot;location&quot;</code></pre>
<div class="sourceCode" id="cb3182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3182-1"><a href="drawing-maps-with-leaflet.html#cb3182-1"></a>wisc</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["state"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"Appleton","2":"WI"},{"1":"Beloit","2":"WI"},{"1":"Fort.Atkinson","2":"WI"},{"1":"Madison","2":"WI"},{"1":"Marshfield","2":"WI"},{"1":"Milwaukee","2":"WI"},{"1":"Monroe","2":"WI"},{"1":"Superior","2":"WI"},{"1":"Wausau","2":"WI"},{"1":"Dubuque","2":"IA"},{"1":"St.Paul","2":"MN"},{"1":"Chicago","2":"IL"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This works because the <em>first</em> column of <code>changes</code>, namely <code>location</code>, is the one that is looked up in <code>wisc2</code>. (<code>rows_update</code> has a <code>by</code> in the same way that <code>left_join</code> does if you want to change this.) So all three locations in <code>changes</code> are looked up in <code>wisc2</code>, and any that match have their <code>state</code> changed to the one in <code>changes</code>.</p>
<p>Magic. Now that I have learned about this, I will be using it a lot.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Create a new column in which the abbreviation for the state is glued on to the end of each <code>location</code>, separated by a space.</li>
</ol>
<p>Solution</p>
<p>A couple of ways: a literal gluing, using <code>paste</code>:</p>
<div class="sourceCode" id="cb3183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3183-1"><a href="drawing-maps-with-leaflet.html#cb3183-1"></a>wisc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3183-2"><a href="drawing-maps-with-leaflet.html#cb3183-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lookup =</span> <span class="kw">paste</span>(location, state))</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["state"],"name":[2],"type":["chr"],"align":["left"]},{"label":["lookup"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"Appleton","2":"WI","3":"Appleton WI"},{"1":"Beloit","2":"WI","3":"Beloit WI"},{"1":"Fort.Atkinson","2":"WI","3":"Fort.Atkinson WI"},{"1":"Madison","2":"WI","3":"Madison WI"},{"1":"Marshfield","2":"WI","3":"Marshfield WI"},{"1":"Milwaukee","2":"WI","3":"Milwaukee WI"},{"1":"Monroe","2":"WI","3":"Monroe WI"},{"1":"Superior","2":"WI","3":"Superior WI"},{"1":"Wausau","2":"WI","3":"Wausau WI"},{"1":"Dubuque","2":"IA","3":"Dubuque IA"},{"1":"St.Paul","2":"MN","3":"St.Paul MN"},{"1":"Chicago","2":"IL","3":"Chicago IL"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>or the same idea using <code>str_c</code> from <code>stringr</code> (part of the tidyverse), only this time you have to supply the space yourself:</p>
<div class="sourceCode" id="cb3184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3184-1"><a href="drawing-maps-with-leaflet.html#cb3184-1"></a>wisc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3184-2"><a href="drawing-maps-with-leaflet.html#cb3184-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lookup =</span> <span class="kw">str_c</span>(location, <span class="st">&quot; &quot;</span>, state))</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["location"],"name":[1],"type":["chr"],"align":["left"]},{"label":["state"],"name":[2],"type":["chr"],"align":["left"]},{"label":["lookup"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"Appleton","2":"WI","3":"Appleton WI"},{"1":"Beloit","2":"WI","3":"Beloit WI"},{"1":"Fort.Atkinson","2":"WI","3":"Fort.Atkinson WI"},{"1":"Madison","2":"WI","3":"Madison WI"},{"1":"Marshfield","2":"WI","3":"Marshfield WI"},{"1":"Milwaukee","2":"WI","3":"Milwaukee WI"},{"1":"Monroe","2":"WI","3":"Monroe WI"},{"1":"Superior","2":"WI","3":"Superior WI"},{"1":"Wausau","2":"WI","3":"Wausau WI"},{"1":"Dubuque","2":"IA","3":"Dubuque IA"},{"1":"St.Paul","2":"MN","3":"St.Paul MN"},{"1":"Chicago","2":"IL","3":"Chicago IL"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>or a way you might have forgotten, using <code>unite</code> (which is the inverse of <code>separate</code>):</p>
<div class="sourceCode" id="cb3185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3185-1"><a href="drawing-maps-with-leaflet.html#cb3185-1"></a>wisc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3185-2"><a href="drawing-maps-with-leaflet.html#cb3185-2"></a><span class="st">  </span><span class="kw">unite</span>(lookup, <span class="kw">c</span>(location, state), <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) -&gt;<span class="st"> </span>wisc</span>
<span id="cb3185-3"><a href="drawing-maps-with-leaflet.html#cb3185-3"></a>wisc</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["lookup"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"Appleton WI"},{"1":"Beloit WI"},{"1":"Fort.Atkinson WI"},{"1":"Madison WI"},{"1":"Marshfield WI"},{"1":"Milwaukee WI"},{"1":"Monroe WI"},{"1":"Superior WI"},{"1":"Wausau WI"},{"1":"Dubuque IA"},{"1":"St.Paul MN"},{"1":"Chicago IL"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This last one is my favourite, because it gets rid of the two constituent columns <code>location</code> and <code>state</code> that we don’t need any more. The syntax is the name of the new column, a vector of columns to unite together, and (optionally) what to separate the joined-together values with. The default for that is an underscore, but here we want a space because that’s what the geocoder (coming up) expects.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Look up the latitudes and longitudes of these twelve places.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb3186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3186-1"><a href="drawing-maps-with-leaflet.html#cb3186-1"></a>wisc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3186-2"><a href="drawing-maps-with-leaflet.html#cb3186-2"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3186-3"><a href="drawing-maps-with-leaflet.html#cb3186-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ll =</span> <span class="kw">list</span>(<span class="kw">geocode_OSM</span>(lookup))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3186-4"><a href="drawing-maps-with-leaflet.html#cb3186-4"></a><span class="st">  </span><span class="kw">unnest_wider</span>(ll) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3186-5"><a href="drawing-maps-with-leaflet.html#cb3186-5"></a><span class="st">  </span><span class="kw">unnest_wider</span>(coords) -&gt;<span class="st"> </span>wisc</span>
<span id="cb3186-6"><a href="drawing-maps-with-leaflet.html#cb3186-6"></a>wisc</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["lookup"],"name":[1],"type":["chr"],"align":["left"]},{"label":["query"],"name":[2],"type":["chr"],"align":["left"]},{"label":["x"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["y"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["bbox"],"name":[5],"type":["list"],"align":["right"]}],"data":[{"1":"Appleton WI","2":"Appleton WI","3":"-88.40676","4":"44.26113","5":"<bbox>"},{"1":"Beloit WI","2":"Beloit WI","3":"-89.03178","4":"42.50833","5":"<bbox>"},{"1":"Fort.Atkinson WI","2":"Fort.Atkinson WI","3":"-88.83705","4":"42.92889","5":"<bbox>"},{"1":"Madison WI","2":"Madison WI","3":"-89.38376","4":"43.07476","5":"<bbox>"},{"1":"Marshfield WI","2":"Marshfield WI","3":"-90.17180","4":"44.66885","5":"<bbox>"},{"1":"Milwaukee WI","2":"Milwaukee WI","3":"-87.92250","4":"43.03499","5":"<bbox>"},{"1":"Monroe WI","2":"Monroe WI","3":"-89.58521","4":"42.61366","5":"<bbox>"},{"1":"Superior WI","2":"Superior WI","3":"-92.11744","4":"46.62332","5":"<bbox>"},{"1":"Wausau WI","2":"Wausau WI","3":"-89.62982","4":"44.95960","5":"<bbox>"},{"1":"Dubuque IA","2":"Dubuque IA","3":"-90.66480","4":"42.50062","5":"<bbox>"},{"1":"St.Paul MN","2":"St.Paul MN","3":"-93.10150","4":"44.95040","5":"<bbox>"},{"1":"Chicago IL","2":"Chicago IL","3":"-87.62442","4":"41.87556","5":"<bbox>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Yes, I forgot the <code>rowwise</code> as well the first time.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Obtain a Leaflet map of the area containing these
twelve cities.</li>
</ol>
<p>Solution</p>
<p>The usual:</p>
<div class="sourceCode" id="cb3187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3187-1"><a href="drawing-maps-with-leaflet.html#cb3187-1"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> wisc) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3187-2"><a href="drawing-maps-with-leaflet.html#cb3187-2"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3187-3"><a href="drawing-maps-with-leaflet.html#cb3187-3"></a><span class="st">  </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> <span class="op">~</span>x, <span class="dt">lat =</span> <span class="op">~</span>y) -&gt;<span class="st"> </span>locs</span>
<span id="cb3187-4"><a href="drawing-maps-with-leaflet.html#cb3187-4"></a>locs</span></code></pre></div>
<div id="htmlwidget-a09c5a54e667a41682cc" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-a09c5a54e667a41682cc">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[44.2611337,42.5083272,42.9288944,43.074761,44.6688524,43.0349931,42.6136586,46.623324,44.9596017,42.5006217,44.9504037,41.8755616],[-88.4067604,-89.031784,-88.8370509,-89.3837613,-90.1717987,-87.922497,-89.5852052208876,-92.117435,-89.6298239,-90.6647967,-93.1015026,-87.6244212],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[41.8755616,46.623324],"lng":[-93.1015026,-87.6244212]}},"evals":[],"jsHooks":[]}</script>
<p>The nice thing about this map is that you can play with it: zoom it (using the plus/minus on the map or your mouse wheel), or move it around by clicking and dragging. To identify the cities: well, the big ones are obvious, and you can zoom in to identify the others. (You have to zoom in quite a long way to find Monroe, and the geocoder seems to have found its airport, which is not actually in the city.)</p>
<p>I like identifying the cities with circles, but there are other possibilities, such as “icon markers” that look like Google map pins:</p>
<div class="sourceCode" id="cb3188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3188-1"><a href="drawing-maps-with-leaflet.html#cb3188-1"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> wisc) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3188-2"><a href="drawing-maps-with-leaflet.html#cb3188-2"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3188-3"><a href="drawing-maps-with-leaflet.html#cb3188-3"></a><span class="st">  </span><span class="kw">addMarkers</span>(<span class="dt">lng =</span> <span class="op">~</span>x, <span class="dt">lat =</span> <span class="op">~</span>y) -&gt;<span class="st"> </span>locs</span>
<span id="cb3188-4"><a href="drawing-maps-with-leaflet.html#cb3188-4"></a>locs</span></code></pre></div>
<div id="htmlwidget-cb601343e4ede037e3ef" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-cb601343e4ede037e3ef">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[[44.2611337,42.5083272,42.9288944,43.074761,44.6688524,43.0349931,42.6136586,46.623324,44.9596017,42.5006217,44.9504037,41.8755616],[-88.4067604,-89.031784,-88.8370509,-89.3837613,-90.1717987,-87.922497,-89.5852052208876,-92.117435,-89.6298239,-90.6647967,-93.1015026,-87.6244212],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[41.8755616,46.623324],"lng":[-93.1015026,-87.6244212]}},"evals":[],"jsHooks":[]}</script>
<p>You can even attach text to the markers that appears when you click on them, but that’s farther than I would go here.</p>

</div>
</div>
<p style="text-align: center;">
<a href="cluster-analysis.html"><button class="btn btn-default">Previous</button></a>
<a href="multidimensional-scaling.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
