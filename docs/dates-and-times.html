<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Problems and Solutions in Applied Statistics" />
<meta property="og:type" content="book" />
<meta property="og:url" content="<a href="http://ritsokiguess.site/pasias" class="uri">http://ritsokiguess.site/pasias</a>" />

<meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
<meta name="github-repo" content="nxskok/pasias" />

<meta name="author" content="Ken Butler" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics">

<title>Problems and Solutions in Applied Statistics</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li class="has-sub"><a href="getting-used-to-r-and-r-studio.html#getting-used-to-r-and-r-studio"><span class="toc-section-number">2</span> Getting used to R and R Studio</a><ul>
<li><a href="getting-used-to-r-and-r-studio.html#getting-an-r-studio-cloud-account"><span class="toc-section-number">2.1</span> Getting an R Studio Cloud account</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#getting-started"><span class="toc-section-number">2.2</span> Getting started</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#reading-data-from-a-file"><span class="toc-section-number">2.3</span> Reading data from a file</a></li>
</ul></li>
<li class="has-sub"><a href="reading-in-data-and-drawing-some-graphs.html#reading-in-data-and-drawing-some-graphs"><span class="toc-section-number">3</span> Reading in data and drawing some graphs</a><ul>
<li><a href="reading-in-data-and-drawing-some-graphs.html#orange-juice"><span class="toc-section-number">3.1</span> Orange juice</a></li>
<li><a href="reading-in-data-and-drawing-some-graphs.html#making-soap"><span class="toc-section-number">3.2</span> Making soap</a></li>
<li><a href="reading-in-data-and-drawing-some-graphs.html#handling-shipments"><span class="toc-section-number">3.3</span> Handling shipments</a></li>
</ul></li>
<li class="has-sub"><a href="data-exploration.html#data-exploration"><span class="toc-section-number">4</span> Data exploration</a><ul>
<li><a href="data-exploration.html#north-carolina-births"><span class="toc-section-number">4.1</span> North Carolina births</a></li>
<li><a href="data-exploration.html#more-about-the-nc-births"><span class="toc-section-number">4.2</span> More about the NC births</a></li>
<li><a href="data-exploration.html#nenana-alaska"><span class="toc-section-number">4.3</span> Nenana, Alaska</a></li>
<li><a href="data-exploration.html#computerized-accounting"><span class="toc-section-number">4.4</span> Computerized accounting</a></li>
<li><a href="data-exploration.html#test-scores-in-two-classes"><span class="toc-section-number">4.5</span> Test scores in two classes</a></li>
</ul></li>
<li class="has-sub"><a href="one-sample-inference.html#one-sample-inference"><span class="toc-section-number">5</span> One-sample inference</a><ul>
<li><a href="one-sample-inference.html#hunter-gatherers-in-australia"><span class="toc-section-number">5.1</span> Hunter-gatherers in Australia</a></li>
<li><a href="one-sample-inference.html#buses-to-boulder"><span class="toc-section-number">5.2</span> Buses to Boulder</a></li>
<li><a href="one-sample-inference.html#length-of-gestation-in-north-carolina"><span class="toc-section-number">5.3</span> Length of gestation in North Carolina</a></li>
<li><a href="one-sample-inference.html#inferring-ice-break-up-in-nenana"><span class="toc-section-number">5.4</span> Inferring ice break-up in Nenana</a></li>
</ul></li>
<li class="has-sub"><a href="two-sample-inference.html#two-sample-inference"><span class="toc-section-number">6</span> Two-sample inference</a><ul>
<li><a href="two-sample-inference.html#children-and-electronic-devices"><span class="toc-section-number">6.1</span> Children and electronic devices</a></li>
<li><a href="two-sample-inference.html#parking-close-to-the-curb"><span class="toc-section-number">6.2</span> Parking close to the curb</a></li>
<li><a href="two-sample-inference.html#bell-peppers-and-too-much-water"><span class="toc-section-number">6.3</span> Bell peppers and too much water</a></li>
<li><a href="two-sample-inference.html#exercise-and-anxiety-and-bullying-mice"><span class="toc-section-number">6.4</span> Exercise and anxiety and bullying mice</a></li>
<li><a href="two-sample-inference.html#diet-and-growth-in-boys"><span class="toc-section-number">6.5</span> Diet and growth in boys</a></li>
</ul></li>
<li class="has-sub"><a href="power-and-sample-size.html#power-and-sample-size"><span class="toc-section-number">7</span> Power and sample size</a><ul>
<li><a href="power-and-sample-size.html#simulating-power"><span class="toc-section-number">7.1</span> Simulating power</a></li>
<li><a href="power-and-sample-size.html#calculating-power-and-sample-size-for-estimating-mean"><span class="toc-section-number">7.2</span> Calculating power and sample size for estimating mean</a></li>
<li><a href="power-and-sample-size.html#simulating-power-for-proportions"><span class="toc-section-number">7.3</span> Simulating power for proportions</a></li>
</ul></li>
<li class="has-sub"><a href="the-sign-test-and-moods-median-test.html#the-sign-test-and-moods-median-test"><span class="toc-section-number">8</span> The sign test and Mood’s median test</a><ul>
<li><a href="the-sign-test-and-moods-median-test.html#running-a-maze"><span class="toc-section-number">8.1</span> Running a maze</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#chocolate-chips"><span class="toc-section-number">8.2</span> Chocolate chips</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#the-power-of-the-sign-test"><span class="toc-section-number">8.3</span> The power of the sign test</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#sugar-in-breakfast-cereals"><span class="toc-section-number">8.4</span> Sugar in breakfast cereals</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#fear-of-math"><span class="toc-section-number">8.5</span> Fear of math</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#medical-instructions"><span class="toc-section-number">8.6</span> Medical instructions</a></li>
</ul></li>
<li class="has-sub"><a href="matched-pairs-t-and-sign-test.html#matched-pairs-t-and-sign-test"><span class="toc-section-number">9</span> Matched pairs t and sign test</a><ul>
<li><a href="matched-pairs-t-and-sign-test.html#measuring-body-fat"><span class="toc-section-number">9.1</span> Measuring body fat</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#throwing-baseballs-and-softballs"><span class="toc-section-number">9.2</span> Throwing baseballs and softballs</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#throwing-baseballs-and-softballs-again"><span class="toc-section-number">9.3</span> Throwing baseballs and softballs, again</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#changes-in-salary"><span class="toc-section-number">9.4</span> Changes in salary</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#body-fat-revisited"><span class="toc-section-number">9.5</span> Body fat revisited</a></li>
</ul></li>
<li class="has-sub"><a href="normal-quantile-plots.html#normal-quantile-plots"><span class="toc-section-number">10</span> Normal quantile plots</a><ul>
<li><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers"><span class="toc-section-number">10.1</span> Lengths of heliconia flowers</a></li>
<li><a href="normal-quantile-plots.html#ferritin-and-normality"><span class="toc-section-number">10.2</span> Ferritin and normality</a></li>
</ul></li>
<li class="has-sub"><a href="analysis-of-variance.html#analysis-of-variance"><span class="toc-section-number">11</span> Analysis of variance</a><ul>
<li><a href="analysis-of-variance.html#movie-ratings-and-lengths"><span class="toc-section-number">11.1</span> Movie ratings and lengths</a></li>
<li><a href="analysis-of-variance.html#deer-and-how-much-they-eat"><span class="toc-section-number">11.2</span> Deer and how much they eat</a></li>
<li><a href="analysis-of-variance.html#movie-ratings-again"><span class="toc-section-number">11.3</span> Movie ratings again</a></li>
<li><a href="analysis-of-variance.html#atomic-weight-of-carbon"><span class="toc-section-number">11.4</span> Atomic weight of carbon</a></li>
<li><a href="analysis-of-variance.html#can-caffeine-improve-your-performance-on-a-test"><span class="toc-section-number">11.5</span> Can caffeine improve your performance on a test?</a></li>
</ul></li>
<li class="has-sub"><a href="tidying-and-selecting-data.html#tidying-and-selecting-data"><span class="toc-section-number">12</span> Tidying and selecting data</a><ul>
<li><a href="tidying-and-selecting-data.html#tidying-the-jays-data"><span class="toc-section-number">12.1</span> Tidying the Jays data</a></li>
<li><a href="tidying-and-selecting-data.html#baseball-and-softball-spaghetti"><span class="toc-section-number">12.2</span> Baseball and softball spaghetti</a></li>
<li><a href="tidying-and-selecting-data.html#ethanol-and-sleep-time-in-rats"><span class="toc-section-number">12.3</span> Ethanol and sleep time in rats</a></li>
<li><a href="tidying-and-selecting-data.html#growth-of-tomatoes"><span class="toc-section-number">12.4</span> Growth of tomatoes</a></li>
<li><a href="tidying-and-selecting-data.html#pain-relief-in-migraine-headaches-again"><span class="toc-section-number">12.5</span> Pain relief in migraine headaches (again)</a></li>
<li><a href="tidying-and-selecting-data.html#location-species-and-disease-in-plants"><span class="toc-section-number">12.6</span> Location, species and disease in plants</a></li>
<li><a href="tidying-and-selecting-data.html#mating-songs-in-crickets"><span class="toc-section-number">12.7</span> Mating songs in crickets</a></li>
<li><a href="tidying-and-selecting-data.html#cars"><span class="toc-section-number">12.8</span> Cars</a></li>
<li><a href="tidying-and-selecting-data.html#number-1-songs"><span class="toc-section-number">12.9</span> Number 1 songs</a></li>
<li><a href="tidying-and-selecting-data.html#bikes-on-college"><span class="toc-section-number">12.10</span> Bikes on College</a></li>
<li><a href="tidying-and-selecting-data.html#feeling-the-heat"><span class="toc-section-number">12.11</span> Feeling the heat</a></li>
</ul></li>
<li class="has-sub"><a href="regression.html#regression"><span class="toc-section-number">13</span> Regression</a><ul>
<li><a href="regression.html#rainfall-in-california"><span class="toc-section-number">13.1</span> Rainfall in California</a></li>
<li><a href="regression.html#carbon-monoxide-in-cigarettes"><span class="toc-section-number">13.2</span> Carbon monoxide in cigarettes</a></li>
<li><a href="regression.html#maximal-oxygen-uptake-in-young-boys"><span class="toc-section-number">13.3</span> Maximal oxygen uptake in young boys</a></li>
<li><a href="regression.html#facebook-friends-and-grey-matter"><span class="toc-section-number">13.4</span> Facebook friends and grey matter</a></li>
<li><a href="regression.html#endogenous-nitrogen-excretion-in-carp"><span class="toc-section-number">13.5</span> Endogenous nitrogen excretion in carp</a></li>
<li><a href="regression.html#sparrowhawks"><span class="toc-section-number">13.6</span> Sparrowhawks</a></li>
<li><a href="regression.html#salaries-of-social-workers"><span class="toc-section-number">13.7</span> Salaries of social workers</a></li>
<li><a href="regression.html#predicting-volume-of-wood-in-pine-trees"><span class="toc-section-number">13.8</span> Predicting volume of wood in pine trees</a></li>
<li><a href="regression.html#tortoise-shells-and-eggs"><span class="toc-section-number">13.9</span> Tortoise shells and eggs</a></li>
<li><a href="regression.html#crickets-revisited"><span class="toc-section-number">13.10</span> Crickets revisited</a></li>
<li><a href="regression.html#roller-coasters"><span class="toc-section-number">13.11</span> Roller coasters</a></li>
<li><a href="regression.html#running-and-blood-sugar"><span class="toc-section-number">13.12</span> Running and blood sugar</a></li>
<li><a href="regression.html#calories-and-fat-in-pizza"><span class="toc-section-number">13.13</span> Calories and fat in pizza</a></li>
<li><a href="regression.html#where-should-the-fire-stations-be"><span class="toc-section-number">13.14</span> Where should the fire stations be?</a></li>
<li><a href="regression.html#being-satisfied-with-hospital"><span class="toc-section-number">13.15</span> Being satisfied with hospital</a></li>
<li><a href="regression.html#handling-shipments-of-chemicals"><span class="toc-section-number">13.16</span> Handling shipments of chemicals</a></li>
<li><a href="regression.html#salaries-of-mathematicians"><span class="toc-section-number">13.17</span> Salaries of mathematicians</a></li>
<li><a href="regression.html#predicting-gpa-of-computer-science-students"><span class="toc-section-number">13.18</span> Predicting GPA of computer science students</a></li>
</ul></li>
<li class="has-sub"><a href="dates-and-times.html#dates-and-times"><span class="toc-section-number">14</span> Dates and times</a><ul>
<li><a href="dates-and-times.html#dealing-with-dates-in-the-worcester-heart-attack-study"><span class="toc-section-number">14.1</span> Dealing with dates in the Worcester Heart Attack study</a></li>
<li><a href="dates-and-times.html#growth-of-mizuna-lettuce-seeds"><span class="toc-section-number">14.2</span> Growth of Mizuna lettuce seeds</a></li>
<li><a href="dates-and-times.html#types-of-childbirth"><span class="toc-section-number">14.3</span> Types of childbirth</a></li>
<li><a href="dates-and-times.html#wolves-and-caribou"><span class="toc-section-number">14.4</span> Wolves and caribou</a></li>
</ul></li>
<li class="has-sub"><a href="functions.html#functions"><span class="toc-section-number">15</span> Functions</a><ul>
<li><a href="functions.html#making-some-r-functions"><span class="toc-section-number">15.1</span> Making some R functions</a></li>
<li><a href="functions.html#the-collatz-sequence"><span class="toc-section-number">15.2</span> The Collatz sequence</a></li>
</ul></li>
<li class="has-sub"><a href="logistic-regression.html#logistic-regression"><span class="toc-section-number">16</span> Logistic regression</a><ul>
<li><a href="logistic-regression.html#finding-wolf-spiders-on-the-beach"><span class="toc-section-number">16.1</span> Finding wolf spiders on the beach</a></li>
<li><a href="logistic-regression.html#killing-aphids"><span class="toc-section-number">16.2</span> Killing aphids</a></li>
<li><a href="logistic-regression.html#the-effects-of-substance-a"><span class="toc-section-number">16.3</span> The effects of Substance A</a></li>
<li><a href="logistic-regression.html#what-makes-an-animal-get-infected"><span class="toc-section-number">16.4</span> What makes an animal get infected?</a></li>
<li><a href="logistic-regression.html#the-brain-of-a-cat"><span class="toc-section-number">16.5</span> The brain of a cat</a></li>
<li><a href="logistic-regression.html#how-not-to-get-heart-disease"><span class="toc-section-number">16.6</span> How not to get heart disease</a></li>
<li><a href="logistic-regression.html#successful-breastfeeding"><span class="toc-section-number">16.7</span> Successful breastfeeding</a></li>
<li><a href="logistic-regression.html#making-it-over-the-mountains"><span class="toc-section-number">16.8</span> Making it over the mountains</a></li>
<li><a href="logistic-regression.html#who-needs-the-most-intensive-care"><span class="toc-section-number">16.9</span> Who needs the most intensive care?</a></li>
<li><a href="logistic-regression.html#go-away-and-dont-come-back"><span class="toc-section-number">16.10</span> Go away and don’t come back!</a></li>
</ul></li>
<li class="has-sub"><a href="logistic-regression-with-ordinal-or-nominal-response.html#logistic-regression-with-ordinal-or-nominal-response"><span class="toc-section-number">17</span> Logistic regression with ordinal or nominal response</a><ul>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#do-you-like-your-mobile-phone"><span class="toc-section-number">17.1</span> Do you like your mobile phone?</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#attitudes-towards-abortion"><span class="toc-section-number">17.2</span> Attitudes towards abortion</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#finding-non-missing-values"><span class="toc-section-number">17.3</span> Finding non-missing values</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#european-social-survey-and-voting"><span class="toc-section-number">17.4</span> European Social Survey and voting</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#alligator-food"><span class="toc-section-number">17.5</span> Alligator food</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#how-do-you-like-your-steak-the-data"><span class="toc-section-number">17.6</span> How do you like your steak – the data</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#crimes-in-san-francisco-the-data"><span class="toc-section-number">17.7</span> Crimes in San Francisco – the data</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#how-do-you-like-your-steak"><span class="toc-section-number">17.8</span> How do you like your steak?</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#crimes-in-san-francisco"><span class="toc-section-number">17.9</span> Crimes in San Francisco</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#high-school-and-beyond"><span class="toc-section-number">17.10</span> High School and Beyond</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#what-sports-do-these-athletes-play"><span class="toc-section-number">17.11</span> What sports do these athletes play?</a></li>
</ul></li>
<li class="has-sub"><a href="survival-analysis.html#survival-analysis"><span class="toc-section-number">18</span> Survival analysis</a><ul>
<li><a href="survival-analysis.html#the-worcester-survey"><span class="toc-section-number">18.1</span> The Worcester survey</a></li>
<li><a href="survival-analysis.html#drug-treatment-programs"><span class="toc-section-number">18.2</span> Drug treatment programs</a></li>
<li><a href="survival-analysis.html#multiple-myeloma"><span class="toc-section-number">18.3</span> Multiple myeloma</a></li>
<li><a href="survival-analysis.html#ovarian-cancer"><span class="toc-section-number">18.4</span> Ovarian cancer</a></li>
</ul></li>
<li class="has-sub"><a href="analysis-of-variance-revisited.html#analysis-of-variance-revisited"><span class="toc-section-number">19</span> Analysis of Variance revisited</a><ul>
<li><a href="analysis-of-variance-revisited.html#focused-comparisons-of-the-effect-of-caffeine"><span class="toc-section-number">19.1</span> Focused comparisons of the effect of caffeine</a></li>
<li><a href="analysis-of-variance-revisited.html#who-studies-the-most-outside-class"><span class="toc-section-number">19.2</span> Who studies the most outside class?</a></li>
<li><a href="analysis-of-variance-revisited.html#mental-context"><span class="toc-section-number">19.3</span> Mental context</a></li>
<li><a href="analysis-of-variance-revisited.html#trying-on-shirts"><span class="toc-section-number">19.4</span> Trying on shirts</a></li>
<li><a href="analysis-of-variance-revisited.html#productivity-and-research-and-development"><span class="toc-section-number">19.5</span> Productivity and research-and-development</a></li>
<li><a href="analysis-of-variance-revisited.html#treating-leprosy"><span class="toc-section-number">19.6</span> Treating leprosy</a></li>
<li><a href="analysis-of-variance-revisited.html#do-characteristics-of-urine-depend-on-obesity"><span class="toc-section-number">19.7</span> Do characteristics of urine depend on obesity?</a></li>
</ul></li>
<li class="has-sub"><a href="multivariate-analysis-of-variance.html#multivariate-analysis-of-variance"><span class="toc-section-number">20</span> Multivariate analysis of variance</a><ul>
<li><a href="multivariate-analysis-of-variance.html#fabricated-data"><span class="toc-section-number">20.1</span> Fabricated data</a></li>
<li><a href="multivariate-analysis-of-variance.html#do-characteristics-of-urine-depend-on-obesity-1"><span class="toc-section-number">20.2</span> Do characteristics of urine depend on obesity?</a></li>
<li><a href="multivariate-analysis-of-variance.html#how-do-height-and-weight-depend-on-sport-played-by-elite-athletes"><span class="toc-section-number">20.3</span> How do height and weight depend on sport played by elite athletes?</a></li>
</ul></li>
<li class="has-sub"><a href="repeated-measures.html#repeated-measures"><span class="toc-section-number">21</span> Repeated measures</a><ul>
<li><a href="repeated-measures.html#effect-of-drug-on-rat-weight"><span class="toc-section-number">21.1</span> Effect of drug on rat weight</a></li>
<li><a href="repeated-measures.html#social-interaction-among-old-people"><span class="toc-section-number">21.2</span> Social interaction among old people</a></li>
<li><a href="repeated-measures.html#childrens-stress-levels-and-airports"><span class="toc-section-number">21.3</span> Children’s stress levels and airports</a></li>
<li><a href="repeated-measures.html#investigating-motor-activity-in-rats"><span class="toc-section-number">21.4</span> Investigating motor activity in rats</a></li>
<li><a href="repeated-measures.html#repeated-measures-with-no-background"><span class="toc-section-number">21.5</span> Repeated measures with no background</a></li>
</ul></li>
<li class="has-sub"><a href="discriminant-analysis.html#discriminant-analysis"><span class="toc-section-number">22</span> Discriminant analysis</a><ul>
<li><a href="discriminant-analysis.html#telling-whether-a-banknote-is-real-or-counterfeit"><span class="toc-section-number">22.1</span> Telling whether a banknote is real or counterfeit</a></li>
<li><a href="discriminant-analysis.html#urine-and-obesity-what-makes-a-difference"><span class="toc-section-number">22.2</span> Urine and obesity: what makes a difference?</a></li>
<li><a href="discriminant-analysis.html#understanding-a-manova"><span class="toc-section-number">22.3</span> Understanding a MANOVA</a></li>
<li><a href="discriminant-analysis.html#what-distinguishes-people-who-do-different-jobs"><span class="toc-section-number">22.4</span> What distinguishes people who do different jobs?</a></li>
<li><a href="discriminant-analysis.html#observing-children-with-adhd"><span class="toc-section-number">22.5</span> Observing children with ADHD</a></li>
<li><a href="discriminant-analysis.html#growing-corn"><span class="toc-section-number">22.6</span> Growing corn</a></li>
<li><a href="discriminant-analysis.html#understanding-athletes-height-weight-sport-and-gender"><span class="toc-section-number">22.7</span> Understanding athletes’ height, weight, sport and gender</a></li>
</ul></li>
<li class="has-sub"><a href="cluster-analysis.html#cluster-analysis"><span class="toc-section-number">23</span> Cluster analysis</a><ul>
<li><a href="cluster-analysis.html#dissimilarities-between-fruits"><span class="toc-section-number">23.1</span> Dissimilarities between fruits</a></li>
<li><a href="cluster-analysis.html#similarity-of-species"><span class="toc-section-number">23.2</span> Similarity of species</a></li>
<li><a href="cluster-analysis.html#rating-beer"><span class="toc-section-number">23.3</span> Rating beer</a></li>
<li><a href="cluster-analysis.html#sites-on-the-sea-bed"><span class="toc-section-number">23.4</span> Sites on the sea bed</a></li>
<li><a href="cluster-analysis.html#clustering-the-swiss-bills"><span class="toc-section-number">23.5</span> Clustering the Swiss bills</a></li>
<li><a href="cluster-analysis.html#grouping-similar-cars"><span class="toc-section-number">23.6</span> Grouping similar cars</a></li>
<li><a href="cluster-analysis.html#running-jumping-and-throwing"><span class="toc-section-number">23.7</span> Running, jumping, and throwing</a></li>
<li><a href="cluster-analysis.html#bridges-in-pittsburgh"><span class="toc-section-number">23.8</span> Bridges in Pittsburgh</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="dates-and-times" class="section level1">
<h1><span class="header-section-number">Chapter 14</span> Dates and times</h1>
<p>The usual to begin with:</p>
<div class="sourceCode" id="cb1655"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1655-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<pre><code>## ── Attaching packages ────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.1.0     ✔ purrr   0.2.5
## ✔ tibble  1.4.2     ✔ dplyr   0.7.8
## ✔ tidyr   0.8.1     ✔ stringr 1.3.1
## ✔ readr   1.1.1     ✔ forcats 0.3.0</code></pre>
<pre><code>## ── Conflicts ───────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div id="dealing-with-dates-in-the-worcester-heart-attack-study" class="section level2">
<h2><span class="header-section-number">14.1</span> Dealing with dates in the Worcester Heart Attack study</h2>
<p>The Worcester Heart Attack Study is an ongoing study of
heart attacks in the Worcester, MA area. The main purpose of the study
is to investigate changes over time in incidence and death rates, and also
the use of different treatment approaches. We will be mainly using
this data set to investigate data handling and dealing with dates. The
data can be found at
<a href="http://www.utsc.utoronto.ca/~butler/c32/whas500.txt">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data into R. The reading-in part is
straightforward, but check what type of thing each column is. Is
that what it should be?</li>
</ol>
<p>Solution</p>
<p>This is <code>read_delim</code>:</p>
<div class="sourceCode" id="cb1659"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1659-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/whas500.txt&quot;</span></a>
<a class="sourceLine" id="cb1659-2" data-line-number="2">whas=<span class="kw">read_delim</span>(my_url,<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_integer(),
##   bmi = col_double(),
##   admitdate = col_character(),
##   disdate = col_character(),
##   fdate = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb1662"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1662-1" data-line-number="1">whas</a></code></pre></div>
<pre><code>## # A tibble: 500 x 22
##       id   age gender    hr sysbp diasbp   bmi   cvd   afb   sho   chf
##    &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1     1    83      0    89   152     78  25.5     1     1     0     0
##  2     2    49      0    84   120     60  24.0     1     0     0     0
##  3     3    70      1    83   147     88  22.1     0     0     0     0
##  4     4    70      0    65   123     76  26.6     1     0     0     1
##  5     5    70      0    63   135     85  24.4     1     0     0     0
##  6     6    70      0    76    83     54  23.2     1     0     0     0
##  7     7    57      0    73   191    116  39.5     1     0     0     0
##  8     8    55      0    91   147     95  27.1     1     0     0     0
##  9     9    88      1    63   209    100  27.4     1     0     0     1
## 10    10    54      0   104   166    106  25.5     1     0     0     0
## # ... with 490 more rows, and 11 more variables: av3 &lt;int&gt;, miord &lt;int&gt;,
## #   mitype &lt;int&gt;, year &lt;int&gt;, admitdate &lt;chr&gt;, disdate &lt;chr&gt;, fdate &lt;chr&gt;,
## #   los &lt;int&gt;, dstat &lt;int&gt;, lenfol &lt;int&gt;, fstat &lt;int&gt;</code></pre>
<p>To see what type everything is, note that when you display a
<code>tibble</code>, the type of all the columns on the screen is
displayed at the top. Click the little right-arrow to see more columns
and to check their type.</p>
<p>All the numbers are properly integer (<code>int</code>) or decimal
(<code>dbl</code>) numbers, but the date columns are <code>chr</code> or
text. This means that they haven’t been read as <code>Date</code>s
(because they were not in year-month-day order). This is (as we will
see) unlike SAS, which determined that they were dates, and even used
the first 20 rows of the file to determine what format of dates they
were.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>The date columns should be R dates. They are not
year-month-day, so converting them via <code>as.Date</code> (which is
what <code>read_delim</code> tries to do) will not work. Load the
<code>lubridate</code> package, and create new columns in your data
frame that are properly dates. Save your data frame, and list it to
demonstrate that it worked.</li>
</ol>
<p>Solution</p>
<p>Load <code>lubridate</code> first:</p>
<div class="sourceCode" id="cb1664"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1664-1" data-line-number="1"><span class="kw">library</span>(lubridate)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     date</code></pre>
<p>These dates are day-month-year, so we need <code>dmy</code> from
<code>lubridate</code>:</p>
<div class="sourceCode" id="cb1667"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1667-1" data-line-number="1">whas2=whas <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">admit=</span><span class="kw">dmy</span>(admitdate),</a>
<a class="sourceLine" id="cb1667-2" data-line-number="2"><span class="dt">dis=</span><span class="kw">dmy</span>(disdate),</a>
<a class="sourceLine" id="cb1667-3" data-line-number="3"><span class="dt">f=</span><span class="kw">dmy</span>(fdate)) </a>
<a class="sourceLine" id="cb1667-4" data-line-number="4"><span class="kw">glimpse</span>(whas2)</a></code></pre></div>
<pre><code>## Observations: 500
## Variables: 25
## $ id        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1...
## $ age       &lt;int&gt; 83, 49, 70, 70, 70, 70, 57, 55, 88, 54, 48, 75, 48, ...
## $ gender    &lt;int&gt; 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1...
## $ hr        &lt;int&gt; 89, 84, 83, 65, 63, 76, 73, 91, 63, 104, 95, 154, 85...
## $ sysbp     &lt;int&gt; 152, 120, 147, 123, 135, 83, 191, 147, 209, 166, 160...
## $ diasbp    &lt;int&gt; 78, 60, 88, 76, 85, 54, 116, 95, 100, 106, 110, 123,...
## $ bmi       &lt;dbl&gt; 25.54051, 24.02398, 22.14290, 26.63187, 24.41255, 23...
## $ cvd       &lt;int&gt; 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0...
## $ afb       &lt;int&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0...
## $ sho       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ chf       &lt;int&gt; 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1...
## $ av3       &lt;int&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ miord     &lt;int&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0...
## $ mitype    &lt;int&gt; 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1...
## $ year      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1...
## $ admitdate &lt;chr&gt; &quot;13-01-1997&quot;, &quot;19-01-1997&quot;, &quot;01-01-1997&quot;, &quot;17-02-199...
## $ disdate   &lt;chr&gt; &quot;18-01-1997&quot;, &quot;24-01-1997&quot;, &quot;06-01-1997&quot;, &quot;27-02-199...
## $ fdate     &lt;chr&gt; &quot;31-12-2002&quot;, &quot;31-12-2002&quot;, &quot;31-12-2002&quot;, &quot;11-12-199...
## $ los       &lt;int&gt; 5, 5, 5, 10, 6, 1, 5, 4, 4, 5, 5, 10, 7, 21, 4, 1, 1...
## $ dstat     &lt;int&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ lenfol    &lt;int&gt; 2178, 2172, 2190, 297, 2131, 1, 2122, 1496, 920, 217...
## $ fstat     &lt;int&gt; 0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1...
## $ admit     &lt;date&gt; 1997-01-13, 1997-01-19, 1997-01-01, 1997-02-17, 199...
## $ dis       &lt;date&gt; 1997-01-18, 1997-01-24, 1997-01-06, 1997-02-27, 199...
## $ f         &lt;date&gt; 2002-12-31, 2002-12-31, 2002-12-31, 1997-12-11, 200...</code></pre>
<p>There are a lot of columns, so I used <code>glimpse</code>. The three new
variables we created are at the end of the list. They are correctly
<code>Date</code>s, and they have the right values, the ones we can see at
least.</p>
<p>The indentation is up to you. I think it’s nice to make the
creations of the three new variables line up. You can also make the
opening and closing brackets on the long <code>mutate</code> aligned, or
you can do as I have done here and put two closing brackets on the
end. The rationale for this is that each of the variable definition
lines in the <code>mutate</code> ends either with a comma or an extra
closing bracket, the latter being on the last line. Your choice here is
a matter of taste or (in your working life) the coding norms of the
team you’re working with.</p>
<p>You may have been offended by the repetition above. It so happens that
these columns’ names all end in <code>date</code> and they are the only
ones that do, so we can use a “select helper” to select only them,
and then submit all of them to a <code>mutate</code> via <code>mutate_at</code>,
which goes like this:</p>
<div class="sourceCode" id="cb1669"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1669-1" data-line-number="1">whas <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">ends_with</span>(<span class="st">&quot;date&quot;</span>)),<span class="kw">funs</span>(<span class="dt">d=</span>dmy)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Observations: 500
## Variables: 25
## $ id          &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,...
## $ age         &lt;int&gt; 83, 49, 70, 70, 70, 70, 57, 55, 88, 54, 48, 75, 48...
## $ gender      &lt;int&gt; 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1,...
## $ hr          &lt;int&gt; 89, 84, 83, 65, 63, 76, 73, 91, 63, 104, 95, 154, ...
## $ sysbp       &lt;int&gt; 152, 120, 147, 123, 135, 83, 191, 147, 209, 166, 1...
## $ diasbp      &lt;int&gt; 78, 60, 88, 76, 85, 54, 116, 95, 100, 106, 110, 12...
## $ bmi         &lt;dbl&gt; 25.54051, 24.02398, 22.14290, 26.63187, 24.41255, ...
## $ cvd         &lt;int&gt; 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1,...
## $ afb         &lt;int&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0,...
## $ sho         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ chf         &lt;int&gt; 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1,...
## $ av3         &lt;int&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ miord       &lt;int&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1,...
## $ mitype      &lt;int&gt; 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0,...
## $ year        &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ admitdate   &lt;chr&gt; &quot;13-01-1997&quot;, &quot;19-01-1997&quot;, &quot;01-01-1997&quot;, &quot;17-02-1...
## $ disdate     &lt;chr&gt; &quot;18-01-1997&quot;, &quot;24-01-1997&quot;, &quot;06-01-1997&quot;, &quot;27-02-1...
## $ fdate       &lt;chr&gt; &quot;31-12-2002&quot;, &quot;31-12-2002&quot;, &quot;31-12-2002&quot;, &quot;11-12-1...
## $ los         &lt;int&gt; 5, 5, 5, 10, 6, 1, 5, 4, 4, 5, 5, 10, 7, 21, 4, 1,...
## $ dstat       &lt;int&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ lenfol      &lt;int&gt; 2178, 2172, 2190, 297, 2131, 1, 2122, 1496, 920, 2...
## $ fstat       &lt;int&gt; 0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1,...
## $ admitdate_d &lt;date&gt; 1997-01-13, 1997-01-19, 1997-01-01, 1997-02-17, 1...
## $ disdate_d   &lt;date&gt; 1997-01-18, 1997-01-24, 1997-01-06, 1997-02-27, 1...
## $ fdate_d     &lt;date&gt; 2002-12-31, 2002-12-31, 2002-12-31, 1997-12-11, 2...</code></pre>
<p>One line, as you see, not three. The syntax of this is that we first
say which columns we want to mutate. We can use any of the
select-helpers for this, including listing the column numbers or
names; in this case our date variables all ended with
<code>date</code>. Then we have to give a function, or more than one
function, to mutate them with; in this case we wanted to run all the
dates-as-text through <code>dmy</code>. Because I said <code>d=dmy</code>, it
takes the original date variable names, glues an underscore on the end
and then the <code>d</code> that I said, so we create new variables by
those names (at the end of the <code>glimpse</code> output). If I had just
said <code>funs(dmy)</code>, we would have <em>overwritten</em> the original
values, and <code>admitdate</code>, <code>disdate</code> and <code>fdate</code>
would now be <code>date</code>s. Losing the original variables would have
been OK here, but I wanted to show you how to create new variables.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Create three new variables <code>diff1, diff2, diff3</code> that
are the numbers of days between each of your dates, and save the
data frame in which they have been created. Verify that at
least some of them are the same as <code>los</code> and <code>lenfol</code>.</li>
</ol>
<p>Solution</p>
<p>I don’t know
what R’s internal storage is for dates (it might be seconds or
milliseconds or anything, not necessarily days),
so subtracting them requires care; you have to divide by the
length of a day (in whatever units), thus:</p>
<div class="sourceCode" id="cb1671"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1671-1" data-line-number="1">whas3=whas2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb1671-2" data-line-number="2"><span class="dt">diff1=</span>(dis<span class="op">-</span>admit)<span class="op">/</span><span class="kw">ddays</span>(<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1671-3" data-line-number="3"><span class="dt">diff2=</span>(f<span class="op">-</span>admit)<span class="op">/</span><span class="kw">ddays</span>(<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1671-4" data-line-number="4"><span class="dt">diff3=</span>(f<span class="op">-</span>dis)<span class="op">/</span><span class="kw">ddays</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1671-5" data-line-number="5"><span class="kw">glimpse</span>(whas3)     </a></code></pre></div>
<pre><code>## Observations: 500
## Variables: 28
## $ id        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1...
## $ age       &lt;int&gt; 83, 49, 70, 70, 70, 70, 57, 55, 88, 54, 48, 75, 48, ...
## $ gender    &lt;int&gt; 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1...
## $ hr        &lt;int&gt; 89, 84, 83, 65, 63, 76, 73, 91, 63, 104, 95, 154, 85...
## $ sysbp     &lt;int&gt; 152, 120, 147, 123, 135, 83, 191, 147, 209, 166, 160...
## $ diasbp    &lt;int&gt; 78, 60, 88, 76, 85, 54, 116, 95, 100, 106, 110, 123,...
## $ bmi       &lt;dbl&gt; 25.54051, 24.02398, 22.14290, 26.63187, 24.41255, 23...
## $ cvd       &lt;int&gt; 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0...
## $ afb       &lt;int&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0...
## $ sho       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ chf       &lt;int&gt; 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1...
## $ av3       &lt;int&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ miord     &lt;int&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0...
## $ mitype    &lt;int&gt; 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1...
## $ year      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1...
## $ admitdate &lt;chr&gt; &quot;13-01-1997&quot;, &quot;19-01-1997&quot;, &quot;01-01-1997&quot;, &quot;17-02-199...
## $ disdate   &lt;chr&gt; &quot;18-01-1997&quot;, &quot;24-01-1997&quot;, &quot;06-01-1997&quot;, &quot;27-02-199...
## $ fdate     &lt;chr&gt; &quot;31-12-2002&quot;, &quot;31-12-2002&quot;, &quot;31-12-2002&quot;, &quot;11-12-199...
## $ los       &lt;int&gt; 5, 5, 5, 10, 6, 1, 5, 4, 4, 5, 5, 10, 7, 21, 4, 1, 1...
## $ dstat     &lt;int&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ lenfol    &lt;int&gt; 2178, 2172, 2190, 297, 2131, 1, 2122, 1496, 920, 217...
## $ fstat     &lt;int&gt; 0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1...
## $ admit     &lt;date&gt; 1997-01-13, 1997-01-19, 1997-01-01, 1997-02-17, 199...
## $ dis       &lt;date&gt; 1997-01-18, 1997-01-24, 1997-01-06, 1997-02-27, 199...
## $ f         &lt;date&gt; 2002-12-31, 2002-12-31, 2002-12-31, 1997-12-11, 200...
## $ diff1     &lt;dbl&gt; 5, 5, 5, 10, 6, 1, 5, 4, 4, 5, 5, 10, 7, 21, 4, 1, 1...
## $ diff2     &lt;dbl&gt; 2178, 2172, 2190, 297, 2131, 1, 2122, 1496, 920, 217...
## $ diff3     &lt;dbl&gt; 2173, 2167, 2185, 287, 2125, 0, 2117, 1492, 916, 217...</code></pre>
<p>The extra <code>d</code> on the front of <code>ddays</code> indicates that
these are what is known to <code>lubridate</code> as “durations”: a
period of time 1 day long that could be any day (as opposed to
“June 1, 1970” which is 1 day long, but tied to a particular day).</p>
<p><code>los</code> should be the number of days in hospital, what I
calculated as <code>diff1</code>, and <code>lenfol</code> should be the time
from being admitted to last followup, which is my <code>diff2</code>. My
output from <code>glimpse</code> confirms that.</p>
<p>Of course, checking that the first few values match is a nice
confirmation, but is not actually a <em>proof</em>. For that, we should
compare all 500 values, and it would be best to do it in such a way
that R is comparing all 500 values for us, since it would be a lot
more reliable than the human eye. R has a function <code>all.equal</code>
which does exactly that. By way of warmup:</p>
<div class="sourceCode" id="cb1673"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1673-1" data-line-number="1">x=<span class="dv">1</span><span class="op">:</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb1673-2" data-line-number="2">y=<span class="dv">1</span><span class="op">:</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb1673-3" data-line-number="3">z=<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1673-4" data-line-number="4"><span class="kw">all.equal</span>(x,y)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1675"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1675-1" data-line-number="1"><span class="kw">all.equal</span>(x,z)</a></code></pre></div>
<pre><code>## [1] &quot;Mean relative difference: 0.25&quot;</code></pre>
<p>I thought the second one was just going to say <code>FALSE</code>, but it
gave us a message instead, saying how close <code>x</code> and <code>z</code>
were on average, so that we could decide whether they were close
enough to call equal, or, as in this case, not.</p>
<p>Anyway:</p>
<div class="sourceCode" id="cb1677"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1677-1" data-line-number="1"><span class="kw">with</span>(whas3,<span class="kw">all.equal</span>(lenfol,diff2))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1679"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1679-1" data-line-number="1"><span class="kw">with</span>(whas3,<span class="kw">all.equal</span>(los,diff1))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>so they really are all equal, all 500 of them.
<label for="tufte-mn-112" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-112" class="margin-toggle"><span class="marginnote">The computer scientists among you will note that I shouldn’t have done this, because <em>diff1</em> through <em>diff3</em> are double-precision decimal numbers, so I should have tested their equality with <em>lenfol</em> and <em>los</em> by working out the absolute differences and testing whether they were all <em>small</em>. On consulting the help for <em>all.equal</em>, though, I find that it <em>does</em> work properly, because it actually tests whether the things being compared differ by less than a quantity <em>tolerance</em> which defaults to 0.000000015, and if they do it calls them equal. This is all tied in with the difference between integers and decimal numbers as they are represented on a computer: exactly and approximately, respectively. A double-precision number has about 16 significant digits of accuracy; equal things won’t have all 16 digits equal, most likely, but they would be expected to have at least 8 of those digits the same. CSCA08 stuff, I imagine. This is where you can casually toss around terms like <em>machine epsilon</em>. Oh! I just realized something. You know how very very small P-values are shown in R as <em>&lt;2.2e-16</em>? <em>That’s</em> the machine epsilon. Anything smaller than that is indistinguishable from zero, and you can’t have a P-value be <em>exactly</em> zero. The default <em>tolerance</em> I mentioned above is the square root of this, which is normally used for such things.</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Construct side-by-side boxplots of the length of followup by
each followup status. You’ll need to make sure
that the followup status, as it gets fed into <code>ggplot</code>, is a
<code>factor</code>, or, at least, not the number that it is now.</li>
</ol>
<p>Solution</p>
<p>The easiest way to make a factor is to wrap <code>fstat</code>, which
is a numeric 0 or 1, in <code>factor()</code>:</p>
<div class="sourceCode" id="cb1681"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1681-1" data-line-number="1"><span class="kw">ggplot</span>(whas3,<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">factor</span>(fstat),<span class="dt">y=</span>lenfol))<span class="op">+</span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-9-1.png" width="672"  /></p>
<p>Or create a factor version of <code>fstat</code> first:</p>
<div class="sourceCode" id="cb1682"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1682-1" data-line-number="1">whas3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">ffstat=</span><span class="kw">factor</span>(fstat)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1682-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>ffstat,<span class="dt">y=</span>lenfol))<span class="op">+</span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-10-1.png" width="672"  /></p>
<p>I think the second way looks better, because you
get a cleaner <span class="math inline">\(x\)</span>-axis on your plot. But if you’re doing this for
exploration, rather than as something that’s going to appear in a
report for your boss, the first way is fine.</p>
<p><code>ggplot</code> also treats text stuff as categorical where needed, so
this also works:</p>
<div class="sourceCode" id="cb1683"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1683-1" data-line-number="1">whas3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">cfstat=</span><span class="kw">as.character</span>(fstat)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1683-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>cfstat, <span class="dt">y=</span>lenfol))<span class="op">+</span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-11-1.png" width="672"  /></p>
</div>
<div id="growth-of-mizuna-lettuce-seeds" class="section level2">
<h2><span class="header-section-number">14.2</span> Growth of Mizuna lettuce seeds</h2>
<p>In 2010, a group of students planted some Mizuna lettuce
seeds, and recorded how they grew. The data were saved in an Excel
spreadsheet, which is at
<a href="http://www.utsc.utoronto.ca/~butler/c32/mizuna.xlsx">link</a>. The columns
are: the date, the height (in cm) of (I presume) the tallest plant,
the amount of water added since the previous date (ml), the
temperature in the container where the seedlings were growing, and any
additional notes that the students made (edited for length by me). The
top line of the data file is variable names.</p>
<ol style="list-style-type: lower-alpha">
<li>Read the
spreadsheet data.</li>
</ol>
<p>Solution</p>
<p>This is <code>read_excel</code> from package <code>readxl</code>. I’m
not sure what will happen to the dates yet. Note that this needs
a “local” copy of the spreadsheet (that is, you have to
download it and save it on your computer, then upload it to
<code>rstudio.cloud</code>), possibly using <code>file.choose</code> to
help R find it. I put my copy in the same project folder as I was
working in, so I just need the file name:</p>
<div class="sourceCode" id="cb1684"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1684-1" data-line-number="1"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb1684-2" data-line-number="2">mizuna=<span class="kw">read_excel</span>(<span class="st">&quot;mizuna.xlsx&quot;</span>)</a>
<a class="sourceLine" id="cb1684-3" data-line-number="3">mizuna</a></code></pre></div>
<pre><code>## # A tibble: 13 x 5
##    date                height water temperature notes                     
##    &lt;dttm&gt;               &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;                     
##  1 2010-02-16 00:00:00    0     400        21   planted seeds; water soak…
##  2 2010-02-18 00:00:00    0       0        22.5 2 of 6 seeds not appeared…
##  3 2010-02-19 00:00:00    0     200        20.9 4 of 6 plants broken surf…
##  4 2010-02-22 00:00:00    3.2   100        20.8 Last seed hasn’t broken s…
##  5 2010-02-23 00:00:00    4.5   100        22.9 Plants growing well.      
##  6 2010-02-25 00:00:00    6     100        21.8 Last seed sprouted; plant…
##  7 2010-02-26 00:00:00    6.5   200        21.2 &lt;NA&gt;                      
##  8 2010-03-01 00:00:00    9.5   200        21.8 &lt;NA&gt;                      
##  9 2010-03-03 00:00:00   11.1   200        21.7 Plants needing more water 
## 10 2010-03-05 00:00:00   13     250        21.9 &lt;NA&gt;                      
## 11 2010-03-08 00:00:00   14.5   500        22.5 No water left, leaves dro…
## 12 2010-03-10 00:00:00   16     200        21.2 Plants green and healthy  
## 13 2010-03-17 00:00:00   18.5   800        20.8 Harvest. Tips of plants t…</code></pre>
<p>The dates <em>did</em> get read properly. <code>dttm</code> is
“date-time”, so I guess it’s allowing for the possibility that my
dates had times attached as well. Unlike with SAS (as we see later),
the years came out right.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Make a plot of <code>height</code> against your
dates, with the points joined by lines.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb1686"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1686-1" data-line-number="1"><span class="kw">ggplot</span>(mizuna,<span class="kw">aes</span>(<span class="dt">x=</span>date,<span class="dt">y=</span>height))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-13-1.png" width="672"  /></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Label each point on the plot with the
amount of water added up to that point.</li>
</ol>
<p>Solution</p>
<p>This is <code>water</code> again. The way to do this is to load
<code>ggrepel</code>, then add <code>geom_text_repel</code> to the
plot, by adding <code>label=water</code> to the <em>original</em>
<code>aes</code>:</p>
<div class="sourceCode" id="cb1687"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1687-1" data-line-number="1"><span class="kw">library</span>(ggrepel)</a>
<a class="sourceLine" id="cb1687-2" data-line-number="2"><span class="kw">ggplot</span>(mizuna,<span class="kw">aes</span>(<span class="dt">x=</span>date,<span class="dt">y=</span>height,<span class="dt">label=</span>water))<span class="op">+</span></a>
<a class="sourceLine" id="cb1687-3" data-line-number="3"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()<span class="op">+</span><span class="kw">geom_text_repel</span>(<span class="dt">colour=</span><span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-14-1.png" width="672"  /></p>
<p>I made the text red, so that you can see it more easily. It “repels”
away from the points, but not from the lines joining them. Which makes
me wonder whether this would work better (I explain <code>alpha</code> afterwards):</p>
<div class="sourceCode" id="cb1688"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1688-1" data-line-number="1"><span class="kw">library</span>(ggrepel)</a>
<a class="sourceLine" id="cb1688-2" data-line-number="2"><span class="kw">ggplot</span>(mizuna,<span class="kw">aes</span>(<span class="dt">x=</span>date,<span class="dt">y=</span>height,<span class="dt">label=</span>water))<span class="op">+</span></a>
<a class="sourceLine" id="cb1688-3" data-line-number="3"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()<span class="op">+</span><span class="kw">geom_label_repel</span>(<span class="dt">colour=</span><span class="st">&quot;red&quot;</span>,<span class="dt">alpha=</span><span class="fl">0.7</span>)</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-15-1.png" width="672"  /></p>
<p>The difference between <code>text</code> and <code>label</code> is that
<code>text</code> just uses the text of the variable to mark the point,
while <code>label</code> puts that text in a box.</p>
<p>I think it works better. You can see where the line goes (under the boxes with
the labels in them), but you can see the labels clearly.</p>
<p>What that <code>alpha</code> does is to make the thing it’s attached to
(the labels) partly <em>transparent</em>. If you leave it out (try it),
the black line disappears completely under the label boxes and you
can’t see where it goes at all. The value you give for <code>alpha</code>
says how transparent the thing is, from 1 (not transparent at all)
down to 0 (invisible). I first tried 0.3, and you could hardly see the
boxes; then I tried 0.7 so that the boxes were a bit more
prominent but the lines underneath were still slightly visible, and I
decided that this is what I liked. I think making the labels a
different colour was a good idea, since that helps to distinguish the
number on the label from the line underneath.</p>
<p>You can apply <code>alpha</code> to pretty much any <code>ggplot</code> thing
that might be on top of something else, to make it possible to see
what’s underneath it. The commonest use for it is if you have a
scatterplot with a lot of points; normally, you only see some of the
points, because the plot is then a sea of black. But if you make the
points partly transparent, you can see more of what’s nearby that
would otherwise have been hidden.</p>
<p>At some point, I also have to show
you folks <code>jitter</code>, which plots in slightly different places
points that would otherwise overprint each other exactly, and you
wouldn’t know how many of them there were, like the outliers on the
boxplots of German children near the new airport.</p>
</div>
<div id="types-of-childbirth" class="section level2">
<h2><span class="header-section-number">14.3</span> Types of childbirth</h2>
<p>Childbirths can be of two types: a
“vaginal” birth in which the child is born through the mother’s
vagina in the normal fashion, and a “cesarean section” where a
surgeon cuts through the wall of the mother’s abdomen, and the baby
is delivered through the incision. Cesarean births are used when
there are difficulties in pregnancy or during childbirth that would
make a vaginal birth too risky.
A hospital kept track of the number of vaginal and Cesarean births
for the twelve months of 2012. Of interest is whether the Cesarean
rate (the ratio of Cesarean births to all births) was increasing,
decreasing or remaining stable over that time.
The data may be found at
<a href="http://www.utsc.utoronto.ca/~butler/c32/birthtypes.txt">link</a>. The
columns are the names of the months (in 2012), the number of cesarean
births and the number of vaginal births. (The data are not real, but
are typical of the kind of thing you would observe.)</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data into R and display your data frame.</li>
</ol>
<p>Solution</p>
<p>This is a space-delimited text file, which means:</p>
<div class="sourceCode" id="cb1689"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1689-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/birthtypes.txt&quot;</span></a>
<a class="sourceLine" id="cb1689-2" data-line-number="2">births=<span class="kw">read_delim</span>(my_url, <span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   month = col_character(),
##   cesarean = col_integer(),
##   vaginal = col_integer()
## )</code></pre>
<div class="sourceCode" id="cb1691"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1691-1" data-line-number="1">births</a></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    month cesarean vaginal
##    &lt;chr&gt;    &lt;int&gt;   &lt;int&gt;
##  1 Jan         11      68
##  2 Feb          9      63
##  3 Mar         10      72
##  4 Apr         18     105
##  5 May         10      90
##  6 Jun         10      92
##  7 Jul         11      78
##  8 Aug          9      83
##  9 Sep          9      90
## 10 Oct         15     101
## 11 Nov         12     130
## 12 Dec          8     101</code></pre>
<p>Some text and two numbers for each month. Check.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Create a column of actual dates and also a column of
cesarean rates, as defined above. Store your new data frame in a
variable and display it. For the dates, assume that each date is of
the 1st of the month that it belongs to.</li>
</ol>
<p>Solution</p>
<p>The easiest way is to use <code>str_c</code> or <code>paste</code> to
create a text date with year, month and day in some order, and
then to use the appropriate function from <code>lubridate</code> to
turn that into an actual <code>date</code>. If you use
<code>str_c</code>, you (probably) need the <code>sep</code> thing to
make sure the values get a space between them; <code>paste</code>
does this automatically. (The next question is whether
<code>ymd</code> or whatever can cope without spaces, but I’m not
exploring that.)
The cesarean rate is <code>cesarean</code> divided by
<code>cesarean</code> plus <code>vaginal</code>:</p>
<div class="sourceCode" id="cb1693"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1693-1" data-line-number="1"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb1693-2" data-line-number="2">b2 =<span class="st"> </span>births <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">datestr=</span><span class="kw">str_c</span>(<span class="st">&quot;2012&quot;</span>,month,<span class="st">&quot;1&quot;</span>,<span class="dt">sep=</span><span class="st">&quot; &quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1693-3" data-line-number="3"><span class="kw">mutate</span>(<span class="dt">thedate=</span><span class="kw">ymd</span>(datestr)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1693-4" data-line-number="4"><span class="kw">mutate</span>(<span class="dt">cesarean_rate=</span>cesarean<span class="op">/</span>(cesarean<span class="op">+</span>vaginal))</a>
<a class="sourceLine" id="cb1693-5" data-line-number="5">b2</a></code></pre></div>
<pre><code>## # A tibble: 12 x 6
##    month cesarean vaginal datestr    thedate    cesarean_rate
##    &lt;chr&gt;    &lt;int&gt;   &lt;int&gt; &lt;chr&gt;      &lt;date&gt;             &lt;dbl&gt;
##  1 Jan         11      68 2012 Jan 1 2012-01-01        0.139 
##  2 Feb          9      63 2012 Feb 1 2012-02-01        0.125 
##  3 Mar         10      72 2012 Mar 1 2012-03-01        0.122 
##  4 Apr         18     105 2012 Apr 1 2012-04-01        0.146 
##  5 May         10      90 2012 May 1 2012-05-01        0.1   
##  6 Jun         10      92 2012 Jun 1 2012-06-01        0.0980
##  7 Jul         11      78 2012 Jul 1 2012-07-01        0.124 
##  8 Aug          9      83 2012 Aug 1 2012-08-01        0.0978
##  9 Sep          9      90 2012 Sep 1 2012-09-01        0.0909
## 10 Oct         15     101 2012 Oct 1 2012-10-01        0.129 
## 11 Nov         12     130 2012 Nov 1 2012-11-01        0.0845
## 12 Dec          8     101 2012 Dec 1 2012-12-01        0.0734</code></pre>
<p>If you don’t like that, create columns that contain 2012 and 1 all
the way down. If you set a column name equal to a single value, that
single value gets repeated the right number of times:
<label for="tufte-mn-113" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-113" class="margin-toggle"><span class="marginnote">This is an example of R’s so-called <em>recycling rules</em>.</span></p>
<div class="sourceCode" id="cb1695"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1695-1" data-line-number="1">births <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">year=</span><span class="dv">2012</span>,<span class="dt">day=</span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 12 x 5
##    month cesarean vaginal  year   day
##    &lt;chr&gt;    &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Jan         11      68  2012     1
##  2 Feb          9      63  2012     1
##  3 Mar         10      72  2012     1
##  4 Apr         18     105  2012     1
##  5 May         10      90  2012     1
##  6 Jun         10      92  2012     1
##  7 Jul         11      78  2012     1
##  8 Aug          9      83  2012     1
##  9 Sep          9      90  2012     1
## 10 Oct         15     101  2012     1
## 11 Nov         12     130  2012     1
## 12 Dec          8     101  2012     1</code></pre>
<p>and then use <code>unite</code> as in class. The distinction is that
<code>unite</code> <em>only</em> works on columns. It also “swallows up”
the columns that it is made out of; in this case, the original year,
month and day disappear:</p>
<div class="sourceCode" id="cb1697"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1697-1" data-line-number="1">b3 =<span class="st"> </span>births <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">year=</span><span class="dv">2012</span>, <span class="dt">day=</span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1697-2" data-line-number="2"><span class="kw">unite</span>(datestr,year,month,day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1697-3" data-line-number="3"><span class="kw">mutate</span>(<span class="dt">thedate=</span><span class="kw">ymd</span>(datestr)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1697-4" data-line-number="4"><span class="kw">mutate</span>(<span class="dt">cesarean_rate=</span>cesarean<span class="op">/</span>(cesarean<span class="op">+</span>vaginal))</a>
<a class="sourceLine" id="cb1697-5" data-line-number="5">b3</a></code></pre></div>
<pre><code>## # A tibble: 12 x 5
##    datestr    cesarean vaginal thedate    cesarean_rate
##    &lt;chr&gt;         &lt;int&gt;   &lt;int&gt; &lt;date&gt;             &lt;dbl&gt;
##  1 2012_Jan_1       11      68 2012-01-01        0.139 
##  2 2012_Feb_1        9      63 2012-02-01        0.125 
##  3 2012_Mar_1       10      72 2012-03-01        0.122 
##  4 2012_Apr_1       18     105 2012-04-01        0.146 
##  5 2012_May_1       10      90 2012-05-01        0.1   
##  6 2012_Jun_1       10      92 2012-06-01        0.0980
##  7 2012_Jul_1       11      78 2012-07-01        0.124 
##  8 2012_Aug_1        9      83 2012-08-01        0.0978
##  9 2012_Sep_1        9      90 2012-09-01        0.0909
## 10 2012_Oct_1       15     101 2012-10-01        0.129 
## 11 2012_Nov_1       12     130 2012-11-01        0.0845
## 12 2012_Dec_1        8     101 2012-12-01        0.0734</code></pre>
<p>I don’t mind which order you glue your year, month and day together,
as long as you construct the dates with the consistent
<code>lubridate</code> function.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Plot the cesarean rate against time, with a smooth
trend. Do you see an upward trend, a downward trend, no trend, or
something else?</li>
</ol>
<p>Solution</p>
<p>This is a scatterplot with time on the <span class="math inline">\(x\)</span> axis:</p>
<div class="sourceCode" id="cb1699"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1699-1" data-line-number="1"><span class="kw">ggplot</span>(b2,<span class="kw">aes</span>(<span class="dt">x=</span>thedate,<span class="dt">y=</span>cesarean_rate))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-20-1.png" width="672"  /></p>
<p>I like this better than joining the points by lines, since we already
have a trend on the plot, but you can do that in some contrasting way:</p>
<div class="sourceCode" id="cb1701"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1701-1" data-line-number="1"><span class="kw">ggplot</span>(b2,<span class="kw">aes</span>(<span class="dt">x=</span>thedate,<span class="dt">y=</span>cesarean_rate))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1701-2" data-line-number="2"><span class="kw">geom_line</span>(<span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="op">+</span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-21-1.png" width="672"  /></p>
<p>I see a downward trend. (“A downward trend with a wiggle” if you
like.) I didn’t ask for any explanation. There is a certain unevenness
in the trend of the actual data, but the overall picture appears to be
downhill.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Try to summarize the trend you just found with a
correlation. What goes wrong? How can you fix it?</li>
</ol>
<p>Solution</p>
<p>Something like this is the obvious guess:</p>
<div class="sourceCode" id="cb1703"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1703-1" data-line-number="1"><span class="kw">with</span>(b2, <span class="kw">cor</span>(thedate, cesarean_rate))</a></code></pre></div>
<pre><code>## Error in cor(thedate, cesarean_rate): &#39;x&#39; must be numeric</code></pre>
<p>This fails because <code>thedate</code> is not of itself a number. But
lurking in the background is how the date is actually
<em>represented</em>: as a number of days since Jan 1, 1970. Thus,
passing it through <code>as.numeric</code> might turn it into that:</p>
<div class="sourceCode" id="cb1705"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1705-1" data-line-number="1">b2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">numeric_date=</span><span class="kw">as.numeric</span>(thedate)) -&gt;<span class="st"> </span>b5</a>
<a class="sourceLine" id="cb1705-2" data-line-number="2">b5</a></code></pre></div>
<pre><code>## # A tibble: 12 x 7
##    month cesarean vaginal datestr    thedate    cesarean_rate numeric_date
##    &lt;chr&gt;    &lt;int&gt;   &lt;int&gt; &lt;chr&gt;      &lt;date&gt;             &lt;dbl&gt;        &lt;dbl&gt;
##  1 Jan         11      68 2012 Jan 1 2012-01-01        0.139         15340
##  2 Feb          9      63 2012 Feb 1 2012-02-01        0.125         15371
##  3 Mar         10      72 2012 Mar 1 2012-03-01        0.122         15400
##  4 Apr         18     105 2012 Apr 1 2012-04-01        0.146         15431
##  5 May         10      90 2012 May 1 2012-05-01        0.1           15461
##  6 Jun         10      92 2012 Jun 1 2012-06-01        0.0980        15492
##  7 Jul         11      78 2012 Jul 1 2012-07-01        0.124         15522
##  8 Aug          9      83 2012 Aug 1 2012-08-01        0.0978        15553
##  9 Sep          9      90 2012 Sep 1 2012-09-01        0.0909        15584
## 10 Oct         15     101 2012 Oct 1 2012-10-01        0.129         15614
## 11 Nov         12     130 2012 Nov 1 2012-11-01        0.0845        15645
## 12 Dec          8     101 2012 Dec 1 2012-12-01        0.0734        15675</code></pre>
<p>A little mental calculation suggests that these dates in 2012 are a
bit over 40 years, that is <span class="math inline">\(40 \times 365 \simeq 14000\)</span> days, since
the “zero” date of Jan 1, 1970, and so it turns out. This suggests
that we can calculate a correlation with the numeric dates:</p>
<div class="sourceCode" id="cb1707"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1707-1" data-line-number="1"><span class="kw">with</span>(b5, <span class="kw">cor</span>(numeric_date, cesarean_rate))</a></code></pre></div>
<pre><code>## [1] -0.7091219</code></pre>
<p>and we can make a test of the null hypothesis that the correlation is
zero (against a two-sided alternative) thus:</p>
<div class="sourceCode" id="cb1709"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1709-1" data-line-number="1"><span class="kw">with</span>(b5, <span class="kw">cor.test</span>(numeric_date, cesarean_rate))</a></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  numeric_date and cesarean_rate
## t = -3.1804, df = 10, p-value = 0.009813
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  -0.9119078 -0.2280145
## sample estimates:
##        cor 
## -0.7091219</code></pre>
<p>That downward trend is more than just chance, with a P-value just
under 0.01. Having said that, though, if you look at the confidence
interval for the correlation, it includes almost all the negative
values it could be, so that with only 12 observations we really know
very little about the correlation other than that it appears to be
negative.</p>
<p>Extra:
In practice, you would typically have a much longer time series
of measurements than this, such as monthly measurements for
several years. In looking at only one year, like we did here,
we could get trapped by seasonal effects: for example, cesarean
rates might always go down through the year and then jump up
again in January. Looking at several years would enable us to
disentangle seasonal effects that happen every year from
long-term trends. (As an example of this, think of Toronto
snowfall: there is almost always snow in the winter and there
is never snow in the summer, a seasonal effect, but in
assessing climate change, you want to think about long-term
trends in snowfall, after allowing for which month you’re
looking at.)</p>
</div>
<div id="wolves-and-caribou" class="section level2">
<h2><span class="header-section-number">14.4</span> Wolves and caribou</h2>
<p>In Denali National Park, Alaska, the size of the wolf
population depends on the size of the caribou population (since
wolves hunt and kill caribou). This is a large national park, so
caribou are found in very large herds, so big, in fact, that the
well-being of the entire herd is not threatened by wolf
attacks.
<label for="tufte-mn-114" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-114" class="margin-toggle"><span class="marginnote">In fact, it is believed that wolves help keep caribou herds strong by preventing over-population: that is, the weakest caribou are the ones taken by wolves.</span>
Can the size of the caribou population
be used to predict the size of the wolf population?
The data can be found at
<a href="http://www.utsc.utoronto.ca/~butler/c32/caribou.txt">link</a>. The
columns
are: the date of the survey,
<label for="tufte-mn-115" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-115" class="margin-toggle"><span class="marginnote">The survey is always taken in the fall, but the date varies.</span>
the name of the park employee in charge of the survey, the caribou population (in hundreds) and the wolf population (actual count).
<label for="tufte-mn-116" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-116" class="margin-toggle"><span class="marginnote">Counting animals in a region, especially rare, hard-to-find animals, is a whole science in itself. These numbers are probably estimates (with some uncertainty).</span></p>
<ol style="list-style-type: lower-alpha">
<li>Take a look at the data file. How would you describe its
format? Read it into R, and check that you got something sensible.</li>
</ol>
<p>Solution</p>
<p>This looks at first sight as if it’s separated by spaces, but
most of the data values are separated by <em>more than one</em>
space. If you look further, you’ll see that the values are
<em>lined up in columns</em>, with the variable names aligned at
the top. This is exactly the kind of thing that
<code>read_table</code> will read. We start with the usual
<code>library(tidyverse)</code>:</p>
<div class="sourceCode" id="cb1711"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1711-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1711-2" data-line-number="2">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/caribou.txt&quot;</span></a>
<a class="sourceLine" id="cb1711-3" data-line-number="3">denali=<span class="kw">read_table</span>(my_url)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   date = col_character(),
##   name = col_character(),
##   caribou = col_integer(),
##   wolf = col_integer()
## )</code></pre>
<div class="sourceCode" id="cb1713"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1713-1" data-line-number="1">denali</a></code></pre></div>
<pre><code>## # A tibble: 7 x 4
##   date       name          caribou  wolf
##   &lt;chr&gt;      &lt;chr&gt;           &lt;int&gt; &lt;int&gt;
## 1 09/01/1995 David S.           30    66
## 2 09/24/1996 Youngjin K.        34    79
## 3 10/03/1997 Srinivasan M.      27    70
## 4 09/15/1998 Lee Anne J.        25    60
## 5 09/08/1999 Stephanie T.       17    48
## 6 09/03/2000 Angus Mc D.        23    55
## 7 10/06/2001 David S.           20    60</code></pre>
<p>That worked: four columns with the right names, and the counts of
caribou and wolf are numbers. There are only seven years of surveys;
in real-life data you would have more. But the point here is working
with dates.</p>
<p>The only (small) weirdness is that the
dates are text rather than having been converted into dates. This is
because they are not year-month-day, which is the only format that
gets automatically converted into dates when read in. (You could use
<code>mdy</code> from <code>lubridate</code> to make them dates.)</p>
<p>Extra: you might have wondered how the names survived, even though
they have spaces in them, sometimes more than one. Here’s how the file looks:</p>
<pre><code>
date       name             caribou wolf
09/01/1995 David S.         30       66
09/24/1996 Youngjin K.      34       79
10/03/1997 Srinivasan M.    27       70
09/15/1998 Lee Anne J.      25       60
09/08/1999 Stephanie T.     17       48
09/03/2000 Angus Mc D.      23       55
10/06/2001 David S.         20       60
</code></pre>
<p>What <code>read_table</code> looks for is columns that contain spaces
<em>all the way down</em>, and separates the values there. For example,
between the year of<code>date</code> and the first name in <code>name</code>
there is a space all the way down. After the names and before the
caribou counts there are several spaces, and there is one space
between the words <code>caribou</code> and <code>wolf</code> in the header
line that goes all the way down. Thus four columns, <code>date</code>,
<code>name</code>, <code>caribou</code> and <code>wolf</code>. This means that the
spaces within the names don’t cause any problems at all, since the
spaces aren’t in the same place in <em>every</em> line.
<label for="tufte-mn-117" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-117" class="margin-toggle"><span class="marginnote">The only way this would fail is if <em>every</em> first name had the same number of letters in it; then the space between first name and initial of last name <em>would</em> be in the same place in every line.</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Create a new data frame where the column labelled
<code>date</code> is now a genuine R <code>Date</code>, using something
from <code>lubridate</code>.</li>
</ol>
<p>Solution</p>
<p>What you do is to look at the format of the dates as they are
now. They appear to be month-day-year, American
style.
<label for="tufte-mn-118" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-118" class="margin-toggle"><span class="marginnote">Not a surprise since Denali National Park is in Alaska.</span><br />
Thus the function needed is <code>mdy</code>. It doesn’t matter
whether the months are names or numbers:</p>
<div class="sourceCode" id="cb1716"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1716-1" data-line-number="1">denali <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">date=</span><span class="kw">mdy</span>(date)) -&gt;<span class="st"> </span>denali</a>
<a class="sourceLine" id="cb1716-2" data-line-number="2">denali</a></code></pre></div>
<pre><code>## # A tibble: 7 x 4
##   date       name          caribou  wolf
##   &lt;date&gt;     &lt;chr&gt;           &lt;int&gt; &lt;int&gt;
## 1 1995-09-01 David S.           30    66
## 2 1996-09-24 Youngjin K.        34    79
## 3 1997-10-03 Srinivasan M.      27    70
## 4 1998-09-15 Lee Anne J.        25    60
## 5 1999-09-08 Stephanie T.       17    48
## 6 2000-09-03 Angus Mc D.        23    55
## 7 2001-10-06 David S.           20    60</code></pre>
<p>I lived on the edge and overwrote both my column and the whole data
frame.
<label for="tufte-mn-119" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-119" class="margin-toggle"><span class="marginnote">It’s actually not <em>really</em> living on the edge, because if it doesn’t work, you go back and read the data in from the file again.</span></p>
<p>The dates are displayed in ISO format, year-month-day. You see at the
top of the column that they now really <em>are</em> dates, not just
pieces of text that look like dates.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Create new columns containing the days of
the week and the month names for the dates.</li>
</ol>
<p>Solution</p>
<p>This involves digging in the <code>lubridate</code> help to find out how to extract things from a date. It turns out that <code>wday</code> extracts the day of the week from a date, by default as a number, and <code>month</code> gets the month, also by default as a number:</p>
<div class="sourceCode" id="cb1718"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1718-1" data-line-number="1">denali <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">mon=</span><span class="kw">month</span>(date), <span class="dt">wd=</span><span class="kw">wday</span>(date))</a></code></pre></div>
<pre><code>## # A tibble: 7 x 6
##   date       name          caribou  wolf   mon    wd
##   &lt;date&gt;     &lt;chr&gt;           &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 1995-09-01 David S.           30    66     9     6
## 2 1996-09-24 Youngjin K.        34    79     9     3
## 3 1997-10-03 Srinivasan M.      27    70    10     6
## 4 1998-09-15 Lee Anne J.        25    60     9     3
## 5 1999-09-08 Stephanie T.       17    48     9     4
## 6 2000-09-03 Angus Mc D.        23    55     9     1
## 7 2001-10-06 David S.           20    60    10     7</code></pre>
<p>This is not what we wanted, though; we wanted the names of the months
and of the days. To fix that, add <code>label=T</code> to both functions:</p>
<div class="sourceCode" id="cb1720"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1720-1" data-line-number="1">denali <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">mon=</span><span class="kw">month</span>(date, <span class="dt">label=</span>T), <span class="dt">wd=</span><span class="kw">wday</span>(date, <span class="dt">label=</span>T))</a></code></pre></div>
<pre><code>## # A tibble: 7 x 6
##   date       name          caribou  wolf mon   wd   
##   &lt;date&gt;     &lt;chr&gt;           &lt;int&gt; &lt;int&gt; &lt;ord&gt; &lt;ord&gt;
## 1 1995-09-01 David S.           30    66 Sep   Fri  
## 2 1996-09-24 Youngjin K.        34    79 Sep   Tue  
## 3 1997-10-03 Srinivasan M.      27    70 Oct   Fri  
## 4 1998-09-15 Lee Anne J.        25    60 Sep   Tue  
## 5 1999-09-08 Stephanie T.       17    48 Sep   Wed  
## 6 2000-09-03 Angus Mc D.        23    55 Sep   Sun  
## 7 2001-10-06 David S.           20    60 Oct   Sat</code></pre>
<p>and that cracks it.</p>
<p>No need to save this data frame anywhere, since we’re not using any of
this later.</p>
<p>Extra: the <code>ord</code> means “ordered factor”, which makes sense
since these are categorical variables with a natural order. This means
that you could do something like counting the number of surveys in
each month like this:</p>
<div class="sourceCode" id="cb1722"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1722-1" data-line-number="1">denali <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">mon=</span><span class="kw">month</span>(date, <span class="dt">label=</span>T), <span class="dt">wd=</span><span class="kw">wday</span>(date, <span class="dt">label=</span>T)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1722-2" data-line-number="2"><span class="kw">count</span>(mon)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   mon       n
##   &lt;ord&gt; &lt;int&gt;
## 1 Sep       5
## 2 Oct       2</code></pre>
<ol start="4" style="list-style-type: lower-alpha">
<li>Enough playing around with dates. Make a scatterplot of
caribou population (explanatory) against wolf population
(response). Do you see any relationship?</li>
</ol>
<p>Solution</p>
<p>Nothing terribly surprising here:</p>
<div class="sourceCode" id="cb1724"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1724-1" data-line-number="1"><span class="kw">ggplot</span>(denali, <span class="kw">aes</span>(<span class="dt">x=</span>caribou, <span class="dt">y=</span>wolf))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-31-1.png" width="672"  /></p>
<p>If you like, add a smooth trend to it:
<label for="tufte-mn-120" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-120" class="margin-toggle"><span class="marginnote">This wiggles more than I would like, with such a small number of observations. Try putting someting like <em>span=2</em> in the smooth to make it less wiggly.</span></p>
<div class="sourceCode" id="cb1725"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1725-1" data-line-number="1"><span class="kw">ggplot</span>(denali, <span class="kw">aes</span>(<span class="dt">x=</span>caribou, <span class="dt">y=</span>wolf))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_smooth</span>(<span class="dt">se=</span>F)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-32-1.png" width="672"  /></p>
<p>This is an upward trend: when one population is large, the other one
is large too. This is typical for predator-prey relationships: when
there is more to eat (more caribou) the wolf population goes up, and
when less, it goes down.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>On your plot from the previous part, label each point with
the year it belongs to. You can do this in two steps: first make a
new column containing just the years, and then use it as labels
for the points on the plot.</li>
</ol>
<p>Solution</p>
<p>I’m going to use <code>geom_text_repel</code> for the labels from package
<code>ggrepel</code>. The year values are gotten using the
<code>lubridate</code> function <code>year</code>:</p>
<div class="sourceCode" id="cb1727"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1727-1" data-line-number="1">denali <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">year=</span><span class="kw">year</span>(date)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1727-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>caribou, <span class="dt">y=</span>wolf, <span class="dt">label=</span>year))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_text_repel</span>()</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-33-1.png" width="672"  /></p>
<p>I thought about joining up the points in year order. This is actually
<em>not</em> <code>geom_line</code> as you would have guessed, since what that
does is to join points in the order of the variable on the
<span class="math inline">\(x\)</span>-axis.
<label for="tufte-mn-121" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-121" class="margin-toggle"><span class="marginnote">I have to say that I didn’t know that until just now.</span>
To join points in the order that they are in the data (what we want
here, because the points are in time order in the data), use instead
<code>geom_path</code>:</p>
<div class="sourceCode" id="cb1728"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1728-1" data-line-number="1">denali <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">year=</span><span class="kw">year</span>(date)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1728-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>caribou, <span class="dt">y=</span>wolf, <span class="dt">label=</span>year))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1728-3" data-line-number="3"><span class="kw">geom_text_repel</span>()<span class="op">+</span><span class="kw">geom_path</span>()</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-34-1.png" width="672"  /></p>
<p>In 1996, both populations were large, and both showed a steady decline
until 1999. In 2000 and 2001, both populations seemed to be on the way
up again, and you can imagine that in a couple of years, things would
go back to about where they were in 1995.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Make a plot of caribou population against time (this is done
the obvious way). What seems to be happening to the caribou
population over time?</li>
</ol>
<p>Solution</p>
<p>Make a scatterplot, with the survey date as explanatory
variable, and caribou population as response (since time always
goes on the <span class="math inline">\(x\)</span>-axis):</p>
<div class="sourceCode" id="cb1729"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1729-1" data-line-number="1"><span class="kw">ggplot</span>(denali, <span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>caribou))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-35-1.png" width="672"  /></p>
<p>I used an ordinary <code>geom_line</code> this time, to connect neighbouring
years, as is often done with a time series. The overall trend is
downward, though the 1999 value might be a low from which the
population is recovering.</p>
<ol start="7" style="list-style-type: lower-alpha">
<li>The caribou and wolf populations over time are
really “time series”.
See if you can make a plot of <em>both</em> the
caribou and wolf populations against time. You can make two
<span class="math inline">\(y\)</span>-axes, one for caribou and one for wolf; this will probably
require some research on your part to figure out.</li>
</ol>
<p>Solution</p>
<p>The obvious starting point is to note that both the
<code>caribou</code> and <code>wolf</code> columns are animal
populations, just of different animals. One way of plotting both
populations is to <code>gather</code> them up into one column, and
then plot them against time, with the two animals distinguished
by colour:</p>
<div class="sourceCode" id="cb1730"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1730-1" data-line-number="1">denali <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(animal, population, caribou<span class="op">:</span>wolf)  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1730-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>population, <span class="dt">colour=</span>animal))<span class="op">+</span></a>
<a class="sourceLine" id="cb1730-3" data-line-number="3"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-36-1.png" width="672"  /></p>
<p>This is not quite the story, though, because the caribou and wolf
populations are on different scales. The caribou population is
numbered in hundreds, while the wolf population is an actual count.</p>
<p>The surveys are late in the year, so the one that is nearly in 1996 is
actually the 1995 survey.</p>
<p>What would be nice would be to have a secondary <span class="math inline">\(y\)</span>-axis, so that
there were two <span class="math inline">\(y\)</span>-scales, one for each animal. This is very easy to
manipulate, though (you can change either scale and get a very
different-looking graph), so we ought to be careful.</p>
<p>All right, so let’s put the caribou on the left:</p>
<div class="sourceCode" id="cb1731"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1731-1" data-line-number="1"><span class="kw">ggplot</span>(denali, <span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>caribou))<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-37-1.png" width="672"  /></p>
<p>Or we can add a <code>colour</code> aesthetic to distinguish the caribou
from the wolf populations, that we’re going to add in a moment. This looks rather odd at first:</p>
<div class="sourceCode" id="cb1732"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1732-1" data-line-number="1"><span class="kw">ggplot</span>(denali, <span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>caribou, <span class="dt">colour=</span><span class="st">&quot;caribou&quot;</span>))<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-38-1.png" width="672"  /></p>
<p>Now we think about adding the wolf numbers. This is done by adding a
second <code>geom_line</code>, overriding the <code>y</code> and the
<code>colour</code> to specify that this is wolf now:</p>
<div class="sourceCode" id="cb1733"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1733-1" data-line-number="1"><span class="kw">ggplot</span>(denali, <span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>caribou, <span class="dt">colour=</span><span class="st">&quot;caribou&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb1733-2" data-line-number="2"><span class="kw">geom_line</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1733-3" data-line-number="3"><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>wolf, <span class="dt">colour=</span><span class="st">&quot;wolf&quot;</span>))</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-39-1.png" width="672"  /></p>
<p>What has happened is that we get lines of different colour for each
animal, with a legend. So far so good. The problem is that the wolf
numbers are about 2.5 times bigger than the caribou
numbers,
<label for="tufte-mn-122" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-122" class="margin-toggle"><span class="marginnote">Which means, if you stop to think about it, that there are <em>actually</em> about 40 times more caribou than wolves.</span>
so that
we don’t get a good sense of how they go up and down together. If we
divided the wolf numbers by 2.5, we would see this better:</p>
<div class="sourceCode" id="cb1734"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1734-1" data-line-number="1"><span class="kw">ggplot</span>(denali, <span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>caribou, <span class="dt">colour=</span><span class="st">&quot;caribou&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb1734-2" data-line-number="2"><span class="kw">geom_line</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1734-3" data-line-number="3"><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>wolf<span class="op">/</span><span class="fl">2.5</span>, <span class="dt">colour=</span><span class="st">&quot;wolf&quot;</span>))</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-40-1.png" width="672"  /></p>
<p>Now we get to the secondary <span class="math inline">\(y\)</span>-axis. We want to label this
<code>wolf</code> and have it reflect that we actually made the graph by
dividing the wolf values by 2.5:</p>
<div class="sourceCode" id="cb1735"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1735-1" data-line-number="1"><span class="kw">ggplot</span>(denali, <span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>caribou, <span class="dt">colour=</span><span class="st">&quot;caribou&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb1735-2" data-line-number="2"><span class="kw">geom_line</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1735-3" data-line-number="3"><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>wolf<span class="op">/</span><span class="fl">2.5</span>, <span class="dt">colour=</span><span class="st">&quot;wolf&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb1735-4" data-line-number="4"><span class="kw">scale_y_continuous</span>(<span class="dt">sec.axis=</span><span class="kw">sec_axis</span>(<span class="op">~</span>.<span class="op">/</span><span class="fl">2.5</span>,<span class="dt">name=</span><span class="st">&quot;wolf&quot;</span>))</a></code></pre></div>
<p><img src="13-dates-and-times_files/figure-html/unnamed-chunk-41-1.png" width="672"  /></p>
<p>Woo, and, very possibly, hoo. I got most of these ideas from
<a href="https://rpubs.com/MarkusLoew/226759">link</a>.</p>
<p>Now we see how the populations vary over time, and also that they vary
together.</p>
<p>This is about the only double-<span class="math inline">\(y\)</span>-axis setup that I like, with scales
chosen so that both the series vary about the same amount. By
“discreetly” changing the wolf scale, you could make it look as if
one population was much bigger than the other, or varied much more
than the other. Lies and statistics.</p>
<p>In my opinion, too many people just plot series against time, possibly
with a second <span class="math inline">\(y\)</span>-axis.
<label for="tufte-mn-123" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-123" class="margin-toggle"><span class="marginnote">And all too often with Excel (spit).</span>
Variables that vary together, like the wolf
and caribou populations here, ought to be plotted  on a scatterplot, possibly with the time points labelled.</p>
<p>The ambitious among you may like to compare the graphs here with
other predator-prey relationships. If you are of a mathematical bent,
you might look into the Lotka-Volterra equations, which is a system of
two differential equations describing how changes in one population
cause changes in the other population.</p>

</div>
</div>
<p style="text-align: center;">
<a href="regression.html"><button class="btn btn-default">Previous</button></a>
<a href="functions.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
