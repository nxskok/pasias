<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Problems and Solutions in Applied Statistics" />
<meta property="og:type" content="book" />
<meta property="og:url" content="<a href="http://ritsokiguess.site/pasias" class="uri">http://ritsokiguess.site/pasias</a>" />

<meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
<meta name="github-repo" content="nxskok/pasias" />

<meta name="author" content="Ken Butler" />

<meta name="date" content="2019-01-07" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics">

<title>Problems and Solutions in Applied Statistics</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="packages-used-somewhere-in-this-book.html#packages-used-somewhere-in-this-book"><span class="toc-section-number">2</span> Packages used somewhere in this book</a></li>
<li class="has-sub"><a href="getting-used-to-r-and-r-studio.html#getting-used-to-r-and-r-studio"><span class="toc-section-number">3</span> Getting used to R and R Studio</a><ul>
<li><a href="getting-used-to-r-and-r-studio.html#getting-an-r-studio-cloud-account"><span class="toc-section-number">3.1</span> Getting an R Studio Cloud account</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#getting-started"><span class="toc-section-number">3.2</span> Getting started</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#reading-data-from-a-file"><span class="toc-section-number">3.3</span> Reading data from a file</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#reading-files-different-ways"><span class="toc-section-number">3.4</span> Reading files different ways</a></li>
</ul></li>
<li class="has-sub"><a href="reading-in-data-and-drawing-some-graphs.html#reading-in-data-and-drawing-some-graphs"><span class="toc-section-number">4</span> Reading in data and drawing some graphs</a><ul>
<li><a href="reading-in-data-and-drawing-some-graphs.html#orange-juice"><span class="toc-section-number">4.1</span> Orange juice</a></li>
<li><a href="reading-in-data-and-drawing-some-graphs.html#making-soap"><span class="toc-section-number">4.2</span> Making soap</a></li>
<li><a href="reading-in-data-and-drawing-some-graphs.html#handling-shipments"><span class="toc-section-number">4.3</span> Handling shipments</a></li>
</ul></li>
<li class="has-sub"><a href="data-exploration.html#data-exploration"><span class="toc-section-number">5</span> Data exploration</a><ul>
<li><a href="data-exploration.html#north-carolina-births"><span class="toc-section-number">5.1</span> North Carolina births</a></li>
<li><a href="data-exploration.html#more-about-the-nc-births"><span class="toc-section-number">5.2</span> More about the NC births</a></li>
<li><a href="data-exploration.html#nenana-alaska"><span class="toc-section-number">5.3</span> Nenana, Alaska</a></li>
<li><a href="data-exploration.html#computerized-accounting"><span class="toc-section-number">5.4</span> Computerized accounting</a></li>
<li><a href="data-exploration.html#test-scores-in-two-classes"><span class="toc-section-number">5.5</span> Test scores in two classes</a></li>
</ul></li>
<li class="has-sub"><a href="one-sample-inference.html#one-sample-inference"><span class="toc-section-number">6</span> One-sample inference</a><ul>
<li><a href="one-sample-inference.html#hunter-gatherers-in-australia"><span class="toc-section-number">6.1</span> Hunter-gatherers in Australia</a></li>
<li><a href="one-sample-inference.html#buses-to-boulder"><span class="toc-section-number">6.2</span> Buses to Boulder</a></li>
<li><a href="one-sample-inference.html#length-of-gestation-in-north-carolina"><span class="toc-section-number">6.3</span> Length of gestation in North Carolina</a></li>
<li><a href="one-sample-inference.html#inferring-ice-break-up-in-nenana"><span class="toc-section-number">6.4</span> Inferring ice break-up in Nenana</a></li>
</ul></li>
<li class="has-sub"><a href="two-sample-inference.html#two-sample-inference"><span class="toc-section-number">7</span> Two-sample inference</a><ul>
<li><a href="two-sample-inference.html#children-and-electronic-devices"><span class="toc-section-number">7.1</span> Children and electronic devices</a></li>
<li><a href="two-sample-inference.html#parking-close-to-the-curb"><span class="toc-section-number">7.2</span> Parking close to the curb</a></li>
<li><a href="two-sample-inference.html#bell-peppers-and-too-much-water"><span class="toc-section-number">7.3</span> Bell peppers and too much water</a></li>
<li><a href="two-sample-inference.html#exercise-and-anxiety-and-bullying-mice"><span class="toc-section-number">7.4</span> Exercise and anxiety and bullying mice</a></li>
<li><a href="two-sample-inference.html#diet-and-growth-in-boys"><span class="toc-section-number">7.5</span> Diet and growth in boys</a></li>
</ul></li>
<li class="has-sub"><a href="power-and-sample-size.html#power-and-sample-size"><span class="toc-section-number">8</span> Power and sample size</a><ul>
<li><a href="power-and-sample-size.html#simulating-power"><span class="toc-section-number">8.1</span> Simulating power</a></li>
<li><a href="power-and-sample-size.html#calculating-power-and-sample-size-for-estimating-mean"><span class="toc-section-number">8.2</span> Calculating power and sample size for estimating mean</a></li>
<li><a href="power-and-sample-size.html#simulating-power-for-proportions"><span class="toc-section-number">8.3</span> Simulating power for proportions</a></li>
</ul></li>
<li class="has-sub"><a href="the-sign-test-and-moods-median-test.html#the-sign-test-and-moods-median-test"><span class="toc-section-number">9</span> The sign test and Mood’s median test</a><ul>
<li><a href="the-sign-test-and-moods-median-test.html#running-a-maze"><span class="toc-section-number">9.1</span> Running a maze</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#chocolate-chips"><span class="toc-section-number">9.2</span> Chocolate chips</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#the-power-of-the-sign-test"><span class="toc-section-number">9.3</span> The power of the sign test</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#sugar-in-breakfast-cereals"><span class="toc-section-number">9.4</span> Sugar in breakfast cereals</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#fear-of-math"><span class="toc-section-number">9.5</span> Fear of math</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#medical-instructions"><span class="toc-section-number">9.6</span> Medical instructions</a></li>
</ul></li>
<li class="has-sub"><a href="matched-pairs-t-and-sign-test.html#matched-pairs-t-and-sign-test"><span class="toc-section-number">10</span> Matched pairs t and sign test</a><ul>
<li><a href="matched-pairs-t-and-sign-test.html#measuring-body-fat"><span class="toc-section-number">10.1</span> Measuring body fat</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#throwing-baseballs-and-softballs"><span class="toc-section-number">10.2</span> Throwing baseballs and softballs</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#throwing-baseballs-and-softballs-again"><span class="toc-section-number">10.3</span> Throwing baseballs and softballs, again</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#changes-in-salary"><span class="toc-section-number">10.4</span> Changes in salary</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#body-fat-revisited"><span class="toc-section-number">10.5</span> Body fat revisited</a></li>
</ul></li>
<li class="has-sub"><a href="normal-quantile-plots.html#normal-quantile-plots"><span class="toc-section-number">11</span> Normal quantile plots</a><ul>
<li><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers"><span class="toc-section-number">11.1</span> Lengths of heliconia flowers</a></li>
<li><a href="normal-quantile-plots.html#ferritin-and-normality"><span class="toc-section-number">11.2</span> Ferritin and normality</a></li>
</ul></li>
<li class="has-sub"><a href="analysis-of-variance.html#analysis-of-variance"><span class="toc-section-number">12</span> Analysis of variance</a><ul>
<li><a href="analysis-of-variance.html#movie-ratings-and-lengths"><span class="toc-section-number">12.1</span> Movie ratings and lengths</a></li>
<li><a href="analysis-of-variance.html#deer-and-how-much-they-eat"><span class="toc-section-number">12.2</span> Deer and how much they eat</a></li>
<li><a href="analysis-of-variance.html#movie-ratings-again"><span class="toc-section-number">12.3</span> Movie ratings again</a></li>
<li><a href="analysis-of-variance.html#atomic-weight-of-carbon"><span class="toc-section-number">12.4</span> Atomic weight of carbon</a></li>
<li><a href="analysis-of-variance.html#can-caffeine-improve-your-performance-on-a-test"><span class="toc-section-number">12.5</span> Can caffeine improve your performance on a test?</a></li>
</ul></li>
<li class="has-sub"><a href="tidying-and-selecting-data.html#tidying-and-selecting-data"><span class="toc-section-number">13</span> Tidying and selecting data</a><ul>
<li><a href="tidying-and-selecting-data.html#tidying-the-jays-data"><span class="toc-section-number">13.1</span> Tidying the Jays data</a></li>
<li><a href="tidying-and-selecting-data.html#baseball-and-softball-spaghetti"><span class="toc-section-number">13.2</span> Baseball and softball spaghetti</a></li>
<li><a href="tidying-and-selecting-data.html#ethanol-and-sleep-time-in-rats"><span class="toc-section-number">13.3</span> Ethanol and sleep time in rats</a></li>
<li><a href="tidying-and-selecting-data.html#growth-of-tomatoes"><span class="toc-section-number">13.4</span> Growth of tomatoes</a></li>
<li><a href="tidying-and-selecting-data.html#pain-relief-in-migraine-headaches-again"><span class="toc-section-number">13.5</span> Pain relief in migraine headaches (again)</a></li>
<li><a href="tidying-and-selecting-data.html#location-species-and-disease-in-plants"><span class="toc-section-number">13.6</span> Location, species and disease in plants</a></li>
<li><a href="tidying-and-selecting-data.html#mating-songs-in-crickets"><span class="toc-section-number">13.7</span> Mating songs in crickets</a></li>
<li><a href="tidying-and-selecting-data.html#cars"><span class="toc-section-number">13.8</span> Cars</a></li>
<li><a href="tidying-and-selecting-data.html#number-1-songs"><span class="toc-section-number">13.9</span> Number 1 songs</a></li>
<li><a href="tidying-and-selecting-data.html#bikes-on-college"><span class="toc-section-number">13.10</span> Bikes on College</a></li>
<li><a href="tidying-and-selecting-data.html#feeling-the-heat"><span class="toc-section-number">13.11</span> Feeling the heat</a></li>
</ul></li>
<li class="has-sub"><a href="regression.html#regression"><span class="toc-section-number">14</span> Regression</a><ul>
<li><a href="regression.html#rainfall-in-california"><span class="toc-section-number">14.1</span> Rainfall in California</a></li>
<li><a href="regression.html#carbon-monoxide-in-cigarettes"><span class="toc-section-number">14.2</span> Carbon monoxide in cigarettes</a></li>
<li><a href="regression.html#maximal-oxygen-uptake-in-young-boys"><span class="toc-section-number">14.3</span> Maximal oxygen uptake in young boys</a></li>
<li><a href="regression.html#facebook-friends-and-grey-matter"><span class="toc-section-number">14.4</span> Facebook friends and grey matter</a></li>
<li><a href="regression.html#endogenous-nitrogen-excretion-in-carp"><span class="toc-section-number">14.5</span> Endogenous nitrogen excretion in carp</a></li>
<li><a href="regression.html#sparrowhawks"><span class="toc-section-number">14.6</span> Sparrowhawks</a></li>
<li><a href="regression.html#salaries-of-social-workers"><span class="toc-section-number">14.7</span> Salaries of social workers</a></li>
<li><a href="regression.html#predicting-volume-of-wood-in-pine-trees"><span class="toc-section-number">14.8</span> Predicting volume of wood in pine trees</a></li>
<li><a href="regression.html#tortoise-shells-and-eggs"><span class="toc-section-number">14.9</span> Tortoise shells and eggs</a></li>
<li><a href="regression.html#crickets-revisited"><span class="toc-section-number">14.10</span> Crickets revisited</a></li>
<li><a href="regression.html#roller-coasters"><span class="toc-section-number">14.11</span> Roller coasters</a></li>
<li><a href="regression.html#running-and-blood-sugar"><span class="toc-section-number">14.12</span> Running and blood sugar</a></li>
<li><a href="regression.html#calories-and-fat-in-pizza"><span class="toc-section-number">14.13</span> Calories and fat in pizza</a></li>
<li><a href="regression.html#where-should-the-fire-stations-be"><span class="toc-section-number">14.14</span> Where should the fire stations be?</a></li>
<li><a href="regression.html#being-satisfied-with-hospital"><span class="toc-section-number">14.15</span> Being satisfied with hospital</a></li>
<li><a href="regression.html#handling-shipments-of-chemicals"><span class="toc-section-number">14.16</span> Handling shipments of chemicals</a></li>
<li><a href="regression.html#salaries-of-mathematicians"><span class="toc-section-number">14.17</span> Salaries of mathematicians</a></li>
<li><a href="regression.html#predicting-gpa-of-computer-science-students"><span class="toc-section-number">14.18</span> Predicting GPA of computer science students</a></li>
</ul></li>
<li class="has-sub"><a href="dates-and-times.html#dates-and-times"><span class="toc-section-number">15</span> Dates and times</a><ul>
<li><a href="dates-and-times.html#dealing-with-dates-in-the-worcester-heart-attack-study"><span class="toc-section-number">15.1</span> Dealing with dates in the Worcester Heart Attack study</a></li>
<li><a href="dates-and-times.html#growth-of-mizuna-lettuce-seeds"><span class="toc-section-number">15.2</span> Growth of Mizuna lettuce seeds</a></li>
<li><a href="dates-and-times.html#types-of-childbirth"><span class="toc-section-number">15.3</span> Types of childbirth</a></li>
<li><a href="dates-and-times.html#wolves-and-caribou"><span class="toc-section-number">15.4</span> Wolves and caribou</a></li>
</ul></li>
<li class="has-sub"><a href="functions.html#functions"><span class="toc-section-number">16</span> Functions</a><ul>
<li><a href="functions.html#making-some-r-functions"><span class="toc-section-number">16.1</span> Making some R functions</a></li>
<li><a href="functions.html#the-collatz-sequence"><span class="toc-section-number">16.2</span> The Collatz sequence</a></li>
</ul></li>
<li class="has-sub"><a href="the-bootstrap.html#the-bootstrap"><span class="toc-section-number">17</span> The Bootstrap</a><ul>
<li><a href="the-bootstrap.html#air-conditioning-failures"><span class="toc-section-number">17.1</span> Air conditioning failures</a></li>
<li><a href="the-bootstrap.html#air-conditioning-failures-bootstrapping-the-median"><span class="toc-section-number">17.2</span> Air conditioning failures: bootstrapping the median</a></li>
</ul></li>
<li class="has-sub"><a href="bayesian-statistics-with-rstan.html#bayesian-statistics-with-rstan"><span class="toc-section-number">18</span> Bayesian Statistics with <code>rstan</code></a><ul>
<li><a href="bayesian-statistics-with-rstan.html#estimating-proportion-in-favour-from-a-survey"><span class="toc-section-number">18.1</span> Estimating proportion in favour from a survey</a></li>
<li><a href="bayesian-statistics-with-rstan.html#bayesian-regression"><span class="toc-section-number">18.2</span> Bayesian regression</a></li>
</ul></li>
<li class="has-sub"><a href="logistic-regression.html#logistic-regression"><span class="toc-section-number">19</span> Logistic regression</a><ul>
<li><a href="logistic-regression.html#finding-wolf-spiders-on-the-beach"><span class="toc-section-number">19.1</span> Finding wolf spiders on the beach</a></li>
<li><a href="logistic-regression.html#killing-aphids"><span class="toc-section-number">19.2</span> Killing aphids</a></li>
<li><a href="logistic-regression.html#the-effects-of-substance-a"><span class="toc-section-number">19.3</span> The effects of Substance A</a></li>
<li><a href="logistic-regression.html#what-makes-an-animal-get-infected"><span class="toc-section-number">19.4</span> What makes an animal get infected?</a></li>
<li><a href="logistic-regression.html#the-brain-of-a-cat"><span class="toc-section-number">19.5</span> The brain of a cat</a></li>
<li><a href="logistic-regression.html#how-not-to-get-heart-disease"><span class="toc-section-number">19.6</span> How not to get heart disease</a></li>
<li><a href="logistic-regression.html#successful-breastfeeding"><span class="toc-section-number">19.7</span> Successful breastfeeding</a></li>
<li><a href="logistic-regression.html#making-it-over-the-mountains"><span class="toc-section-number">19.8</span> Making it over the mountains</a></li>
<li><a href="logistic-regression.html#who-needs-the-most-intensive-care"><span class="toc-section-number">19.9</span> Who needs the most intensive care?</a></li>
<li><a href="logistic-regression.html#go-away-and-dont-come-back"><span class="toc-section-number">19.10</span> Go away and don’t come back!</a></li>
</ul></li>
<li class="has-sub"><a href="logistic-regression-with-ordinal-or-nominal-response.html#logistic-regression-with-ordinal-or-nominal-response"><span class="toc-section-number">20</span> Logistic regression with ordinal or nominal response</a><ul>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#do-you-like-your-mobile-phone"><span class="toc-section-number">20.1</span> Do you like your mobile phone?</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#attitudes-towards-abortion"><span class="toc-section-number">20.2</span> Attitudes towards abortion</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#finding-non-missing-values"><span class="toc-section-number">20.3</span> Finding non-missing values</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#european-social-survey-and-voting"><span class="toc-section-number">20.4</span> European Social Survey and voting</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#alligator-food"><span class="toc-section-number">20.5</span> Alligator food</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#how-do-you-like-your-steak-the-data"><span class="toc-section-number">20.6</span> How do you like your steak – the data</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#crimes-in-san-francisco-the-data"><span class="toc-section-number">20.7</span> Crimes in San Francisco – the data</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#how-do-you-like-your-steak"><span class="toc-section-number">20.8</span> How do you like your steak?</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#crimes-in-san-francisco"><span class="toc-section-number">20.9</span> Crimes in San Francisco</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#high-school-and-beyond"><span class="toc-section-number">20.10</span> High School and Beyond</a></li>
<li><a href="logistic-regression-with-ordinal-or-nominal-response.html#what-sports-do-these-athletes-play"><span class="toc-section-number">20.11</span> What sports do these athletes play?</a></li>
</ul></li>
<li class="has-sub"><a href="survival-analysis.html#survival-analysis"><span class="toc-section-number">21</span> Survival analysis</a><ul>
<li><a href="survival-analysis.html#the-worcester-survey"><span class="toc-section-number">21.1</span> The Worcester survey</a></li>
<li><a href="survival-analysis.html#drug-treatment-programs"><span class="toc-section-number">21.2</span> Drug treatment programs</a></li>
<li><a href="survival-analysis.html#multiple-myeloma"><span class="toc-section-number">21.3</span> Multiple myeloma</a></li>
<li><a href="survival-analysis.html#ovarian-cancer"><span class="toc-section-number">21.4</span> Ovarian cancer</a></li>
</ul></li>
<li class="has-sub"><a href="analysis-of-variance-revisited.html#analysis-of-variance-revisited"><span class="toc-section-number">22</span> Analysis of variance revisited</a><ul>
<li><a href="analysis-of-variance-revisited.html#acid-rain"><span class="toc-section-number">22.1</span> Acid rain</a></li>
<li><a href="analysis-of-variance-revisited.html#treating-hay-fever"><span class="toc-section-number">22.2</span> Treating hay fever</a></li>
<li><a href="analysis-of-variance-revisited.html#focused-comparisons-of-the-effect-of-caffeine"><span class="toc-section-number">22.3</span> Focused comparisons of the effect of caffeine</a></li>
<li><a href="analysis-of-variance-revisited.html#who-studies-the-most-outside-class"><span class="toc-section-number">22.4</span> Who studies the most outside class?</a></li>
<li><a href="analysis-of-variance-revisited.html#mental-context"><span class="toc-section-number">22.5</span> Mental context</a></li>
<li><a href="analysis-of-variance-revisited.html#trying-on-shirts"><span class="toc-section-number">22.6</span> Trying on shirts</a></li>
<li><a href="analysis-of-variance-revisited.html#productivity-and-research-and-development"><span class="toc-section-number">22.7</span> Productivity and research-and-development</a></li>
<li><a href="analysis-of-variance-revisited.html#treating-leprosy"><span class="toc-section-number">22.8</span> Treating leprosy</a></li>
</ul></li>
<li class="has-sub"><a href="multivariate-analysis-of-variance.html#multivariate-analysis-of-variance"><span class="toc-section-number">23</span> Multivariate analysis of variance</a><ul>
<li><a href="multivariate-analysis-of-variance.html#fabricated-data"><span class="toc-section-number">23.1</span> Fabricated data</a></li>
<li><a href="multivariate-analysis-of-variance.html#do-characteristics-of-urine-depend-on-obesity"><span class="toc-section-number">23.2</span> Do characteristics of urine depend on obesity?</a></li>
<li><a href="multivariate-analysis-of-variance.html#how-do-height-and-weight-depend-on-sport-played-by-elite-athletes"><span class="toc-section-number">23.3</span> How do height and weight depend on sport played by elite athletes?</a></li>
</ul></li>
<li class="has-sub"><a href="repeated-measures.html#repeated-measures"><span class="toc-section-number">24</span> Repeated measures</a><ul>
<li><a href="repeated-measures.html#effect-of-drug-on-rat-weight"><span class="toc-section-number">24.1</span> Effect of drug on rat weight</a></li>
<li><a href="repeated-measures.html#social-interaction-among-old-people"><span class="toc-section-number">24.2</span> Social interaction among old people</a></li>
<li><a href="repeated-measures.html#childrens-stress-levels-and-airports"><span class="toc-section-number">24.3</span> Children’s stress levels and airports</a></li>
<li><a href="repeated-measures.html#body-fat-as-repeated-measures"><span class="toc-section-number">24.4</span> Body fat as repeated measures</a></li>
<li><a href="repeated-measures.html#investigating-motor-activity-in-rats"><span class="toc-section-number">24.5</span> Investigating motor activity in rats</a></li>
<li><a href="repeated-measures.html#repeated-measures-with-no-background"><span class="toc-section-number">24.6</span> Repeated measures with no background</a></li>
</ul></li>
<li class="has-sub"><a href="discriminant-analysis.html#discriminant-analysis"><span class="toc-section-number">25</span> Discriminant analysis</a><ul>
<li><a href="discriminant-analysis.html#telling-whether-a-banknote-is-real-or-counterfeit"><span class="toc-section-number">25.1</span> Telling whether a banknote is real or counterfeit</a></li>
<li><a href="discriminant-analysis.html#urine-and-obesity-what-makes-a-difference"><span class="toc-section-number">25.2</span> Urine and obesity: what makes a difference?</a></li>
<li><a href="discriminant-analysis.html#understanding-a-manova"><span class="toc-section-number">25.3</span> Understanding a MANOVA</a></li>
<li><a href="discriminant-analysis.html#what-distinguishes-people-who-do-different-jobs"><span class="toc-section-number">25.4</span> What distinguishes people who do different jobs?</a></li>
<li><a href="discriminant-analysis.html#observing-children-with-adhd"><span class="toc-section-number">25.5</span> Observing children with ADHD</a></li>
<li><a href="discriminant-analysis.html#growing-corn"><span class="toc-section-number">25.6</span> Growing corn</a></li>
<li><a href="discriminant-analysis.html#understanding-athletes-height-weight-sport-and-gender"><span class="toc-section-number">25.7</span> Understanding athletes’ height, weight, sport and gender</a></li>
</ul></li>
<li class="has-sub"><a href="cluster-analysis.html#cluster-analysis"><span class="toc-section-number">26</span> Cluster analysis</a><ul>
<li><a href="cluster-analysis.html#sites-on-the-sea-bed"><span class="toc-section-number">26.1</span> Sites on the sea bed</a></li>
<li><a href="cluster-analysis.html#dissimilarities-between-fruits"><span class="toc-section-number">26.2</span> Dissimilarities between fruits</a></li>
<li><a href="cluster-analysis.html#similarity-of-species"><span class="toc-section-number">26.3</span> Similarity of species</a></li>
<li><a href="cluster-analysis.html#rating-beer"><span class="toc-section-number">26.4</span> Rating beer</a></li>
<li><a href="cluster-analysis.html#clustering-the-swiss-bills"><span class="toc-section-number">26.5</span> Clustering the Swiss bills</a></li>
<li><a href="cluster-analysis.html#grouping-similar-cars"><span class="toc-section-number">26.6</span> Grouping similar cars</a></li>
<li><a href="cluster-analysis.html#running-jumping-and-throwing"><span class="toc-section-number">26.7</span> Running, jumping, and throwing</a></li>
<li><a href="cluster-analysis.html#bridges-in-pittsburgh"><span class="toc-section-number">26.8</span> Bridges in Pittsburgh</a></li>
<li><a href="cluster-analysis.html#clustering-the-australian-athletes"><span class="toc-section-number">26.9</span> Clustering the Australian athletes</a></li>
</ul></li>
<li class="has-sub"><a href="multidimensional-scaling.html#multidimensional-scaling"><span class="toc-section-number">27</span> Multidimensional Scaling</a><ul>
<li><a href="multidimensional-scaling.html#making-a-map-of-wisconsin"><span class="toc-section-number">27.1</span> Making a map of Wisconsin</a></li>
<li><a href="multidimensional-scaling.html#things-that-feel-similar-to-each-other"><span class="toc-section-number">27.2</span> Things that feel similar to each other</a></li>
<li><a href="multidimensional-scaling.html#confusing-letters"><span class="toc-section-number">27.3</span> Confusing letters</a></li>
<li><a href="multidimensional-scaling.html#more-beer-please"><span class="toc-section-number">27.4</span> More beer please</a></li>
<li><a href="multidimensional-scaling.html#feeling-similar-again"><span class="toc-section-number">27.5</span> Feeling similar, again</a></li>
</ul></li>
<li class="has-sub"><a href="principal-components-and-factor-analysis.html#principal-components-and-factor-analysis"><span class="toc-section-number">28</span> Principal Components and Factor Analysis</a><ul>
<li><a href="principal-components-and-factor-analysis.html#the-weather-somewhere"><span class="toc-section-number">28.1</span> The weather, somewhere</a></li>
<li><a href="principal-components-and-factor-analysis.html#air-pollution"><span class="toc-section-number">28.2</span> Air pollution</a></li>
<li><a href="principal-components-and-factor-analysis.html#a-correlation-matrix"><span class="toc-section-number">28.3</span> A correlation matrix</a></li>
<li><a href="principal-components-and-factor-analysis.html#the-interpersonal-circumplex"><span class="toc-section-number">28.4</span> The Interpersonal Circumplex</a></li>
</ul></li>
<li class="has-sub"><a href="frequency-table-analysis.html#frequency-table-analysis"><span class="toc-section-number">29</span> Frequency table analysis</a><ul>
<li><a href="frequency-table-analysis.html#college-plans"><span class="toc-section-number">29.1</span> College plans</a></li>
<li><a href="frequency-table-analysis.html#predicting-voting"><span class="toc-section-number">29.2</span> Predicting voting</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="the-sign-test-and-moods-median-test" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> The sign test and Mood’s median test</h1>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb434-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<pre><code>## ── Attaching packages ────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.2.1     ✔ purrr   0.3.2
## ✔ tibble  2.1.3     ✔ dplyr   0.8.3
## ✔ tidyr   1.0.0     ✔ stringr 1.4.0
## ✔ readr   1.3.1     ✔ forcats 0.4.0</code></pre>
<pre><code>## ── Conflicts ───────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb438-1" data-line-number="1"><span class="kw">library</span>(smmr)</a></code></pre></div>
<pre><code>## Warning: `env_bind_fns()` is deprecated as of rlang 0.3.0.
## Please use `env_bind_active()` instead.
## This warning is displayed once per session.</code></pre>
<div id="running-a-maze" class="section level2">
<h2><span class="header-section-number">9.1</span> Running a maze</h2>
<p>A researcher is trying to design a maze that can be run by
rats in about 60 seconds. One particular maze was run by a sample of
21 rats, with the times shown in
<a href="http://www.utsc.utoronto.ca/~butler/c32/maze.txt">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data into R. What (if anything) are the data values
delimited by?</li>
</ol>
<p>Solution</p>
<p>Take a look at the data file first. There is only one column of
data, so you can treat it as being delimited by anything you like:
a space, or a comma (the file can also be treated as a
<code>.csv</code>), etc.:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" data-line-number="1">myurl &lt;-<span class="st"> &quot;http://www.utsc.utoronto.ca/~butler/c32/maze.txt&quot;</span></a>
<a class="sourceLine" id="cb440-2" data-line-number="2">times &lt;-<span class="st"> </span><span class="kw">read_delim</span>(myurl, <span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   time = col_double()
## )</code></pre>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb442-1" data-line-number="1">times</a></code></pre></div>
<pre><code>## # A tibble: 21 x 1
##     time
##    &lt;dbl&gt;
##  1  38.4
##  2  46.2
##  3  62.5
##  4  38  
##  5  62.8
##  6  33.9
##  7  50.4
##  8  35  
##  9  52.8
## 10  60.1
## # … with 11 more rows</code></pre>
<ol start="2" style="list-style-type: lower-alpha">
<li>Run a sign test, doing it yourself as we did in class:
count the number of values above and below 60, take the <em>smaller</em>
of those, and find the probability of a value of that or smaller still
on a binomial distribution with <span class="math inline">\(n=21\)</span> and <span class="math inline">\(p=0.5\)</span> (we have 21 data
points), doubling the answer because the test is two-sided.</li>
</ol>
<p>Solution</p>
<p>Count how many values are above and below 60:</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb444-1" data-line-number="1">times <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(time <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   `time &gt; 60`     n
##   &lt;lgl&gt;       &lt;int&gt;
## 1 FALSE          16
## 2 TRUE            5</code></pre>
<p>5 above and 16 below. Then find out how likely it is that a binomial
with <span class="math inline">\(n=21, p=0.5\)</span> would produce 5 or fewer successes:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb446-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dbinom</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">21</span>, <span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb446-2" data-line-number="2">p</a></code></pre></div>
<pre><code>## [1] 0.01330185</code></pre>
<p>or if you prefer count upwards from 16:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb448-1" data-line-number="1"><span class="kw">sum</span>(<span class="kw">dbinom</span>(<span class="dv">16</span><span class="op">:</span><span class="dv">21</span>, <span class="dv">21</span>, <span class="fl">0.5</span>))</a></code></pre></div>
<pre><code>## [1] 0.01330185</code></pre>
<p>and double it to get a two-sided P-value:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb450-1" data-line-number="1"><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>p</a></code></pre></div>
<pre><code>## [1] 0.0266037</code></pre>
<p>We’ll compare this with <code>smmr</code> in a moment.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Install my package <code>smmr</code>, if you haven’t already. To do
this, you first need to install the package <code>devtools</code> (if you
haven’t already),
by going to the console and typing</li>
</ol>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb452-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</a></code></pre></div>
<p>When that’s all done, install <code>smmr</code> thus:</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb453-1" data-line-number="1"><span class="kw">library</span>(devtools)</a>
<a class="sourceLine" id="cb453-2" data-line-number="2"><span class="kw">install_github</span>(<span class="st">&quot;nxskok/smmr&quot;</span>)</a></code></pre></div>
<p>That all needs to be done only once. Then, each R Studio session where
you want to use <code>smmr</code> needs this:</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb454-1" data-line-number="1"><span class="kw">library</span>(smmr)</a></code></pre></div>
<pre><code>## Warning: `quo_expr()` is deprecated as of rlang 0.2.0.
## Please use `quo_squash()` instead.
## This warning is displayed once per session.</code></pre>
<p>As usual, only the <code>library</code> thing only needs to be done every
time.</p>
<p>When you have <code>smmr</code> installed, use <code>sign_test</code> from
that package to re-run your sign test. Do you get the same P-value?</p>
<p>Solution</p>
<p>The sign test function takes a data frame, an (unquoted) column
name from that data frame of data to test the median of, and a
null median (which defaults to 0 if you omit it):</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb456-1" data-line-number="1"><span class="kw">library</span>(smmr)</a>
<a class="sourceLine" id="cb456-2" data-line-number="2"><span class="kw">sign_test</span>(times, time, <span class="dv">60</span>)</a></code></pre></div>
<pre><code>## $above_below
## below above 
##    16     5 
## 
## $p_values
##   alternative    p_value
## 1       lower 0.01330185
## 2       upper 0.99640131
## 3   two-sided 0.02660370</code></pre>
<p>This shows you two things: a count of the values below and above the
null median, and then the P-values according to the various
alternative hypotheses you might have.</p>
<p>In our case, we see again the 16 maze-running times below 60 seconds
and 5 above (one of which was a long way above, but we don’t care
about that here). We were testing whether the median was different
from 60, so we look at the two-sided P-value of 0.0266, which is
exactly what we had before.</p>
<p>If <code>sign_test</code> doesn’t work for you (perhaps because it needs
a function <code>enquo</code> that you don’t have), there is an
alternative function <code>sign_test0</code> that doesn’t use it. It
requires as input a <em>column</em> of values (extracted from the data
frame) and a null median, thus:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb458-1" data-line-number="1"><span class="kw">with</span>(times, <span class="kw">sign_test0</span>(time, <span class="dv">60</span>))</a></code></pre></div>
<pre><code>## $above_below
## below above 
##    16     5 
## 
## $p_values
##   alternative    p_value
## 1       lower 0.01330185
## 2       upper 0.99640131
## 3   two-sided 0.02660370</code></pre>
<p>The output should be, and here is, identical.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Package <code>smmr</code> also has a function
<code>pval_sign</code>, which has the same input as
<code>sign_test</code>, but with the null median <em>first</em>.
Run it on your data and see what it gives.</li>
</ol>
<p>Solution</p>
<p>Try it and see:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb460-1" data-line-number="1"><span class="kw">pval_sign</span>(<span class="dv">60</span>, times, time)</a></code></pre></div>
<pre><code>## [1] 0.0266037</code></pre>
<p>The two-sided P-value, and that is all. We’ll be using this in a minute.</p>
<p>Alternatively, there is also this, which needs a null median and a
<em>column</em> as input:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb462-1" data-line-number="1"><span class="kw">with</span>(times, <span class="kw">pval_sign0</span>(<span class="dv">60</span>, time))</a></code></pre></div>
<pre><code>## [1] 0.0266037</code></pre>
<ol start="5" style="list-style-type: lower-alpha">
<li>Obtain a 95% confidence interval for the median based on these
data. Do this two ways. First, use the trial and error way from class
(either the try-lots-of-values way or the bisection way; either is good).
Second, use <code>ci_median</code> from <code>smmr</code>. The latter takes
as input a data frame, a column name (unquoted) and optionally a
<code>conf.level</code> that defaults to 0.95.</li>
</ol>
<p>Solution</p>
<p>The reason for showing you <code>pval_sign</code> in the previous
part is that this is a building block for the confidence interval.
What we do is to try various null medians
and find out which ones give P-values less than 0.05 (outside the
interval) and which ones bigger (inside).
We know that the value 60 is
outside the 95% CI, and the sample median is close to 50 (which we
expect to be inside), so sensible values to try for the upper end of
the interval would be between 50 and 60:</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb464-1" data-line-number="1"><span class="kw">pval_sign</span>(<span class="dv">58</span>, times, time)</a></code></pre></div>
<pre><code>## [1] 0.0266037</code></pre>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb466-1" data-line-number="1"><span class="kw">pval_sign</span>(<span class="dv">55</span>, times, time)</a></code></pre></div>
<pre><code>## [1] 0.6636238</code></pre>
<p>So, 55 is inside the interval and 58 is outside. I could investigate
further in similar fashion, but I thought I would try a whole bunch of null
medians all at once. That goes like this:</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb468-1" data-line-number="1">meds &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">55</span>, <span class="dv">58</span>, <span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb468-2" data-line-number="2">meds</a></code></pre></div>
<pre><code>##  [1] 55.00 55.25 55.50 55.75 56.00 56.25 56.50 56.75 57.00 57.25 57.50
## [12] 57.75 58.00</code></pre>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb470-1" data-line-number="1">pvals &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(meds, pval_sign, times, time)</a>
<a class="sourceLine" id="cb470-2" data-line-number="2"><span class="kw">data.frame</span>(meds, pvals)</a></code></pre></div>
<pre><code>##     meds      pvals
## 1  55.00 0.66362381
## 2  55.25 0.38331032
## 3  55.50 0.26317596
## 4  55.75 0.18924713
## 5  56.00 0.18924713
## 6  56.25 0.18924713
## 7  56.50 0.07835388
## 8  56.75 0.07835388
## 9  57.00 0.07835388
## 10 57.25 0.07835388
## 11 57.50 0.07835388
## 12 57.75 0.02660370
## 13 58.00 0.02660370</code></pre>
<p>So values for the median all the way up to and including 57.5 are in
the confidence interval.</p>
<p>What <code>map_dbl</code> does is to take a vector of values, here the
ones in <code>meds</code> (55 through 58 in steps of 0.25), feed them into
a function, here <code>pval_sign</code>, one by one and gather together
the results. <code>pval_sign</code> has two other inputs, <code>times</code> and
<code>time</code>, which are added to <code>map_dbl</code> at the end. (They
are the same no matter what median we are testing.) So, putting the
calculated P-values side by side with the null medians they belong to
shows you which medians are inside the confidence interval and which
are outside.</p>
<p>The function is called <code>map_dbl</code> because <em>my</em> function
called <code>pval_sign</code> that is called repeatedly returns a single
decimal number (a <code>dbl</code>). There is also, for example,
<code>map_chr</code> for repeatedly calling a function that returns a
single piece of text, and plain <code>map</code> that is used when the
repeatedly-called function returns a data frame.</p>
<p>Since you don’t know about <code>map_dbl</code>, I didn’t want to confuse
things more than necessary, but now that you <em>do</em> know what it
does, you might be in a better position to understand this more
Tidyverse-flavoured code, with the <code>map_dbl</code> inside a
<code>mutate</code> and the data frame created as we go:</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb472-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">meds =</span> <span class="kw">seq</span>(<span class="dv">55</span>, <span class="dv">58</span>, <span class="fl">0.25</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb472-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pvals =</span> <span class="kw">map_dbl</span>(meds, pval_sign, times, time))</a></code></pre></div>
<pre><code>## # A tibble: 13 x 2
##     meds  pvals
##    &lt;dbl&gt;  &lt;dbl&gt;
##  1  55   0.664 
##  2  55.2 0.383 
##  3  55.5 0.263 
##  4  55.8 0.189 
##  5  56   0.189 
##  6  56.2 0.189 
##  7  56.5 0.0784
##  8  56.8 0.0784
##  9  57   0.0784
## 10  57.2 0.0784
## 11  57.5 0.0784
## 12  57.8 0.0266
## 13  58   0.0266</code></pre>
<p>Now for the other end of the interval. I’m going to do this a
different way: more efficient, but less transparent. The first thing I
need is a pair of values for the median: one inside the interval and
one outside. Let’s try 40 and 50:</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb474-1" data-line-number="1"><span class="kw">pval_sign</span>(<span class="dv">40</span>, times, time)</a></code></pre></div>
<pre><code>## [1] 0.00719738</code></pre>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb476-1" data-line-number="1"><span class="kw">pval_sign</span>(<span class="dv">50</span>, times, time)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>OK, so 40 is outside and 50 is inside. So what do I guess for the next
value to try? I could do something clever like assuming that the
relationship between hypothesized median and P-value is <em>linear</em>,
and then guessing where that line crosses 0.05. But I’m going to
assume <em>nothing</em> about the relationship except that it goes
uphill, and therefore crosses 0.05 somewhere. So my next guess is
halfway between the two values I tried before:</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb478-1" data-line-number="1"><span class="kw">pval_sign</span>(<span class="dv">45</span>, times, time)</a></code></pre></div>
<pre><code>## [1] 0.07835388</code></pre>
<p>So, 45 is inside the interval, and my (slightly) improved guess at the
bottom end of the interval is that it’s between 40 and 45. So next, I
try halfway between <em>those</em>:</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb480-1" data-line-number="1"><span class="kw">pval_sign</span>(<span class="fl">42.5</span>, times, time)</a></code></pre></div>
<pre><code>## [1] 0.0266037</code></pre>
<p>42.5 is outside, so the bottom end of the interval is between 42.5 and 45.</p>
<p>What we are doing is narrowing down where the interval’s bottom end
is. We started by knowing it to within 10, and now we know it to
within 2.5. So if we keep going, we’ll know it as accurately as we wish.</p>
<p>This is called a “bisection” method, because at each step, we’re
dividing our interval by 2.</p>
<p>There is one piece of decision-making at each step: if the P-value for
the median you try is greater than 0.05, that becomes the top end of
your interval (as when we tried 45); if it is less, it becomes the
bottom end (when we tried 42.5).</p>
<p>This all begs to be automated into a loop. It’s not a
<code>for</code>-type loop, because we don’t know how many times we’ll be
going around. It’s a <code>while</code> loop: keep going while something
is true. Here’s how it goes:</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb482-1" data-line-number="1">lo &lt;-<span class="st"> </span><span class="dv">40</span></a>
<a class="sourceLine" id="cb482-2" data-line-number="2">hi &lt;-<span class="st"> </span><span class="dv">50</span></a>
<a class="sourceLine" id="cb482-3" data-line-number="3"><span class="cf">while</span> (<span class="kw">abs</span>(hi <span class="op">-</span><span class="st"> </span>lo) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.1</span>) {</a>
<a class="sourceLine" id="cb482-4" data-line-number="4">  try &lt;-<span class="st"> </span>(hi <span class="op">+</span><span class="st"> </span>lo) <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb482-5" data-line-number="5">  ptry &lt;-<span class="st"> </span><span class="kw">pval_sign</span>(try, times, time)</a>
<a class="sourceLine" id="cb482-6" data-line-number="6">  <span class="kw">print</span>(<span class="kw">c</span>(try, ptry))</a>
<a class="sourceLine" id="cb482-7" data-line-number="7">  <span class="cf">if</span> (ptry <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>) {</a>
<a class="sourceLine" id="cb482-8" data-line-number="8">    lo &lt;-<span class="st"> </span>try</a>
<a class="sourceLine" id="cb482-9" data-line-number="9">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb482-10" data-line-number="10">    hi &lt;-<span class="st"> </span>try</a>
<a class="sourceLine" id="cb482-11" data-line-number="11">  }</a>
<a class="sourceLine" id="cb482-12" data-line-number="12">}</a></code></pre></div>
<pre><code>## [1] 45.00000000  0.07835388
## [1] 42.5000000  0.0266037
## [1] 43.7500000  0.0266037
## [1] 44.37500000  0.07835388
## [1] 44.0625000  0.0266037
## [1] 44.2187500  0.0266037
## [1] 44.2968750  0.0266037</code></pre>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb484-1" data-line-number="1">lo</a></code></pre></div>
<pre><code>## [1] 44.29688</code></pre>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb486-1" data-line-number="1"><span class="kw">pval_sign</span>(lo, times, time)</a></code></pre></div>
<pre><code>## [1] 0.0266037</code></pre>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb488-1" data-line-number="1">hi</a></code></pre></div>
<pre><code>## [1] 44.375</code></pre>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb490-1" data-line-number="1"><span class="kw">pval_sign</span>(hi, times, time)</a></code></pre></div>
<pre><code>## [1] 0.07835388</code></pre>
<p>The loop stopped because 44.297 and 44.375 are less than 0.1
apart. The first of those is outside the interval and the second is
inside. So the bottom end of our interval is 44.375, to this
accuracy. If you want it more accurately, change 0.1 in the
<code>while</code> line to something smaller (but then you’ll be waiting
longer for the answer).</p>
<p>I put the <code>print</code> statement in the loop so that you could see
what values were being tried, and what P-values they were
producing. What happens with these is that the P-value jumps at each
data value, so you won’t get a P-value exactly 0.05; you’ll get one
above and one below.</p>
<p>Likewise, you can use the function with a zero on its name and feed it
a column rather than a data frame and a column name:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb492-1" data-line-number="1">meds &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">55</span>, <span class="dv">58</span>, <span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb492-2" data-line-number="2">meds</a></code></pre></div>
<pre><code>##  [1] 55.00 55.25 55.50 55.75 56.00 56.25 56.50 56.75 57.00 57.25 57.50
## [12] 57.75 58.00</code></pre>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb494-1" data-line-number="1">pvals &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(meds, <span class="op">~</span><span class="st"> </span><span class="kw">with</span>(times, <span class="kw">pval_sign0</span>(., time)))</a>
<a class="sourceLine" id="cb494-2" data-line-number="2"><span class="kw">data.frame</span>(meds, pvals)</a></code></pre></div>
<pre><code>##     meds      pvals
## 1  55.00 0.66362381
## 2  55.25 0.38331032
## 3  55.50 0.26317596
## 4  55.75 0.18924713
## 5  56.00 0.18924713
## 6  56.25 0.18924713
## 7  56.50 0.07835388
## 8  56.75 0.07835388
## 9  57.00 0.07835388
## 10 57.25 0.07835388
## 11 57.50 0.07835388
## 12 57.75 0.02660370
## 13 58.00 0.02660370</code></pre>
<p>Or adapt the idea I had above for bisection.
All that was a lot of work, but I wanted you to see it all once, so that you
know where the confidence interval is coming from. <code>smmr</code> also
has a function <code>ci_median</code> that does all of the above without
you having to do it. As I first wrote it, it was using the trial and
error thing with <code>map_dbl</code>, but I chose to rewrite it with the
bisection idea, because I thought that would be more accurate.</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb496-1" data-line-number="1"><span class="kw">ci_median</span>(times, time)</a></code></pre></div>
<pre><code>## [1] 44.30747 57.59766</code></pre>
<p>This is a more accurate interval than we got above. (The
<code>while</code> loop for the bisection keeps going until the two
guesses at the appropriate end of the interval are less than 0.01
apart, by default.)
<label for="tufte-mn-27" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-27" class="margin-toggle"><span class="marginnote">You can change this by adding something like <em>tol=1e-4</em> to the end of your <em>ci-median</em>.</span></p>
<p>If you want some other confidence level, you add <code>conf.level</code>
on the end, as you would for <code>t.test</code>:</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb498-1" data-line-number="1"><span class="kw">ci_median</span>(times, time, <span class="dt">conf.level =</span> <span class="fl">0.75</span>)</a></code></pre></div>
<pre><code>## [1] 46.20444 55.49473</code></pre>
<p>A 75% CI, just for fun. This is a shorter interval than the 95% one,
as it should be.</p>
<p>Likewise there is a <code>ci_median0</code> that takes a column and an
optional confidence level:</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb500-1" data-line-number="1"><span class="kw">with</span>(times, <span class="kw">ci_median0</span>(time))</a></code></pre></div>
<pre><code>## [1] 44.30747 57.59766</code></pre>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb502-1" data-line-number="1"><span class="kw">with</span>(times, <span class="kw">ci_median0</span>(time, <span class="dt">conf.level =</span> <span class="fl">0.75</span>))</a></code></pre></div>
<pre><code>## [1] 46.20444 55.49473</code></pre>
<p>with the same results. Try <code>ci_median</code> first, and if it
doesn’t work, try <code>ci_median0</code>.</p>
</div>
<div id="chocolate-chips" class="section level2">
<h2><span class="header-section-number">9.2</span> Chocolate chips</h2>
<p>A famous cookie manufacturer claims that
their bags of chocolate chip cookies contain “more than 1100 chocolate chips on average”. A diligent group of students buys 16
bags of these cookies and counts the number of chocolate chips in each
bag. The results are in <a href="http://www.utsc.utoronto.ca/~butler/c32/chips.txt" class="uri">http://www.utsc.utoronto.ca/~butler/c32/chips.txt</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in and display (some of) the data.</li>
</ol>
<p>Solution</p>
<p>I’ll pretend it’s a
<code>.csv</code> this time, just for fun. Give the data frame a
name different from <code>chips</code>, so that you don’t get
confused:</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb504-1" data-line-number="1">bags=<span class="kw">read_csv</span>(<span class="st">&quot;chips.txt&quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   chips = col_double()
## )</code></pre>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb506-1" data-line-number="1">bags</a></code></pre></div>
<pre><code>## # A tibble: 16 x 1
##    chips
##    &lt;dbl&gt;
##  1  1219
##  2  1214
##  3  1087
##  4  1200
##  5  1419
##  6  1121
##  7  1325
##  8  1345
##  9  1244
## 10  1258
## 11  1356
## 12  1132
## 13  1191
## 14  1270
## 15  1295
## 16  1135</code></pre>
<p>That looks sensible.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Build your own sign test in R for testing that the median is
1100 chocolate chips, against the alternative that it is greater.
(Do this as in class: count the appropriate thing,
compare it with an appropriate binomial distribution, and obtain a
P-value.</li>
</ol>
<p>Solution</p>
<p>The null median is 1100, so we count the number
of values above and below:</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb508-1" data-line-number="1">bags <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(chips<span class="op">&lt;</span><span class="dv">1100</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   `chips &lt; 1100`     n
##   &lt;lgl&gt;          &lt;int&gt;
## 1 FALSE             15
## 2 TRUE               1</code></pre>
<p>The un-standard thing there is that we can put a logical condition
directly into the <code>count</code>. If you don’t think of that, you can
also do this, which creates a new variable <code>less</code> that is
<code>TRUE</code> or <code>FALSE</code> for each bag appropriately:</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb510-1" data-line-number="1">bags <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">less=</span>(chips<span class="op">&lt;</span><span class="dv">1100</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(less)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   less      n
##   &lt;lgl&gt; &lt;int&gt;
## 1 FALSE    15
## 2 TRUE      1</code></pre>
<p>or the more verbose</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb512-1" data-line-number="1">bags <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">less=</span>(chips<span class="op">&lt;</span><span class="dv">1100</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb512-2" data-line-number="2"><span class="kw">group_by</span>(less) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">howmany=</span><span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   less  howmany
##   &lt;lgl&gt;   &lt;int&gt;
## 1 FALSE      15
## 2 TRUE        1</code></pre>
<p>Just one value below, with all the rest above.
Getting the right P-value, properly, requires some careful thought
(but you will probably get the right answer anyway). If the
alternative hypothesis is true, and the median is actually bigger than
1100 (say, 1200), you would expect half the data values to be bigger
than 1200 and half smaller. So <em>more</em> than half the data values
would be bigger than <em>1100</em>, and fewer than half of them would be
less than 1100. So, if we are going to reject the null (as it looks as
if we will), that small number of values below 1100 is what we want.</p>
<p>The P-value is the probability of a value 1 or less in a binomial
distribution with <span class="math inline">\(n=16, p=0.5\)</span>:</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb514-1" data-line-number="1"><span class="kw">sum</span>(<span class="kw">dbinom</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,<span class="dv">16</span>,<span class="fl">0.5</span>))</a></code></pre></div>
<pre><code>## [1] 0.0002593994</code></pre>
<p>Or, equivalently, count <em>up</em> from 15:</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb516-1" data-line-number="1"><span class="kw">sum</span>(<span class="kw">dbinom</span>(<span class="dv">15</span><span class="op">:</span><span class="dv">16</span>,<span class="dv">16</span>,<span class="fl">0.5</span>))</a></code></pre></div>
<pre><code>## [1] 0.0002593994</code></pre>
<p>This is correctly one-sided, so we don’t have to do anything with
it.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Use my R package <code>smmr</code> to reproduce your sign test
above, and verify that you get consistent results. (See the
maze-design question for instructions on installing this, if you
haven’t yet.)</li>
</ol>
<p>Solution</p>
<p>This will mean reading the output carefully:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb518-1" data-line-number="1"><span class="kw">library</span>(smmr)</a>
<a class="sourceLine" id="cb518-2" data-line-number="2"><span class="kw">sign_test</span>(bags,chips,<span class="dv">1100</span>)</a></code></pre></div>
<pre><code>## $above_below
## below above 
##     1    15 
## 
## $p_values
##   alternative      p_value
## 1       lower 0.9999847412
## 2       upper 0.0002593994
## 3   two-sided 0.0005187988</code></pre>
<p>This time, we’re doing a one-sided test, specifically an
<em>upper-tail</em> test, since we are looking for evidence that the
median is <em>greater than</em> 1100. The results are exactly what we
got “by hand”: 15 values above and one below, and a P-value (look
along the <code>upper</code> line) of 0.00026.
The two-sided P-value of 0.00052 rounds to the same 0.0005 as SAS got.</p>
<p>Alternatively, you can do this:</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb520-1" data-line-number="1"><span class="kw">sign_test0</span>(bags<span class="op">$</span>chips,<span class="dv">1100</span>)</a></code></pre></div>
<pre><code>## $above_below
## below above 
##     1    15 
## 
## $p_values
##   alternative      p_value
## 1       lower 0.9999847412
## 2       upper 0.0002593994
## 3   two-sided 0.0005187988</code></pre>
<p>with the same result (but only go this way if you need to).</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Use <code>smmr</code> to obtain a 95% confidence interval for the
median number of chocolate chips per bag of cookies.</li>
</ol>
<p>Solution</p>
<p>Once everything is in place, this is simplicity itself:</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb522-1" data-line-number="1"><span class="kw">ci_median</span>(bags,chips)</a></code></pre></div>
<pre><code>## [1] 1135.003 1324.996</code></pre>
<p>1135 to 1325. I would round these off to whole numbers, since the data
values are all whole numbers. These values are all above 1100, which
supports the conclusion we got above that the median is above
1100. This is as it should be, because the CI is “all those medians that would <em>not</em> be rejected by the sign test”.</p>
<p>Or,</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb524-1" data-line-number="1"><span class="kw">ci_median0</span>(bags<span class="op">$</span>chips)</a></code></pre></div>
<pre><code>## [1] 1135.003 1324.996</code></pre>
</div>
<div id="the-power-of-the-sign-test" class="section level2">
<h2><span class="header-section-number">9.3</span> The power of the sign test</h2>
<p>I’ve mentioned several times that the sign test has less
power than the <span class="math inline">\(t\)</span>-test. Let’s investigate this with a specific example.</p>
<p>Let’s suppose we are testing <span class="math inline">\(H_0: \mu=40\)</span> against <span class="math inline">\(H_a: \mu \ne 40\)</span>,
where <span class="math inline">\(\mu\)</span> is the population mean (and median, as we shall see). Our
population actually has a normal distribution with mean 50 and SD 15,
so that the null hypothesis is <em>wrong</em> and we want to reject it
most of the time. On the other hand, the population actually <em>is</em>
normally-distributed and so the <span class="math inline">\(t\)</span>-test is the right one to use.</p>
<p>(This is an old question, so I tackle the simulated power differently
than I did it in class this time. But see if you can follow what I do
here.)</p>
<ol style="list-style-type: lower-alpha">
<li>Use <code>power.t.test</code> to find the probability that a
<span class="math inline">\(t\)</span>-test correctly rejects the null hypothesis using a sample size
of <span class="math inline">\(n=10\)</span>.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb526-1" data-line-number="1"><span class="kw">power.t.test</span>(<span class="dt">delta=</span><span class="dv">50-40</span>,<span class="dt">n=</span><span class="dv">10</span>,<span class="dt">sd=</span><span class="dv">15</span>,<span class="dt">type=</span><span class="st">&quot;one.sample&quot;</span>,<span class="dt">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</a></code></pre></div>
<pre><code>## 
##      One-sample t test power calculation 
## 
##               n = 10
##           delta = 10
##              sd = 15
##       sig.level = 0.05
##           power = 0.4691805
##     alternative = two.sided</code></pre>
<p>The power is 0.469. Not great, but we’ll see how this stacks up
against the sign test.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>What code in R would draw a random sample of size 10 from the
<em>true</em> population distribution and save the sample in a variable?</li>
</ol>
<p>Solution</p>
<p>The data actually have a normal distribution with mean 50 and
SD 15, so we use <code>rnorm</code> with this mean and SD, obtaining
10 values:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb528-1" data-line-number="1">x=<span class="kw">rnorm</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">15</span>)  </a>
<a class="sourceLine" id="cb528-2" data-line-number="2">x</a></code></pre></div>
<pre><code>##  [1]  65.18397  49.29537  47.10528 101.07841  59.79886  52.75204  49.37039
##  [8]  51.94922  50.28833  61.43263</code></pre>
<ol start="3" style="list-style-type: lower-alpha">
<li>What code would count how many of the sampled values are less
than 40 and how many are greater (or equal)?</li>
</ol>
<p>Solution</p>
<p>The way we know this is to put <code>x</code> into a data frame first:</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb530-1" data-line-number="1"><span class="kw">tibble</span>(x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(x<span class="op">&lt;</span><span class="dv">40</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   `x &lt; 40`     n
##   &lt;lgl&gt;    &lt;int&gt;
## 1 FALSE       10</code></pre>
<p>2 values less (and 8 greater-or-equal).</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>It turns out the sign test would reject <span class="math inline">\(H_0: M=40\)</span> against
<span class="math inline">\(H_a: M \ne 40\)</span> at <span class="math inline">\(\alpha=0.05\)</span> if the smaller of the numbers in the
last part is 1 or less. (<span class="math inline">\(M\)</span> is the population median.)
Add to your pipeline to obtain <code>TRUE</code>
if you should reject the null for your
data and <code>FALSE</code> otherwise.</li>
</ol>
<p>Solution</p>
<p>This is actually easier than you might think. The output from
<code>count</code> is a data frame with a column called <code>n</code>,
whose minimum value you want. I add to my pipeline:</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb532-1" data-line-number="1"><span class="kw">tibble</span>(x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(x<span class="op">&lt;</span><span class="dv">40</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb532-2" data-line-number="2"><span class="kw">summarize</span>(<span class="dt">the_min=</span><span class="kw">min</span>(n)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb532-3" data-line-number="3"><span class="kw">mutate</span>(<span class="dt">is_rejected=</span>(the_min<span class="op">&lt;=</span><span class="dv">1</span>))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   the_min is_rejected
##     &lt;int&gt; &lt;lgl&gt;      
## 1      10 FALSE</code></pre>
<p>This will fail sometimes. If all 10 of your sample values are greater
than 40, which they might turn out to be, you’ll get a table with only
one line, <code>FALSE</code> and 10; the minimum of the <code>n</code> values
is 10 (since there is only one), and it will falsely say that you
should not reject. The fix is</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb534-1" data-line-number="1"><span class="kw">tibble</span>(x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(x<span class="op">&lt;</span><span class="dv">40</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb534-2" data-line-number="2"><span class="kw">summarize</span>(<span class="dt">the_min=</span><span class="kw">min</span>(n)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb534-3" data-line-number="3"><span class="kw">mutate</span>(<span class="dt">is_rejected=</span>(the_min<span class="op">&lt;=</span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>the_min<span class="op">==</span><span class="dv">10</span>))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   the_min is_rejected
##     &lt;int&gt; &lt;lgl&gt;      
## 1      10 TRUE</code></pre>
<p>The above is almost the right thing, but not quite: we only want that value
that I called <code>is_rejected</code>, rather than the whole data frame,
so a <code>pull</code> will grab it:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb536-1" data-line-number="1"><span class="kw">tibble</span>(x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(x<span class="op">&lt;</span><span class="dv">40</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb536-2" data-line-number="2"><span class="kw">summarize</span>(<span class="dt">the_min=</span><span class="kw">min</span>(n)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb536-3" data-line-number="3"><span class="kw">mutate</span>(<span class="dt">is_rejected=</span>(the_min<span class="op">&lt;=</span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>the_min<span class="op">==</span><span class="dv">10</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb536-4" data-line-number="4"><span class="kw">pull</span>(is_rejected)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>You might be wondering where the “1 or less” came from. Getting a
P-value for the sign test involves the binomial distribution: if the
null is correct, each data value is independently either above or
below 40, with probability 0.5 of each, so the number of values below
40 (say) is binomial with <span class="math inline">\(n=10\)</span> and <span class="math inline">\(p=0.5\)</span>. The P-value for 1
observed value below 40 and the rest above is</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb538-1" data-line-number="1"><span class="dv">2</span><span class="op">*</span><span class="kw">pbinom</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="fl">0.5</span>)  </a></code></pre></div>
<pre><code>## [1] 0.02148438</code></pre>
<p>which is less than 0.05; the P-value for 2 values below 40 and the
rest above is</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb540-1" data-line-number="1"><span class="dv">2</span><span class="op">*</span><span class="kw">pbinom</span>(<span class="dv">2</span>,<span class="dv">10</span>,<span class="fl">0.5</span>)    </a></code></pre></div>
<pre><code>## [1] 0.109375</code></pre>
<p>which is bigger than 0.05.</p>
<p>You might have encountered the term “critical region” for a
test. This is the values of your test statistic that you would reject
the null hypothesis for. In this case, the critical region is 1 and 0
observations below 40, along with 1 and 0 observations above 40.</p>
<p>When you’re thinking about power, I think it’s easiest to think in
terms of the critical region (rather than directly in terms of
P-values) since you have a certain <span class="math inline">\(\alpha\)</span> in mind all the way
through, 0.05 in the power examples that I’ve done. The steps are then:</p>
<ul>
<li><p>Work out the critical region for your test, the values of the
test statistic (or sample mean or sample count) that would lead to
rejecting the null hypothesis.</p></li>
<li><p>Under your particular alternative hypothesis, find the
probability of falling into your critical region.</p></li>
</ul>
<p>When I say “work out”, I mean either calculating (along the lines of
STAB57), or simulating, as we have done here.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Use <code>rerun</code> to simulate the above process 1000 times:
drawing a random sample from a normal distribution with mean 50 and SD
15, counting the number of values below and above 40, rejecting if the
minimum of those is 1 or less, then counting the number of rejections
out of 1000.</li>
</ol>
<p>Solution</p>
<p>The way we’ve used <code>rerun</code> is to use it to select the
random samples, and then we use <code>map</code> ideas to do what we
want to do with each random sample, along the lines of what we did
with the one random sample above.
This is liable to go wrong the first few times, so make sure that
each line works before you go on to the next. (<code>rerun</code> will
produce you a <code>list</code> of random samples, with each of which
you want to do something.) While you’re debugging, try it with a
small number of random samples like 5.
I start with setting the random number seed, so it comes out the
same each time. I discuss the results below and the code below that.</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb542-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">457299</span>)</a>
<a class="sourceLine" id="cb542-2" data-line-number="2"><span class="kw">rerun</span>(<span class="dv">1000</span>,<span class="kw">rnorm</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">15</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb542-3" data-line-number="3"><span class="kw">map</span>(<span class="op">~</span><span class="kw">tibble</span>(<span class="dt">x=</span>.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb542-4" data-line-number="4"><span class="kw">map</span>(<span class="op">~</span><span class="kw">count</span>(.,x<span class="op">&lt;</span><span class="dv">40</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb542-5" data-line-number="5"><span class="kw">map</span>(<span class="op">~</span><span class="kw">summarize</span>(.,<span class="dt">the_min=</span><span class="kw">min</span>(n))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb542-6" data-line-number="6"><span class="kw">map</span>(<span class="op">~</span><span class="kw">mutate</span>(.,<span class="dt">is_rejected=</span>(the_min<span class="op">&lt;=</span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>the_min<span class="op">==</span><span class="dv">10</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb542-7" data-line-number="7"><span class="kw">map_lgl</span>(<span class="op">~</span><span class="kw">pull</span>(.,is_rejected)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb542-8" data-line-number="8"><span class="kw">tibble</span>(<span class="dt">was_true=</span>.) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb542-9" data-line-number="9"><span class="kw">count</span>(was_true)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   was_true     n
##   &lt;lgl&gt;    &lt;int&gt;
## 1 FALSE      757
## 2 TRUE       243</code></pre>
<p>The estimated power of the sign test is 0.243, since that was the
number of times a simulated sample gave us 0 or 1 values above or
below 40 (and the rest on the other side).</p>
<p>All right, that code is seriously scary. Let me try to take you
through it.</p>
<ul>
<li><p>The <code>rerun</code> line is the same kind of thing we had before:
generate 1000 different random samples of size 10 from a normal
distribution with mean 50 and SD 15.</p></li>
<li><p>The output from the previous step is a <code>list</code> of
vectors. But we like data frames to count things in, so for each
vector we turn it into a data frame, filling a column called
<code>x</code> with whatever was in each vector (that random sample). So
now we have 1000 data frames each containing a column called
<code>x</code>.</p></li>
<li><p>Next, in each of those data frames, count up how many of the
<code>x</code> values are less than 40. This will produce a data frame
each time containing a column <code>n</code> that is the
frequencies. Here and below, the <code>.</code> is used to denote
“it”: that is, each of the elements of the list created originally
by <code>rerun</code> that we are doing something with. Also, at the
moment, the output for each element of the list is a data frame, so
we stick with <code>map</code> for the time being.</p></li>
<li><p>Next, for each of those tables of frequencies, find the smallest
one and call it <code>the_min</code>. (As discussed above, all the
values might be bigger than 40, in which case <code>the_min</code> will
be 10 rather than 0, which we handle next.)</p></li>
<li><p>Next, we create a new column called <code>is_rejected</code> which
says that we should reject a median of 40 if the minimum value we
just calculated is 1 or less, or if it happens to be 10, in which
case that would have been the only entry in the frequency table, so
that the missing one would have been zero.</p></li>
<li><p>Next, we pull out only the true-or-false value in
<code>is_rejected</code>. At last, the answer here is not a data frame
but a simple logical value; <code>map_lgl</code> is like
<code>map_dbl</code> except that the thing we are doing returns a
<code>TRUE</code> or a <code>FALSE</code> rather than a number.</p></li>
<li><p>At this point we have a vector of 1000 true-or-false. We want to
count them, so we put them into a data frame (with a column called
<code>was_true</code>), and in the last line, count them up. There are
243 (correct) rejections and 757 (incorrect) non-rejections.</p></li>
</ul>
<p>You may now breathe again.</p>
<p>I’m now thinking a better way to do this is to write a function that
takes a sample (in a vector) and returns a TRUE or FALSE according to
whether or not a median of 40 would be rejected for that sample:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb544-1" data-line-number="1">is_reject=<span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb544-2" data-line-number="2"><span class="kw">tibble</span>(<span class="dt">x=</span>x) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb544-3" data-line-number="3"><span class="kw">count</span>(x<span class="op">&lt;</span><span class="dv">40</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb544-4" data-line-number="4"><span class="kw">summarize</span>(<span class="dt">the_min=</span><span class="kw">min</span>(n)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb544-5" data-line-number="5"><span class="kw">mutate</span>(<span class="dt">is_rejected=</span>the_min<span class="op">&lt;=</span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>the_min<span class="op">==</span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb544-6" data-line-number="6"><span class="kw">pull</span>(is_rejected)</a>
<a class="sourceLine" id="cb544-7" data-line-number="7">}</a></code></pre></div>
<p>Now, we have to use that. This function will be “mapped” over for
each of the random samples that come out of <code>rerun</code>, but now
there will be only one <code>map</code> because the complication of the
multiple <code>maps</code> has been subsumed into this one function. I’ll
set my random number seed so that I get the same results as before:</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb545-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">457299</span>)</a>
<a class="sourceLine" id="cb545-2" data-line-number="2"><span class="kw">rerun</span>(<span class="dv">1000</span>,<span class="kw">rnorm</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">15</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb545-3" data-line-number="3"><span class="kw">map_lgl</span>(<span class="op">~</span><span class="kw">is_reject</span>(.)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb545-4" data-line-number="4"><span class="kw">tibble</span>(<span class="dt">rejected=</span>.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb545-5" data-line-number="5"><span class="kw">count</span>(rejected)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   rejected     n
##   &lt;lgl&gt;    &lt;int&gt;
## 1 FALSE      757
## 2 TRUE       243</code></pre>
<p>Same results, and yeah, I like that a lot better.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Which is more powerful in this case, the sign test or the
<span class="math inline">\(t\)</span>-test? How do you know?</li>
</ol>
<p>Solution</p>
<p>The power of the sign test is estimated as 0.243, which is quite a bit less
than the power of the <span class="math inline">\(t\)</span>-test, which we found back in (a) to be
0.469. So the <span class="math inline">\(t\)</span>-test, in this situation where it is valid, is
the right test to use: it is (i) valid and (ii) more powerful.
So the <span class="math inline">\(t\)</span>-test is more powerful. One way to think about how
<em>much</em> more powerful is to ask “how much smaller of a sample size would be needed for the <span class="math inline">\(t\)</span>-test to have the same power as this sign test?”
The power of my sign test was 0.243, so in
<code>power.t.test</code> we set
<code>power</code> equal to that and
omit the sample size <code>n</code>:</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb547-1" data-line-number="1"><span class="kw">power.t.test</span>(<span class="dt">delta=</span><span class="dv">50-40</span>,<span class="dt">power=</span><span class="fl">0.243</span>,<span class="dt">sd=</span><span class="dv">15</span>,<span class="dt">type=</span><span class="st">&quot;one.sample&quot;</span>,<span class="dt">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</a></code></pre></div>
<pre><code>## 
##      One-sample t test power calculation 
## 
##               n = 5.599293
##           delta = 10
##              sd = 15
##       sig.level = 0.05
##           power = 0.243
##     alternative = two.sided</code></pre>
<p>A sample of size 6 gives the same power for the <span class="math inline">\(t\)</span>-test that a
sample of size 10 does for the sign test. The ratio of these two
sample sizes is called the <em>relative efficiency</em> of the two
tests: in this case, the <span class="math inline">\(t\)</span>-test is <span class="math inline">\(10/6=1.67\)</span> times more
efficient. The data that you have are being used “more efficiently”
by the <span class="math inline">\(t\)</span>-test.
It is possible to derive
<label for="tufte-mn-28" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-28" class="margin-toggle"><span class="marginnote">Meaning, I forget how to do it. But it has something to do with looking at alternatives that are very close to the null.</span><br />
the limiting relative efficiency of
the <span class="math inline">\(t\)</span> test relative to the sign test when the data are actually
normal, as the sample size gets larger. This turns out not to
depend on how far wrong the null is (as long as it is the same for
both the <span class="math inline">\(t\)</span>-test and the sign test). This “asymptotic relative efficiency” is <span class="math inline">\(\pi/2=1.57\)</span>.
Our relative efficiency for power
0.243, namely 1.67, was pretty close to this, even though our
sample sizes 10 and 6 are not especially close to infinity.
This says that, if your data are actually from a normal
distribution, you do a lot better to use the <span class="math inline">\(t\)</span>-test than the
sign test, because the sign test is wasteful of data (it only uses
above/below rather than the actual values).
If your data are <em>not</em> from a normal distribution, then the
story can be very different.
Of course you knew I would investigate this. There is a
distribution called the “Laplace” or “double exponential”
distribution, that has very long tails.
<label for="tufte-mn-29" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-29" class="margin-toggle"><span class="marginnote">If you’ve ever run into the exponential distribution, you’ll recall that this is right skewed with a very long tail. The Laplace distribution looks like two of these glued back to back.</span>
The distribution is not in
base R, but there is a package called <code>smoothmest</code> that
contains a function <code>rdoublex</code> to generate random values from
this distribution. So we’re going to do a simulation investigation
of the power of the sign test for Laplace data, by the same
simulation technique that we did above. Like the normal, the Laplace
distribution is symmetric, so its mean and median are the same
(which makes our life easier).
<label for="tufte-mn-30" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-30" class="margin-toggle"><span class="marginnote">This is about the <em>only</em> way in which the normal and Laplace distributions are alike.</span></p>
<p>Let’s test the hypothesis that the median is zero. We’ll suppose that
the true median is 0.5 (this is called <code>mu</code> in
<code>rdoublex</code>). The first problem we run into is that we can’t use
<code>power.t.test</code> because they assume normal data, which we are
far from having. So we have to do two simulations: one to simulate the
power of the <span class="math inline">\(t\)</span> test, and one to simulate the power of the sign test.</p>
<p>To simulate the <span class="math inline">\(t\)</span> test, we first have to generate some Laplace data
with the true mean of 0.5. We’ll use a sample size of 50 throughout
these simulations.</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb549-1" data-line-number="1"><span class="kw">library</span>(smoothmest)</a>
<a class="sourceLine" id="cb549-2" data-line-number="2">rl=<span class="kw">rdoublex</span>(<span class="dv">50</span>,<span class="dt">mu=</span><span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb549-3" data-line-number="3">rl</a></code></pre></div>
<pre><code>##  [1] -0.33323285  0.70569291 -1.22513053  0.68517708  0.12778518
##  [6]  0.50749949  0.26700527  1.90236874  0.53288312 -0.37374732
## [11]  0.27256566  0.53365929  0.43581431 -0.01545866  0.18594908
## [16] -0.40403202  1.13540289  0.16137306 -0.23360644 -0.74050354
## [21]  2.92089551 -2.72173880  0.48428815  1.23636045  0.17078618
## [26]  1.72456334  0.07903058  0.25210411  0.09512810  2.52310082
## [31] -2.13629814  0.81851434  0.74615575 -0.26068744  2.70683355
## [36]  1.46981530  1.45646489 -0.20232517  6.65249860  1.51575026
## [41] -0.07606399 -1.11338640 -1.20427995 -0.70986104 -1.66466321
## [46]  0.55346854  0.66091469  0.72100677  0.92025176  0.98922656</code></pre>
<p>This seems to have some unusual values, far away from zero:</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb551-1" data-line-number="1"><span class="kw">tibble</span>(rl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb551-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">sample=</span>rl))<span class="op">+</span></a>
<a class="sourceLine" id="cb551-3" data-line-number="3"><span class="kw">stat_qq</span>()<span class="op">+</span><span class="kw">stat_qq_line</span>()</a></code></pre></div>
<p><img src="07-sign-mood-median_files/figure-html/unnamed-chunk-50-1.png" width="672"  /></p>
<p>You see the long tails compared to the normal.</p>
<p>Now, we feed these values into <code>t.test</code> and see whether we
reject a null median of zero (at <span class="math inline">\(\alpha=0.05\)</span>):</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb552-1" data-line-number="1">tt=<span class="kw">t.test</span>(rl)  </a>
<a class="sourceLine" id="cb552-2" data-line-number="2">tt</a></code></pre></div>
<pre><code>## 
##  One Sample t-test
## 
## data:  rl
## t = 2.2556, df = 49, p-value = 0.0286
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  0.04959344 0.85981931
## sample estimates:
## mean of x 
## 0.4547064</code></pre>
<p>Or we can just pull out the P-value and even compare it to 0.05:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb554-1" data-line-number="1">pval=tt<span class="op">$</span>p.value  </a>
<a class="sourceLine" id="cb554-2" data-line-number="2">pval</a></code></pre></div>
<pre><code>## [1] 0.02859596</code></pre>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb556-1" data-line-number="1">is.reject=(pval<span class="op">&lt;=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb556-2" data-line-number="2">is.reject</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>$</p>
<p>This one has a small P-value and so the null median of 0 should be
(correctly) rejected.</p>
<p>We’ll use these ideas to simulate the power of the <span class="math inline">\(t\)</span>-test for these
data, testing a mean of 0. This uses the same ideas as for any power
simulation; the difference here is the true distribution:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb558-1" data-line-number="1"><span class="kw">rerun</span>(<span class="dv">1000</span>,<span class="kw">rdoublex</span>(<span class="dv">50</span>,<span class="dt">mu=</span><span class="fl">0.5</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb558-2" data-line-number="2"><span class="kw">map</span>(<span class="op">~</span><span class="kw">t.test</span>(.,<span class="dt">mu=</span><span class="dv">0</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb558-3" data-line-number="3"><span class="kw">map_dbl</span>(<span class="st">&quot;p.value&quot;</span>) -&gt;</a>
<a class="sourceLine" id="cb558-4" data-line-number="4">pvals</a></code></pre></div>
<p>and then count them:</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb559-1" data-line-number="1"><span class="kw">tibble</span>(pvals) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(pvals<span class="op">&lt;=</span><span class="fl">0.05</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   `pvals &lt;= 0.05`     n
##   &lt;lgl&gt;           &lt;int&gt;
## 1 FALSE             304
## 2 TRUE              696</code></pre>
<p>And now we simulate the sign test. Since what we want is a P-value
from a vector, the easiest way to do this is to use
<code>pval_sign0</code> from <code>smmr</code>, which returns exactly the
two-sided P-value that we want, so that the procedure is a step simpler:</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb561-1" data-line-number="1"><span class="kw">rerun</span>(<span class="dv">1000</span>,<span class="kw">rdoublex</span>(<span class="dv">50</span>,<span class="dt">mu=</span><span class="fl">0.5</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb561-2" data-line-number="2"><span class="kw">map_dbl</span>(<span class="op">~</span><span class="kw">pval_sign0</span>(<span class="dv">0</span>,.)) -&gt;</a>
<a class="sourceLine" id="cb561-3" data-line-number="3">pvals_sign</a></code></pre></div>
<p>and then</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb562-1" data-line-number="1"><span class="kw">tibble</span>(pvals_sign) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(pvals_sign<span class="op">&lt;=</span><span class="fl">0.05</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   `pvals_sign &lt;= 0.05`     n
##   &lt;lgl&gt;                &lt;int&gt;
## 1 FALSE                  239
## 2 TRUE                   761</code></pre>
<p>For data from this Laplace
distribution, the power of this <span class="math inline">\(t\)</span>-test is 0.696, but the power of
the sign test on the same data is 0.761, <em>bigger</em>. For
Laplace-distributed data, the sign test is <em>more</em> powerful than
the <span class="math inline">\(t\)</span>-test.</p>
<p>This is not to say that you will ever run into data that comes from
the Laplace distribution. But the moral of the story is that the sign
test <em>can</em> be more powerful than the <span class="math inline">\(t\)</span>-test, under the right
circumstances (and the above simulation is the “proof” of that
statement). So a blanket statement like “the sign test is not very powerful”
needs to be qualified a bit: when your data come from a
sufficiently long-tailed distribution, the sign test can be more
powerful relative to the <span class="math inline">\(t\)</span>-test than you would think.</p>
<p>I finish by “unloading” the two packages that got loaded:</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb564-1" data-line-number="1"><span class="kw">detach</span>(package<span class="op">:</span>smoothmest, <span class="dt">unload=</span>T)</a>
<a class="sourceLine" id="cb564-2" data-line-number="2"><span class="kw">detach</span>(package<span class="op">:</span>MASS, <span class="dt">unload=</span>T)</a></code></pre></div>
<pre><code>## Warning: &#39;MASS&#39; namespace cannot be unloaded:
##   namespace &#39;MASS&#39; is imported by &#39;lme4&#39; so cannot be unloaded</code></pre>
</div>
<div id="sugar-in-breakfast-cereals" class="section level2">
<h2><span class="header-section-number">9.4</span> Sugar in breakfast cereals</h2>
<p>The data for this question are in
<a href="http://www.utsc.utoronto.ca/~butler/c32/cereal-sugar.txt" class="uri">http://www.utsc.utoronto.ca/~butler/c32/cereal-sugar.txt</a>. The
story here is whether breakfast cereals marketed to children have a
lot of sugar in them; in particular, whether they have more sugar on
average than cereals marketed to adults.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data (to R) and display the data set. Do you have
a variable that distinguishes the children’s cereals from the
adults’ cereals, and another that contains the amount of sugar?</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb566-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/cereal-sugar.txt&quot;</span></a>
<a class="sourceLine" id="cb566-2" data-line-number="2">cereals=<span class="kw">read_delim</span>(my_url,<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   who = col_character(),
##   sugar = col_double()
## )</code></pre>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb568-1" data-line-number="1">cereals</a></code></pre></div>
<pre><code>## # A tibble: 40 x 2
##    who      sugar
##    &lt;chr&gt;    &lt;dbl&gt;
##  1 children  40.3
##  2 children  55  
##  3 children  45.7
##  4 children  43.3
##  5 children  50.3
##  6 children  45.9
##  7 children  53.5
##  8 children  43  
##  9 children  44.2
## 10 children  44  
## # … with 30 more rows</code></pre>
<p>The variable <code>who</code> is a categorical variable saying who the
cereal is intended for, and the variable <code>sugar</code> says how much
sugar each cereal has.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Calculate the mean sugar content for each group of cereals (the
adults’ ones and the children’s ones). Do they look similar or different?</li>
</ol>
<p>Solution</p>
<p><code>group_by</code> and <code>summarize</code>:</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb570-1" data-line-number="1">cereals <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(who) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb570-2" data-line-number="2"><span class="kw">summarize</span>(<span class="dt">sugar_mean=</span><span class="kw">mean</span>(sugar))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   who      sugar_mean
##   &lt;chr&gt;         &lt;dbl&gt;
## 1 adults         10.9
## 2 children       46.6</code></pre>
<p>These means look very different, though it would be better to look at
a boxplot (coming up in a moment).</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Make side-by-side boxplots of the sugar contents of the two
types of cereal. What do you see that is out of the ordinary?</li>
</ol>
<p>Solution</p>
<p>The usual:</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb572-1" data-line-number="1"><span class="kw">ggplot</span>(cereals,<span class="kw">aes</span>(<span class="dt">x=</span>who,<span class="dt">y=</span>sugar))<span class="op">+</span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="07-sign-mood-median_files/figure-html/unnamed-chunk-60-1.png" width="672"  /></p>
<p>I see outliers: two high ones on the adults’ cereals, and one high and
one low on the children’s cereals.</p>
<p>My thought above about the means being very different is definitely supported by the medians being very different on the boxplots. We should have no trouble declaring that the “typical” amounts of sugar in the adults’ and children’s cereals are different.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Explain briefly why you would not trust a two-sample <span class="math inline">\(t\)</span>-test
with these data. (That is, say what the problem is, and why it’s a
problem.)</li>
</ol>
<p>Solution</p>
<p>The problem is the outliers (which is rather a giveaway), but the
reason it’s a problem is that the two-sample <span class="math inline">\(t\)</span>-test assumes
(approximately) normal data, and a normal distribution doesn’t
have outliers.
Not only do you need to note the outliers, but you also need to
say why the outliers cause a problem <em>in this case</em>. Anything
less than that is not a complete answer.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Run a suitable test to see whether the “typical” amount of
sugar differs between adult’s and children’s cereals. Justify the test
that you run. (You can use the version of your test that lives in a
package, if that is easier for you.) What do you conclude, in the
context of the data?</li>
</ol>
<p>Solution</p>
<p>Having ruled out the two-sample <span class="math inline">\(t\)</span>-test, we are left with Mood’s
median test. I didn’t need you to build it yourself, so you can
use package <code>smmr</code> to run it with:</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb573-1" data-line-number="1"><span class="kw">library</span>(smmr)</a>
<a class="sourceLine" id="cb573-2" data-line-number="2"><span class="kw">median_test</span>(cereals,sugar,who)</a></code></pre></div>
<pre><code>## $table
##           above
## group      above below
##   adults       2    19
##   children    18     1
## 
## $test
##        what        value
## 1 statistic 2.897243e+01
## 2        df 1.000000e+00
## 3   P-value 7.341573e-08</code></pre>
<p>We conclude that there <em>is</em> a difference between the median
amounts of sugar between the two groups of cereals, the P-value of 0.00000007
being extremely small.</p>
<p>Why did it come out so small? Because the amount of sugar was smaller
than the overall median for almost all the adult cereals, and larger
than the overall median for almost all the children’s ones. That is,
the children’s cereals really do have more sugar.</p>
<p>Mood’s median test doesn’t come with a confidence interval (for the
difference in population medians), because whether or not a certain
difference in medians is rejected depends on what those medians
actually are, and the idea of the duality of the test and CI doesn’t
carry over as we would like.</p>
<p>My daughter likes chocolate Cheerios, but she also likes Shredded
Wheat and <em>Bran Flakes</em>. Go figure. (Her current favourite is
Raisin Bran, even though she doesn’t like raisins by themselves.)</p>
<p>Mood’s median test is the test we should trust, but you might be
curious about how the <span class="math inline">\(t\)</span>-test stacks up here:</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb575-1" data-line-number="1"><span class="kw">t.test</span>(sugar<span class="op">~</span>who,<span class="dt">data=</span>cereals)</a></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  sugar by who
## t = -11.002, df = 37.968, p-value = 2.278e-13
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -42.28180 -29.13925
## sample estimates:
##   mean in group adults mean in group children 
##               10.90000               46.61053</code></pre>
<p>The P-value is <em>even smaller</em>, and we have the advantage of
getting a confidence interval for the difference in means: from about
30 to about 40 units less sugar in the adult cereals. Whatever the
units were.</p>
</div>
<div id="fear-of-math" class="section level2">
<h2><span class="header-section-number">9.5</span> Fear of math</h2>
<p>Two new short courses have been proposed for helping
students who suffer from severe math phobia. The courses are labelled
A and B. Ten students were randomly allocated to one of these two
courses, and each student’s score on a math phobia test was recorded
after they completed their course. The math phobia test produces
whole-number scores between 0 and 10, with a higher score indicating a
greater fear of mathematics. The data can be found in
<a href="http://www.utsc.utoronto.ca/~butler/c32/mathphobia.txt">link</a>. We start
with R for this question.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data and check, however you like, that you have 10
observations, 5 from each course.</li>
</ol>
<p>Solution</p>
<p>This doesn’t need much comment:</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb577-1" data-line-number="1">my_url &lt;-<span class="st"> &quot;http://www.utsc.utoronto.ca/~butler/c32/mathphobia.txt&quot;</span></a>
<a class="sourceLine" id="cb577-2" data-line-number="2">math &lt;-<span class="st"> </span><span class="kw">read_delim</span>(my_url, <span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   course = col_character(),
##   phobia = col_double()
## )</code></pre>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb579-1" data-line-number="1">math</a></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    course phobia
##    &lt;chr&gt;   &lt;dbl&gt;
##  1 a           8
##  2 a           7
##  3 a           7
##  4 a           6
##  5 a           6
##  6 b           9
##  7 b           8
##  8 b           7
##  9 b           2
## 10 b           1</code></pre>
<p>This will do, counting the <code>a</code> and <code>b</code>. Or, to save
yourself that trouble:</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb581-1" data-line-number="1">math <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(course)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   course     n
##   &lt;chr&gt;  &lt;int&gt;
## 1 a          5
## 2 b          5</code></pre>
<p>Five each. The story is to get the computer to do the grunt work for
you, if you can make it do so. Other ways:</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb583-1" data-line-number="1">math <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(course) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   course count
##   &lt;chr&gt;  &lt;int&gt;
## 1 a          5
## 2 b          5</code></pre>
<p>and this:</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb585-1" data-line-number="1"><span class="kw">with</span>(math, <span class="kw">table</span>(course))</a></code></pre></div>
<pre><code>## course
## a b 
## 5 5</code></pre>
<p>giving the same answer. Lots of ways.</p>
<p>Extra: there is an experimental design issue here. You might have noticed that each student did only <em>one</em> of the courses. Couldn’t students do both, in a matched-pairs kind of way? Well, it’s a bit like the kids learning to read in that if the first of the courses reduces a student’s anxiety, the second course won’t appear to do much good (even if it actually would have been helpful had the student done that one first). This is the same idea as the kids learning to read: once you’ve learned to read, you’ve learned to read, and learning to read a second way won’t help much. The place where matched pairs scores is when you can “wipe out” the effect of one treatment before a subject gets the other one. We have an example of kids throwing baseballs and softballs that is like that: if you throw one kind of ball, that won’t affect how far you can throw the other kind.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Do a two-sample <span class="math inline">\(t\)</span>-test to assess whether there is a
difference in mean phobia scores after the students have taken the two
courses. What do you conclude? (You have no 
<label for="tufte-mn-31" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-31" class="margin-toggle"><span class="marginnote">That is, before looking at the data. This is Latin. It’s also the place that the Bayesian <em>prior distribution</em> comes from. The <em>posterior distribution</em> comes from the Latin <em>a posteriori</em>, which means <em>afterwards</em>, that is, after you have looked at the data.</span>
reason to
suppose that a particular one of the tests will produce a higher mean
than the other, so do a two-sided test.)</li>
</ol>
<p>Solution</p>
<p>A two-sided test is the default, so there is not much to do here:</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb587-1" data-line-number="1"><span class="kw">t.test</span>(phobia <span class="op">~</span><span class="st"> </span>course, <span class="dt">data =</span> math)</a></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  phobia by course
## t = 0.83666, df = 4.4199, p-value = 0.4456
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -3.076889  5.876889
## sample estimates:
## mean in group a mean in group b 
##             6.8             5.4</code></pre>
<p>The P-value of 0.4456 is nowhere near less than 0.05, so there is no
evidence at all that the<br />
mean math phobia scores are different between the two courses.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Draw boxplots of the math phobia scores for each group (one
line of code). What is the most striking thing that you notice?</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb589-1" data-line-number="1"><span class="kw">ggplot</span>(math, <span class="kw">aes</span>(<span class="dt">x =</span> course, <span class="dt">y =</span> phobia)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="07-sign-mood-median_files/figure-html/unnamed-chunk-68-1.png" width="672"  /></p>
<p>Boxplot <code>a</code> is just weird. The bar across the middle is
actually at the top, and it has no bottom. (Noting something sensible
like this is enough.) Boxplot <code>b</code> is hugely spread
out.
<label for="tufte-mn-32" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-32" class="margin-toggle"><span class="marginnote">The two groups have very different spreads, but that is not a problem as long as we remember to do the Welch-Satterthwaite test that does not assume equal spreads. This is the default in R, so we are good, at least with that.</span></p>
<p>By way of explanation: the course <code>a</code> scores have a number of
values equal so that the 3rd quartile and the median are the name, and
also that the first quartile and the minimum value are the same:</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb590-1" data-line-number="1">tmp &lt;-<span class="st"> </span>math <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(course <span class="op">==</span><span class="st"> &quot;a&quot;</span>)</a>
<a class="sourceLine" id="cb590-2" data-line-number="2">tmp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(phobia)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   phobia     n
##    &lt;dbl&gt; &lt;int&gt;
## 1      6     2
## 2      7     2
## 3      8     1</code></pre>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb592-1" data-line-number="1"><span class="kw">summary</span>(tmp)</a></code></pre></div>
<pre><code>##     course              phobia   
##  Length:5           Min.   :6.0  
##  Class :character   1st Qu.:6.0  
##  Mode  :character   Median :7.0  
##                     Mean   :6.8  
##                     3rd Qu.:7.0  
##                     Max.   :8.0</code></pre>
<p>The phobia scores from course A are two 6’s, two 7’s and an 8. The
median and third quartile are both 7, and the first quartile is the
same as the lowest value, 6.</p>
<p>Technique note: I wanted to do two things with the phobia scores from
course A: count up how many of each score, and show you what the
five-number summary looks like. One pipe won’t do this (the pipe
“branches”), so I saved what I needed to use, before it branched,
into a data frame <code>tmp</code> and then used <code>tmp</code> twice. Pipes
are powerful, but not <em>all</em>-powerful.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Explain briefly why a <span class="math inline">\(t\)</span>-test would not be good for these
data. (There are two things that you need to say.)</li>
</ol>
<p>Solution</p>
<p>The easiest way to structure this is to ask yourself first what the
<span class="math inline">\(t\)</span>-test needs, and second whether you have it.
The <span class="math inline">\(t\)</span>-test assumes (approximately) normal data. The boxplot for
group <code>a</code> doesn’t even look symmetric, and the one for group
<code>b</code> has an oddly asymmetric box. So I think the normality is
in question here, and therefore another test would be
better. (This is perhaps a bit glib of an answer, since there are
only 5 values in each group, and so they can certainly look
non-normal even if they actually are normal, but these values are
all integers, so it is perhaps wise to be cautious.)
We have the machinery to assess the normality for these, in one shot:</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb594-1" data-line-number="1"><span class="kw">ggplot</span>(math, <span class="kw">aes</span>(<span class="dt">sample =</span> phobia)) <span class="op">+</span></a>
<a class="sourceLine" id="cb594-2" data-line-number="2"><span class="st">  </span><span class="kw">stat_qq</span>() <span class="op">+</span><span class="st"> </span><span class="kw">stat_qq_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb594-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>course, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="07-sign-mood-median_files/figure-html/unnamed-chunk-70-1.png" width="672"  /></p>
<p>I don’t know what <em>you</em> make of those, but they both look pretty
straight to me (and there are only five observations, so it’s hard to
judge). Course <code>b</code> maybe has a “hole” in it (three large
values and two small ones). Maybe. I dunno. What I would <em>really</em>
be worried about is outliers, and at least we don’t have those.
I mentioned in class that the <span class="math inline">\(t\)</span>-tests are robust to non-normality. I
ought to have expanded on that a bit: what really makes the <span class="math inline">\(t\)</span>-test
still behave itself with non-normality is when you have <em>large</em>
samples, that is, when the Central Limit Theorem has had a chance to
take hold. (That’s what drives the normality not really being
necessary in most cases.) But, even with small samples, exact
normality doesn’t matter so much. Here, we have two tiny samples, and
so we have to insist a bit more, but only a bit more, on a
more-or-less normal shape in each group. (It’s kind of a double
jeopardy in that the situation where normality matters most, namely
with small samples, is where it’s the hardest to judge, because
samples of size 5 even from a normal distribution can look very
non-normal.)
But, the biggest threats to the <span class="math inline">\(t\)</span>-test are big-time skewness and
outliers, and we are not suffering too badly from those.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Run a suitable test to compare the “typical” scores for the
two courses. (You can use the version from a package rather than
building your own.) What do you conclude?</li>
</ol>
<p>Solution</p>
<p>This is an invite to use <code>smmr</code>:</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb595-1" data-line-number="1"><span class="kw">library</span>(smmr)</a>
<a class="sourceLine" id="cb595-2" data-line-number="2"><span class="kw">median_test</span>(math, phobia, course)</a></code></pre></div>
<pre><code>## $table
##      above
## group above below
##     a     1     2
##     b     2     2
## 
## $test
##        what     value
## 1 statistic 0.1944444
## 2        df 1.0000000
## 3   P-value 0.6592430</code></pre>
<p>We are nowhere near rejecting equal medians; in fact, both courses are
very close to 50–50 above and below the overall median.</p>
<p>If you look at the frequency table, you might be confused by
something: there were 10 observations, but there are only <span class="math inline">\(1+2+2+2=7\)</span>
in the table. This is because three of the observations were equal to
the overall median, and had to be thrown away:</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb597-1" data-line-number="1">math <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">med =</span> <span class="kw">median</span>(phobia))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##     med
##   &lt;dbl&gt;
## 1     7</code></pre>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb599-1" data-line-number="1">math <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(phobia)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   phobia     n
##    &lt;dbl&gt; &lt;int&gt;
## 1      1     1
## 2      2     1
## 3      6     2
## 4      7     3
## 5      8     2
## 6      9     1</code></pre>
<p>The overall median was 7. Because the actual data were really discrete
(the phobia scores could only be whole numbers), we risked losing a
lot of our data when we did this test (and we didn’t have much to
begin with). The other thing to say is that with small sample sizes,
the frequencies in the table have to be <em>very</em> lopsided for you
to have a chance of rejecting the null. Something like this is what
you’d need:</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb601-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb601-2" data-line-number="2">g &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb601-3" data-line-number="3">d &lt;-<span class="st"> </span><span class="kw">tibble</span>(x, g)</a>
<a class="sourceLine" id="cb601-4" data-line-number="4"><span class="kw">median_test</span>(d, x, g)</a></code></pre></div>
<pre><code>## $table
##      above
## group above below
##     1     0     3
##     2     4     0
## 
## $test
##        what       value
## 1 statistic 7.000000000
## 2        df 1.000000000
## 3   P-value 0.008150972</code></pre>
<p>I faked it up so that we had 10 observations, three of which were
equal to the overall median. Of the rest, all the small ones were in
group 1 and all the large ones were in group 2. This is lopsided
enough to reject with, though, because of the small frequencies, there
actually was a warning about
“chi-squared approximation may be inaccurate”.
<label for="tufte-mn-33" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-33" class="margin-toggle"><span class="marginnote">There <em>was</em>, in the <em>chisq.test</em> inside <em>median-test</em>, but in <em>smmr</em> I didn’t pass that warning back to the outside world.</span></p>
</div>
<div id="medical-instructions" class="section level2">
<h2><span class="header-section-number">9.6</span> Medical instructions</h2>
<p>Do people understand medical instructions better at certain
times of the day? In a study, students in a grade 12 class are
randomly divided into two groups, A and B. All students see a video
describing how to use an infant forehead thermometer. The students in
Group A see the video at 8:30 am, while the students in Group B see
the same video at 3:00 pm (on the same day). The next day, all the
students are given a test on the material in the video (graded out of
100). The observed scores are in
<a href="http://www.utsc.utoronto.ca/~butler/c32/forehead.txt">link</a> (values
separated by spaces).</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data into R and display the (first ten) values.</li>
</ol>
<p>Solution</p>
<p>Separated by spaces, so <code>read_delim</code>:</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb603-1" data-line-number="1">my_url &lt;-<span class="st"> &quot;http://www.utsc.utoronto.ca/~butler/c32/forehead.txt&quot;</span></a>
<a class="sourceLine" id="cb603-2" data-line-number="2">instr &lt;-<span class="st"> </span><span class="kw">read_delim</span>(my_url, <span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   group = col_character(),
##   score = col_double()
## )</code></pre>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb605-1" data-line-number="1">instr</a></code></pre></div>
<pre><code>## # A tibble: 18 x 2
##    group score
##    &lt;chr&gt; &lt;dbl&gt;
##  1 A        88
##  2 A        89
##  3 A        79
##  4 A       100
##  5 A        98
##  6 A        89
##  7 A        65
##  8 A        94
##  9 A        95
## 10 A        91
## 11 B        87
## 12 B        69
## 13 B        78
## 14 B        79
## 15 B        83
## 16 B        90
## 17 B        85
## 18 B        58</code></pre>
<ol start="2" style="list-style-type: lower-alpha">
<li>Obtain a suitable plot that will enable you to assess the
assumptions for a two-sample <span class="math inline">\(t\)</span>-test.</li>
</ol>
<p>Solution</p>
<p>We need the values in each group to be approximately normally
distributed. Side-by-side boxplots will do it:</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb607-1" data-line-number="1"><span class="kw">ggplot</span>(instr, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">y =</span> score)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="07-sign-mood-median_files/figure-html/unnamed-chunk-75-1.png" width="672"  /></p>
<p>or, if you like, separate (facetted) normal quantile plots, which I
would do this way:</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb608-1" data-line-number="1"><span class="kw">ggplot</span>(instr, <span class="kw">aes</span>(<span class="dt">sample =</span> score)) <span class="op">+</span></a>
<a class="sourceLine" id="cb608-2" data-line-number="2"><span class="st">  </span><span class="kw">stat_qq</span>() <span class="op">+</span><span class="st"> </span><span class="kw">stat_qq_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb608-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>group, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="07-sign-mood-median_files/figure-html/unnamed-chunk-76-1.png" width="672"  /></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Why might you have doubts about using a two-sample <span class="math inline">\(t\)</span>-test here?</li>
</ol>
<p>Solution</p>
<p>We are looking for non-normality in at least one of the
groups. Here, both groups have an outlier at the low end that
would be expected to pull the mean downward. I don’t think there
is left-skewness here, since there is no particular evidence of
the high-end values being bunched up: the problem in both cases
with normality is at the low end.
One way or another, I’m expecting you to have noticed the outliers.
Extra: last year, when I first drew the normal quantile plots,
there was no <code>stat_qq_line</code>, so you had to imagine where
the line went if you did it this way. Without the line, these
plots look somewhat curved, which would have pointed to
left-skewness, but now we see that the lowest observation is too
low, and maybe the second-lowest one as well, while the other
observations are just fine.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Run Mood’s median test as in class (<em>without</em> using
<code>smmr</code>). What do you conclude, in the context of the data?
What recommendation would you make about the time of day to see the
video? (You might get a warning about “chisquared approximation being incorrect”,
which you can ignore here.)</li>
</ol>
<p>Solution</p>
<p>The overall median first:</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb609-1" data-line-number="1">instr <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">med =</span> <span class="kw">median</span>(score))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##     med
##   &lt;dbl&gt;
## 1  87.5</code></pre>
<p>87.5, which is not equal to any of the data values (they are all
integers). This will avoid any issues with values-equal-to-median later.</p>
<p>Then, create and save a table of the value by group and above/below
median. You can count either above or below (it comes out equivalently
either way):</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb611-1" data-line-number="1">tab &lt;-<span class="st"> </span><span class="kw">with</span>(instr, <span class="kw">table</span>(group, score <span class="op">&gt;</span><span class="st"> </span><span class="fl">87.5</span>))</a>
<a class="sourceLine" id="cb611-2" data-line-number="2">tab</a></code></pre></div>
<pre><code>##      
## group FALSE TRUE
##     A     2    8
##     B     7    1</code></pre>
<p>Then, chi-squared test for independence (the null) or association of
some kind (the alternative). The <code>correct=F</code> is saying not to
do Yates’s correction, so that it would come out the same if you were
doing it by hand (“observed minus expected, squared, divided by expected”
and all that stuff).</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb613-1" data-line-number="1"><span class="kw">chisq.test</span>(tab, <span class="dt">correct =</span> F)</a></code></pre></div>
<pre><code>## Warning in chisq.test(tab, correct = F): Chi-squared approximation may be
## incorrect</code></pre>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  tab
## X-squared = 8.1, df = 1, p-value = 0.004427</code></pre>
<p>The P-value is 0.0044, which is (much) smaller than 0.05, and
therefore you can reject independence and conclude association: that
is, whether a student scores above or below the median depends on
which group they are in, or, that the median scores are different for
the two groups.</p>
<p>The warning is because the expected frequencies are on the small side
(if you have done this kind of problem by hand, you might remember
something about “expected frequencies less than 5”. This is that.)
Here, the P-value is so small that we can afford to have it be
inaccurate by a bit and still not affect the conclusion, so I think we
are safe.</p>
<p>As for which group is better, well, the easiest way is to go back to
your boxplots and see that the median for group A (8:30 am) is
substantially higher than for group B (3:00pm). But you can also see
it from your frequency table, if you displayed it:</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb616-1" data-line-number="1">tab</a></code></pre></div>
<pre><code>##      
## group FALSE TRUE
##     A     2    8
##     B     7    1</code></pre>
<p>Most of the people in the 8:30 am group scored above the median, and
most of the people in the 3:00 pm group scored below the median. So
the scores at 8:30 am were better overall.</p>
<p>As I write this, it is just after 3:00 pm and I am about to make
myself a pot of tea!</p>
<p>Extra: about that <code>correct=F</code> thing. There was a point of view for a
long time that when you are dealing with a <span class="math inline">\(2 \times 2\)</span> table, you can
get better P-values by, before squaring “observed minus expected”,
taking 0.5 away from the absolute value of the difference. This is
called Yates’s correction. It is in the same spirit as the
“continuity correction” that you might have encountered in the
normal approximation to the binomial, where in the binomial you have
to have a whole number of successes, but the normal allows fractional
values as well. In about the 1960s, the usefulness of Yates’s
correction was shot down, for general contingency tables. There is,
however, one case where it <em>is</em> useful, and that is the case
where the row totals and column totals are <em>fixed</em>.</p>
<p>What do I mean by that? Well, first let’s look at a case where the
totals are <em>not</em> all fixed. Consider a survey in which you want
to see whether males and females agree or disagree on some burning
issue of the day. You collect random samples of, say, 500 males and
500 females, and you count how many of them say Yes or No to your
statement.
<label for="tufte-mn-34" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-34" class="margin-toggle"><span class="marginnote">To simplify things, we’ll assume that everyone gave a Yes or a No answer, though you could add a column like <em>No answer</em> if you wanted to make it more realistic.</span>
You might get results like this:</p>
<pre><code>
Yes  No  Total
Males    197 303   500
Females  343 157   500
Total    540 460  1000
</code></pre>
<p>In this table, the row totals must be 500, because you asked this many
males and this many females, and each one must have answered
something. The column totals, however, are not fixed: you didn’t know,
ahead of time, that 540 people would answer “yes”. That was just the
way the data turned out, and if you did another survey with the same
design, you’d probably get a different number of people saying
“yes”.</p>
<p>For another example, let’s go back to Fisher (yes, <em>that</em>
Fisher). A “lady” of his acquaintance claimed to be able, by
drinking a cup of tea with milk and sugar in it, whether the milk or
the sugar had been added first. Fisher, or, more likely, his
housekeeper, prepared 8 cups of tea, 4 with milk first and 4 with
sugar first. The lady knew that four of the cups had milk first, and
her job was to say which four. The results might have been like this:</p>
<pre><code>
Actual 
Milk first  sugar first  Total
Lady   Milk first        3            1         4
says   sugar first       1            3         4
Total             4            4         8
</code></pre>
<p>This time, all of the row totals and all of the column totals must be
4, regardless of what the lady thinks. Even if she thinks 5 of the
cups of tea actually had milk first, she is going to pick 4 of them to
say that they have milk first, since she knows there are only 4. In
this case, all of the row and column totals are fixed at 4, and the
right analysis is called Fisher’s Exact Test, based on the
hypergeometric distribution. In a <span class="math inline">\(2\times 2\)</span> table like this one,
there is only one “degree of freedom”, since as soon as you specify
one of the frequencies, say the number of cups where the lady said
milk first and they actually were milk first, you can work out the
others. But, leaving that aside, the usual chi-squared analysis is a
perfectly good approximation, especially if the frequencies are large,
and especially if you use Yates’s correction.</p>
<p>It is clear that Fisher must have been English, since he was able to
get a publication out of drinking tea.</p>
<p>How does that apply to Mood’s median test? Well, let’s remind
ourselves of the table we had:</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb620-1" data-line-number="1">tab</a></code></pre></div>
<pre><code>##      
## group FALSE TRUE
##     A     2    8
##     B     7    1</code></pre>
<p>We know how many students were in each group: 10 in group A and 8 in
B. So the row totals are fixed. What about the columns? These are
whether each observation was above or below the overall median. There
were 18 observations altogether, so there <em>must</em> be 9 above and 9
below.
<label for="tufte-mn-35" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-35" class="margin-toggle"><span class="marginnote">Except in the case of the previous problem, where there were multiple observations equal to the overall median. Which we ignore for the moment.</span>
So the column totals are fixed as well. All
totals fixed, so we should be using Yates’s correction. I didn’t,
because I wanted to keep things simple, but I should have done.</p>
<p>R’s <code>chisq.test</code> by default <em>always</em> uses Yates’s
correction, and if you don’t want it, you have to say
<code>correct=F</code>. Which is why I have been doing so all through.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Run Mood’s median test on these data using my <code>smmr</code>
package, and verify that you get the same answer.</li>
</ol>
<p>Solution</p>
<p>Not much to it, since the data is already read in:</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb622-1" data-line-number="1"><span class="kw">library</span>(smmr)</a>
<a class="sourceLine" id="cb622-2" data-line-number="2"><span class="kw">median_test</span>(instr, score, group)</a></code></pre></div>
<pre><code>## $table
##      above
## group above below
##     A     8     2
##     B     1     7
## 
## $test
##        what       value
## 1 statistic 8.100000000
## 2        df 1.000000000
## 3   P-value 0.004426526</code></pre>
<p>Identical, test statistic, degrees of freedom and P-value. The table
of frequencies is also the same, just with columns rearranged. (In
<code>smmr</code> I counted the number of values below the overall median,
whereas in my build-it-yourself I counted the number of
values above.)</p>

</div>
</div>
<p style="text-align: center;">
<a href="power-and-sample-size.html"><button class="btn btn-default">Previous</button></a>
<a href="matched-pairs-t-and-sign-test.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
