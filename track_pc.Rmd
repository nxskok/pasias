## Track running records (principal components)

Standard track running distances for men are 100 metres, 200m, 400m, 800m, 1500m, 5000m, 10000m, and marathon.^[Ok, strictly the marathon is not run as laps on a track, but it is still run on a prepared course, as opposed to something like cross-country running.] The dataset in [http://ritsokiguess.site/datafiles/men_track_field.txt](http://ritsokiguess.site/datafiles/men_track_field.txt) contains the record (low) times for each distance for each of a number of different countries. These record times date from 1984. Can we determine dimensions on which the countries differ in terms of running records, and see what the distances in each dimension have in common?

(a) Read in and display (some of) the data. What seems to be different about some of the (quantitative) columns? What does the column `country` appear to contain?

Solution

Take a look at the data and see that it is aligned columns, and thus that `read_table` is what you want. (Or, try something like `read_delim`, see that it doesn't work, and see why it goes wrong):

```{r track-pc-1}
my_url <- "http://ritsokiguess.site/datafiles/men_track_field.txt"
track <- read_table2(my_url)
track
```

You would expect running a longer distance to take a longer time, but the numbers go up for a bit and then suddenly get smaller. This is because  the record times for the shorter distances (up to 400m) are measured in seconds and for the longer distances (800m and up) are in minutes.^[This does not actually *matter* for our analysis; principal components is based on the correlation matrix, that is, standardized values, but it is good to be aware of what happened.] 

You might also note that the distances are expressed in the column names with the "m" first and the number of metres after that. This is because a column name cannot start with a number.^[At least, if it *did*, we'd have to refer to it with backticks every time, which would be a nuisance.] So we'll have to do a little mental translation when we read the results.

The last column `country` contains not country names but abbreviations for country names, some of which you may recognize as Internet domain names. This last bit we come to next.

$\blacksquare$

(b) The file [http://ritsokiguess.site/datafiles/isocodes.csv](http://ritsokiguess.site/datafiles/isocodes.csv) contains country names and abbreviations. Read in and display (some of) this file. Do you see anything that resembles the `country` column in the dataframe of running records?

Solution

This is an ordinary `csv` file, so no issues there:

```{r track-pc-2}
my_other_url <- "http://ritsokiguess.site/datafiles/isocodes.csv"
codes <- read_csv(my_other_url)
codes
```

These are names of countries and abbreviations for them. The one called `ISO2` here looks like what we have in our running records data file (it is). 

We will use these later to identify the highest and lowest countries on the principal components.

Extra: each country has a two-letter and a three-letter code, as well as an identifying number. These come from the international agreement called [ISO 3166](https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes). The two-letter codes are often used as Internet domain names (for example, at the end of someone's email address or of a website based in that country), while you might see the three-letter codes identifying countries at the Olympic Games. Those are a bit more readable than the two-letter codes. According to the Wikipedia page linked above, the numbers are useful for countries that do not use the same alphabet as English; they still use the same numbers as the rest of the world, so the number codes can be matched to the name of the country in the local writing system. 

$\blacksquare$

(c) Run a principal components analysis (on the correlation matrix), and display the `summary` output.

Solution

The input to `princomp` requires just the quantitative columns of the dataframe. The obvious way to go is te first create this dataframe and save it:

```{r track-pc-3}
track %>% select(where(is.numeric)) -> track_num
track_num
```

An option for the `select` part is to recognize that the only column you *do not* need is the one called `country`:

```{r track-pc-4, eval=FALSE}
track %>% select(-country) -> track_num
```

Then you run the analysis:

```{r track-pc-5}
track.1 <- princomp(track_num, cor = TRUE)
```


Another option is to recognize that this is the only place you'll need the dataframe of quantitative columns, so the whole thing can be done in a pipeline without saving the thing I called `track_num`:

```{r track-pc-6, eval=FALSE}
track %>% 
  select(where(is.numeric)) %>% 
  princomp(cor = TRUE) -> track.1
```

We *do* need the output of the analysis again later (several times), so you *will* need to save that. 

The last step is to display its `summary`:

```{r track-pc-7}
summary(track.1)
```

Extra: the immediate thing to see from this is that the cumulative proportion of variance explained is already high (94%) for *two* components, so we would expect two components to be pretty good as a representation of the eight variables. We are about to draw a scree plot, which will tell us whether that is a sensible thing to conclude.^[Another way to see this is that the Proportion of Variance explained by each component, the second line of numbers, are all small after the second component, indicating that components 3 and on don't have much to say.]


$\blacksquare$

(a) Obtain a scree plot. What does this say about an appropriate number of components? Explain briefly. 

Solution

Once you have `ggbiplot` (the package) installed, getting the plot is simplicity itself:

```{r track-pc-8}
ggscreeplot(track.1)
```

To decide on an appropriate number of components, look for an elbow. There are two candidates: at 2, suggesting one component, and at 3, suggesting two components. I think either of these is a defensible answer, though (as it turns out later) we will see that two components gives more insight.^[That is to say, there is something useful to be had from including the second component as well.]

$\blacksquare$

(a) Explain briefly how the `summary` output is consistent with your conclusion from the scree plot.

Solution

In the `summary` output the cumulative proportion of variance explained is already high (83%) for one component and very high (94%) for two components, so we would expect one or two components to be pretty good as a representation of the eight variables.^[Another way to see this is that the Proportion of Variance explained by each component, the second line of numbers, are very small after the second component, indicating that components 3 and on, and maybe even component 2, don't have much to say.]

Tailor your wording of this according to whether you thought the scree plot was saying one or two components.

My take is that having two components is not hard to interpret, and so if there is value in having the second one, which I think there is, it is worth including. Or you could phrase this as saying, in your opinion (and mine too), that the second component is still "on the mountain", and so we want to include it as well. The third one is definitely on the scree (the scree plot is almost completely flat for 3 and on), so there is no value in including the third one, but the decision for you to make is whether to take one or two.

$\blacksquare$

(a) Interpret the first two principal components in terms of the original variables.

Solution

This is a matter of looking at the component `loadings`:

```{r track-pc-9}
track.1$loadings
```

Component 1 is easy: the loadings are all positive, and basically all the same size! So component 1 contains everything. What makes component 1 small is if all the running records are small (a country is "good at running"), and what makes it large is if all the records are large ("bad at running"). 

Component 2 is harder: the blank loading is "close to zero^[I think this means 'less than 0.1 in absolute value'.]". The large positive loadings are for 100m and 200m (sprinting), and there are large negative loadings for marathon, and, depending on where you draw the line, maybe 5000m and 10000m as well (distance running). This component is a contrast between sprinting and distance running. What makes a country come out low on this is to be low on 100m and 200m, and/or *high* on 5000m through marathon: that is, low means good at sprinting and/or bad at distance running. High on component 2 means *bad* at sprinting and/or *good* at distance running. 

Later, we do factor analysis on the same data set, and you'll see that things come out a good bit more clearly. 

Extra: if you wanted to interpret component 3, that would be a contrast between short sprints (100m and 200m) and longer sprints (400m and 800m^[It is a matter of taste whether you call the 800m race a long sprint or a short middle-distance race. Athletes who are good at 800m tend to be good at 1500m as well, and you would definitely call 1500m "middle distance".])

$\blacksquare$

(a) Make a biplot, labelling the points by their country abbreviations as in the original data file.

Solution

This is `ggbiplot` from the package of the same name. The input you need is (i) the output from running `princomp` earlier, and (ii) a column of country name abbreviations, taken most easily from the dataframe I called `track`:

```{r track-pc-10}
ggbiplot(track.1, labels = track$country)
```

$\blacksquare$

(a) Where on your biplot would you find countries that are: (i) good at running generally, (ii) bad at running generally, (iii) good at sprinting compared to distance running, (iv) good at distance running compared to sprinting?

Solution

(i) and (ii) relate to component 1. The arrows point mainly to the right, which means that high times are on the right. But high is *bad*. So the countries that are good at running are on the *left* (examples US and UK), and countries that are bad at running overall are on the *right* (examples CK and WS; we will see shortly which countries these are). (iii) and (iv) relate to component 2. The short-distance arrows point more up than down, so the long (bad) times will be at the top, and the long-distance arrows point more down than up, so the long (bad) times for these will be at the bottom. Hence the better-at-sprinting countries are at the bottom (examples DO, BM) and the better-at-distance countries are at the top (eg TR, PT).

$\blacksquare$

(a) Display the countries that are highest and lowest on components 1 and 2 with the full names of the countries.

Solution

There is a bit of preparatory work to do here. Let's do some setup so that we have everything we need to answer the four subparts fairly easily.

First, the component scores (this is rather longer than I would like you to hand in ever, but I want to show you the process):

```{r track-pc-11}
track.1$scores
```

The reason this is so long is that it is an R `matrix`, which will display all of itself, rather than a dataframe or `tibble`, which won't. So, at some stage, we will want to turn this into a `tibble` to use `tidyverse` tools to work with it. Also, we will need some indicator of country attached to these, and what we have is the `country` column in `track` that matches up to these (the two-letter country abbreviations). 
The problem with using something like `cbind` is that the country abbreviations are text and the scores are numbers. So `cbind` will turn all the scores into text, which we don't want. 

The base-R first way, uses `data.frame` to combine:

```{r track-pc-12}
data.frame(country = track$country, track.1$scores)
```

or you could turn the `matrix` into a `tibble` and then add the column of country abbreviations:

```{r track-pc-13}
track.1$scores %>% 
  as_tibble() %>% 
  bind_cols(country = track$country) %>% 
  select(country, Comp.1, Comp.2)
```

Either way is good. I went a bit further the second way, recognizing that the only component scores I need to keep are the first two.

Now we need to look up the country names. This is a `left_join` with the dataframe that I called `codes` earlier. This one will need a `by` because the column we want to look up by is called different names in the two places: `country` here and `ISO2` there:

```{r track-pc-14}
track.1$scores %>% 
  as_tibble() %>% 
  bind_cols(country = track$country) %>% 
  select(country, Comp.1, Comp.2) %>% 
  left_join(codes, by = c("country" = "ISO2"))
```

Now I just need the country names and the component scores, so I'll grab those and save what I have:

```{r track-pc-15}
track.1$scores %>% 
  as_tibble() %>% 
  bind_cols(country = track$country) %>% 
  select(country, Comp.1, Comp.2) %>% 
  left_join(codes, by = c("country" = "ISO2")) %>% 
  select(Country, Comp.1, Comp.2) -> scores
```

As ever, I don't need you to stop after each piece. Run the last pipeline, and tell me what you did. But absolutely *develop* it in steps, making sure that each stop is correct before moving on, so that if you then get an error, you know where the error is.

That was the hard part. Now we need to find the highest and lowest scores on each component, which is a matter of using `arrange` suitably:

Lowest on component 1:

```{r track-pc-16}
scores %>% arrange(Comp.1)
```

These are the best at running overall, probably about what you would guess if you know about running. Kenyan athletes appeared from nowhere in the 1970s; it turned out that they were used to running long distances at altitude, which gave them an edge when they raced (mostly) near sea level.

The worst overall:

```{r track-pc-17}
scores %>% arrange(desc(Comp.1))
```

So now we know that CK is the Cook Islands and WS is (Western) Samoa. The big sport in these two countries is not (evidently) running, but rugby.

Low on component 2:

```{r track-pc-18}
scores %>% arrange(Comp.2)
```

Countries that are better at sprinting than at distance running. Perhaps the most noticeable one there is Bermuda, a country that has produced some good sprinters for its size. The US does not have much of a history of distance running, but of course its sprinters are among the best in the world.

Finally, high on component 2:

```{r track-pc-19}
scores %>% arrange(desc(Comp.2))
```

I would pick out Portugal, Norway and Mexico as countries with a focus on distance running rather than sprinting. Kenya is on the next page.

Another way to tackle something like this is to work out how to get one answer, say lowest on component 1, do that first (it will be a longish pipeline with a `left_join` in it), run that, then copy-paste all of that code, modify, and run, three more times. The way I did it, though, is clearer (both for your reader and for future-you); in fact, it is in the same spirit as writing a function to do the hard stuff and then running the function four times. 

$\blacksquare$

(a) Make a plot of the (first two) component scores, plotting the country abbreviations, with the axes scaled suitably.

Solution

This will probably mean some reconstruction of what you did in the previous part:

```{r track-pc-20}
track.1$scores %>% 
  as_tibble() %>% 
  bind_cols(country = track$country) %>% 
  ggplot(aes(x = Comp.1, y = Comp.2, label = country)) +
  geom_text() + coord_fixed()
```

This should look like a compressed version of your biplot, but without the red arrows. Compressed is honest because the second component explains less of the variability than the first one does. 

If I had been thinking, I would have saved one of my intermediate steps from the previous part to use here. 
Another way you might think of is to load `ggrepel` and then do this:

```{r track-pc-21}
track.1$scores %>% 
  as_tibble() %>% 
  bind_cols(country = track$country) %>% 
  ggplot(aes(x = Comp.1, y = Comp.2, label = country)) +
  geom_point() + geom_text_repel() + coord_fixed()
```

This plots the points as points and then puts the abbreviation next to the point. In other circumstances this might be better, but you might find here that the points over on the left are too close together and there isn't enough room to put in the labels for all of them. The difference with my first plot is that the text is centred at the point, so the text is taking the place of the `geom_point` circle, and you are not using up so much plot real-estate each time.

$\blacksquare$

